const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ModelSelector-B-fXYzGj.js","assets/permissions-DQjjgS8V.js","assets/Main-iyJ1wi9k.js","assets/Main-PFH1wzVy.css","assets/client-BsbSyIlx.js","assets/ModelSelector-CD1qrI1T.css"])))=>i.map(i=>d[i]);
import{u as e,c as t,s as n,a as s,M as r,B as i,I as o,p as a,b as l,d as c,C as d,e as u,T as h,r as p,f as m,X as f,g,R as y,E as x,h as C,i as b,j as w,W as v,D as k,k as M,l as S,m as N,S as T,n as E,F as j,L as A,o as I,q as O,t as L,v as D,w as R,x as _,y as P,z as V,A as H,G as $,H as z,J as F,K as B,N as W,O as Z}from"./Main-iyJ1wi9k.js";import{r as U,j as q,g as J,S as G,s as K,R as Y,a as Q,b as X,c as ee,_ as te,d as ne,e as se,T as re,f as ie,P as oe,h as ae,i as le,k as ce,U as de,D as ue}from"./permissions-DQjjgS8V.js";import{b as he,g as pe,p as me,s as fe,t as ge,B as ye,a as xe,u as Ce,c as be,d as we,e as ve,f as ke,n as Me,r as Se,h as Ne,i as Te,j as Ee,k as je,l as Ae,m as Ie,o as Oe,q as Le,v as De,w as Re,x as _e,y as Pe,z as Ve,A as He,C as $e,D as ze,E as Fe,F as Be,G as We,H as Ze,I as Ue,J as qe}from"./mcpPermissions-njmGsNbg.js";import{u as Je,w as Ge,H as Ke,U as Ye,C as Qe,S as Xe,a as et,b as tt,T as nt,G as st,c as rt,n as it,I as ot,d as at,e as lt,f as ct,g as dt,h as ut,i as ht,j as pt,W as mt,k as ft,F as gt,l as yt,m as xt,o as Ct,p as bt,q as wt,r as vt,s as kt,t as Mt,v as St,x as Nt,M as Tt,y as Et,z as jt,A as At,B as It,D as Ot,E as Lt,J as Dt,K as Rt,L as _t,N as Pt,O as Vt,P as Ht,Q as $t,R as zt,V as Ft,X as Bt,Y as Wt,Z as Zt,_ as Ut,$ as qt,a0 as Jt,a1 as Gt,a2 as Kt,a3 as Yt,a4 as Qt,a5 as Xt,a6 as en,a7 as tn,a8 as nn,a9 as sn,aa as rn,ab as on,ac as an,ad as ln,ae as cn,af as dn,ag as un,ah as hn,ai as pn,aj as mn,ak as fn,al as gn,am as yn,an as xn,ao as Cn,ap as bn,aq as wn,ar as vn,as as kn,at as Mn,au as Sn,av as Nn,aw as Tn,ax as En,ay as jn,az as An,aA as In}from"./ModelSelector-B-fXYzGj.js";import{u as On,c as Ln,A as Dn,a as Rn}from"./client-BsbSyIlx.js";import{w as _n,g as Pn,S as Vn,P as Hn,i as $n,a as zn}from"./SentryService-JiT06VPa.js";import{L as Fn,X as Bn,m as Wn,u as Zn,a as Un}from"./useNotifications-CbXeQbHW.js";function qn({ref:n,children:s,parentClassName:r,innerClassName:i,pinToBottomConfig:o={disabled:!1,initialValue:!1},containerRef:a}){const l=U.useRef(a?.current||null),c=e(a,l),d=U.useRef(null),u=U.useRef(o.initialValue),h=U.useRef(!1),p=U.useRef(!1),m=U.useRef(null),f=U.useRef(0),g=U.useCallback(()=>l.current,[]),y=U.useCallback((e="auto",t)=>{if(!l.current)return;if(t?.onlyIfPinned&&!u.current)return;const{scrollHeight:n,scrollTop:s,clientHeight:r}=l.current;s>n-r||(p.current=!0,l.current.scrollTo({top:l.current.scrollHeight,behavior:e}),m.current&&clearTimeout(m.current),m.current=window.setTimeout(()=>{p.current=!1},0))},[]),x=U.useCallback(e=>{u.current=e},[]);return U.useImperativeHandle(n,()=>({getScrollContainer:g,scrollToBottom:y,setPinToBottom:x,innerRef:d}),[g,y,x]),U.useLayoutEffect(()=>{const e=l.current,t=d.current;if(!e||!t||o.disabled)return;const n=()=>{if(p.current)return;const{scrollHeight:t,scrollTop:n,clientHeight:s}=e,r=t-n-s,i=Math.floor(r)<8;h.current=i;const o=n<f.current;f.current=n,!i&&o&&(u.current=!1)},s=new ResizeObserver(()=>{u.current&&y()});return e.addEventListener("scroll",n),s.observe(t),s.observe(e),()=>{e.removeEventListener("scroll",n),s.disconnect(),m.current&&clearTimeout(m.current)}},[d,o.disabled,y]),q.jsx("div",{className:t("overflow-y-scroll overflow-x-hidden",r),ref:c,children:q.jsx("div",{className:t("relative w-full min-h-full",i),ref:d,children:s})})}void 0===globalThis.Buffer&&(globalThis.Buffer=he.Buffer);const Jn=({scrollRefs:e,autoScrollRef:t,messageCount:n,additionalBuffer:s=0,parentContainerRef:r,disablePinToTop:i=!1,disableInitialScrollToBottom:o=!1})=>{const a=U.useRef(n),l=U.useCallback(()=>{const t=e.lastAssistantMessage.current?.clientHeight||0,n=e.lastHumanMessage.current?.clientHeight||0,i=e.chatInput?.current?.clientHeight||0,o=e.extras.current?.clientHeight||0,a=r?.current?.clientHeight||window.innerHeight,l=s||62,c=Math.max(a-n-t-o-i-l,0);e.extraSpace.current&&(e.extraSpace.current.style.height=`${c}px`)},[e.lastAssistantMessage,e.lastHumanMessage,e.chatInput,e.extras,e.extraSpace,r,s]);return U.useLayoutEffect(()=>{a.current!==n&&(l(),i||t.current?.scrollToBottom("smooth")),a.current=n},[n,l,t,i]),U.useLayoutEffect(()=>{const t=new ResizeObserver(()=>{l()});return[e.lastAssistantMessage,e.lastHumanMessage,e.chatInput,e.extras].forEach(e=>{e?.current&&t.observe(e.current)}),window.addEventListener("resize",l),()=>{t.disconnect(),window.removeEventListener("resize",l)}},[e,l,n]),U.useLayoutEffect(()=>{o||t.current?.scrollToBottom("instant")},[t,o]),q.jsx("div",{ref:e.extraSpace,"aria-hidden":"true"})};function Gn({domainConfig:e,onPromptClick:t}){return q.jsxs("div",{className:"flex flex-col items-center justify-center h-full px-4 py-8",children:[q.jsx("div",{className:"w-12 h-12 rounded-xl border-[0.5px] border-border-300 bg-always-white shadow-sm mb-4 overflow-hidden",children:q.jsx("img",{src:e.logo_url,alt:"",className:"w-full h-full object-cover"})}),q.jsx("h2",{className:"font-ui-sm text-text-500 mb-[22px]",children:e.header_text}),q.jsx("div",{className:"flex flex-col items-center gap-2 w-full max-w-sm",children:e.prompts.map((e,n)=>q.jsx("button",{onClick:()=>t(e.prompt),className:"min-w-[75px] min-h-8 px-[14px] py-[3px] font-base text-text-100 border-[0.5px] border-border-300 bg-bg-000/30 hover:bg-bg-200 transition-colors text-center line-clamp-2 break-words",style:{borderRadius:"38px"},children:e.prompt_title},n))})]})}function Kn(e,t,n,s=[]){const r=U.useRef(null),i=U.useCallback(n,s);U.useEffect(()=>{if(void 0===e)return;const n=pe();return r.current=n.subscribe(e,t,i),()=>{r.current&&(n.unsubscribe(r.current),r.current=null)}},[e,t,i])}function Yn(e,t,n=["url","status"],s=[]){const r=U.useCallback((n,s)=>{n===e&&t(s)},[e,...s]);Kn(e,n,r,[r])}function Qn({lightImage:e,darkImage:t,title:n,subtitle:s}){const r=Je();return q.jsxs("div",{className:"flex flex-col items-center",children:[q.jsx("img",{src:r?t:e,alt:n,className:"w-[212px] h-[122px] rounded-[14px]"}),q.jsxs("div",{className:"mt-4 flex flex-col items-center gap-1 w-[188px]",children:[q.jsx("p",{className:"font-small-bold text-text-300 text-center",children:n}),q.jsx("p",{className:"font-small text-text-500 text-center",children:s})]})]})}const Xn={pin_extension:{maxDisplays:1,requiresGate:!1}},es=({children:e,onMount:t})=>(U.useEffect(()=>{t()},[t]),q.jsx(q.Fragment,{children:e}));function ts({tabId:e,onPromptClick:t}){const r=s(),[i,o]=U.useState(""),[a,l]=U.useState(null),c=(()=>{const{value:e}=n.useDynamicConfig("crochet_chips");return e||{}})(),d=((e,t)=>{const[n,s]=U.useState(!1),[r,i]=U.useState(!1);return U.useEffect(()=>{(async()=>{if(t)try{const n=Xn[e],r=(await J(G.TIP_DISPLAY_COUNTS)||{})[e]||[],o=r.includes(String(t)),a=r.length>=n.maxDisplays;i(a),s(!o&&!a)}catch(n){s(!1),i(!1)}else s(!1)})()},[e,t]),{canShow:n,limitReached:r,markAsShown:U.useCallback(async()=>{if(t)try{const n=await J(G.TIP_DISPLAY_COUNTS)||{},s=n[e]||[];s.includes(String(t))||(s.push(String(t)),n[e]=s,await K(G.TIP_DISPLAY_COUNTS,n))}catch(n){}},[e,t])}})("pin_extension",e);U.useEffect(()=>{(async()=>{const e=await async function(){try{return!(!chrome.action||!chrome.action.getUserSettings)&&((await chrome.action.getUserSettings()).isOnToolbar??!1)}catch(e){return!1}}();l(e)})()},[]);const u=U.useCallback(e=>{if(e.url)try{const t=new URL(e.url).hostname.replace(/^www\./,"");o(t)}catch(t){o("")}else o("")},[]);U.useEffect(()=>{e&&chrome.tabs.get(e).then(u).catch(e=>{o("")})},[e,u]),Kn(e,["url"],(t,n,s)=>{t===e&&n.url&&s&&u(s)},[e]);const h=c[i];return h?q.jsx(Gn,{domainConfig:h,onPromptClick:t}):null===a?null:!a&&d.canShow?q.jsx(es,{onMount:d.markAsShown,children:q.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:q.jsx(Qn,{lightImage:"/assets/extension-light-min-CwWd0kAK.svg",darkImage:"/assets/extension-dark-min-Ctxo0Z8w.svg",title:r.formatMessage({defaultMessage:"Pin Claude for quick access",id:"9qJKQKXInl"}),subtitle:r.formatMessage({defaultMessage:"Click the pin icon in the top right corner of the extension window",id:"PqHH2BNESm"})})})}):null}const ns=()=>q.jsxs("div",{className:"flex items-center gap-2 py-2 my-2",children:[q.jsx("div",{className:"flex-1 h-[0.5px] bg-border-300"}),q.jsx("div",{className:"text-xs text-text-400 px-2 bg-bg-100",children:q.jsx(r,{defaultMessage:"Conversation compacted",id:"iTAs3tpllt"})}),q.jsx("div",{className:"flex-1 h-[0.5px] bg-border-300"})]});function ss({isDarkMode:e,text:t}){return q.jsxs("span",{className:"text-sm italic font-claude-response relative inline-block mb-1",style:{color:"transparent",background:e?"linear-gradient(90deg, #faf9f5 0%, #faf9f5 35%, #808080 50%, #faf9f5 65%, #faf9f5 100%)":"linear-gradient(90deg, #141413 0%, #141413 35%, #888888 50%, #141413 65%, #141413 100%)",backgroundSize:"200% 100%",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",animation:"shimmerSweep 2.25s ease-in-out infinite"},children:[q.jsx("style",{dangerouslySetInnerHTML:{__html:"\n  @keyframes shimmerSweep {\n    0% { background-position: 200% 0; }\n    100% { background-position: -200% 0; }\n  }\n"}}),t]})}function rs({error:e,tabId:t,title:n,onRetry:o}){const a=s(),[l,c]=U.useState(null),[d,u]=U.useState(!1),h=n??a.formatMessage({defaultMessage:"Error",id:"KN7zKn8z4F"}),p=e?.includes("Cannot access a chrome-extension:// URL of different extension"),m=e?.toLowerCase().includes("connection error")||e?.toLowerCase().includes("network error")||e?.toLowerCase().includes("failed to fetch");return U.useEffect(()=>{p&&t&&!d&&(async()=>{try{u(!0);const e=await async function(e){try{const t=await chrome.scripting.executeScript({target:{tabId:e},func:()=>{try{const e=document.documentElement.outerHTML.toLowerCase(),t=[{name:"LastPass",patterns:["lastpass","lpform","data-lastpass"]},{name:"Loom",patterns:["loom-","loom.com"]}];for(const n of t)for(const t of n.patterns)if(e.includes(t))return n.name;return null}catch{return null}}});return t&&0!==t.length&&t[0].result?t[0].result:null}catch{return null}}(t);e&&c(e)}catch{}finally{u(!1)}})()},[p,t,d]),e?q.jsx("div",{className:"p-4 bg-danger-900 border border-danger-200 rounded-lg",children:q.jsxs("div",{className:"flex items-start",children:[q.jsx("svg",{className:"w-5 h-5 text-danger-200 mt-0.5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:q.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),q.jsxs("div",{className:"flex-1 min-w-0",children:[q.jsx("h3",{className:"font-base-bold text-danger-000",children:h}),q.jsx("p",{className:"font-base-sm text-danger-000 mt-1 break-words whitespace-pre-wrap",children:p?l?q.jsx(r,{defaultMessage:"Another extension you're using is preventing Claude in Chrome from operating. Turn off extensions such as {extensionName} to use Claude in your browser.",id:"6zfn3n4+te",values:{extensionName:l}}):q.jsx(r,{defaultMessage:"Another extension you're using is preventing Claude in Chrome from operating.",id:"a7x0CkSo6z"}):e}),m&&o&&q.jsx(i,{onClick:o,variant:"secondary",size:"sm",className:"mt-3",children:q.jsx(r,{defaultMessage:"Retry",id:"62nsdyMyIO"})})]})]})}):null}const is=e=>q.jsx(o,{...e,children:q.jsx("path",{d:"M10 2.5C14.1421 2.5 17.5 5.85787 17.5 10C17.5 14.1421 14.1421 17.5 10 17.5C5.85786 17.5 2.5 14.1421 2.5 10C2.5 5.85787 5.85786 2.5 10 2.5ZM10 3.5C6.41015 3.5 3.5 6.41015 3.5 10C3.5 13.5898 6.41015 16.5 10 16.5C13.5899 16.5 16.5 13.5898 16.5 10C16.5 6.41015 13.5899 3.5 10 3.5ZM10 6.5C10.2415 6.50008 10.4436 6.67171 10.4902 6.89941L10.5 7V11.792L12.1455 10.1465C12.3406 9.95139 12.6572 9.95174 12.8525 10.1465C13.0478 10.3417 13.0478 10.6583 12.8525 10.8535L10.3535 13.3535C10.1827 13.5243 9.91865 13.5459 9.72461 13.418L9.64648 13.3535L7.14648 10.8535C6.95122 10.6583 6.95123 10.3417 7.14648 10.1465C7.34174 9.95122 7.65825 9.95123 7.85352 10.1465L9.5 11.793V7L9.50977 6.89941C9.55628 6.6715 9.75836 6.50008 10 6.5Z"})}),as=e=>q.jsx(o,{...e,children:q.jsx("path",{d:"M4.6465 7.14649C4.84175 6.95124 5.15826 6.95127 5.35353 7.14649C5.54879 7.34175 5.54879 7.65826 5.35353 7.85352L3.70705 9.50001H8.50002L8.6006 9.50977C8.82856 9.55625 8.99993 9.75834 9.00002 10C8.99991 10.2413 8.82907 10.4434 8.60158 10.4902L8.50002 10.5H3.70705L5.35353 12.1455C5.54865 12.3406 5.54835 12.6572 5.35353 12.8525C5.15827 13.0478 4.84176 13.0478 4.6465 12.8525L2.1465 10.3535C1.97577 10.1827 1.95409 9.91864 2.08204 9.72462L2.1465 9.64649L4.6465 7.14649ZM14.6465 7.14649C14.8418 6.95123 15.1583 6.95123 15.3535 7.14649L17.8535 9.64649L17.918 9.72462C18.0459 9.91866 18.0243 10.1827 17.8535 10.3535L15.3535 12.8525C15.1583 13.0478 14.8418 13.0478 14.6465 12.8525C14.4517 12.6572 14.4514 12.3406 14.6465 12.1455L16.293 10.5H11.5L11.3994 10.4902C11.1717 10.4436 11.0001 10.2415 11 10C11.0001 9.75846 11.1716 9.55736 11.3994 9.51075L11.5 9.50001H16.293L14.6465 7.85352C14.4513 7.65829 14.4513 7.34176 14.6465 7.14649Z"})}),ls=e=>q.jsx(o,{...e,children:q.jsx("path",{d:"M10 2.5C14.1421 2.5 17.5 5.85786 17.5 10C17.5 14.1421 14.1421 17.5 10 17.5C5.85786 17.5 2.5 14.1421 2.5 10C2.5 5.85786 5.85786 2.5 10 2.5ZM10 3.5C6.41015 3.5 3.5 6.41015 3.5 10C3.5 13.5899 6.41015 16.5 10 16.5C13.5899 16.5 16.5 13.5899 16.5 10C16.5 6.41015 13.5899 3.5 10 3.5ZM9.64648 6.64648C9.81727 6.47572 10.0813 6.45407 10.2754 6.58203L10.3535 6.64648L12.8535 9.14648C13.0488 9.34174 13.0488 9.65825 12.8535 9.85352C12.6583 10.0488 12.3417 10.0488 12.1465 9.85352L10.5 8.20703V13L10.4902 13.1006C10.4437 13.3285 10.2416 13.4999 10 13.5C9.75851 13.4999 9.55644 13.3283 9.50977 13.1006L9.5 13V8.20703L7.85449 9.85352C7.6594 10.0486 7.34276 10.0483 7.14746 9.85352C6.9522 9.65825 6.9522 9.34175 7.14746 9.14648L9.64648 6.64648Z"})}),cs=e=>q.jsx(o,{...e,children:q.jsx("path",{d:"M16.1338 6.16015C16.3217 5.95783 16.6375 5.94599 16.8399 6.13378C17.0421 6.32166 17.054 6.6375 16.8662 6.83984L10.3662 13.8398L10.2891 13.9082C10.2053 13.9675 10.1043 14 9.99999 14C9.86101 14 9.72836 13.9417 9.63377 13.8398L3.13374 6.83984L3.07221 6.75976C2.95129 6.56111 2.98312 6.29824 3.16011 6.13378C3.33708 5.96954 3.60085 5.95776 3.78999 6.09277L3.86616 6.16015L9.99999 12.7666L16.1338 6.16015Z"})}),ds=e=>q.jsx(o,{...e,children:q.jsx("path",{d:"M6.13378 3.16011C6.29824 2.98312 6.5611 2.95129 6.75976 3.07221L6.83984 3.13374L13.8398 9.63377C13.9417 9.72836 14 9.86101 14 9.99999C14 10.1043 13.9675 10.2053 13.9082 10.289L13.8398 10.3662L6.83984 16.8662C6.6375 17.054 6.32166 17.0421 6.13378 16.8399C5.94599 16.6375 5.95783 16.3217 6.16015 16.1338L12.7666 9.99999L6.16015 3.86616L6.09277 3.78999C5.95776 3.60085 5.96954 3.33709 6.13378 3.16011Z"})}),us=e=>q.jsx(o,{...e,children:q.jsx("path",{d:"M10 2.5C14.1421 2.5 17.5 5.85786 17.5 10C17.5 14.1421 14.1421 17.5 10 17.5H3C2.79779 17.5 2.61549 17.3782 2.53809 17.1914C2.4607 17.0046 2.50349 16.7895 2.64648 16.6465L4.35547 14.9365C3.20124 13.6175 2.5 11.8906 2.5 10C2.5 5.85786 5.85786 2.5 10 2.5ZM10 3.5C6.41015 3.5 3.5 6.41015 3.5 10C3.5 11.7952 4.22659 13.4199 5.40332 14.5967L5.46582 14.6729C5.52017 14.7544 5.5498 14.8508 5.5498 14.9502C5.5498 15.0828 5.49709 15.2099 5.40332 15.3037L4.20703 16.5H10C13.5899 16.5 16.5 13.5899 16.5 10C16.5 6.41015 13.5899 3.5 10 3.5ZM13.29 9.30371C13.3986 9.05001 13.6925 8.93174 13.9463 9.04004C14.2 9.14863 14.3183 9.44253 14.21 9.69629C13.8506 10.536 13.1645 11.25 12.25 11.25C11.6372 11.25 11.128 10.9289 10.75 10.4648C10.372 10.9289 9.86276 11.25 9.25 11.25C8.63724 11.25 8.12801 10.9289 7.75 10.4648C7.37198 10.9289 6.86276 11.25 6.25 11.25C5.97386 11.25 5.75 11.0261 5.75 10.75C5.75 10.4739 5.97386 10.25 6.25 10.25C6.58764 10.25 7.00448 9.97056 7.29004 9.30371L7.32422 9.2373C7.41431 9.09121 7.5749 9 7.75 9C7.9501 9 8.13123 9.11975 8.20996 9.30371L8.32227 9.53516C8.59804 10.0359 8.95442 10.25 9.25 10.25C9.58764 10.25 10.0045 9.97056 10.29 9.30371L10.3242 9.2373C10.4143 9.09121 10.5749 9 10.75 9C10.9501 9 11.1312 9.11975 11.21 9.30371L11.3223 9.53516C11.598 10.0359 11.9544 10.25 12.25 10.25C12.5876 10.25 13.0045 9.97056 13.29 9.30371Z"})}),hs=e=>q.jsx(o,{...e,children:q.jsx("path",{d:"M11.6318 4.01757C11.898 4.09032 12.055 4.36555 11.9824 4.63183L8.98242 15.6318C8.90966 15.8981 8.63449 16.0551 8.36816 15.9824C8.10193 15.9097 7.94495 15.6345 8.01758 15.3682L11.0176 4.36816C11.0904 4.102 11.3656 3.94497 11.6318 4.01757ZM13.124 6.17089C13.3059 5.96325 13.6213 5.9423 13.8291 6.12402L17.8291 9.62402L17.9014 9.70215C17.9647 9.78754 18 9.89182 18 10C18 10.1441 17.9375 10.281 17.8291 10.376L13.8291 13.876L13.7471 13.9346C13.5449 14.0498 13.2833 14.011 13.124 13.8291C12.9649 13.6472 12.9606 13.3824 13.1016 13.1973L13.1709 13.124L16.7412 10L13.1709 6.87597C12.9632 6.69411 12.9422 6.37866 13.124 6.17089ZM6.25293 6.06542C6.45509 5.95025 6.71675 5.98908 6.87598 6.17089C7.03513 6.35279 7.03933 6.6176 6.89844 6.80273L6.8291 6.87597L3.25879 10L6.8291 13.124C7.03682 13.3059 7.05771 13.6213 6.87598 13.8291C6.69413 14.0369 6.37869 14.0578 6.1709 13.876L2.1709 10.376L2.09863 10.2979C2.03528 10.2124 2 10.1082 2 10C2.00005 9.85591 2.06247 9.71893 2.1709 9.62402L6.1709 6.12402L6.25293 6.06542Z"})}),ps=e=>q.jsx(o,{...e,children:q.jsx("path",{d:"M13.5 16C13.7761 16 14 16.2239 14 16.5C14 16.7761 13.7761 17 13.5 17H6.5C6.22386 17 6 16.7761 6 16.5C6 16.2239 6.22386 16 6.5 16H13.5ZM16.5 4C17.3284 4 18 4.67157 18 5.5V13.5C18 14.3284 17.3284 15 16.5 15H3.5C2.67157 15 2 14.3284 2 13.5V5.5C2 4.67157 2.67157 4 3.5 4H16.5ZM3.5 5C3.22386 5 3 5.22386 3 5.5V13.5C3 13.7761 3.22386 14 3.5 14H16.5C16.7761 14 17 13.7761 17 13.5V5.5C17 5.22386 16.7761 5 16.5 5H3.5Z"})}),ms=e=>q.jsx(o,{...e,children:q.jsx("path",{d:"M16.5 13C16.7761 13 17 13.2239 17 13.5V15.5C17 16.3284 16.3284 17 15.5 17H4.5C3.67157 17 3 16.3284 3 15.5V13.5C3 13.2239 3.22386 13 3.5 13C3.77614 13 4 13.2239 4 13.5V15.5C4 15.7761 4.22386 16 4.5 16H15.5C15.7761 16 16 15.7761 16 15.5V13.5C16 13.2239 16.2239 13 16.5 13ZM10 3C10.2761 3 10.5 3.22386 10.5 3.5V12.1855L13.626 8.66797C13.8094 8.46166 14.1256 8.44275 14.332 8.62598C14.5383 8.80936 14.5573 9.12563 14.374 9.33203L10.374 13.832L10.2949 13.9033C10.21 13.9654 10.107 14 10 14C9.85718 14 9.72086 13.9388 9.62598 13.832L5.62598 9.33203L5.56738 9.25C5.45079 9.04872 5.48735 8.78653 5.66797 8.62598C5.84854 8.46567 6.1127 8.46039 6.29883 8.59961L6.37402 8.66797L9.5 12.1855V3.5C9.5 3.22386 9.72386 3 10 3Z"})}),fs=e=>q.jsx(o,{...e,children:q.jsx("path",{d:"M10 4C14.0285 4 16.6432 7.30578 17.6602 8.86621L17.7402 8.99902C18.0858 9.62459 18.0858 10.3754 17.7402 11.001L17.6602 11.1338C16.6432 12.6942 14.0285 16 10 16C6.22298 16 3.68865 13.0942 2.54883 11.4453L2.33985 11.1338C1.88802 10.4404 1.88802 9.55955 2.33985 8.86621L2.54883 8.55469C3.68865 6.90581 6.22298 4 10 4ZM10 5C6.74739 5 4.47588 7.53 3.38086 9.11035L3.17774 9.41211C2.94217 9.77359 2.94217 10.2264 3.17774 10.5879L3.38086 10.8896C4.47588 12.47 6.74739 15 10 15C13.4691 15 15.8223 12.1222 16.8223 10.5879L16.8994 10.4482C17.0321 10.1621 17.0321 9.83791 16.8994 9.55176L16.8223 9.41211C15.8223 7.87782 13.4691 5 10 5ZM10 7C11.6569 7 13 8.34315 13 10C13 11.6569 11.6569 13 10 13C8.34315 13 7 11.6569 7 10C7 8.34315 8.34315 7 10 7ZM10 8C8.89543 8 8 8.89543 8 10C8 11.1046 8.89543 12 10 12C11.1046 12 12 11.1046 12 10C12 8.89543 11.1046 8 10 8Z"})}),gs=e=>q.jsx(o,{...e,children:q.jsx("path",{d:"M16.5 4C17.3284 4 18 4.67157 18 5.5V14.5C18 15.3284 17.3284 16 16.5 16H3.5C2.67157 16 2 15.3284 2 14.5V5.5C2 4.67157 2.67157 4 3.5 4H16.5ZM3.5 5C3.22386 5 3 5.22386 3 5.5V14.5C3 14.7761 3.22386 15 3.5 15H16.5C16.7761 15 17 14.7761 17 14.5V5.5C17 5.22386 16.7761 5 16.5 5H3.5ZM12.5 12C12.7761 12 13 12.2239 13 12.5C13 12.7761 12.7761 13 12.5 13H7.5C7.22386 13 7 12.7761 7 12.5C7 12.2239 7.22386 12 7.5 12H12.5ZM6.25 9.5C6.66421 9.5 7 9.83579 7 10.25C7 10.6642 6.66421 11 6.25 11C5.83579 11 5.5 10.6642 5.5 10.25C5.5 9.83579 5.83579 9.5 6.25 9.5ZM8.75 9.5C9.16421 9.5 9.5 9.83579 9.5 10.25C9.5 10.6642 9.16421 11 8.75 11C8.33579 11 8 10.6642 8 10.25C8 9.83579 8.33579 9.5 8.75 9.5ZM11.25 9.5C11.6642 9.5 12 9.83579 12 10.25C12 10.6642 11.6642 11 11.25 11C10.8358 11 10.5 10.6642 10.5 10.25C10.5 9.83579 10.8358 9.5 11.25 9.5ZM13.75 9.5C14.1642 9.5 14.5 9.83579 14.5 10.25C14.5 10.6642 14.1642 11 13.75 11C13.3358 11 13 10.6642 13 10.25C13 9.83579 13.3358 9.5 13.75 9.5ZM6.25 7C6.66421 7 7 7.33579 7 7.75C7 8.16421 6.66421 8.5 6.25 8.5C5.83579 8.5 5.5 8.16421 5.5 7.75C5.5 7.33579 5.83579 7 6.25 7ZM8.75 7C9.16421 7 9.5 7.33579 9.5 7.75C9.5 8.16421 9.16421 8.5 8.75 8.5C8.33579 8.5 8 8.16421 8 7.75C8 7.33579 8.33579 7 8.75 7ZM11.25 7C11.6642 7 12 7.33579 12 7.75C12 8.16421 11.6642 8.5 11.25 8.5C10.8358 8.5 10.5 8.16421 10.5 7.75C10.5 7.33579 10.8358 7 11.25 7ZM13.75 7C14.1642 7 14.5 7.33579 14.5 7.75C14.5 8.16421 14.1642 8.5 13.75 8.5C13.3358 8.5 13 8.16421 13 7.75C13 7.33579 13.3358 7 13.75 7Z"})}),ys=e=>q.jsx(o,{...e,children:q.jsx("path",{d:"M14.5 2C15.3284 2 16 2.67157 16 3.5V16.5C16 17.3284 15.3284 18 14.5 18H6.375C5.06332 18 4 16.9367 4 15.625V4.375C4 3.06332 5.06332 2 6.375 2H14.5ZM15 13.9121C14.8434 13.9676 14.6756 14 14.5 14H6.375C5.61561 14 5 14.6156 5 15.375V15.625C5 16.3844 5.61561 17 6.375 17H14.5C14.7761 17 15 16.7761 15 16.5V13.9121ZM6.375 3C5.61561 3 5 3.61561 5 4.375V13.4395C5.38814 13.1632 5.86232 13 6.375 13H14.5C14.7761 13 15 12.7761 15 12.5V3.5C15 3.22386 14.7761 3 14.5 3H6.375ZM11.5 5C12.3284 5 13 5.67157 13 6.5V11C13 11.1921 12.8898 11.3669 12.7168 11.4502C12.5436 11.5335 12.3376 11.5107 12.1875 11.3906L10 9.64062L7.8125 11.3906C7.66242 11.5107 7.45644 11.5335 7.2832 11.4502C7.11017 11.3669 7 11.1921 7 11V6.5C7 5.67157 7.67157 5 8.5 5H11.5ZM8.5 6C8.22386 6 8 6.22386 8 6.5V9.95898L9.6875 8.60938L9.75977 8.56152C9.93421 8.46584 10.1528 8.48162 10.3125 8.60938L12 9.95898V6.5C12 6.22386 11.7761 6 11.5 6H8.5Z"})}),xs=e=>q.jsx(o,{...e,children:q.jsx("path",{d:"M10 3C12.7614 3 15 5.23858 15 8V9.81543C15 10.5361 15.4709 11.2387 16.1465 11.7832L16.3115 11.9209C17.1376 12.6382 18 13.7991 18 15.5C18 15.7761 17.7761 16 17.5 16H12.4502C12.2186 17.1411 11.2095 18 10 18C8.79051 18 7.78142 17.1411 7.5498 16H2.5C2.22386 16 2 15.7761 2 15.5C2 13.6856 2.98177 12.4857 3.85352 11.7832L4.09668 11.5723C4.63959 11.0632 5 10.4461 5 9.81543V8C5 5.23858 7.23858 3 10 3ZM8.58691 16C8.79297 16.5823 9.34707 17 10 17C10.6529 17 11.207 16.5823 11.4131 16H8.58691ZM10 4C7.79086 4 6 5.79086 6 8V9.81543C6 10.826 5.43779 11.6866 4.77148 12.3096L4.48047 12.5615C3.83983 13.0778 3.18409 13.8648 3.03223 15H16.9678C16.8376 14.0269 16.3367 13.31 15.793 12.7998L15.5195 12.5615C14.7347 11.9291 14 10.9704 14 9.81543V8C14 5.79086 12.2091 4 10 4Z"})}),Cs=e=>q.jsx(o,{...e,children:q.jsx("path",{d:"M6 5.34256C6.00015 4.15259 7.31959 3.43636 8.31739 4.08474L15.4825 8.74199L15.6426 8.86114C16.3892 9.49703 16.3356 10.703 15.4825 11.2576L8.31739 15.9149C7.31952 16.5634 6 15.8472 6 14.6571V5.34256ZM7.77247 4.92361C7.43991 4.70754 7.00016 4.946 7 5.34256V14.6571C7 15.0538 7.43984 15.2922 7.77247 15.076L14.9375 10.4188C15.2218 10.2339 15.2401 9.83187 14.9912 9.61993L14.9375 9.58087L7.77247 4.92361Z"})}),bs=e=>q.jsx(o,{...e,children:q.jsx("path",{d:"M8 14C8 14.5523 8.44772 15 9 15H9.5C9.77614 15 10 15.2239 10 15.5C10 15.7761 9.77614 16 9.5 16H9C8.40169 16 7.86651 15.7357 7.5 15.3193C7.13349 15.7357 6.59831 16 6 16H5.5C5.22386 16 5 15.7761 5 15.5C5 15.2239 5.22386 15 5.5 15H6C6.55228 15 7 14.5523 7 14V13.5L7.00098 6.5H7V6C7 5.44772 6.55228 5 6 5H5.5C5.22386 5 5 4.77614 5 4.5C5 4.22386 5.22386 4 5.5 4H6C6.59805 4 7.1335 4.26363 7.5 4.67969C7.8665 4.26363 8.40195 4 9 4H9.5C9.77614 4 10 4.22386 10 4.5C10 4.77614 9.77614 5 9.5 5H9C8.44772 5 8 5.44772 8 6V6.5H8.00098L8 13.5V14ZM5.5 7C5.77614 7 6 7.22386 6 7.5C6 7.77614 5.77614 8 5.5 8H3.5C3.22386 8 3 8.22386 3 8.5V11.5C3 11.7761 3.22386 12 3.5 12H5.5C5.77614 12 6 12.2239 6 12.5C6 12.7761 5.77614 13 5.5 13H3.5C2.67157 13 2 12.3284 2 11.5V8.5C2 7.67157 2.67157 7 3.5 7H5.5ZM16.5 7C17.3284 7 18 7.67157 18 8.5V11.5C18 12.3284 17.3284 13 16.5 13H9.5C9.22386 13 9 12.7761 9 12.5C9 12.2239 9.22386 12 9.5 12H16.5C16.7761 12 17 11.7761 17 11.5V8.5C17 8.22386 16.7761 8 16.5 8H9.5C9.22386 8 9 7.77614 9 7.5C9 7.22386 9.22386 7 9.5 7H16.5Z"})}),ws=e=>q.jsx(o,{...e,children:q.jsx("path",{d:"M12.6699 3C14.2586 3 15.6148 4.14871 15.876 5.71582L16.5566 9.79785C16.836 11.4741 15.5431 13 13.8438 13H11.6094L12.0117 15.0098C12.3211 16.5567 11.1381 17.9999 9.56055 18H9.32324C8.97898 18 8.66235 17.8236 8.48047 17.5391L8.41113 17.4102L6.89746 14.0459C6.59327 13.3699 6.02983 12.847 5.33789 12.5928L5.19824 12.5459L4.05859 12.1953C3.4294 12.0016 3.00013 11.42 3 10.7617V4.5C3 3.67157 3.67157 3 4.5 3H12.6699ZM4.5 4C4.22386 4 4 4.22386 4 4.5V10.7617C4.00013 10.981 4.14305 11.1746 4.35254 11.2393L5.49219 11.5898L5.68359 11.6543C6.62674 12.001 7.39486 12.7133 7.80957 13.6348L9.32324 17H9.56055C10.507 16.9999 11.2167 16.1341 11.0312 15.2061L10.5098 12.5977C10.4805 12.4509 10.5184 12.2984 10.6133 12.1826C10.7083 12.0669 10.8503 12 11 12H13.8438C14.9251 12 15.7481 11.0286 15.5703 9.96191L14.8896 5.87988C14.7087 4.79508 13.7697 4 12.6699 4H4.5Z"})}),vs=e=>q.jsx(o,{...e,children:q.jsx("path",{d:"M9.56055 2C11.1381 2.00009 12.3211 3.44332 12.0117 4.99023L11.6094 7H13.8438C15.5431 7 16.836 8.52594 16.5566 10.2021L15.876 14.2842C15.6148 15.8513 14.2586 17 12.6699 17H4.5C3.67157 17 3 16.3284 3 15.5V9.23828C3.00013 8.57996 3.4294 7.99838 4.05859 7.80469L5.19824 7.4541L5.33789 7.40723C6.02983 7.15302 6.59327 6.63008 6.89746 5.9541L8.41113 2.58984L8.48047 2.46094C8.66235 2.17643 8.97898 2.00002 9.32324 2H9.56055ZM7.80957 6.36523C7.39486 7.2867 6.62674 7.99897 5.68359 8.3457L5.49219 8.41016L4.35254 8.76074C4.14305 8.82539 4.00013 9.01904 4 9.23828V15.5C4 15.7761 4.22386 16 4.5 16H12.6699C13.7697 16 14.7087 15.2049 14.8896 14.1201L15.5703 10.0381C15.7481 8.97141 14.9251 8 13.8438 8H11C10.8503 8 10.7083 7.9331 10.6133 7.81738C10.5184 7.70164 10.4805 7.54912 10.5098 7.40234L11.0312 4.79395C11.2167 3.86589 10.507 3.00009 9.56055 3H9.32324L7.80957 6.36523Z"})}),ks=e=>q.jsx(o,{...e,children:q.jsx("path",{d:"M11.5 2C11.7761 2 12 2.22386 12 2.5C12 2.77614 11.7761 3 11.5 3H10.5V4.01953C12.0566 4.12942 13.4719 4.74753 14.582 5.70996L15.3037 4.98926C15.499 4.79436 15.8156 4.79412 16.0107 4.98926C16.2059 5.1844 16.2056 5.501 16.0107 5.69629L15.2891 6.41699C16.3542 7.64511 17 9.24674 17 11C17 14.866 13.866 18 10 18C6.13401 18 3 14.866 3 11C3 7.30217 5.86743 4.27597 9.5 4.01953V3H8.5C8.22386 3 8 2.77614 8 2.5C8 2.22386 8.22386 2 8.5 2H11.5ZM10 5C6.68629 5 4 7.68629 4 11C4 14.3137 6.68629 17 10 17C13.3137 17 16 14.3137 16 11C16 7.68629 13.3137 5 10 5ZM7.17188 8.17188C7.29007 8.05368 7.45914 8.0024 7.62305 8.03516H7.62695C7.62846 8.03541 7.63045 8.03566 7.63281 8.03613C7.63847 8.03729 7.64687 8.03982 7.65723 8.04199C7.67822 8.04638 7.70875 8.05315 7.74707 8.06152C7.82438 8.07842 7.93535 8.10307 8.07031 8.13574C8.34023 8.20109 8.7112 8.29808 9.11133 8.42383C9.51008 8.54915 9.94691 8.70603 10.3467 8.89258C10.7387 9.07552 11.132 9.30384 11.4141 9.58594C12.1951 10.367 12.1951 11.633 11.4141 12.4141C10.633 13.1951 9.36699 13.1951 8.58594 12.4141C8.30384 12.132 8.07552 11.7387 7.89258 11.3467C7.70603 10.9469 7.54915 10.5101 7.42383 10.1113C7.29808 9.7112 7.20109 9.34023 7.13574 9.07031C7.10307 8.93535 7.07842 8.82438 7.06152 8.74707C7.05315 8.70876 7.04638 8.67822 7.04199 8.65723C7.03982 8.64687 7.03729 8.63847 7.03613 8.63281C7.03566 8.63045 7.03541 8.62846 7.03516 8.62695V8.62305L7.02637 8.56055C7.01616 8.41702 7.06868 8.27507 7.17188 8.17188ZM8.37793 9.81152C8.49565 10.1861 8.63741 10.5779 8.79883 10.9238C8.96389 11.2775 9.13316 11.5472 9.29297 11.707C9.68349 12.0975 10.3165 12.0975 10.707 11.707C11.0975 11.3165 11.0975 10.6835 10.707 10.293C10.5472 10.1332 10.2775 9.96389 9.92383 9.79883C9.57792 9.63741 9.18607 9.49565 8.81152 9.37793C8.59583 9.31014 8.38783 9.25179 8.20215 9.20215C8.25179 9.38783 8.31014 9.59583 8.37793 9.81152Z"})}),Ms=e=>q.jsx(o,{...e,children:q.jsx("path",{d:"M16.5 13C16.7761 13 17 13.2239 17 13.5V15.5C17 16.3284 16.3284 17 15.5 17H4.5C3.67157 17 3 16.3284 3 15.5V13.5C3 13.2239 3.22386 13 3.5 13C3.77614 13 4 13.2239 4 13.5V15.5C4 15.7761 4.22386 16 4.5 16H15.5C15.7761 16 16 15.7761 16 15.5V13.5C16 13.2239 16.2239 13 16.5 13ZM10 3C10.1428 3 10.2791 3.06122 10.374 3.16797L14.374 7.66797L14.4326 7.75C14.5492 7.95128 14.5127 8.21347 14.332 8.37402C14.1515 8.53433 13.8873 8.53961 13.7012 8.40039L13.626 8.33203L10.5 4.81445V13.5C10.5 13.7761 10.2761 14 10 14C9.72386 14 9.5 13.7761 9.5 13.5V4.81445L6.37402 8.33203C6.19064 8.53834 5.87437 8.55725 5.66797 8.37402C5.46166 8.19064 5.44275 7.87437 5.62598 7.66797L9.62598 3.16797L9.70508 3.09668C9.79001 3.03458 9.89298 3 10 3Z"})}),Ss=e=>q.jsx(o,{...e,children:q.jsx("path",{d:"M8.5 3C8.77614 3 9 3.22386 9 3.5V16.5C9 16.7761 8.77614 17 8.5 17C8.22386 17 8 16.7761 8 16.5V3.5C8 3.22386 8.22386 3 8.5 3ZM14.5 4C14.7761 4 15 4.22386 15 4.5V15.5C15 15.7761 14.7761 16 14.5 16C14.2239 16 14 15.7761 14 15.5V4.5C14 4.22386 14.2239 4 14.5 4ZM5.5 6C5.77614 6 6 6.22386 6 6.5V13.5C6 13.7761 5.77614 14 5.5 14C5.22386 14 5 13.7761 5 13.5V6.5C5 6.22386 5.22386 6 5.5 6ZM11.5 6C11.7761 6 12 6.22386 12 6.5V13.5C12 13.7761 11.7761 14 11.5 14C11.2239 14 11 13.7761 11 13.5V6.5C11 6.22386 11.2239 6 11.5 6ZM2.5 8C2.77614 8 3 8.22386 3 8.5V11.5C3 11.7761 2.77614 12 2.5 12C2.22386 12 2 11.7761 2 11.5V8.5C2 8.22386 2.22386 8 2.5 8ZM17.5 8C17.7761 8 18 8.22386 18 8.5V11.5C18 11.7761 17.7761 12 17.5 12C17.2239 12 17 11.7761 17 11.5V8.5C17 8.22386 17.2239 8 17.5 8Z"})}),Ns=(e,t)=>{let n="v";"__lib_version__"===t&&(n="");const s=`${n}${t}`;if("undefined"!=typeof globalThis){var r;globalThis.__perseus_debug__=null!=(r=globalThis.__perseus_debug__)?r:{};const t=globalThis.__perseus_debug__[e];if(t){if(t!==s){const n=Array.isArray(t)?t:[t];n.push(s),globalThis.__perseus_debug__[e]=n}}else globalThis.__perseus_debug__[e]=s}};Ns("@khanacademy/perseus-core","1.4.2");Ns("@khanacademy/simple-markdown","0.11.4");var Ts,Es,js,As,Is,Os,Ls,Ds,Rs=/\r\n?/g,_s=/\t/g,Ps=/\f/g,Vs=function(e,t){var n=e||{};if(null!=t)for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s]);return n},Hs=function(e,t){var n,s=Object.keys(e).filter(function(t){var n=e[t];if(null==n||null==n.match)return!1;var s=n.order;return"number"!=typeof s||isFinite(s),!0});s.sort(function(t,n){var s=e[t],r=e[n],i=s.order,o=r.order;if(i!==o)return i-o;var a=s.quality?0:1,l=r.quality?0:1;return a!==l?a-l:t<n?-1:t>n?1:0});var r=function t(r,i){var o=[];for(n=i=i||n;r;){var a=null,l=null,c=null,d=NaN,u=0,h=s[0],p=e[h];do{var m=p.order,f=null==i.prevCapture?"":i.prevCapture[0],g=p.match(r,i,f);if(g){var y=p.quality?p.quality(g,i,f):0;y<=d||(a=h,l=p,c=g,d=y)}u++,h=s[u],p=e[h]}while(p&&(!c||p.order===m&&p.quality));if(null==l||null==c)throw new Error("Could not find a matching rule for the below content. The rule with highest `order` should always match content provided to it. Check the definition of `match` for '"+s[s.length-1]+"'. It seems to not match the following source:\n"+r);if(c.index)throw new Error("`match` must return a capture starting at index 0 (the current parse index). Did you forget a ^ at the start of the RegExp?");var x=l.parse(c,t,i);if(Array.isArray(x))Array.prototype.push.apply(o,x);else{if(null==x||"object"!=typeof x)throw new Error(`parse() function returned invalid parse result: '${x}'`);null==x.type&&(x.type=a),o.push(x)}i.prevCapture=c,r=r.substring(i.prevCapture[0].length)}return o};return function(e,s){return(n=Vs(s,t)).inline||n.disableAutoBlockNewlines||(e+="\n\n"),n.prevCapture=null,r(function(e){return e.replace(Rs,"\n").replace(Ps,"").replace(_s,"    ")}(e),n)}},$s=function(e){var t=function(t,n,s){return n.inline?e.exec(t):null};return t.regex=e,t},zs=function(e){var t=function(t,n){return n.inline?null:e.exec(t)};return t.regex=e,t},Fs=function(e){var t=function(t,n){return e.exec(t)};return t.regex=e,t},Bs="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103,Ws=function(e,t,n){return{$$typeof:Bs,type:e,key:null==t?void 0:t,ref:null,props:n,_owner:null}},Zs=function(e,t,n,s){n=n||{},s=void 0===s||s;var r="";for(var i in n){var o=n[i];Object.prototype.hasOwnProperty.call(n,i)&&o&&(r+=" "+Ks(i)+'="'+Ks(o)+'"')}var a="<"+e+r+">";return s?a+t+"</"+e+">":a},Us={},qs=function(e){if(null==e)return null;try{var t=new URL(e,"https://localhost").protocol;if(0===t.indexOf("javascript:")||0===t.indexOf("vbscript:")||0===t.indexOf("data:"))return null}catch(n){return null}return e},Js=/[<>&"']/g,Gs={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#x27;","/":"&#x2F;","`":"&#96;"},Ks=function(e){return String(e).replace(Js,function(e){return Gs[e]})},Ys=/\\([^0-9A-Za-z\s])/g,Qs=function(e){return e.replace(Ys,"$1")},Xs=function(e,t,n){var s=n.inline||!1;n.inline=!0;var r=e(t,n);return n.inline=s,r},er=function(e,t,n){return{content:Xs(t,e[1],n)}},tr=function(){return{}},nr="(?:[*+-]|\\d+\\.)",sr="( *)("+nr+") +",rr=new RegExp("^"+sr),ir=new RegExp(sr+"[^\\n]*(?:\\n(?!\\1"+nr+" )[^\\n]*)*(\n|$)","gm"),or=/^ (?= *`)|(` *) $/g,ar=/\n{2,}$/,lr=/ *\n+$/,cr=new RegExp("^( *)("+nr+") [\\s\\S]+?(?:\n{2,}(?! )(?!\\1"+nr+" )\\n*|\\s*\n*$)"),dr=/(?:^|\n)( *)$/,ur=(Ts=/^ *\| *| *\| *$/g,Es=/ *$/,js=/^ *-+: *$/,As=/^ *:-+: *$/,Is=/^ *:-+ *$/,Os=function(e){return js.test(e)?"right":As.test(e)?"center":Is.test(e)?"left":null},Ls=function(e,t,n,s){var r=n.inTable;n.inTable=!0;var i=t(e.trim(),n);n.inTable=r;var o=[[]];return i.forEach(function(e,t){"tableSeparator"===e.type?(!s||0!==t&&t!==i.length-1)&&o.push([]):("text"!==e.type||null!=i[t+1]&&"tableSeparator"!==i[t+1].type||(e.content=e.content.replace(Es,"")),o[o.length-1].push(e))}),o},{parseTable:(Ds=function(e){return function(t,n,s){s.inline=!0;var r=Ls(t[1],n,s,e),i=function(e,t,n,s){return s&&(e=e.replace(Ts,"")),e.trim().split("|").map(Os)}(t[2],0,0,e),o=function(e,t,n,s){return e.trim().split("\n").map(function(e){return Ls(e,t,n,s)})}(t[3],n,s,e);return s.inline=!1,{type:"table",header:r,align:i,cells:o}}})(!0),parseNpTable:Ds(!1),TABLE_REGEX:/^ *(\|.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/,NPTABLE_REGEX:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/}),hr="(?:\\[[^\\]]*\\]|[^\\[\\]]|\\](?=[^\\[]*\\]))*",pr="\\s*<?((?:\\([^)]*\\)|[^\\s\\\\]|\\\\.)*?)>?(?:\\s+['\"]([\\s\\S]*?)['\"])?\\s*",mr=/mailto:/i,fr=function(e,t,n){var s=(e[2]||e[1]).replace(/\s+/g," ").toLowerCase();if(t._defs&&t._defs[s]){var r=t._defs[s];n.target=r.target,n.title=r.title}return t._refs=t._refs||{},t._refs[s]=t._refs[s]||[],t._refs[s].push(n),n},gr=0,yr={Array:{react:function(e,t,n){for(var s=n.key,r=[],i=0,o=0;i<e.length;i++,o++){n.key=""+i;var a=e[i];if("text"===a.type)for(a={type:"text",content:a.content};i+1<e.length&&"text"===e[i+1].type;i++)a.content+=e[i+1].content;r.push(t(a,n))}return n.key=s,r},html:function(e,t,n){for(var s="",r=0;r<e.length;r++){var i=e[r];if("text"===i.type)for(i={type:"text",content:i.content};r+1<e.length&&"text"===e[r+1].type;r++)i.content+=e[r+1].content;s+=t(i,n)}return s}},heading:{order:gr++,match:zs(/^ *(#{1,6})([^\n]+?)#* *(?:\n *)+\n/),parse:function(e,t,n){return{level:e[1].length,content:Xs(t,e[2].trim(),n)}},react:function(e,t,n){return Ws("h"+e.level,n.key,{children:t(e.content,n)})},html:function(e,t,n){return Zs("h"+e.level,t(e.content,n))}},nptable:{order:gr++,match:zs(ur.NPTABLE_REGEX),parse:ur.parseNpTable,react:null,html:null},lheading:{order:gr++,match:zs(/^([^\n]+)\n *(=|-){3,} *(?:\n *)+\n/),parse:function(e,t,n){return{type:"heading",level:"="===e[2]?1:2,content:Xs(t,e[1],n)}},react:null,html:null},hr:{order:gr++,match:zs(/^( *[-*_]){3,} *(?:\n *)+\n/),parse:tr,react:function(e,t,n){return Ws("hr",n.key,Us)},html:function(e,t,n){return"<hr>"}},codeBlock:{order:gr++,match:zs(/^(?:    [^\n]+\n*)+(?:\n *)+\n/),parse:function(e,t,n){return{lang:void 0,content:e[0].replace(/^    /gm,"").replace(/\n+$/,"")}},react:function(e,t,n){var s=e.lang?"markdown-code-"+e.lang:void 0;return Ws("pre",n.key,{children:Ws("code",null,{className:s,children:e.content})})},html:function(e,t,n){var s=e.lang?"markdown-code-"+e.lang:void 0,r=Zs("code",Ks(e.content),{class:s});return Zs("pre",r)}},fence:{order:gr++,match:zs(/^ *(`{3,}|~{3,}) *(?:(\S+) *)?\n([\s\S]+?)\n?\1 *(?:\n *)+\n/),parse:function(e,t,n){return{type:"codeBlock",lang:e[2]||void 0,content:e[3]}},react:null,html:null},blockQuote:{order:gr++,match:zs(/^( *>[^\n]+(\n[^\n]+)*\n*)+\n{2,}/),parse:function(e,t,n){return{content:t(e[0].replace(/^ *> ?/gm,""),n)}},react:function(e,t,n){return Ws("blockquote",n.key,{children:t(e.content,n)})},html:function(e,t,n){return Zs("blockquote",t(e.content,n))}},list:{order:gr++,match:function(e,t){var n=null==t.prevCapture?"":t.prevCapture[0],s=dr.exec(n),r=t._list||!t.inline;return s&&r?(e=s[1]+e,cr.exec(e)):null},parse:function(e,t,n){var s=e[2],r=s.length>1,i=r?+s:void 0,o=e[0].replace(ar,"\n").match(ir),a=!1,l=o.map(function(e,s){var r=rr.exec(e),i=r?r[0].length:0,l=new RegExp("^ {1,"+i+"}","gm"),c=e.replace(l,"").replace(rr,""),d=s===o.length-1,u=-1!==c.indexOf("\n\n")||d&&a;a=u;var h,p=n.inline,m=n._list;n._list=!0,u?(n.inline=!1,h=c.replace(lr,"\n\n")):(n.inline=!0,h=c.replace(lr,""));var f=t(h,n);return n.inline=p,n._list=m,f});return{ordered:r,start:i,items:l}},react:function(e,t,n){var s=e.ordered?"ol":"ul";return Ws(s,n.key,{start:e.start,children:e.items.map(function(e,s){return Ws("li",""+s,{children:t(e,n)})})})},html:function(e,t,n){var s=e.items.map(function(e){return Zs("li",t(e,n))}).join(""),r=e.ordered?"ol":"ul",i={start:e.start};return Zs(r,s,i)}},def:{order:gr++,match:zs(/^ *\[([^\]]+)\]: *<?([^\s>]*)>?(?: +["(]([^\n]+)[")])? *\n(?: *\n)*/),parse:function(e,t,n){var s=e[1].replace(/\s+/g," ").toLowerCase(),r=e[2],i=e[3];return n._refs&&n._refs[s]&&n._refs[s].forEach(function(e){e.target=r,e.title=i}),n._defs=n._defs||{},n._defs[s]={target:r,title:i},{def:s,target:r,title:i}},react:function(){return null},html:function(){return""}},table:{order:gr++,match:zs(ur.TABLE_REGEX),parse:ur.parseTable,react:function(e,t,n){var s=function(t){return null==e.align[t]?{}:{textAlign:e.align[t]}},r=e.header.map(function(e,r){return Ws("th",""+r,{style:s(r),scope:"col",children:t(e,n)})}),i=e.cells.map(function(e,r){return Ws("tr",""+r,{children:e.map(function(e,r){return Ws("td",""+r,{style:s(r),children:t(e,n)})})})});return Ws("table",n.key,{children:[Ws("thead","thead",{children:Ws("tr",null,{children:r})}),Ws("tbody","tbody",{children:i})]})},html:function(e,t,n){var s=function(t){return null==e.align[t]?"":"text-align:"+e.align[t]+";"},r=e.header.map(function(e,r){return Zs("th",t(e,n),{style:s(r),scope:"col"})}).join(""),i=e.cells.map(function(e){var r=e.map(function(e,r){return Zs("td",t(e,n),{style:s(r)})}).join("");return Zs("tr",r)}).join(""),o=Zs("thead",Zs("tr",r)),a=Zs("tbody",i);return Zs("table",o+a)}},newline:{order:gr++,match:zs(/^(?:\n *)*\n/),parse:tr,react:function(e,t,n){return"\n"},html:function(e,t,n){return"\n"}},paragraph:{order:gr++,match:zs(/^((?:[^\n]|\n(?! *\n))+)(?:\n *)+\n/),parse:er,react:function(e,t,n){return Ws("div",n.key,{className:"paragraph",children:t(e.content,n)})},html:function(e,t,n){return Zs("div",t(e.content,n),{class:"paragraph"})}},escape:{order:gr++,match:$s(/^\\([^0-9A-Za-z\s])/),parse:function(e,t,n){return{type:"text",content:e[1]}},react:null,html:null},tableSeparator:{order:gr++,match:function(e,t){return t.inTable?/^ *\| */.exec(e):null},parse:function(){return{type:"tableSeparator"}},react:function(){return" | "},html:function(){return" &vert; "}},autolink:{order:gr++,match:$s(/^<([^: >]+:\/[^ >]+)>/),parse:function(e,t,n){return{type:"link",content:[{type:"text",content:e[1]}],target:e[1]}},react:null,html:null},mailto:{order:gr++,match:$s(/^<([^ >]+@[^ >]+)>/),parse:function(e,t,n){var s=e[1],r=e[1];return mr.test(r)||(r="mailto:"+r),{type:"link",content:[{type:"text",content:s}],target:r}},react:null,html:null},url:{order:gr++,match:$s(/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/),parse:function(e,t,n){return{type:"link",content:[{type:"text",content:e[1]}],target:e[1],title:void 0}},react:null,html:null},link:{order:gr++,match:$s(new RegExp("^\\[("+hr+")\\]\\("+pr+"\\)")),parse:function(e,t,n){return{content:t(e[1],n),target:Qs(e[2]),title:e[3]}},react:function(e,t,n){return Ws("a",n.key,{href:qs(e.target),title:e.title,children:t(e.content,n)})},html:function(e,t,n){var s={href:qs(e.target),title:e.title};return Zs("a",t(e.content,n),s)}},image:{order:gr++,match:$s(new RegExp("^!\\[("+hr+")\\]\\("+pr+"\\)")),parse:function(e,t,n){return{alt:e[1],target:Qs(e[2]),title:e[3]}},react:function(e,t,n){return Ws("img",n.key,{src:qs(e.target),alt:e.alt,title:e.title})},html:function(e,t,n){var s={src:qs(e.target),alt:e.alt,title:e.title};return Zs("img","",s,!1)}},reflink:{order:gr++,match:$s(new RegExp("^\\[("+hr+")\\]\\s*\\[([^\\]]*)\\]")),parse:function(e,t,n){return fr(e,n,{type:"link",content:t(e[1],n)})},react:null,html:null},refimage:{order:gr++,match:$s(new RegExp("^!\\[("+hr+")\\]\\s*\\[([^\\]]*)\\]")),parse:function(e,t,n){return fr(e,n,{type:"image",alt:e[1]})},react:null,html:null},em:{order:gr,match:$s(new RegExp("^\\b_((?:__|\\\\[\\s\\S]|[^\\\\_])+?)_\\b|^\\*(?=\\S)((?:\\*\\*|\\\\[\\s\\S]|\\s+(?:\\\\[\\s\\S]|[^\\s\\*\\\\]|\\*\\*)|[^\\s\\*\\\\])+?)\\*(?!\\*)")),quality:function(e){return e[0].length+.2},parse:function(e,t,n){return{content:t(e[2]||e[1],n)}},react:function(e,t,n){return Ws("em",n.key,{children:t(e.content,n)})},html:function(e,t,n){return Zs("em",t(e.content,n))}},strong:{order:gr,match:$s(/^\*\*((?:\\[\s\S]|[^\\])+?)\*\*(?!\*)/),quality:function(e){return e[0].length+.1},parse:er,react:function(e,t,n){return Ws("strong",n.key,{children:t(e.content,n)})},html:function(e,t,n){return Zs("strong",t(e.content,n))}},u:{order:gr++,match:$s(/^__((?:\\[\s\S]|[^\\])+?)__(?!_)/),quality:function(e){return e[0].length},parse:er,react:function(e,t,n){return Ws("u",n.key,{children:t(e.content,n)})},html:function(e,t,n){return Zs("u",t(e.content,n))}},del:{order:gr++,match:$s(/^~~(?=\S)((?:\\[\s\S]|~(?!~)|[^\s~\\]|\s(?!~~))+?)~~/),parse:er,react:function(e,t,n){return Ws("del",n.key,{children:t(e.content,n)})},html:function(e,t,n){return Zs("del",t(e.content,n))}},inlineCode:{order:gr++,match:$s(/^(`+)([\s\S]*?[^`])\1(?!`)/),parse:function(e,t,n){return{content:e[2].replace(or,"$1")}},react:function(e,t,n){return Ws("code",n.key,{children:e.content})},html:function(e,t,n){return Zs("code",Ks(e.content))}},br:{order:gr++,match:Fs(/^ {2,}\n/),parse:tr,react:function(e,t,n){return Ws("br",n.key,Us)},html:function(e,t,n){return"<br>"}},text:{order:gr++,match:Fs(/^[\s\S]+?(?=[^0-9A-Za-z\s\u00c0-\uffff]|\n\n| {2,}\n|\w+:\S|$)/),parse:function(e,t,n){return{content:e[0]}},react:function(e,t,n){return e.content},html:function(e,t,n){return Ks(e.content)}}},xr=function(e,t,n={}){if(!t)throw new Error("simple-markdown: outputFor: `property` must be defined. if you just upgraded, you probably need to replace `outputFor` with `reactFor`");var s,r=(e.Array||yr.Array)[t];if(!r)throw new Error("simple-markdown: outputFor: to join nodes of type `"+t+"` you must provide an `Array:` joiner rule with that type, Please see the docs for details on specifying an Array rule.");var i=r,o=function n(r,o){return s=o=o||s,Array.isArray(r)?i(r,n,o):e[r.type][t](r,n,o)};return function(e,t){return s=Vs(t,n),o(e,s)}};Hs(yr),xr(yr,"react"),xr(yr,"html");var Cr={defaultRules:yr,parserFor:Hs,outputFor:xr};const br=Cr.defaultRules,wr=Cr.parserFor,vr=Cr.outputFor,kr=e=>{if(!e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map(kr);if(Y.isValidElement(e)){if(e.props&&"object"==typeof e.props&&"children"in e.props){const t=e.props.children,n=kr(t);if(n!==t)return Y.cloneElement(e,void 0,n)}return e}if("object"==typeof(t=e)&&null!==t&&"$$typeof"in t&&"type"in t&&"props"in t){const{type:t,props:n,key:s}=e,r={};return n&&"object"==typeof n&&(Object.assign(r,n),"children"in n&&(r.children=kr(n.children))),null!=s&&(r.key=s),Y.createElement(t,r)}var t;return e},Mr=e=>((e,t,n)=>{const s=vr(e,t,n),r=(e,t)=>{const n=s(e,t);return kr(n)};return r.displayName=`OutputFor_${String(t)}`,r})(e,"react"),Sr={fence:{...br.fence,parse:(e,t,n)=>({lang:e[2]||void 0,content:e[3]}),react:e=>q.jsx(Ye.pre,{flagShowCodeHeader:!1,children:e.content})},blockQuote:{...br.blockQuote,react:(e,t,n)=>q.jsx(Ye.blockQuote,{children:t(e.content,n)})},list:{...br.list,react:(e,t,n)=>{const s=e.ordered?Ye.ol:Ye.ul;return q.jsx(s,{children:e.items.map((e,s)=>q.jsx(Ye.li,{children:t(e,n)},s))},n.key)}},newline:br.newline,paragraph:{...br.paragraph,react:(e,t,n)=>q.jsx(Ye.p,{children:t(e.content,n)},n.key)},del:br.del,inlineCode:{...br.inlineCode,react:e=>{const t=e.content;return t&&Ke.test(t)&&t.match(Ke)?.[0]===t?q.jsxs(Ye.code,{children:[q.jsx("span",{style:{display:"inline-block",verticalAlign:"middle",position:"relative",top:"-0.15em"},children:q.jsx(Qe,{color:t})}),t]}):q.jsx(Ye.code,{children:t})}},text:{...br.text,react:e=>Ge(e.content)},url:br.url,link:{...br.link,match:(e,t)=>null,react:e=>{const t=e.target;return q.jsx("a",{href:t,target:"_blank",className:"underline",children:t})}}},Nr=U.memo(({text:e})=>{const t=(n=e,wr(Sr)(n,{inline:!1}));var n;return Mr(Sr)(t)});Nr.displayName="AnthropicMarkDown";const Tr=new Map([["bold",U.createElement(U.Fragment,null,U.createElement("path",{d:"M156,92a12,12,0,0,1,12-12h64a12,12,0,0,1,0,24H168A12,12,0,0,1,156,92Zm76,28H168a12,12,0,0,0,0,24h64a12,12,0,0,0,0-24Zm0,40H80a12,12,0,0,0,0,24H232a12,12,0,0,0,0-24Zm0,40H80a12,12,0,0,0,0,24H232a12,12,0,0,0,0-24ZM96,144a12,12,0,0,0,0-24H92V68h24v4a12,12,0,0,0,24,0V56a12,12,0,0,0-12-12H32A12,12,0,0,0,20,56V72a12,12,0,0,0,24,0V68H68v52H64a12,12,0,0,0,0,24Z"}))],["duotone",U.createElement(U.Fragment,null,U.createElement("path",{d:"M232,104v96H80V168h48V104Z",opacity:"0.2"}),U.createElement("path",{d:"M128,96H232a8,8,0,0,1,0,16H128a8,8,0,0,1,0-16Zm104,32H128a8,8,0,0,0,0,16H232a8,8,0,0,0,0-16Zm0,32H80a8,8,0,0,0,0,16H232a8,8,0,0,0,0-16Zm0,32H80a8,8,0,0,0,0,16H232a8,8,0,0,0,0-16ZM96,144a8,8,0,0,0,0-16H88V64h32v8a8,8,0,0,0,16,0V56a8,8,0,0,0-8-8H32a8,8,0,0,0-8,8V72a8,8,0,0,0,16,0V64H72v64H64a8,8,0,0,0,0,16Z"}))],["fill",U.createElement(U.Fragment,null,U.createElement("path",{d:"M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40ZM64,92a8,8,0,0,1-16,0V80a8,8,0,0,1,8-8h72a8,8,0,0,1,8,8V92a8,8,0,0,1-16,0V88H100v48h4a8,8,0,0,1,0,16H80a8,8,0,0,1,0-16h4V88H64Zm136,92H80a8,8,0,0,1,0-16H200a8,8,0,0,1,0,16Zm0-32H136a8,8,0,0,1,0-16h64a8,8,0,0,1,0,16Zm0-32H152a8,8,0,0,1,0-16h48a8,8,0,0,1,0,16Z"}))],["light",U.createElement(U.Fragment,null,U.createElement("path",{d:"M128,98H232a6,6,0,0,1,0,12H128a6,6,0,0,1,0-12Zm104,32H128a6,6,0,0,0,0,12H232a6,6,0,0,0,0-12Zm0,32H80a6,6,0,0,0,0,12H232a6,6,0,0,0,0-12Zm0,32H80a6,6,0,0,0,0,12H232a6,6,0,0,0,0-12ZM96,142a6,6,0,0,0,0-12H86V62h36V72a6,6,0,0,0,12,0V56a6,6,0,0,0-6-6H32a6,6,0,0,0-6,6V72a6,6,0,0,0,12,0V62H74v68H64a6,6,0,0,0,0,12Z"}))],["regular",U.createElement(U.Fragment,null,U.createElement("path",{d:"M128,96H232a8,8,0,0,1,0,16H128a8,8,0,0,1,0-16Zm104,32H128a8,8,0,0,0,0,16H232a8,8,0,0,0,0-16Zm0,32H80a8,8,0,0,0,0,16H232a8,8,0,0,0,0-16Zm0,32H80a8,8,0,0,0,0,16H232a8,8,0,0,0,0-16ZM96,144a8,8,0,0,0,0-16H88V64h32v8a8,8,0,0,0,16,0V56a8,8,0,0,0-8-8H32a8,8,0,0,0-8,8V72a8,8,0,0,0,16,0V64H72v64H64a8,8,0,0,0,0,16Z"}))],["thin",U.createElement(U.Fragment,null,U.createElement("path",{d:"M128,100H232a4,4,0,0,1,0,8H128a4,4,0,0,1,0-8Zm104,32H128a4,4,0,0,0,0,8H232a4,4,0,0,0,0-8Zm0,32H80a4,4,0,0,0,0,8H232a4,4,0,0,0,0-8Zm0,32H80a4,4,0,0,0,0,8H232a4,4,0,0,0,0-8ZM96,140a4,4,0,0,0,0-8H84V60h40V72a4,4,0,0,0,8,0V56a4,4,0,0,0-4-4H32a4,4,0,0,0-4,4V72a4,4,0,0,0,8,0V60H76v72H64a4,4,0,0,0,0,8Z"}))]]),Er=new Map([["bold",U.createElement(U.Fragment,null,U.createElement("path",{d:"M56.88,39.93A12,12,0,1,0,39.12,56.07L76,96.64V128a52,52,0,0,0,72.11,48l11.26,12.39A67.34,67.34,0,0,1,128,196a68.07,68.07,0,0,1-68-68,12,12,0,0,0-24,0,92.14,92.14,0,0,0,80,91.22V240a12,12,0,0,0,24,0V219.23a90.39,90.39,0,0,0,35.92-12.68l23.2,25.52a12,12,0,0,0,17.76-16.14ZM128,156a28,28,0,0,1-28-28v-5l29.9,32.89C129.27,156,128.64,156,128,156Zm63-2.42A67.63,67.63,0,0,0,196,128a12,12,0,0,1,24,0,91.48,91.48,0,0,1-6.74,34.61,12,12,0,0,1-22.23-9ZM85.7,33.75A52,52,0,0,1,180,64v56.54a12,12,0,0,1-24,0V64a28,28,0,0,0-50.79-16.28,12,12,0,0,1-19.51-14Z"}))],["duotone",U.createElement(U.Fragment,null,U.createElement("path",{d:"M168,64v64a40,40,0,0,1-40,40h0a40,40,0,0,1-40-40V64a40,40,0,0,1,40-40h0A40,40,0,0,1,168,64Z",opacity:"0.2"}),U.createElement("path",{d:"M213.92,218.62l-160-176A8,8,0,0,0,42.08,53.38L80,95.09V128a48,48,0,0,0,69.11,43.12l11.1,12.2A63.41,63.41,0,0,1,128,192a64.07,64.07,0,0,1-64-64,8,8,0,0,0-16,0,80.11,80.11,0,0,0,72,79.6V240a8,8,0,0,0,16,0V207.59a78.83,78.83,0,0,0,35.16-12.22l30.92,34a8,8,0,1,0,11.84-10.76ZM128,160a32,32,0,0,1-32-32V112.69l41.66,45.82A32,32,0,0,1,128,160Zm57.52-3.91A63.32,63.32,0,0,0,192,128a8,8,0,0,1,16,0,79.16,79.16,0,0,1-8.11,35.12,8,8,0,0,1-7.19,4.49,7.88,7.88,0,0,1-3.51-.82A8,8,0,0,1,185.52,156.09ZM84,44.87A48,48,0,0,1,176,64v64a49.19,49.19,0,0,1-.26,5,8,8,0,0,1-8,7.17,8.13,8.13,0,0,1-.84,0,8,8,0,0,1-7.12-8.79c.11-1.1.17-2.24.17-3.36V64A32,32,0,0,0,98.64,51.25,8,8,0,1,1,84,44.87Z"}))],["fill",U.createElement(U.Fragment,null,U.createElement("path",{d:"M213.38,229.92a8,8,0,0,1-11.3-.54l-30.92-34A78.83,78.83,0,0,1,136,207.59V240a8,8,0,0,1-16,0V207.6A80.11,80.11,0,0,1,48,128a8,8,0,0,1,16,0,64.07,64.07,0,0,0,64,64,63.41,63.41,0,0,0,32.21-8.68l-11.1-12.2A48,48,0,0,1,80,128V95.09L42.08,53.38A8,8,0,0,1,53.92,42.62l160,176A8,8,0,0,1,213.38,229.92Zm-24.19-63.13a7.88,7.88,0,0,0,3.51.82,8,8,0,0,0,7.19-4.49A79.16,79.16,0,0,0,208,128a8,8,0,0,0-16,0,63.32,63.32,0,0,1-6.48,28.09A8,8,0,0,0,189.19,166.79Zm-27.33-29.22A8,8,0,0,0,175.74,133a49.49,49.49,0,0,0,.26-5V64A48,48,0,0,0,84,44.87a8,8,0,0,0,1.41,8.57Z"}))],["light",U.createElement(U.Fragment,null,U.createElement("path",{d:"M212.44,220,52.44,44A6,6,0,0,0,43.56,52L82,94.32V128a46,46,0,0,0,67.56,40.64l13.75,15.12A65.26,65.26,0,0,1,128,194a66.08,66.08,0,0,1-66-66,6,6,0,0,0-12,0,78.09,78.09,0,0,0,72,77.75V240a6,6,0,0,0,12,0V205.77a76.93,76.93,0,0,0,37.48-13L203.56,228a6,6,0,0,0,8.88-8.08ZM128,162a34,34,0,0,1-34-34V107.52l47.12,51.84A33.82,33.82,0,0,1,128,162Zm59.32-5A65.38,65.38,0,0,0,194,128a6,6,0,0,1,12,0,77.33,77.33,0,0,1-7.9,34.25A6,6,0,1,1,187.32,157ZM85.8,45.67A46,46,0,0,1,174,64v64a45.17,45.17,0,0,1-.25,4.81,6,6,0,0,1-6,5.38q-.31,0-.63,0a6,6,0,0,1-5.34-6.59A35.41,35.41,0,0,0,162,128V64A34,34,0,0,0,96.8,50.45a6,6,0,0,1-11-4.78Z"}))],["regular",U.createElement(U.Fragment,null,U.createElement("path",{d:"M213.92,218.62l-160-176A8,8,0,0,0,42.08,53.38L80,95.09V128a48,48,0,0,0,69.11,43.12l11.1,12.2A63.41,63.41,0,0,1,128,192a64.07,64.07,0,0,1-64-64,8,8,0,0,0-16,0,80.11,80.11,0,0,0,72,79.6V240a8,8,0,0,0,16,0V207.59a78.83,78.83,0,0,0,35.16-12.22l30.92,34a8,8,0,1,0,11.84-10.76ZM128,160a32,32,0,0,1-32-32V112.69l41.66,45.82A32,32,0,0,1,128,160Zm57.52-3.91A63.32,63.32,0,0,0,192,128a8,8,0,0,1,16,0,79.16,79.16,0,0,1-8.11,35.12,8,8,0,0,1-7.19,4.49,7.88,7.88,0,0,1-3.51-.82A8,8,0,0,1,185.52,156.09ZM84,44.87A48,48,0,0,1,176,64v64a49.19,49.19,0,0,1-.26,5,8,8,0,0,1-8,7.17,8.13,8.13,0,0,1-.84,0,8,8,0,0,1-7.12-8.79c.11-1.1.17-2.24.17-3.36V64A32,32,0,0,0,98.64,51.25,8,8,0,1,1,84,44.87Z"}))],["thin",U.createElement(U.Fragment,null,U.createElement("path",{d:"M211,221.31,51,45.31A4,4,0,0,0,45,50.69L84,93.55V128a44,44,0,0,0,66,38.12l16.38,18A67.21,67.21,0,0,1,128,196a68.07,68.07,0,0,1-68-68,4,4,0,0,0-8,0,76.09,76.09,0,0,0,72,75.89V240a4,4,0,0,0,8,0V203.89a75.1,75.1,0,0,0,39.79-13.77L205,226.69a4,4,0,1,0,5.92-5.38ZM128,164a36,36,0,0,1-36-36V102.35L144.43,160A35.83,35.83,0,0,1,128,164Zm61.12-6.15A67.44,67.44,0,0,0,196,128a4,4,0,0,1,8,0,75.28,75.28,0,0,1-7.7,33.37,4,4,0,0,1-7.18-3.52ZM87.63,46.46A44,44,0,0,1,172,64v64a44.2,44.2,0,0,1-.24,4.61,4,4,0,0,1-4,3.58l-.42,0a4,4,0,0,1-3.57-4.39A36.67,36.67,0,0,0,164,128V64A36,36,0,0,0,95,49.66a4,4,0,0,1-7.34-3.2Z"}))]]),jr=new Map([["bold",U.createElement(U.Fragment,null,U.createElement("path",{d:"M144,12H112A68.07,68.07,0,0,0,44,80v96a68.07,68.07,0,0,0,68,68h32a68.07,68.07,0,0,0,68-68V80A68.07,68.07,0,0,0,144,12Zm44,68v20H140V36h4A44.05,44.05,0,0,1,188,80ZM112,36h4v64H68V80A44.05,44.05,0,0,1,112,36Zm32,184H112a44.05,44.05,0,0,1-44-44V124H188v52A44.05,44.05,0,0,1,144,220Z"}))],["duotone",U.createElement(U.Fragment,null,U.createElement("path",{d:"M200,112v64a56,56,0,0,1-56,56H112a56,56,0,0,1-56-56V112Z",opacity:"0.2"}),U.createElement("path",{d:"M144,16H112A64.07,64.07,0,0,0,48,80v96a64.07,64.07,0,0,0,64,64h32a64.07,64.07,0,0,0,64-64V80A64.07,64.07,0,0,0,144,16Zm48,64v24H136V32h8A48.05,48.05,0,0,1,192,80ZM112,32h8v72H64V80A48.05,48.05,0,0,1,112,32Zm32,192H112a48.05,48.05,0,0,1-48-48V120H192v56A48.05,48.05,0,0,1,144,224Z"}))],["fill",U.createElement(U.Fragment,null,U.createElement("path",{d:"M144,16H112A64.07,64.07,0,0,0,48,80v96a64.07,64.07,0,0,0,64,64h32a64.07,64.07,0,0,0,64-64V80A64.07,64.07,0,0,0,144,16Zm48,64v24H136V32h8A48.05,48.05,0,0,1,192,80ZM112,32h8v72H64V80A48.05,48.05,0,0,1,112,32Z"}))],["light",U.createElement(U.Fragment,null,U.createElement("path",{d:"M144,18H112A62.07,62.07,0,0,0,50,80v96a62.07,62.07,0,0,0,62,62h32a62.07,62.07,0,0,0,62-62V80A62.07,62.07,0,0,0,144,18Zm50,62v26H134V30h10A50.06,50.06,0,0,1,194,80ZM112,30h10v76H62V80A50.06,50.06,0,0,1,112,30Zm32,196H112a50.06,50.06,0,0,1-50-50V118H194v58A50.06,50.06,0,0,1,144,226Z"}))],["regular",U.createElement(U.Fragment,null,U.createElement("path",{d:"M144,16H112A64.07,64.07,0,0,0,48,80v96a64.07,64.07,0,0,0,64,64h32a64.07,64.07,0,0,0,64-64V80A64.07,64.07,0,0,0,144,16Zm48,64v24H136V32h8A48.05,48.05,0,0,1,192,80ZM112,32h8v72H64V80A48.05,48.05,0,0,1,112,32Zm32,192H112a48.05,48.05,0,0,1-48-48V120H192v56A48.05,48.05,0,0,1,144,224Z"}))],["thin",U.createElement(U.Fragment,null,U.createElement("path",{d:"M144,20H112A60.07,60.07,0,0,0,52,80v96a60.07,60.07,0,0,0,60,60h32a60.07,60.07,0,0,0,60-60V80A60.07,60.07,0,0,0,144,20Zm52,60v28H132V28h12A52.06,52.06,0,0,1,196,80ZM112,28h12v80H60V80A52.06,52.06,0,0,1,112,28Zm32,200H112a52.06,52.06,0,0,1-52-52V116H196v60A52.06,52.06,0,0,1,144,228Z"}))]]),Ar=new Map([["bold",U.createElement(U.Fragment,null,U.createElement("path",{d:"M200,28H160a20,20,0,0,0-20,20V208a20,20,0,0,0,20,20h40a20,20,0,0,0,20-20V48A20,20,0,0,0,200,28Zm-4,176H164V52h32ZM96,28H56A20,20,0,0,0,36,48V208a20,20,0,0,0,20,20H96a20,20,0,0,0,20-20V48A20,20,0,0,0,96,28ZM92,204H60V52H92Z"}))],["duotone",U.createElement(U.Fragment,null,U.createElement("path",{d:"M208,48V208a8,8,0,0,1-8,8H160a8,8,0,0,1-8-8V48a8,8,0,0,1,8-8h40A8,8,0,0,1,208,48ZM96,40H56a8,8,0,0,0-8,8V208a8,8,0,0,0,8,8H96a8,8,0,0,0,8-8V48A8,8,0,0,0,96,40Z",opacity:"0.2"}),U.createElement("path",{d:"M200,32H160a16,16,0,0,0-16,16V208a16,16,0,0,0,16,16h40a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm0,176H160V48h40ZM96,32H56A16,16,0,0,0,40,48V208a16,16,0,0,0,16,16H96a16,16,0,0,0,16-16V48A16,16,0,0,0,96,32Zm0,176H56V48H96Z"}))],["fill",U.createElement(U.Fragment,null,U.createElement("path",{d:"M216,48V208a16,16,0,0,1-16,16H160a16,16,0,0,1-16-16V48a16,16,0,0,1,16-16h40A16,16,0,0,1,216,48ZM96,32H56A16,16,0,0,0,40,48V208a16,16,0,0,0,16,16H96a16,16,0,0,0,16-16V48A16,16,0,0,0,96,32Z"}))],["light",U.createElement(U.Fragment,null,U.createElement("path",{d:"M200,34H160a14,14,0,0,0-14,14V208a14,14,0,0,0,14,14h40a14,14,0,0,0,14-14V48A14,14,0,0,0,200,34Zm2,174a2,2,0,0,1-2,2H160a2,2,0,0,1-2-2V48a2,2,0,0,1,2-2h40a2,2,0,0,1,2,2ZM96,34H56A14,14,0,0,0,42,48V208a14,14,0,0,0,14,14H96a14,14,0,0,0,14-14V48A14,14,0,0,0,96,34Zm2,174a2,2,0,0,1-2,2H56a2,2,0,0,1-2-2V48a2,2,0,0,1,2-2H96a2,2,0,0,1,2,2Z"}))],["regular",U.createElement(U.Fragment,null,U.createElement("path",{d:"M200,32H160a16,16,0,0,0-16,16V208a16,16,0,0,0,16,16h40a16,16,0,0,0,16-16V48A16,16,0,0,0,200,32Zm0,176H160V48h40ZM96,32H56A16,16,0,0,0,40,48V208a16,16,0,0,0,16,16H96a16,16,0,0,0,16-16V48A16,16,0,0,0,96,32Zm0,176H56V48H96Z"}))],["thin",U.createElement(U.Fragment,null,U.createElement("path",{d:"M200,36H160a12,12,0,0,0-12,12V208a12,12,0,0,0,12,12h40a12,12,0,0,0,12-12V48A12,12,0,0,0,200,36Zm4,172a4,4,0,0,1-4,4H160a4,4,0,0,1-4-4V48a4,4,0,0,1,4-4h40a4,4,0,0,1,4,4ZM96,36H56A12,12,0,0,0,44,48V208a12,12,0,0,0,12,12H96a12,12,0,0,0,12-12V48A12,12,0,0,0,96,36Zm4,172a4,4,0,0,1-4,4H56a4,4,0,0,1-4-4V48a4,4,0,0,1,4-4H96a4,4,0,0,1,4,4Z"}))]]),Ir=new Map([["bold",U.createElement(U.Fragment,null,U.createElement("path",{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Zm52-84a12,12,0,0,1-12,12H140v28a12,12,0,0,1-24,0V140H88a12,12,0,0,1,0-24h28V88a12,12,0,0,1,24,0v28h28A12,12,0,0,1,180,128Z"}))],["duotone",U.createElement(U.Fragment,null,U.createElement("path",{d:"M224,128a96,96,0,1,1-96-96A96,96,0,0,1,224,128Z",opacity:"0.2"}),U.createElement("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm48-88a8,8,0,0,1-8,8H136v32a8,8,0,0,1-16,0V136H88a8,8,0,0,1,0-16h32V88a8,8,0,0,1,16,0v32h32A8,8,0,0,1,176,128Z"}))],["fill",U.createElement(U.Fragment,null,U.createElement("path",{d:"M128,24A104,104,0,1,0,232,128,104.13,104.13,0,0,0,128,24Zm40,112H136v32a8,8,0,0,1-16,0V136H88a8,8,0,0,1,0-16h32V88a8,8,0,0,1,16,0v32h32a8,8,0,0,1,0,16Z"}))],["light",U.createElement(U.Fragment,null,U.createElement("path",{d:"M128,26A102,102,0,1,0,230,128,102.12,102.12,0,0,0,128,26Zm0,192a90,90,0,1,1,90-90A90.1,90.1,0,0,1,128,218Zm46-90a6,6,0,0,1-6,6H134v34a6,6,0,0,1-12,0V134H88a6,6,0,0,1,0-12h34V88a6,6,0,0,1,12,0v34h34A6,6,0,0,1,174,128Z"}))],["regular",U.createElement(U.Fragment,null,U.createElement("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm48-88a8,8,0,0,1-8,8H136v32a8,8,0,0,1-16,0V136H88a8,8,0,0,1,0-16h32V88a8,8,0,0,1,16,0v32h32A8,8,0,0,1,176,128Z"}))],["thin",U.createElement(U.Fragment,null,U.createElement("path",{d:"M128,28A100,100,0,1,0,228,128,100.11,100.11,0,0,0,128,28Zm0,192a92,92,0,1,1,92-92A92.1,92.1,0,0,1,128,220Zm44-92a4,4,0,0,1-4,4H132v36a4,4,0,0,1-8,0V132H88a4,4,0,0,1,0-8h36V88a4,4,0,0,1,8,0v36h36A4,4,0,0,1,172,128Z"}))]]),Or=new Map([["bold",U.createElement(U.Fragment,null,U.createElement("path",{d:"M156,40a12,12,0,0,1-12,12H112a12,12,0,0,1,0-24h32A12,12,0,0,1,156,40ZM144,204H112a12,12,0,0,0,0,24h32a12,12,0,0,0,0-24ZM204,52V72a12,12,0,0,0,24,0V48a20,20,0,0,0-20-20H184a12,12,0,0,0,0,24Zm12,48a12,12,0,0,0-12,12v32a12,12,0,0,0,24,0V112A12,12,0,0,0,216,100ZM40,156a12,12,0,0,0,12-12V112a12,12,0,0,0-24,0v32A12,12,0,0,0,40,156Zm32,48H52V184a12,12,0,0,0-24,0v24a20,20,0,0,0,20,20H72a12,12,0,0,0,0-24ZM72,28H48A20,20,0,0,0,28,48V72a12,12,0,0,0,24,0V52H72a12,12,0,0,0,0-24ZM240,204H228V192a12,12,0,0,0-24,0v12H192a12,12,0,0,0,0,24h12v12a12,12,0,0,0,24,0V228h12a12,12,0,0,0,0-24Z"}))],["duotone",U.createElement(U.Fragment,null,U.createElement("path",{d:"M216,40V216H40V40Z",opacity:"0.2"}),U.createElement("path",{d:"M152,40a8,8,0,0,1-8,8H112a8,8,0,0,1,0-16h32A8,8,0,0,1,152,40Zm-8,168H112a8,8,0,0,0,0,16h32a8,8,0,0,0,0-16ZM208,48V72a8,8,0,0,0,16,0V48a16,16,0,0,0-16-16H184a8,8,0,0,0,0,16Zm8,56a8,8,0,0,0-8,8v32a8,8,0,0,0,16,0V112A8,8,0,0,0,216,104ZM40,152a8,8,0,0,0,8-8V112a8,8,0,0,0-16,0v32A8,8,0,0,0,40,152Zm32,56H48V184a8,8,0,0,0-16,0v24a16,16,0,0,0,16,16H72a8,8,0,0,0,0-16ZM72,32H48A16,16,0,0,0,32,48V72a8,8,0,0,0,16,0V48H72a8,8,0,0,0,0-16ZM240,208H224V192a8,8,0,0,0-16,0v16H192a8,8,0,0,0,0,16h16v16a8,8,0,0,0,16,0V224h16a8,8,0,0,0,0-16Z"}))],["fill",U.createElement(U.Fragment,null,U.createElement("path",{d:"M208,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM56,72A16,16,0,0,1,72,56H96a8,8,0,0,1,0,16H72V96a8,8,0,0,1-16,0Zm56,112H72a16,16,0,0,1-16-16V136a8,8,0,0,1,16,0v32h40a8,8,0,0,1,0,16ZM128,64a8,8,0,0,1,8-8h32a16,16,0,0,1,16,16v40a8,8,0,0,1-16,0V72H136A8,8,0,0,1,128,64Zm72,120H184v16a8,8,0,0,1-16,0V184H152a8,8,0,0,1,0-16h16V152a8,8,0,0,1,16,0v16h16a8,8,0,0,1,0,16Z"}))],["light",U.createElement(U.Fragment,null,U.createElement("path",{d:"M150,40a6,6,0,0,1-6,6H112a6,6,0,0,1,0-12h32A6,6,0,0,1,150,40Zm-6,170H112a6,6,0,0,0,0,12h32a6,6,0,0,0,0-12ZM210,48V72a6,6,0,0,0,12,0V48a14,14,0,0,0-14-14H184a6,6,0,0,0,0,12h24A2,2,0,0,1,210,48Zm6,58a6,6,0,0,0-6,6v32a6,6,0,0,0,12,0V112A6,6,0,0,0,216,106ZM40,150a6,6,0,0,0,6-6V112a6,6,0,0,0-12,0v32A6,6,0,0,0,40,150Zm32,60H48a2,2,0,0,1-2-2V184a6,6,0,0,0-12,0v24a14,14,0,0,0,14,14H72a6,6,0,0,0,0-12ZM72,34H48A14,14,0,0,0,34,48V72a6,6,0,0,0,12,0V48a2,2,0,0,1,2-2H72a6,6,0,0,0,0-12ZM240,210H222V192a6,6,0,0,0-12,0v18H192a6,6,0,0,0,0,12h18v18a6,6,0,0,0,12,0V222h18a6,6,0,0,0,0-12Z"}))],["regular",U.createElement(U.Fragment,null,U.createElement("path",{d:"M152,40a8,8,0,0,1-8,8H112a8,8,0,0,1,0-16h32A8,8,0,0,1,152,40Zm-8,168H112a8,8,0,0,0,0,16h32a8,8,0,0,0,0-16ZM208,48V72a8,8,0,0,0,16,0V48a16,16,0,0,0-16-16H184a8,8,0,0,0,0,16Zm8,56a8,8,0,0,0-8,8v32a8,8,0,0,0,16,0V112A8,8,0,0,0,216,104ZM40,152a8,8,0,0,0,8-8V112a8,8,0,0,0-16,0v32A8,8,0,0,0,40,152Zm32,56H48V184a8,8,0,0,0-16,0v24a16,16,0,0,0,16,16H72a8,8,0,0,0,0-16ZM72,32H48A16,16,0,0,0,32,48V72a8,8,0,0,0,16,0V48H72a8,8,0,0,0,0-16ZM240,208H224V192a8,8,0,0,0-16,0v16H192a8,8,0,0,0,0,16h16v16a8,8,0,0,0,16,0V224h16a8,8,0,0,0,0-16Z"}))],["thin",U.createElement(U.Fragment,null,U.createElement("path",{d:"M148,40a4,4,0,0,1-4,4H112a4,4,0,0,1,0-8h32A4,4,0,0,1,148,40Zm-4,172H112a4,4,0,0,0,0,8h32a4,4,0,0,0,0-8ZM212,48V72a4,4,0,0,0,8,0V48a12,12,0,0,0-12-12H184a4,4,0,0,0,0,8h24A4,4,0,0,1,212,48Zm4,60a4,4,0,0,0-4,4v32a4,4,0,0,0,8,0V112A4,4,0,0,0,216,108ZM40,148a4,4,0,0,0,4-4V112a4,4,0,0,0-8,0v32A4,4,0,0,0,40,148Zm32,64H48a4,4,0,0,1-4-4V184a4,4,0,0,0-8,0v24a12,12,0,0,0,12,12H72a4,4,0,0,0,0-8ZM72,36H48A12,12,0,0,0,36,48V72a4,4,0,0,0,8,0V48a4,4,0,0,1,4-4H72a4,4,0,0,0,0-8ZM240,212H220V192a4,4,0,0,0-8,0v20H192a4,4,0,0,0,0,8h20v20a4,4,0,0,0,8,0V220h20a4,4,0,0,0,0-8Z"}))]]),Lr=U.forwardRef((e,t)=>U.createElement(a,{ref:t,...e,weights:Tr}));Lr.displayName="ArticleNyTimesIcon";const Dr=Lr,Rr=U.forwardRef((e,t)=>U.createElement(a,{ref:t,...e,weights:Er}));Rr.displayName="MicrophoneSlashIcon";const _r=Rr,Pr=U.forwardRef((e,t)=>U.createElement(a,{ref:t,...e,weights:jr}));Pr.displayName="MouseIcon";const Vr=Pr,Hr=U.forwardRef((e,t)=>U.createElement(a,{ref:t,...e,weights:Ar}));Hr.displayName="PauseIcon";const $r=Hr,zr=U.forwardRef((e,t)=>U.createElement(a,{ref:t,...e,weights:Ir}));zr.displayName="PlusCircleIcon";const Fr=zr,Br=U.forwardRef((e,t)=>U.createElement(a,{ref:t,...e,weights:Or}));Br.displayName="SelectionPlusIcon";const Wr=Br;const Zr=U.memo(function({text:e,variant:t="assistant",onComputerFileClick:n}){const s=U.useCallback((e,t)=>{if(t?.startsWith("computer://")&&n){e.preventDefault();const s=t.replace("computer://","");n(s)}},[n]);return"user"===t?q.jsx("div",{className:"font-base",children:q.jsx(Nr,{text:e})}):q.jsx("div",{className:"font-claude-response text-sm leading-[1.65rem] text-text-100 [&_a]:!underline [&_a]:text-accent-main-100 [&_p]:!text-sm [&_p]:text-text-100 [&_ul]:text-sm [&_ol]:text-sm",children:q.jsx(Xe,{text:e,className:"[&_>_*]:min-w-0",onLinkClick:s,unsafeAllowNavigationWithoutConfirmation:!0})})}),Ur=e=>q.jsx(l,{...e,children:q.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.56055 2C11.1381 2.00009 12.3211 3.44332 12.0117 4.99023L11.6094 7H13.8438C15.5431 7 16.836 8.52594 16.5566 10.2021L15.876 14.2842C15.6148 15.8513 14.2586 17 12.6699 17H4.5C3.67157 17 3 16.3284 3 15.5V9.23828C3.00013 8.57996 3.4294 7.99838 4.05859 7.80469L5.19824 7.4541L5.33789 7.40723C6.02983 7.15302 6.59327 6.63008 6.89746 5.9541L8.41113 2.58984L8.48047 2.46094C8.66235 2.17643 8.97898 2.00002 9.32324 2H9.56055Z"})}),qr=e=>q.jsx(l,{...e,children:q.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.56055 17C11.1381 16.9999 12.3211 15.5567 12.0117 14.0098L11.6094 12H13.8438C15.5431 12 16.836 10.4741 16.5566 8.79785L15.876 4.71582C15.6148 3.14873 14.2586 2 12.6699 2H4.5C3.67157 2 3 2.67157 3 3.5V9.76172C3.00013 10.42 3.4294 11.0016 4.05859 11.1953L5.19824 11.5459L5.33789 11.5928C6.02983 11.847 6.59327 12.3699 6.89746 13.0459L8.41113 16.4102L8.48047 16.5391C8.66235 16.8236 8.97898 17 9.32324 17H9.56055Z"})}),Jr=/\[\[shortcut:([^:]+):([^\]]+)\]\]/g;async function Gr(e){if(!e.some(e=>"string"==typeof e.content?e.content.includes("[[shortcut:"):!!Array.isArray(e.content)&&e.content.some(e=>"object"==typeof e&&null!==e&&"type"in e&&"text"===e.type&&"text"in e&&"string"==typeof e.text&&e.text.includes("[[shortcut:"))))return e;const t=await Q.getAllPrompts(),n=new Map(t.map(e=>[e.id,e]));return Promise.all(e.map(async e=>{if("string"==typeof e.content)return{...e,content:Kr(e.content,n)};if(Array.isArray(e.content)){const t=e.content.map(e=>"object"==typeof e&&null!==e&&"type"in e&&"text"===e.type&&"text"in e&&"string"==typeof e.text?{...e,text:Kr(e.text,n)}:e);return{...e,content:t}}return e}))}function Kr(e,t){return e.includes("[[shortcut:")?e.replace(Jr,(e,n,s)=>{const r=t.get(n);return r?.prompt?r.prompt:`/${s}`}):e}const Yr=e=>!!["tool_use","tool_result"].includes(e.type),Qr=e=>"tool_result"!==e.type;function Xr({dataUrl:e,width:t,height:n,maxHeight:r="200px",className:i=""}){const o=s();return q.jsxs("div",{className:i,children:[q.jsx("img",{src:e,alt:o.formatMessage({defaultMessage:"Screenshot",id:"9a+SKtXKhe"}),className:"max-w-full h-auto rounded border border-border-300 cursor-pointer hover:opacity-90 hover:rotate-2 transition-all duration-150 ease-out",style:{maxHeight:r},onClick:()=>window.open(e,"_blank"),title:o.formatMessage({defaultMessage:"Click to open in new tab",id:"A+vguREwVx"})}),t&&n&&q.jsxs("div",{className:"mt-1 text-xs text-text-300",children:[t,"×",n]})]})}function ei({screenshot:e,coordinates:t,viewportDimensions:n,className:r="",zoomLevel:i=2.5}){const o=s(),a=U.useRef(null),l=U.useRef(null),c=U.useRef(null),[d,u]=U.useState(1),[h,p]=U.useState({x:50,y:50});return U.useEffect(()=>{const e=()=>{if(a.current&&l.current){const e=a.current,s=l.current,r=n?.width||e.naturalWidth,o=n?.height||e.naturalHeight,c=e.naturalWidth/r,d=e.naturalHeight/o,u=t[0]*c,h=t[1]*d,m=s.offsetWidth,f=s.offsetHeight,g=m/e.naturalWidth,y=f/e.naturalHeight,x=Math.min(g,y),C=e.naturalWidth*x,b=e.naturalHeight*x,w=(m-C)/2,v=(f-b)/2,k=u*x+w,M=h*x+v,S=w*i/(i-1),N=((w+C)*i-m)/(i-1),T=v*i/(i-1),E=((v+b)*i-f)/(i-1),j=(k*i-m)/(i-1),A=k*i/(i-1),I=(M*i-f)/(i-1),O=M*i/(i-1),L=Math.max(S,j),D=Math.min(N,A),R=Math.max(T,I),_=Math.min(E,O);let P=k,V=M;L<=D&&(P=Math.max(L,Math.min(D,k))),R<=_&&(V=Math.max(R,Math.min(_,M)));p({x:P/m*100,y:V/f*100})}},s=a.current;if(s){if(!s.complete)return s.addEventListener("load",e),()=>s.removeEventListener("load",e);e()}return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[e,t,n,i]),U.useEffect(()=>{u(1);const e=setTimeout(()=>{u(i)},300);return()=>clearTimeout(e)},[e,i]),q.jsx("div",{ref:l,className:`relative overflow-hidden ${r}`,children:q.jsx("div",{ref:c,className:"w-full h-full",style:{transform:`scale(${d})`,transformOrigin:`${h.x}% ${h.y}%`,transition:"transform 0.6s ease-out"},children:q.jsx("img",{ref:a,src:e,alt:o.formatMessage({defaultMessage:"Screenshot with click location",id:"5n05oJw5CD"}),className:"w-full h-full",style:{objectFit:"contain"}})})})}function ti({screenshot:e,startCoordinate:t,endCoordinate:n,className:r=""}){const i=s(),[o,a]=U.useState({width:0,height:0}),l=U.useRef(null);U.useEffect(()=>{if(l.current){const e=()=>{l.current&&a({width:l.current.offsetWidth,height:l.current.offsetHeight})};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}},[e]);const[c,d]=t,[u,h]=n,p=o.width>0?o.width/(l.current?.naturalWidth||o.width):1,m=o.height>0?o.height/(l.current?.naturalHeight||o.height):1,f=c*p,g=d*m,y=u*p,x=h*m;return q.jsxs("div",{className:`relative inline-block ${r}`,children:[q.jsx("img",{ref:l,src:e,alt:i.formatMessage({defaultMessage:"Screenshot with drag path",id:"cF32KOfDNQ"}),className:"max-w-full h-auto hover:rotate-2 transition-transform duration-150 ease-out",onLoad:()=>{l.current&&a({width:l.current.offsetWidth,height:l.current.offsetHeight})}}),o.width>0&&q.jsxs(q.Fragment,{children:[q.jsxs("svg",{className:"absolute pointer-events-none",style:{left:0,top:0,width:"100%",height:"100%",zIndex:15},children:[q.jsx("defs",{children:q.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:q.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#dc2626"})})}),q.jsx("line",{x1:f,y1:g,x2:y,y2:x,stroke:"#dc2626",strokeWidth:"2",markerEnd:"url(#arrowhead)"})]}),q.jsx("div",{className:"absolute bg-bg-000 border-2 border-accent-secondary-100 rounded-full",style:{left:`${f}px`,top:`${g}px`,width:"8px",height:"8px",transform:"translate(-50%, -50%)",zIndex:20}}),q.jsx("div",{className:"absolute bg-bg-000 border-2 border-danger-200 rounded-full",style:{left:`${y}px`,top:`${x}px`,width:"8px",height:"8px",transform:"translate(-50%, -50%)",zIndex:20}})]})]})}
/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ni=c("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),si=c("list-checks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]),ri=c("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function ii(e){return/^mcp__[0-9a-f-]+__/.test(e)}const oi=e=>q.jsxs(l,{...e,children:[q.jsx("path",{d:"M10.8139 17.5841L7.08902 8.12868C6.76198 7.29851 7.60347 6.48813 8.42074 6.84621L17.6697 10.8985C18.6008 11.3065 18.4 12.6821 17.3912 12.8069L14.3103 13.1881C13.8869 13.2405 13.5433 13.5557 13.4548 13.973L12.7225 17.4251C12.5168 18.3949 11.1772 18.5065 10.8139 17.5841Z",stroke:"currentColor",fill:"none",strokeWidth:"1"}),q.jsx("path",{d:"M5 5L3 3",stroke:"currentColor",strokeLinecap:"round"}),q.jsx("path",{d:"M8.36609 3.82843L8.36609 1.63391",stroke:"currentColor",strokeLinecap:"round"}),q.jsx("path",{d:"M3.82843 8.4624H1.5376",stroke:"currentColor",strokeLinecap:"round"})]}),ai=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M8.5284 16.4959L3.99583 4.99017C3.6688 4.16 4.51029 3.34963 5.32755 3.7077L16.6268 8.65832C17.5578 9.06626 17.3571 10.4419 16.3482 10.5667L12.2422 11.0747C11.8188 11.1271 11.4753 11.4423 11.3868 11.8596L10.437 16.3369C10.2313 17.3066 8.89175 17.4182 8.5284 16.4959Z",stroke:"currentColor",fill:"none",strokeWidth:"1"})}),li=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M9.77051 6.99976C10.7236 6.99987 11.5443 7.67268 11.7314 8.60718L12.4102 11.9998H14.3906L13.7344 8.72339C13.6503 8.3028 13.2814 7.9999 12.8525 7.99976H12.5C12.224 7.99976 12.0002 7.77576 12 7.49976C12 7.22361 12.2239 6.99976 12.5 6.99976H12.8525C13.7581 6.9999 14.5382 7.63909 14.7158 8.5271L15.4102 11.9998H17.3906L16.7344 8.72339C16.6503 8.3028 16.2814 7.9999 15.8525 7.99976H15.5C15.224 7.99976 15.0002 7.77576 15 7.49976C15 7.22361 15.2239 6.99976 15.5 6.99976H15.8525C16.7581 6.9999 17.5382 7.63909 17.7158 8.5271L18.4902 12.4021C18.5194 12.5488 18.4815 12.7015 18.3867 12.8171C18.2918 12.9327 18.1496 12.9997 18 12.9998H2.5C2.43885 12.9998 2.38012 12.9857 2.32422 12.9646C2.31718 12.9619 2.30962 12.9607 2.30273 12.9578C2.28147 12.9486 2.262 12.9366 2.24219 12.9246C2.23265 12.9187 2.22297 12.9134 2.21387 12.907C2.19638 12.8947 2.17994 12.8815 2.16406 12.8669C2.15403 12.8577 2.14402 12.8486 2.13477 12.8386C2.12793 12.8313 2.1197 12.825 2.11328 12.8171C2.10702 12.8095 2.10244 12.8007 2.09668 12.7927C2.08824 12.7811 2.08068 12.7689 2.07324 12.7566C2.06252 12.7387 2.0523 12.7208 2.04395 12.7019C2.03919 12.6912 2.03623 12.6798 2.03223 12.6687C2.02468 12.6477 2.01639 12.627 2.01172 12.6052C2.00939 12.5944 2.00943 12.5831 2.00781 12.572C1.99968 12.5161 1.99848 12.4588 2.00977 12.4021L2.76855 8.60718C2.95571 7.67268 3.7764 6.99986 4.72949 6.99976H9.77051ZM4.72949 7.99976C4.25302 7.99986 3.84263 8.33629 3.74902 8.80347L3.10938 11.9998H11.3906L10.751 8.80347C10.6574 8.33629 10.247 7.99987 9.77051 7.99976H4.72949Z",fill:"currentColor"})}),ci=e=>e.split("_").map((e,t)=>0===t?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():e.toLowerCase()).join(" "),di=new Set(["computer","click","navigate","read_page","find","screenshot","get_page_text","form_input","type","wait","tabs_create","tabs_context","upload_image","read_console_messages","read_network_requests","resize_window","gif_creator","execute_js"]),ui=e=>"string"==typeof e?e:e.domain,hi=({plan:e,isCollapsible:t=!1,defaultCollapsed:n=!1,showHeader:s=!0})=>{const[i,o]=U.useState(n),a=me(e.domains,"domains"),l=me(e.approach,"approach"),c=q.jsxs("div",{className:"space-y-3",children:[a.length>0&&q.jsxs("div",{children:[q.jsx("h4",{className:"font-small text-text-400 mb-2",style:{fontFamily:"var(--font-ui-serif)",fontSize:"0.75rem",fontWeight:430},children:q.jsx(r,{defaultMessage:"Visit these sites",id:"cv8yc1KJ7n"})}),q.jsx("div",{className:"border-[0.5px] border-border-300 rounded-xl px-3 py-2 space-y-1.5",children:a.map((e,t)=>q.jsx("div",{className:"font-base text-text-100",children:ui(e)},t))})]}),l.length>0&&q.jsxs("div",{children:[q.jsx("h4",{className:"font-small text-text-400 mb-2",style:{fontFamily:"var(--font-ui-serif)",fontSize:"0.75rem",fontWeight:430},children:q.jsx(r,{defaultMessage:"Follow this approach",id:"YREuYaOzoG"})}),q.jsx("div",{className:"border-[0.5px] border-border-300 rounded-xl px-3 py-2 space-y-2",children:l.map((e,t)=>q.jsxs("div",{className:"flex gap-2 font-base text-text-100",children:[q.jsx("span",{className:"text-text-100","aria-hidden":"true",children:"•"}),q.jsx("span",{className:"flex-1",children:e})]},t))})]})]});return t?q.jsxs("div",{className:"space-y-3",children:[s&&q.jsxs("button",{onClick:()=>o(!i),className:"flex items-center gap-2 w-full text-left group",children:[q.jsx(si,{size:16,className:"text-text-300"}),q.jsx(d,{size:14,className:u("text-text-400 transition-transform",i?"-rotate-90":"")}),q.jsx("span",{className:"font-base-bold text-text-200 group-hover:text-text-100",children:q.jsx(r,{defaultMessage:"Follow the plan",id:"e8VD9vcoJC"})})]}),!i&&c]}):q.jsx("div",{className:"space-y-3",children:c})},pi=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M10 3C10.2761 3 10.5 3.22386 10.5 3.5V9.5H16.5L16.6006 9.50977C16.8286 9.55629 17 9.75829 17 10C17 10.2417 16.8286 10.4437 16.6006 10.4902L16.5 10.5H10.5V16.5C10.5 16.7761 10.2761 17 10 17C9.72386 17 9.5 16.7761 9.5 16.5V10.5H3.5C3.22386 10.5 3 10.2761 3 10C3 9.72386 3.22386 9.5 3.5 9.5H9.5V3.5C9.5 3.22386 9.72386 3 10 3Z"})}),mi=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M10 3C10.2761 3.00006 10.5 3.2239 10.5 3.5V15.293L14.6465 11.1465C14.8418 10.9514 15.1583 10.9513 15.3536 11.1465C15.5487 11.3417 15.5486 11.6583 15.3536 11.8535L10.3535 16.8535C10.2598 16.9473 10.1326 17 10 17C9.90062 17 9.8042 16.9703 9.72268 16.916L9.64651 16.8535L4.6465 11.8535C4.45138 11.6582 4.45128 11.3417 4.6465 11.1465C4.84172 10.9513 5.15827 10.9514 5.35353 11.1465L9.50003 15.293V3.5C9.50003 3.22386 9.72389 3 10 3Z"})}),fi=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M8.14648 4.64648C8.34176 4.45136 8.6583 4.45127 8.85352 4.64648C9.04868 4.8417 9.04862 5.15826 8.85352 5.35352L4.70703 9.50001H16.5C16.7761 9.50001 17 9.72387 17 10C16.9999 10.2761 16.7761 10.5 16.5 10.5H4.70703L8.85352 14.6465C9.04863 14.8418 9.04873 15.1583 8.85352 15.3535C8.6583 15.5487 8.34174 15.5486 8.14648 15.3535L3.14648 10.3535C3.05274 10.2598 3.00003 10.1326 3 10C3 9.90061 3.02967 9.80418 3.08398 9.72267L3.14648 9.64649L8.14648 4.64648Z"})}),gi=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M11.1465 4.64648C11.3417 4.45127 11.6582 4.45136 11.8535 4.64648L16.8535 9.64649L16.916 9.72267C16.9703 9.80418 17 9.90061 17 10C17 10.1326 16.9473 10.2598 16.8535 10.3535L11.8535 15.3535C11.6583 15.5486 11.3417 15.5487 11.1465 15.3535C10.9513 15.1583 10.9514 14.8418 11.1465 14.6465L15.293 10.5H3.5C3.2239 10.5 3.00006 10.2761 3 10C3 9.72387 3.22386 9.50001 3.5 9.50001H15.293L11.1465 5.35352C10.9514 5.15826 10.9513 4.8417 11.1465 4.64648Z"})}),yi=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M10 3C10.1326 3.00003 10.2598 3.05274 10.3535 3.14648L15.3536 8.14648C15.5486 8.34174 15.5487 8.6583 15.3536 8.85352C15.1583 9.04873 14.8418 9.04863 14.6465 8.85352L10.5 4.70703V16.5C10.5 16.7761 10.2761 16.9999 10 17C9.72389 17 9.50003 16.7761 9.50003 16.5V4.70703L5.35353 8.85352C5.15827 9.04862 4.84172 9.04868 4.6465 8.85352C4.45128 8.6583 4.45138 8.34176 4.6465 8.14648L9.64651 3.14648L9.72268 3.08398C9.8042 3.02967 9.90062 3 10 3Z"})}),xi=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M12 3C12.4721 3 12.9169 3.222 13.2002 3.59961L14.25 5H16.5C17.3284 5 18 5.67157 18 6.5V15.5C18 16.3284 17.3284 17 16.5 17H3.5C2.67157 17 2 16.3284 2 15.5V6.5C2 5.67157 2.67157 5 3.5 5H5.75L6.7998 3.59961L6.91309 3.46582C7.19443 3.17009 7.58677 3 8 3H12ZM8 4C7.88217 4 7.76948 4.04152 7.68066 4.11523L7.59961 4.2002L6.40039 5.7998C6.30596 5.92571 6.15738 6 6 6H3.5C3.22386 6 3 6.22386 3 6.5V15.5C3 15.7761 3.22386 16 3.5 16H16.5C16.7761 16 17 15.7761 17 15.5V6.5C17 6.22386 16.7761 6 16.5 6H14C13.8426 6 13.694 5.92571 13.5996 5.7998L12.4004 4.2002C12.306 4.07429 12.1574 4 12 4H8ZM10 7C11.933 7 13.5 8.567 13.5 10.5C13.5 12.433 11.933 14 10 14C8.067 14 6.5 12.433 6.5 10.5C6.5 8.567 8.067 7 10 7ZM10 8C8.61929 8 7.5 9.11929 7.5 10.5C7.5 11.8807 8.61929 13 10 13C11.3807 13 12.5 11.8807 12.5 10.5C12.5 9.11929 11.3807 8 10 8Z"})}),Ci=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M7.12771 5.16489C7.28926 4.98544 7.55225 4.95072 7.75273 5.0682L7.83477 5.12778L12.835 9.62788C12.9402 9.72264 12.9999 9.85833 13 9.99995C13 10.1063 12.9667 10.2093 12.9053 10.2939L12.835 10.372L7.83477 14.8721C7.62952 15.0567 7.31242 15.0402 7.12771 14.835C6.94336 14.6298 6.95983 14.3126 7.16482 14.128L11.7519 9.99995L7.16482 5.87193L7.09744 5.79674C6.95939 5.60969 6.96617 5.34444 7.12771 5.16489Z"})}),bi=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M10 2.5C14.1421 2.5 17.5 5.85786 17.5 10C17.5 14.1421 14.1421 17.5 10 17.5H3C2.79779 17.5 2.61549 17.3782 2.53809 17.1914C2.4607 17.0046 2.50349 16.7895 2.64648 16.6465L4.35547 14.9365C3.20124 13.6175 2.5 11.8906 2.5 10C2.5 5.85786 5.85786 2.5 10 2.5ZM10 3.5C6.41015 3.5 3.5 6.41015 3.5 10C3.5 11.7952 4.22659 13.4199 5.40332 14.5967L5.46582 14.6729C5.52017 14.7544 5.5498 14.8508 5.5498 14.9502C5.5498 15.0828 5.49709 15.2099 5.40332 15.3037L4.20703 16.5H10C13.5899 16.5 16.5 13.5899 16.5 10C16.5 6.41015 13.5899 3.5 10 3.5ZM13.29 9.30371C13.3986 9.05001 13.6925 8.93174 13.9463 9.04004C14.2 9.14863 14.3183 9.44253 14.21 9.69629C13.8506 10.536 13.1645 11.25 12.25 11.25C11.6372 11.25 11.128 10.9289 10.75 10.4648C10.372 10.9289 9.86276 11.25 9.25 11.25C8.63724 11.25 8.12801 10.9289 7.75 10.4648C7.37198 10.9289 6.86276 11.25 6.25 11.25C5.97386 11.25 5.75 11.0261 5.75 10.75C5.75 10.4739 5.97386 10.25 6.25 10.25C6.58764 10.25 7.00448 9.97056 7.29004 9.30371L7.32422 9.2373C7.41431 9.09121 7.5749 9 7.75 9C7.9501 9 8.13123 9.11975 8.20996 9.30371L8.32227 9.53516C8.59804 10.0359 8.95442 10.25 9.25 10.25C9.58764 10.25 10.0045 9.97056 10.29 9.30371L10.3242 9.2373C10.4143 9.09121 10.5749 9 10.75 9C10.9501 9 11.1312 9.11975 11.21 9.30371L11.3223 9.53516C11.598 10.0359 11.9544 10.25 12.25 10.25C12.5876 10.25 13.0045 9.97056 13.29 9.30371Z"})}),wi=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M10 2.5C14.1421 2.5 17.5 5.85786 17.5 10C17.5 14.1421 14.1421 17.5 10 17.5H3C2.79779 17.5 2.61549 17.3782 2.53809 17.1914C2.4607 17.0046 2.50349 16.7895 2.64648 16.6465L4.35547 14.9365C3.20124 13.6175 2.5 11.8906 2.5 10C2.5 5.85786 5.85786 2.5 10 2.5ZM10 3.5C6.41015 3.5 3.5 6.41015 3.5 10C3.5 11.7952 4.22659 13.4199 5.40332 14.5967L5.46582 14.6729C5.52017 14.7544 5.5498 14.8508 5.5498 14.9502C5.5498 15.0828 5.49709 15.2099 5.40332 15.3037L4.20703 16.5H10C13.5899 16.5 16.5 13.5899 16.5 10C16.5 6.41015 13.5899 3.5 10 3.5ZM10 7C10.2761 7 10.5 7.22386 10.5 7.5V9.5H12.5C12.7761 9.5 13 9.72386 13 10C13 10.2761 12.7761 10.5 12.5 10.5H10.5V12.5C10.5 12.7761 10.2761 13 10 13C9.72386 13 9.5 12.7761 9.5 12.5V10.5H7.5C7.22386 10.5 7 10.2761 7 10C7 9.72386 7.22386 9.5 7.5 9.5H9.5V7.5C9.5 7.22386 9.72386 7 10 7Z"})}),vi=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"})}),ki=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M10 2.5C14.1421 2.5 17.5 5.85786 17.5 10C17.5 14.1421 14.1421 17.5 10 17.5C5.85786 17.5 2.5 14.1421 2.5 10C2.5 5.85786 5.85786 2.5 10 2.5ZM10 3.5C6.41015 3.5 3.5 6.41015 3.5 10C3.5 13.5899 6.41015 16.5 10 16.5C13.5899 16.5 16.5 13.5899 16.5 10C16.5 6.41015 13.5899 3.5 10 3.5ZM10 5C10.2761 5 10.5 5.22386 10.5 5.5V9.66895L13.6973 11.04L13.7852 11.0898C13.9763 11.2224 14.0552 11.4751 13.96 11.6973C13.8647 11.9193 13.6272 12.0372 13.3994 11.9902L13.3027 11.96L9.80273 10.46C9.61896 10.3811 9.5 10.2 9.5 10V5.5C9.5 5.22386 9.72386 5 10 5Z"})}),Mi=({size:e=16,className:t=""})=>q.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 16 16",fill:"none",className:t,children:q.jsx("path",{d:"M11.25 9H10V7H11.25C11.695 7 12.13 6.86804 12.5 6.62081C12.87 6.37357 13.1584 6.02217 13.3287 5.61104C13.499 5.1999 13.5436 4.7475 13.4568 4.31105C13.37 3.87459 13.1557 3.47368 12.841 3.15901C12.5263 2.84434 12.1254 2.63005 11.689 2.54323C11.2525 2.45642 10.8001 2.50097 10.389 2.67127C9.97783 2.84157 9.62643 3.12996 9.37919 3.49997C9.13196 3.86998 9 4.30499 9 4.75V6H7V4.75C7 4.30499 6.86804 3.86998 6.62081 3.49997C6.37357 3.12996 6.02217 2.84157 5.61104 2.67127C5.1999 2.50097 4.7475 2.45642 4.31105 2.54323C3.87459 2.63005 3.47368 2.84434 3.15901 3.15901C2.84434 3.47368 2.63005 3.87459 2.54323 4.31105C2.45642 4.7475 2.50097 5.1999 2.67127 5.61104C2.84157 6.02217 3.12996 6.37357 3.49997 6.62081C3.86998 6.86804 4.30499 7 4.75 7H6V9H4.75C4.30499 9 3.86998 9.13196 3.49997 9.37919C3.12996 9.62643 2.84157 9.97783 2.67127 10.389C2.50097 10.8001 2.45642 11.2525 2.54323 11.689C2.63005 12.1254 2.84434 12.5263 3.15901 12.841C3.47368 13.1557 3.87459 13.37 4.31105 13.4568C4.7475 13.5436 5.1999 13.499 5.61104 13.3287C6.02217 13.1584 6.37357 12.87 6.62081 12.5C6.86804 12.13 7 11.695 7 11.25V10H9V11.25C9 11.695 9.13196 12.13 9.37919 12.5C9.62643 12.87 9.97783 13.1584 10.389 13.3287C10.8001 13.499 11.2525 13.5436 11.689 13.4568C12.1254 13.37 12.5263 13.1557 12.841 12.841C13.1557 12.5263 13.37 12.1254 13.4568 11.689C13.5436 11.2525 13.499 10.8001 13.3287 10.389C13.1584 9.97783 12.87 9.62643 12.5 9.37919C12.13 9.13196 11.695 9 11.25 9ZM10 4.75C10 4.50277 10.0733 4.2611 10.2107 4.05554C10.348 3.84998 10.5432 3.68976 10.7716 3.59515C11.0001 3.50054 11.2514 3.47579 11.4939 3.52402C11.7363 3.57225 11.9591 3.6913 12.1339 3.86612C12.3087 4.04093 12.4278 4.26366 12.476 4.50614C12.5242 4.74861 12.4995 4.99995 12.4049 5.22836C12.3102 5.45676 12.15 5.65199 11.9445 5.78934C11.7389 5.92669 11.4972 6 11.25 6H10V4.75ZM3.5 4.75C3.5 4.41848 3.6317 4.10054 3.86612 3.86612C4.10054 3.6317 4.41848 3.5 4.75 3.5C5.08152 3.5 5.39946 3.6317 5.63388 3.86612C5.8683 4.10054 6 4.41848 6 4.75V6H4.75C4.41848 6 4.10054 5.8683 3.86612 5.63388C3.6317 5.39946 3.5 5.08152 3.5 4.75ZM6 11.25C6 11.4972 5.92669 11.7389 5.78934 11.9445C5.65199 12.15 5.45676 12.3102 5.22836 12.4049C4.99995 12.4995 4.74861 12.5242 4.50614 12.476C4.26366 12.4278 4.04093 12.3087 3.86612 12.1339C3.6913 11.9591 3.57225 11.7363 3.52402 11.4939C3.47579 11.2514 3.50054 11.0001 3.59515 10.7716C3.68976 10.5432 3.84998 10.348 4.05554 10.2107C4.2611 10.0733 4.50277 10 4.75 10H6V11.25ZM7 7H9V9H7V7ZM11.25 12.5C10.9185 12.5 10.6005 12.3683 10.3661 12.1339C10.1317 11.8995 10 11.5815 10 11.25V10H11.25C11.5815 10 11.8995 10.1317 12.1339 10.3661C12.3683 10.6005 12.5 10.9185 12.5 11.25C12.5 11.5815 12.3683 11.8995 12.1339 12.1339C11.8995 12.3683 11.5815 12.5 11.25 12.5Z",fill:"currentColor"})}),Si=e=>U.useMemo(()=>navigator.platform.toUpperCase().indexOf("MAC")>=0||navigator.userAgent.toUpperCase().indexOf("MAC")>=0,[])?q.jsx(Mi,{...e}):q.jsx("span",{className:"text-text-500 font-normal",children:"Ctrl +"}),Ni=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M10 14C10.8284 14 11.5 14.6716 11.5 15.5C11.5 16.3284 10.8284 17 10 17C9.17157 17 8.5 16.3284 8.5 15.5C8.5 14.6716 9.17157 14 10 14ZM10 8.5C10.8284 8.5 11.5 9.17157 11.5 10C11.5 10.8284 10.8284 11.5 10 11.5C9.17157 11.5 8.5 10.8284 8.5 10C8.5 9.17157 9.17157 8.5 10 8.5ZM10 3C10.8284 3 11.5 3.67157 11.5 4.5C11.5 5.32843 10.8284 6 10 6C9.17157 6 8.5 5.32843 8.5 4.5C8.5 3.67157 9.17157 3 10 3Z"})}),Ti=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M9.72821 2.87934C10.0318 2.10869 10.9028 1.72933 11.6735 2.03266L14.4655 3.13226C15.236 3.43593 15.6145 4.30697 15.3112 5.07758L11.3903 15.0307C11.2954 15.2717 11.1394 15.4835 10.9391 15.6459L10.8513 15.7123L7.7077 17.8979C7.29581 18.1843 6.73463 17.9917 6.57294 17.5356L6.54657 17.4409L5.737 13.6987C5.67447 13.4092 5.69977 13.107 5.80829 12.8315L9.72821 2.87934ZM6.73798 13.1987C6.70201 13.2903 6.69385 13.3906 6.71454 13.4868L7.44501 16.8627L10.28 14.892L10.3376 14.8452C10.3909 14.7949 10.4325 14.7332 10.4597 14.6645L13.0974 7.96723L9.37567 6.50141L6.73798 13.1987ZM11.3073 2.96332C11.0504 2.86217 10.7601 2.98864 10.6589 3.24555L9.74188 5.57074L13.4636 7.03754L14.3806 4.71137C14.4817 4.45445 14.3552 4.16413 14.0983 4.06293L11.3073 2.96332Z"})}),Ei=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M11.0974 2.04754C11.8559 1.36502 13.1023 1.62953 13.4919 2.61785L14.4558 5.06414C15.6023 4.86154 16.7713 5.48673 17.2145 6.61199C17.6576 7.73723 17.2274 8.98904 16.2507 9.62273L17.2155 12.071C17.6307 13.1254 16.7716 14.2422 15.6462 14.111L11.3727 13.61L12.3366 16.0563C12.6402 16.827 12.2615 17.6979 11.4909 18.0016L10.5602 18.3688C9.78952 18.6723 8.91852 18.2929 8.61493 17.5221L7.33173 14.2663L6.86689 14.4499C5.06846 15.1581 3.03623 14.2737 2.32782 12.4753C1.61965 10.6769 2.50309 8.64461 4.30146 7.93621L6.85907 6.92937C6.93572 6.89918 7.00401 6.84961 7.05732 6.7868L10.9528 2.19695L11.0974 2.04754ZM9.66669 13.4108C9.58487 13.4012 9.50115 13.4119 9.4245 13.4421L8.26239 13.8991L9.5456 17.1559C9.6468 17.4129 9.93711 17.5394 10.194 17.4382L11.1247 17.072C11.3814 16.9707 11.507 16.6803 11.4059 16.4235L10.2468 13.4782L9.66669 13.4108ZM4.66767 8.86687C3.38323 9.373 2.75252 10.8245 3.25849 12.1091C3.76452 13.3937 5.21604 14.0253 6.50067 13.5192L8.82587 12.6022L6.99384 7.94988L4.66767 8.86687ZM12.5612 2.98504C12.4313 2.65568 12.0162 2.56714 11.7634 2.79461L11.7145 2.84441L7.85028 7.39617L9.82978 12.4225L15.7614 13.1179C16.1365 13.1617 16.4229 12.7896 16.2849 12.4382L12.5612 2.98504ZM14.8356 6.02996L15.8708 8.65887C16.3372 8.25373 16.5232 7.58576 16.2839 6.9782C16.0445 6.37071 15.453 6.00819 14.8356 6.02996Z"})}),ji=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M11.5859 2C11.9837 2.00004 12.3652 2.15818 12.6465 2.43945L15.5605 5.35352C15.8418 5.63478 16 6.01629 16 6.41406V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.72334 18 4.08461 17.4097 4.00781 16.6533L4 16.5V3.5C4 2.67157 4.67157 2 5.5 2H11.5859ZM5.5 3C5.22386 3 5 3.22386 5 3.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V7H12.5C11.6716 7 11 6.32843 11 5.5V3H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM12 5.5C12 5.77614 12.2239 6 12.5 6H14.793L12 3.20703V5.5Z"})}),Ai=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M7.2705 3.0498C11.1054 1.5437 15.4369 3.42942 16.9473 7.26367C18.4585 11.1003 16.5729 15.4359 12.7363 16.9473C8.89982 18.4583 4.56416 16.5736 3.05272 12.7373C1.54288 8.90435 3.42282 4.57201 7.25194 3.05663C7.25547 3.05522 7.25914 3.05413 7.26269 3.05273C7.26523 3.05172 7.26795 3.05079 7.2705 3.0498ZM8.64159 14.5283C8.05764 14.958 7.56418 15.4198 7.17772 15.8896C8.21355 16.3858 9.37633 16.6096 10.5508 16.5098C10.2224 16.2862 9.89754 16.0029 9.58202 15.6748C9.26312 15.3432 8.94744 14.9583 8.64159 14.5283ZM13.1572 12.5351C12.5305 12.6659 11.8818 12.8585 11.2275 13.1162C10.5729 13.3741 9.96666 13.6758 9.41894 14.0078C9.6946 14.3937 9.97385 14.7371 10.2539 15.0283C10.7036 15.4959 11.1332 15.8156 11.5117 15.9863C11.8879 16.1559 12.1765 16.1643 12.3935 16.0791C12.6107 15.9936 12.8179 15.7903 12.9775 15.4092C13.1379 15.0262 13.2342 14.4991 13.2441 13.8506C13.2503 13.4466 13.2187 13.0053 13.1572 12.5351ZM3.63768 8.51855C3.34594 9.76629 3.4167 11.1121 3.92186 12.3945C4.42675 13.6762 5.29203 14.7083 6.35546 15.4219C6.82009 14.8304 7.4201 14.2628 8.12694 13.748C7.6691 12.9972 7.2458 12.1466 6.88378 11.2275C6.52163 10.3082 6.25055 9.397 6.07323 8.53515C5.20566 8.64053 4.38055 8.63422 3.63768 8.51855ZM16.081 12.3828C15.4777 12.3027 14.8015 12.3016 14.081 12.3857C14.1506 12.9087 14.1838 13.4053 14.1767 13.8652C14.1698 14.3208 14.124 14.75 14.0361 15.1377C14.9636 14.4096 15.6617 13.4524 16.081 12.3828ZM11.0947 6.7705C10.4885 7.14026 9.82394 7.47239 9.11425 7.75195C8.40436 8.03157 7.69176 8.2418 6.99608 8.38476C7.16147 9.17591 7.41289 10.0225 7.75292 10.8857C8.09272 11.7483 8.48601 12.5376 8.90429 13.2285C9.51056 12.8587 10.176 12.5276 10.8857 12.248C11.5954 11.9685 12.3075 11.7572 13.0029 11.6143C12.8376 10.8236 12.5869 9.97794 12.2471 9.11523C11.907 8.25206 11.5133 7.46188 11.0947 6.7705ZM13.6426 4.57714C13.178 5.16855 12.5788 5.73625 11.8721 6.25097C12.3302 7.00222 12.754 7.85307 13.1162 8.77245C13.4782 9.69152 13.7485 10.6024 13.9258 11.4639C14.7932 11.3584 15.6185 11.3649 16.3613 11.4805C16.6528 10.233 16.5841 8.88752 16.0791 7.60546C15.5738 6.32297 14.707 5.29067 13.6426 4.57714ZM5.9619 4.86327C5.03547 5.59096 4.33712 6.54756 3.91796 7.6162C4.52106 7.69641 5.19677 7.69821 5.91698 7.61425C5.84736 7.09104 5.81616 6.59385 5.82323 6.13378C5.83026 5.679 5.87418 5.25038 5.9619 4.86327ZM8.48827 4.01367C8.11174 3.8439 7.82256 3.83644 7.60546 3.92187C7.38849 4.0075 7.182 4.20998 7.02245 4.59081C6.86212 4.97369 6.76585 5.50006 6.75585 6.14843C6.74965 6.55226 6.78027 6.99382 6.84179 7.46386C7.46863 7.33317 8.11803 7.14252 8.77245 6.88476C9.42675 6.62702 10.0316 6.32305 10.5791 5.9912C10.3036 5.6057 10.0259 5.26167 9.74608 4.9707C9.29651 4.50322 8.8667 4.18435 8.48827 4.01367ZM12.8223 4.10937C11.7866 3.61351 10.6234 3.3904 9.44921 3.49023C9.77744 3.71355 10.1026 3.99633 10.418 4.32421C10.7368 4.65579 11.0526 5.04068 11.3584 5.4707C11.9424 5.04095 12.4358 4.57931 12.8223 4.10937Z"})}),Ii=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M16.5 4C17.3284 4 18 4.67157 18 5.5V14.5C18 15.3284 17.3284 16 16.5 16H3.5C2.67157 16 2 15.3284 2 14.5V5.5C2 4.67157 2.67157 4 3.5 4H16.5ZM3.5 5C3.22386 5 3 5.22386 3 5.5V14.5C3 14.7761 3.22386 15 3.5 15H16.5C16.7761 15 17 14.7761 17 14.5V5.5C17 5.22386 16.7761 5 16.5 5H3.5ZM12.5 12C12.7761 12 13 12.2239 13 12.5C13 12.7761 12.7761 13 12.5 13H7.5C7.22386 13 7 12.7761 7 12.5C7 12.2239 7.22386 12 7.5 12H12.5ZM6.25 9.5C6.66421 9.5 7 9.83579 7 10.25C7 10.6642 6.66421 11 6.25 11C5.83579 11 5.5 10.6642 5.5 10.25C5.5 9.83579 5.83579 9.5 6.25 9.5ZM8.75 9.5C9.16421 9.5 9.5 9.83579 9.5 10.25C9.5 10.6642 9.16421 11 8.75 11C8.33579 11 8 10.6642 8 10.25C8 9.83579 8.33579 9.5 8.75 9.5ZM11.25 9.5C11.6642 9.5 12 9.83579 12 10.25C12 10.6642 11.6642 11 11.25 11C10.8358 11 10.5 10.6642 10.5 10.25C10.5 9.83579 10.8358 9.5 11.25 9.5ZM13.75 9.5C14.1642 9.5 14.5 9.83579 14.5 10.25C14.5 10.6642 14.1642 11 13.75 11C13.3358 11 13 10.6642 13 10.25C13 9.83579 13.3358 9.5 13.75 9.5ZM6.25 7C6.66421 7 7 7.33579 7 7.75C7 8.16421 6.66421 8.5 6.25 8.5C5.83579 8.5 5.5 8.16421 5.5 7.75C5.5 7.33579 5.83579 7 6.25 7ZM8.75 7C9.16421 7 9.5 7.33579 9.5 7.75C9.5 8.16421 9.16421 8.5 8.75 8.5C8.33579 8.5 8 8.16421 8 7.75C8 7.33579 8.33579 7 8.75 7ZM11.25 7C11.6642 7 12 7.33579 12 7.75C12 8.16421 11.6642 8.5 11.25 8.5C10.8358 8.5 10.5 8.16421 10.5 7.75C10.5 7.33579 10.8358 7 11.25 7ZM13.75 7C14.1642 7 14.5 7.33579 14.5 7.75C14.5 8.16421 14.1642 8.5 13.75 8.5C13.3358 8.5 13 8.16421 13 7.75C13 7.33579 13.3358 7 13.75 7Z"})}),Oi=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M8 14C8 14.5523 8.44772 15 9 15H9.5C9.77614 15 10 15.2239 10 15.5C10 15.7761 9.77614 16 9.5 16H9C8.40169 16 7.86651 15.7357 7.5 15.3193C7.13349 15.7357 6.59831 16 6 16H5.5C5.22386 16 5 15.7761 5 15.5C5 15.2239 5.22386 15 5.5 15H6C6.55228 15 7 14.5523 7 14V13.5L7.00098 6.5H7V6C7 5.44772 6.55228 5 6 5H5.5C5.22386 5 5 4.77614 5 4.5C5 4.22386 5.22386 4 5.5 4H6C6.59805 4 7.1335 4.26363 7.5 4.67969C7.8665 4.26363 8.40195 4 9 4H9.5C9.77614 4 10 4.22386 10 4.5C10 4.77614 9.77614 5 9.5 5H9C8.44772 5 8 5.44772 8 6V6.5H8.00098L8 13.5V14ZM5.5 7C5.77614 7 6 7.22386 6 7.5C6 7.77614 5.77614 8 5.5 8H3.5C3.22386 8 3 8.22386 3 8.5V11.5C3 11.7761 3.22386 12 3.5 12H5.5C5.77614 12 6 12.2239 6 12.5C6 12.7761 5.77614 13 5.5 13H3.5C2.67157 13 2 12.3284 2 11.5V8.5C2 7.67157 2.67157 7 3.5 7H5.5ZM16.5 7C17.3284 7 18 7.67157 18 8.5V11.5C18 12.3284 17.3284 13 16.5 13H9.5C9.22386 13 9 12.7761 9 12.5C9 12.2239 9.22386 12 9.5 12H16.5C16.7761 12 17 11.7761 17 11.5V8.5C17 8.22386 16.7761 8 16.5 8H9.5C9.22386 8 9 7.77614 9 7.5C9 7.22386 9.22386 7 9.5 7H16.5Z"})}),Li=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M8.5 2C12.0899 2 15 4.91015 15 8.5C15 10.1149 14.4094 11.5908 13.4346 12.7275L17.8535 17.1465L17.918 17.2246C18.0461 17.4187 18.0244 17.6827 17.8535 17.8535C17.6827 18.0244 17.4187 18.0461 17.2246 17.918L17.1465 17.8535L12.7275 13.4346C11.5908 14.4094 10.1149 15 8.5 15C4.91015 15 2 12.0899 2 8.5C2 4.91015 4.91015 2 8.5 2ZM8.5 3C5.46243 3 3 5.46243 3 8.5C3 11.5376 5.46243 14 8.5 14C11.5376 14 14 11.5376 14 8.5C14 5.46243 11.5376 3 8.5 3Z"})}),Di=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M10.5488 2C11.3503 2 12 2.64973 12 3.45117C12 3.64554 12.1376 3.85418 12.3848 3.95215C12.4534 3.97933 12.5215 4.00769 12.5889 4.03711L12.6797 4.06934C12.8914 4.12916 13.094 4.07583 13.2148 3.95508C13.7824 3.38817 14.7023 3.38882 15.2695 3.95605L16.0439 4.73047L16.1436 4.84082C16.6091 5.41137 16.5761 6.25346 16.0439 6.78516C15.9061 6.92297 15.8568 7.16748 15.9629 7.41016L16.0479 7.61523L16.0898 7.70215C16.1981 7.8943 16.3787 7.99998 16.5488 8C17.3503 8 18 8.64973 18 9.45117V10.5488C18 11.3503 17.3503 12 16.5488 12C16.3787 12 16.1982 12.1057 16.0898 12.2979L16.0479 12.3848C16.0206 12.4533 15.9923 12.5216 15.9629 12.5889C15.8567 12.8317 15.9059 13.0768 16.0439 13.2148C16.6113 13.7823 16.6113 14.7021 16.0439 15.2695L15.2695 16.0439C14.7021 16.6113 13.7823 16.6113 13.2148 16.0439C13.0941 15.9232 12.8914 15.87 12.6797 15.9297L12.5889 15.9629C12.5219 15.9921 12.4539 16.0198 12.3857 16.0469C12.1385 16.1449 12.0002 16.3534 12 16.5479C12 17.3496 11.3496 18 10.5479 18H9.45215C8.6504 18 8 17.3496 8 16.5479C7.99981 16.3776 7.89419 16.1969 7.70215 16.0889L7.61523 16.0469C7.5465 16.0197 7.4777 15.9914 7.41016 15.9619C7.16721 15.8561 6.92289 15.9062 6.78516 16.0439C6.25346 16.5761 5.41137 16.6091 4.84082 16.1436L4.73047 16.0439L3.95605 15.2695C3.38882 14.7023 3.38817 13.7824 3.95508 13.2148L4.00293 13.1582C4.089 13.0359 4.1206 12.8611 4.06934 12.6797L4.03711 12.5889C4.00769 12.5215 3.97933 12.4534 3.95215 12.3848C3.85418 12.1376 3.64554 12 3.45117 12C2.64973 12 2 11.3503 2 10.5488V9.45117C2 8.64973 2.64973 8 3.45117 8C3.64551 7.99998 3.85336 7.86221 3.95117 7.61523L4.03711 7.41016L4.06934 7.31934C4.12058 7.13786 4.0891 6.963 4.00293 6.84082L3.95508 6.78516C3.38796 6.21804 3.38796 5.29759 3.95508 4.73047L4.73047 3.95508L4.84082 3.85547C5.41121 3.39018 6.25345 3.42338 6.78516 3.95508C6.92296 4.09285 7.16718 4.14308 7.41016 4.03711C7.47794 4.00754 7.54625 3.97848 7.61523 3.95117C7.86221 3.85336 7.99998 3.64551 8 3.45117C8 2.64973 8.64973 2 9.45117 2H10.5488ZM9.45117 3C9.20202 3 9 3.20202 9 3.45117C8.99998 4.12476 8.54338 4.66017 7.9834 4.88184C7.92515 4.9049 7.86686 4.92814 7.80957 4.95312C7.25608 5.19449 6.55378 5.13969 6.07715 4.66309C5.92261 4.50854 5.68432 4.48855 5.50879 4.60449L5.43848 4.66309L4.66309 5.43848C4.48649 5.61507 4.48649 5.90055 4.66309 6.07715C5.10986 6.52395 5.18607 7.1692 4.99512 7.7041L4.95312 7.80957C4.92814 7.86686 4.9049 7.92515 4.88184 7.9834C4.66017 8.54338 4.12476 8.99998 3.45117 9C3.20202 9 3 9.20202 3 9.45117V10.5488C3 10.798 3.20202 11 3.45117 11C4.12476 11 4.65999 11.4569 4.88184 12.0166C4.90472 12.0743 4.92834 12.1317 4.95312 12.1885C5.1948 12.7421 5.13958 13.4449 4.66309 13.9219C4.48628 14.0988 4.48621 14.3856 4.66309 14.5625L5.4375 15.3369L5.50879 15.3955C5.6843 15.5112 5.92272 15.4914 6.07715 15.3369C6.55382 14.8599 7.25685 14.8044 7.81055 15.0459C7.86752 15.0707 7.92546 15.0943 7.9834 15.1172L8.08691 15.1631C8.59842 15.4071 8.99981 15.9165 9 16.5479C9 16.7973 9.20268 17 9.45215 17H10.5479C10.7973 17 11 16.7973 11 16.5479C11.0002 15.8742 11.4568 15.3391 12.0166 15.1172C12.0743 15.0943 12.1317 15.0707 12.1885 15.0459L12.2939 15.0039C12.8292 14.8126 13.4747 14.8898 13.9219 15.3369C14.0988 15.5138 14.3856 15.5138 14.5625 15.3369L15.3369 14.5625C15.5138 14.3856 15.5138 14.0988 15.3369 13.9219C14.86 13.445 14.8046 12.7424 15.0469 12.1885C15.0718 12.1315 15.0952 12.0735 15.1182 12.0156L15.1641 11.9121C15.4084 11.4013 15.9175 11 16.5488 11C16.798 11 17 10.798 17 10.5488V9.45117C17 9.20202 16.798 9 16.5488 9C15.9172 8.99998 15.4081 8.59825 15.1641 8.08691L15.1182 7.9834L15.0459 7.81055C14.8038 7.25675 14.8599 6.55381 15.3369 6.07715C15.4914 5.92272 15.5112 5.6843 15.3955 5.50879L15.3369 5.4375L14.5625 4.66309C14.4079 4.50844 14.169 4.48878 13.9932 4.60449L13.9219 4.66309C13.4449 5.13958 12.7421 5.1948 12.1885 4.95312L12.0166 4.88184C11.4569 4.65999 11 4.12476 11 3.45117C11 3.20202 10.798 3 10.5488 3H9.45117ZM10 7C11.6569 7 13 8.34315 13 10C13 11.6569 11.6569 13 10 13C8.34315 13 7 11.6569 7 10C7 8.34315 8.34315 7 10 7ZM10 8C8.89543 8 8 8.89543 8 10C8 11.1046 8.89543 12 10 12C11.1046 12 12 11.1046 12 10C12 8.89543 11.1046 8 10 8Z"})}),Ri=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M5.99999 13.5C6.55227 13.5 6.99998 13.9478 6.99999 14.5V16.5C6.99999 17.0523 6.55228 17.5 5.99999 17.5H3.99999C3.44771 17.5 2.99999 17.0523 2.99999 16.5V14.5C3 13.9478 3.44772 13.5 3.99999 13.5H5.99999ZM3.99999 16.5H5.99999V14.5H3.99999V16.5ZM16.5 15C16.7761 15 17 15.2239 17 15.5C17 15.7762 16.7761 16 16.5 16H9.49999C9.22386 16 8.99999 15.7762 8.99999 15.5C9.00001 15.2239 9.22387 15 9.49999 15H16.5ZM5.99999 8.00002C6.55227 8.00002 6.99998 8.44775 6.99999 9.00002V11C6.99999 11.5523 6.55228 12 5.99999 12H3.99999C3.44771 12 2.99999 11.5523 2.99999 11V9.00002C3 8.44775 3.44772 8.00003 3.99999 8.00002H5.99999ZM3.99999 11H5.99999V9.00002H3.99999V11ZM16.5 9.50002C16.7761 9.50002 17 9.72389 17 10C17 10.2762 16.7761 10.5 16.5 10.5H9.49999C9.22386 10.5 8.99999 10.2762 8.99999 10C9.00001 9.7239 9.22387 9.50003 9.49999 9.50002H16.5ZM6.12597 2.91798C6.30923 2.71156 6.62549 2.69282 6.83202 2.87599C7.03846 3.05925 7.05721 3.37551 6.87402 3.58205L4.65624 6.08205C4.56198 6.18816 4.42708 6.24925 4.28515 6.25002C4.14315 6.25078 4.0075 6.19113 3.9121 6.08596L2.87987 4.94728L2.81932 4.86525C2.701 4.66516 2.7351 4.40248 2.91405 4.24025C3.09293 4.07823 3.35742 4.06993 3.54491 4.20705L3.62011 4.27541L4.27733 5.00002L6.12597 2.91798ZM16.5 4.00002C16.7761 4.00002 17 4.22389 17 4.50002C17 4.77616 16.7761 5.00002 16.5 5.00002H9.49999C9.22386 5.00001 8.99999 4.77615 8.99999 4.50002C9.00001 4.22389 9.22387 4.00002 9.49999 4.00002H16.5Z"})}),_i=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M11.3232 1.5C11.9365 1.50011 12.4881 1.87396 12.7158 2.44336L13.3379 4H17.5L17.6006 4.00977C17.8285 4.0563 18 4.25829 18 4.5C18 4.7417 17.8285 4.94371 17.6006 4.99023L17.5 5H15.9629L15.0693 16.6152C15.0091 17.3965 14.3578 17.9999 13.5742 18H6.42578C5.6912 17.9999 5.07237 17.4697 4.94824 16.7598L4.93066 16.6152L4.03711 5H2.5C2.22387 5 2.00002 4.77613 2 4.5C2 4.22386 2.22386 4 2.5 4H6.66211L7.28418 2.44336L7.33105 2.33887C7.58152 1.82857 8.10177 1.5001 8.67676 1.5H11.3232ZM5.92773 16.5381C5.94778 16.7985 6.16464 16.9999 6.42578 17H13.5742C13.8354 16.9999 14.0522 16.7985 14.0723 16.5381L14.9609 5H5.03906L5.92773 16.5381ZM8.5 8C8.77613 8 8.99998 8.22388 9 8.5V13.5C9 13.7761 8.77614 14 8.5 14C8.22386 14 8 13.7761 8 13.5V8.5C8.00002 8.22388 8.22387 8 8.5 8ZM11.5 8C11.7761 8 12 8.22386 12 8.5V13.5C12 13.7761 11.7761 14 11.5 14C11.2239 14 11 13.7761 11 13.5V8.5C11 8.22386 11.2239 8 11.5 8ZM8.67676 2.5C8.49802 2.5001 8.33492 2.59525 8.24609 2.74609L8.21289 2.81445L7.73828 4H12.2617L11.7871 2.81445C11.7112 2.62471 11.5276 2.50011 11.3232 2.5H8.67676Z"})}),Pi=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M15.5 4C15.7761 4 16 4.22386 16 4.5V6.5C16 6.77614 15.7761 7 15.5 7C15.2239 7 15 6.77614 15 6.5V5H10.5V15H12C12.2761 15 12.5 15.2239 12.5 15.5C12.5 15.7761 12.2761 16 12 16H8C7.72386 16 7.5 15.7761 7.5 15.5C7.5 15.2239 7.72386 15 8 15H9.5V5H5V6.5C5 6.77614 4.77614 7 4.5 7C4.22386 7 4 6.77614 4 6.5V4.5C4 4.46557 4.00314 4.43189 4.00977 4.39941C4.05629 4.17145 4.25829 4 4.5 4H15.5Z",fill:"currentColor"})}),Vi=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M16.5 13C16.7761 13 17 13.2239 17 13.5V15.5C17 16.3284 16.3284 17 15.5 17H4.5C3.67157 17 3 16.3284 3 15.5V13.5C3 13.2239 3.22386 13 3.5 13C3.77614 13 4 13.2239 4 13.5V15.5C4 15.7761 4.22386 16 4.5 16H15.5C15.7761 16 16 15.7761 16 15.5V13.5C16 13.2239 16.2239 13 16.5 13ZM10 3C10.1428 3 10.2791 3.06122 10.374 3.16797L14.374 7.66797L14.4326 7.75C14.5492 7.95128 14.5127 8.21347 14.332 8.37402C14.1515 8.53433 13.8873 8.53961 13.7012 8.40039L13.626 8.33203L10.5 4.81445V13.5C10.5 13.7761 10.2761 14 10 14C9.72386 14 9.5 13.7761 9.5 13.5V4.81445L6.37402 8.33203C6.19064 8.53834 5.87437 8.55725 5.66797 8.37402C5.46166 8.19064 5.44275 7.87437 5.62598 7.66797L9.62598 3.16797L9.70508 3.09668C9.79001 3.03458 9.89298 3 10 3Z"})});function Hi({result:e,toolInfo:t,lastScreenshot:n,debugMode:i=!1}){const o=s(),[a,l]=U.useState(!1),[c,d]=U.useState(!1);U.useEffect(()=>{J(G.SHOW_SYSTEM_REMINDERS).then(e=>{void 0!==e&&d(e)});const e=e=>{void 0!==e[G.SHOW_SYSTEM_REMINDERS]?.newValue&&d(e[G.SHOW_SYSTEM_REMINDERS].newValue)};return chrome.storage.onChanged.addListener(e),()=>{chrome.storage.onChanged.removeListener(e)}},[]);const u=Array.isArray(e.content)&&e.content.some(e=>"image"===e.type),h=t?(()=>{if(!t)return null;if("computer"===t.name){const n=t.input?.action,s="string"==typeof e.content?(()=>{try{return JSON.parse(e.content)}catch{return null}})():null,r=s?.action||n;switch(r){case"screenshot":return{icon:q.jsx(xi,{size:16,className:"text-text-300"}),text:o.formatMessage({defaultMessage:"Take screenshot",id:"oqZjDDkxak"})};case"left_click":return{icon:q.jsx(oi,{size:16,className:"text-text-300"}),text:o.formatMessage({defaultMessage:"Click",id:"X6qJ+Mle0d"})};case"right_click":return{icon:q.jsx("span",{className:"text-text-300",children:q.jsx(Vr,{size:14,color:"currentColor"})}),text:o.formatMessage({defaultMessage:"Right-click",id:"Ri63Z85D7E"})};case"double_click":return{icon:q.jsx(oi,{size:16,className:"text-text-300"}),text:o.formatMessage({defaultMessage:"Double-click",id:"x0gJoMad7a"})};case"triple_click":return{icon:q.jsx(oi,{size:16,className:"text-text-300"}),text:o.formatMessage({defaultMessage:"Triple-click",id:"AG0gBvRduy"})};case"type":{const e=t.input?.text,n=e?`${e.substring(0,30)}${e.length>30?"...":""}`:"";return{icon:q.jsx(Pi,{size:16,className:"text-text-300"}),text:e?o.formatMessage({defaultMessage:'Type: "{text}"',id:"b5Uf1JSpcI"},{text:n}):o.formatMessage({defaultMessage:"Type text",id:"ai0JAxDdlC"})}}case"wait":{const e=t.input?.duration;return{icon:q.jsx(ki,{size:16,className:"text-text-300"}),text:o.formatMessage({defaultMessage:"Wait {count, plural, one {# second} other {# seconds}}",id:"aLzfIziOrP"},{count:e})}}case"scroll":{const e=t.input?.scroll_direction||"down";return{icon:"up"===e?q.jsx(yi,{size:16,className:"text-text-300"}):"down"===e?q.jsx(mi,{size:16,className:"text-text-300"}):"left"===e?q.jsx(fi,{size:16,className:"text-text-300"}):"right"===e?q.jsx(gi,{size:16,className:"text-text-300"}):q.jsx(mi,{size:16,className:"text-text-300"}),text:`Scroll ${e}`}}case"key":{const e=t.input?.text;return{icon:q.jsx(Ii,{size:16,className:"text-text-300"}),text:e?`Press key: ${e}`:o.formatMessage({defaultMessage:"Press key",id:"ZJn5qDfYOD"})}}case"left_click_drag":return{icon:q.jsx("span",{className:"text-text-300",children:q.jsx(Wr,{size:14,color:"currentColor"})}),text:o.formatMessage({defaultMessage:"Drag",id:"r5pj/5J6ic"})};default:return{icon:q.jsx(Di,{size:16,className:"text-text-300"}),text:`Computer action: ${r||n||"Unknown"}`}}}if("screenshot"===t.name)return{icon:q.jsx(xi,{size:16,className:"text-text-300"}),text:o.formatMessage({defaultMessage:"Take screenshot",id:"oqZjDDkxak"})};if("read_page"===t.name){const e=t.input?.filter;let n=o.formatMessage({defaultMessage:"Read page",id:"hbWicV9xaa"});return"interactive"===e?n=o.formatMessage({defaultMessage:"Read page (interactive)",id:"6kGP03sC6R"}):"all"===e&&(n=o.formatMessage({defaultMessage:"Read page (all)",id:"N6hq8IFfkj"})),{icon:q.jsx(ji,{size:16,className:"text-text-300"}),text:n}}if("find"===t.name){const e=t.input?.query,n=e?`${e.substring(0,30)}${e.length>30?"...":""}`:"";return{icon:q.jsx(Li,{size:16,className:"text-text-300"}),text:e?o.formatMessage({defaultMessage:'Find: "{query}"',id:"ArrUF7Kfqw"},{query:n}):o.formatMessage({defaultMessage:"Find element",id:"C9scsm6HrW"})}}if("get_page_text"===t.name)return{icon:q.jsx("span",{className:"text-text-300",children:q.jsx(Dr,{size:20,color:"currentColor"})}),text:o.formatMessage({defaultMessage:"Extract page text",id:"kwxxreL+i3"})};if("scroll"===t.name){const e=t.input;let n=o.formatMessage({defaultMessage:"Scroll",id:"SxCvYAQUfY"}),s=q.jsx(mi,{size:16,className:"text-text-300"});if(e?.direction)n=`Scroll ${e.direction}`,s="up"===e.direction?q.jsx(yi,{className:"w-3.5 h-3.5 text-text-300"}):"down"===e.direction?q.jsx(mi,{className:"w-3.5 h-3.5 text-text-300"}):"left"===e.direction?q.jsx(fi,{className:"w-3.5 h-3.5 text-text-300"}):"right"===e.direction?q.jsx(gi,{className:"w-3.5 h-3.5 text-text-300"}):q.jsx(mi,{className:"w-3.5 h-3.5 text-text-300"});else if(e?.text){const t=`${e.text.substring(0,20)}${e.text.length>20?"...":""}`;n=o.formatMessage({defaultMessage:'Scroll to: "{text}"',id:"PhoFlacbDZ"},{text:t})}else e?.ref&&(n=o.formatMessage({defaultMessage:"Scroll to element",id:"CyQ6so5Xsy"}));return{icon:s,text:n}}if("key"===t.name){const e=t.input?.key?.split(" ").filter(e=>e.length>0)||[],n=e.length;let s="";if(1===n)s=o.formatMessage({defaultMessage:"Press {key} key",id:"rwoZ8xAmCX"},{key:e[0]});else if(n<=5)s=o.formatMessage({defaultMessage:"Press keys: {keys}",id:"W/T0ya233Q"},{keys:e.join(", ")});else{const t={};e.forEach(e=>{t[e]=(t[e]||0)+1});const r=Object.entries(t).map(([e,t])=>t>1?`${e} ×${t}`:e).join(", ");s=o.formatMessage({defaultMessage:"Press {count} keys: {summary}",id:"07CU16lPVb"},{count:n,summary:r})}return{icon:q.jsx(Ii,{className:"w-3.5 h-3.5 text-text-300"}),text:s}}if("wait"===t.name)return{icon:q.jsx(ki,{className:"w-3.5 h-3.5 text-text-300"}),text:o.formatMessage({defaultMessage:"Wait {count, plural, one {# second} other {# seconds}}",id:"aLzfIziOrP"},{count:t.input?.duration})};if("type"===t.name){const e=t.input?.text?`${t.input.text.substring(0,30)}${t.input.text.length>30?"...":""}`:"";return{icon:q.jsx(Pi,{size:16,className:"text-text-300"}),text:o.formatMessage({defaultMessage:'Type: "{text}"',id:"b5Uf1JSpcI"},{text:e})}}if("form_input"===t.name){const e=t.input?.value;let n=o.formatMessage({defaultMessage:"Set form value",id:"ceCuvzBxbw"});if(e){const t=`${String(e).substring(0,20)}${String(e).length>20?"...":""}`;n=o.formatMessage({defaultMessage:'Set input to "{value}"',id:"d1iFfHCXCd"},{value:t})}return{icon:q.jsx(Oi,{size:16,className:"text-text-300"}),text:n}}if("click"===t.name){let e="";if(t.input?.text){const n=`${t.input.text.substring(0,30)}${t.input.text.length>30?"...":""}`;e=o.formatMessage({defaultMessage:'Click: "{target}"',id:"fuoi35GbI+"},{target:n})}else e=o.formatMessage({defaultMessage:"Click",id:"X6qJ+Mle0d"});return{icon:q.jsx(oi,{size:16,className:"text-text-300"}),text:e}}if("navigate"===t.name){const e=t.input?.url?.substring(0,30)||"",n=t.input?.url?.length>30?"...":"";return{icon:q.jsx(ai,{size:16,className:"text-text-300"}),text:o.formatMessage({defaultMessage:"Navigate to {url}",id:"B5amdqFEtT"},{url:`${e}${n}`})}}if("update_plan"===t.name){const t=Array.isArray(e.content)?e.content.filter(e=>"text"===e.type).map(e=>e.text).join(""):"string"==typeof e.content?e.content:"",n=t.includes("approved your plan")||t.includes("User has approved"),s=t.includes("rejected")||t.includes("Permission denied");return n?{icon:q.jsx(vi,{className:"w-4 h-4 text-accent-secondary-100"}),text:o.formatMessage({defaultMessage:"Plan approved",id:"htmyA3WAQx"})}:s?{icon:q.jsx("span",{className:"text-danger-100","aria-hidden":"true",children:"✕"}),text:o.formatMessage({defaultMessage:"Plan rejected",id:"7wJz7kSrLT"})}:{icon:q.jsx(Ri,{size:16,className:"text-text-300"}),text:o.formatMessage({defaultMessage:"Update plan",id:"e6uhP1Ta9X"})}}if("TodoWrite"===t.name){const e=me(t.input?.todos,"todos"),n=e.length;let s=1;for(let t=0;t<e.length;t++){if("in_progress"===e[t].status){s=t+1;break}if("pending"===e[t].status){s=t+1;break}}return{icon:q.jsx(Ri,{size:16,className:"text-text-300"}),text:n>0?o.formatMessage({defaultMessage:"Step {currentStep} of {totalCount}",id:"2uu7KJJCOH"},{currentStep:s,totalCount:n}):o.formatMessage({defaultMessage:"Steps",id:"huCHmkVjex"})}}return"tabs_create"===t.name?{icon:q.jsx("span",{className:"text-text-300",children:q.jsx(Fr,{size:14,color:"currentColor"})}),text:o.formatMessage({defaultMessage:"Create new tab",id:"hjoV9zJZVT"})}:"tabs_context"===t.name?{icon:q.jsx(li,{size:16,className:"text-text-300"}),text:o.formatMessage({defaultMessage:"Get tabs",id:"PytICQxIDI"})}:"execute_javascript"===t.name?{icon:q.jsx("span",{className:"text-text-300",children:q.jsx(it,{size:16,color:"currentColor"})}),text:o.formatMessage({defaultMessage:"Execute JavaScript",id:"MtIcfsBa83"})}:"upload_image"===t.name?{icon:q.jsx(Vi,{className:"w-4 h-4 text-text-300"}),text:o.formatMessage({defaultMessage:"Upload image",id:"vMUomPyEk+"})}:{icon:q.jsx(Di,{size:16,className:"text-text-300"}),text:`Tool: ${t.name||"Unknown"}`}})():null,p=!h&&e&&u&&!e.is_error?{icon:q.jsx(xi,{size:16,className:"text-text-300"}),text:o.formatMessage({defaultMessage:"Screenshot",id:"9a+SKtXKhe"})}:null,m=h||p,f="update_plan"===t?.name&&("Plan approved"===m?.text||"Plan rejected"===m?.text),g=i||"update_plan"===t?.name&&!f;return q.jsxs("div",{className:"overflow-hidden border-[0.5px] border-border-300 rounded-[10px]",children:[g?q.jsxs("button",{onClick:()=>l(!a),className:"w-full px-3 py-2 bg-bg-100 flex items-center justify-between text-left hover:bg-bg-200 cursor-pointer transition-colors",children:[q.jsxs("div",{className:"flex items-center gap-2",children:[q.jsx("div",{className:"flex items-center justify-center flex-shrink-0",children:m?.icon}),q.jsx("span",{className:"font-base text-text-300",children:m?.text||q.jsx(r,{defaultMessage:"Tool Result",id:"Yn41lcLvmg"})})]}),q.jsx(Ci,{className:"w-4 h-4 text-text-400 transition-transform "+(a?"rotate-90":"")})]}):q.jsx("div",{className:"w-full px-3 py-2 bg-bg-100 flex items-center justify-between text-left",children:q.jsxs("div",{className:"flex items-center gap-2",children:[q.jsx("div",{className:"flex items-center justify-center flex-shrink-0",children:m?.icon}),q.jsx("span",{className:"font-base text-text-300",children:m?.text||q.jsx(r,{defaultMessage:"Tool Result",id:"Yn41lcLvmg"})})]})}),"update_plan"===t?.name&&a&&t?.input&&q.jsx("div",{className:"px-4 py-3 bg-bg-000 border-t-[0.5px] border-border-200",children:q.jsx(hi,{plan:{domains:t.input.domains||[],approach:t.input.approach||[]}})}),i&&a&&q.jsx("div",{className:"p-4 bg-bg-000 border-t-[0.5px] border-border-200",children:q.jsxs("div",{className:"space-y-3",children:[t&&q.jsxs("div",{className:"space-y-2",children:[q.jsxs("div",{children:[q.jsx("span",{className:"font-caption font-medium text-text-400",children:q.jsx(r,{defaultMessage:"Tool ID:",id:"NhwAlG8X9c"})}),q.jsx("code",{className:"ml-2 font-code-sm bg-bg-200 px-2 py-1 rounded text-text-200",children:t.id||e.tool_use_id})]}),t.input?.tabId&&q.jsxs("div",{children:[q.jsx("span",{className:"font-caption font-medium text-text-400",children:q.jsx(r,{defaultMessage:"Target Tab ID:",id:"8YQCrT7GkS"})}),q.jsx("code",{className:"ml-2 font-code-sm bg-bg-200 px-2 py-1 rounded text-text-200",children:t.input.tabId})]}),q.jsxs("div",{children:[q.jsx("span",{className:"font-caption font-medium text-text-400",children:q.jsx(r,{defaultMessage:"Parameters:",id:"qTWwGwIHH6"})}),q.jsx("pre",{className:"mt-1 font-code-sm bg-bg-200 p-2 rounded overflow-x-auto text-text-200",children:JSON.stringify(t.input,null,2)})]})]}),("click"===t?.name&&t?.input?.coordinate||"computer"===t?.name&&["left_click","right_click","double_click","triple_click"].includes(t?.input?.action)&&t?.input?.coordinate)&&n&&q.jsxs("div",{children:[q.jsx("span",{className:"font-caption font-medium text-text-400",children:q.jsx(r,{defaultMessage:"Click Location:",id:"3h3ag+S9Qb"})}),q.jsx(ei,{screenshot:n,coordinates:(t.name,t.input.coordinate),className:"mt-1"})]}),"computer"===t?.name&&"left_click_drag"===t?.input?.action&&t?.input?.start_coordinate&&t?.input?.coordinate&&n&&q.jsxs("div",{children:[q.jsx("span",{className:"font-caption font-medium text-text-400",children:q.jsx(r,{defaultMessage:"Drag Path:",id:"AU53gP2rAv"})}),q.jsx(ti,{screenshot:n,startCoordinate:t.input.start_coordinate,endCoordinate:t.input.coordinate,className:"mt-1"})]}),q.jsxs("div",{children:[q.jsx("span",{className:"font-caption font-medium text-text-400",children:q.jsx(r,{defaultMessage:"Result:",id:"vBiQpyXw2X"})}),u?q.jsx("div",{className:"mt-2",children:e.content.map((e,t)=>{if("image"===e.type&&"base64"===e.source?.type){const n=`data:${e.source.media_type};base64,${e.source.data}`;return q.jsx(Xr,{dataUrl:n,className:"mt-2"},t)}return"text"===e.type?q.jsx("pre",{className:"mt-1 font-code-sm bg-bg-200 p-2 rounded overflow-x-auto text-text-200",children:c?e.text:fe(e.text)},t):null})}):q.jsx("pre",{className:"mt-1 text-xs bg-bg-200 p-2 rounded overflow-x-auto text-text-200",children:"string"==typeof e.content?c?e.content:fe(e.content):JSON.stringify(e.content,null,2)})]})]})})]})}const $i=({size:e=16,className:t=""})=>q.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 16 16",fill:"none",className:t,children:q.jsx("path",{d:"M14.4999 7C14.4987 8.06051 14.0769 9.07725 13.3271 9.82715C12.5772 10.577 11.5604 10.9988 10.4999 11H3.20678L5.35366 13.1462C5.44748 13.2401 5.50018 13.3673 5.50018 13.5C5.50018 13.6327 5.44748 13.7599 5.35366 13.8538C5.25984 13.9476 5.13259 14.0003 4.99991 14.0003C4.86722 14.0003 4.73998 13.9476 4.64615 13.8538L1.64615 10.8538C1.59967 10.8073 1.56279 10.7522 1.53763 10.6915C1.51246 10.6308 1.49951 10.5657 1.49951 10.5C1.49951 10.4343 1.51246 10.3692 1.53763 10.3085C1.56279 10.2478 1.59967 10.1927 1.64615 10.1462L4.64615 7.14625C4.73998 7.05243 4.86722 6.99972 4.99991 6.99972C5.13259 6.99972 5.25984 7.05243 5.35366 7.14625C5.44748 7.24007 5.50018 7.36732 5.50018 7.5C5.50018 7.63268 5.44748 7.75993 5.35366 7.85375L3.20678 10H10.4999C11.2956 10 12.0586 9.68393 12.6212 9.12132C13.1838 8.55871 13.4999 7.79565 13.4999 7C13.4999 6.20435 13.1838 5.44129 12.6212 4.87868C12.0586 4.31607 11.2956 4 10.4999 4H4.99991C4.8673 4 4.74012 3.94732 4.64635 3.85355C4.55258 3.75979 4.49991 3.63261 4.49991 3.5C4.49991 3.36739 4.55258 3.24021 4.64635 3.14645C4.74012 3.05268 4.8673 3 4.99991 3H10.4999C11.5604 3.00116 12.5772 3.42296 13.3271 4.17285C14.0769 4.92275 14.4987 5.93949 14.4999 7Z",fill:"currentColor"})}),zi=({onClick:e,children:t,isActive:n=!1,isPrimary:s=!1,height:r})=>q.jsx("button",{onClick:e,className:`w-full font-base flex min-w-[75px] px-[14px] py-[3px] justify-between items-center gap-2 rounded-lg border-[0.5px] transition-colors font-medium ${n?"text-text-100 bg-bg-300 border-border-400":s?"bg-text-000 text-bg-000 border-text-000 hover:bg-text-100":"text-text-100 border-border-200 hover:bg-bg-100"} ${r?"":"h-9"}`,style:r?{height:r}:void 0,children:t}),Fi=({planStructure:e,onApprove:t,onReject:n,isReadOnly:i=!1,onClose:o})=>{const a=s(),[l,c]=U.useState(null),d=U.useCallback(()=>{t()},[t]),u=U.useCallback(()=>{n()},[n]),p=U.useCallback(e=>{e.target===e.currentTarget&&i&&o&&o()},[i,o]);U.useEffect(()=>{if(i){const e=e=>{"Escape"===e.key&&o&&o()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}{const e=e=>(e.metaKey||e.ctrlKey)&&"Enter"===e.key?(e.preventDefault(),e.stopPropagation(),c("reject"),void setTimeout(()=>{u()},150)):"Enter"===e.key?(e.preventDefault(),c("approve"),void setTimeout(()=>{d()},150)):void("Escape"===e.key&&(e.preventDefault(),e.stopPropagation(),c("reject"),setTimeout(()=>{u()},150)));return window.addEventListener("keydown",e,!0),()=>window.removeEventListener("keydown",e,!0)}},[d,u,i,o]);const{domains:m=[],approach:f=[]}=e,g=q.jsxs("div",{className:"bg-bg-000 rounded-[14px]",children:[q.jsxs("div",{className:"flex items-center justify-between py-[10px] px-4",children:[q.jsxs("div",{className:"flex items-center gap-2",children:[q.jsx(Ri,{size:20,className:"text-text-100"}),q.jsx("h3",{className:"font-base text-text-100",children:q.jsx(r,{defaultMessage:"Claude's plan",id:"VlOMp+IyXR"})})]}),i&&o&&q.jsx("button",{onClick:o,className:"text-text-400 hover:text-text-200 transition-colors duration-200 p-1 rounded-md hover:bg-bg-200",children:q.jsx("svg",{width:"16",height:"16",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:q.jsx("path",{d:"M15 5L5 15M5 5L15 15",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),q.jsx("div",{className:"border-t border-border-300"}),q.jsxs("div",{className:"px-4 py-3 space-y-4 max-h-[40vh] overflow-y-auto",children:[m.length>0&&q.jsxs("div",{children:[q.jsx("p",{className:"font-small text-text-400 mb-2",children:q.jsx(r,{defaultMessage:"Allow actions on these sites",id:"DR5hG1vSxp"})}),q.jsx("div",{className:"space-y-2",children:m.map((e,t)=>{const{name:n,isForceAsk:s}=(e=>"string"==typeof e?{name:e,isForceAsk:!1}:{name:e.domain,isForceAsk:"category3"===e.category})(e);return q.jsxs("div",{className:"flex items-start gap-2",children:[q.jsx("span",{className:"flex-shrink-0 w-5 h-5 flex items-center justify-center",children:q.jsx(Ai,{size:16,className:"text-text-400"})}),q.jsx("span",{className:"font-base text-text-100",children:n}),s&&q.jsx(h,{tooltipContent:a.formatMessage({defaultMessage:"You must approve any Claude action on this site",id:"qgGoWr0XYl"}),side:"top",align:"center",children:q.jsx("span",{className:"flex-shrink-0 cursor-help",children:q.jsx(ot,{size:14,className:"text-text-400"})})})]},t)})})]}),f.length>0&&q.jsxs("div",{children:[q.jsx("p",{className:"font-small text-text-400 mb-2",children:q.jsx(r,{defaultMessage:"Approach to follow",id:"XAcQi8udmY"})}),q.jsx("div",{className:"space-y-2",children:f.map((e,t)=>q.jsxs("div",{className:"flex items-start gap-2",children:[q.jsx("span",{className:"flex-shrink-0 w-5 h-5 rounded-full border-border-300 border-0.5 flex items-center justify-center text-xs text-text-400",children:t+1}),q.jsx("span",{className:"font-base text-text-100",children:e})]},t))})]})]}),!i&&q.jsxs("div",{className:"px-3 py-[10px] space-y-[5px] mt-[10px]",children:[q.jsxs(zi,{onClick:d,isPrimary:!0,isActive:"approve"===l,children:[q.jsx("span",{children:q.jsx(r,{defaultMessage:"Approve plan",id:"K8niogJNQY"})}),q.jsx($i,{className:"text-text-500"})]}),q.jsxs(zi,{onClick:u,isActive:"reject"===l,children:[q.jsx("span",{children:q.jsx(r,{defaultMessage:"Make changes",id:"PSsQUhf180"})}),q.jsxs("span",{className:"flex items-center gap-0.5",children:[q.jsx(Si,{className:"text-text-500"}),q.jsx($i,{className:"text-text-500"})]})]}),q.jsx("p",{className:"font-small text-text-500 pt-1 px-1",children:q.jsx(r,{defaultMessage:"Claude will only use the sites listed. You'll be asked before accessing anything else.",id:"ttaSfve/3w"})})]})]});return i?q.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",onClick:p,children:[q.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm animate-fade-in"}),q.jsx("div",{className:"relative max-w-lg w-full animate-modal-enter",children:g})]}):g},Bi=({plan:e,isStreaming:t=!1,toolResult:n})=>{const[s,i]=U.useState(!1),o=n?n.is_error||"string"==typeof n.content&&n.content.includes("Plan rejected")?"rejected":"approved":void 0,a=!!n&&!t;return q.jsxs(q.Fragment,{children:[q.jsx("div",{onClick:()=>{a&&i(!0)},className:"flex text-left rounded-lg overflow-hidden border-[0.5px] border-border-300 transition duration-300 w-full hover:bg-bg-000/50 px-4 mt-4 mb-3 "+(a?"cursor-pointer hover:border-border-200":""),children:q.jsxs("div",{className:"group/artifact-block flex flex-1 align-start justify-between w-full",children:[q.jsxs("div",{className:"flex flex-col gap-1 py-4 min-w-0 flex-1",children:[q.jsx("div",{className:"font-base leading-tight line-clamp-1 "+(t&&0===e.approach.length?"text-text-500":"text-text-200"),children:t&&0===e.approach.length?q.jsx("span",{className:"animate-pulse",children:q.jsx(r,{defaultMessage:"Drafting plan...",id:"0A0qMvsWV4"})}):q.jsx(r,{defaultMessage:"Plan",id:"fz0z4cb6fQ"})}),q.jsx("div",{className:"font-small line-clamp-1 text-text-400",children:o?q.jsx(q.Fragment,{children:"approved"===o?q.jsx(r,{defaultMessage:"Approved",id:"6XFO/Cw7Ld"}):q.jsx(r,{defaultMessage:"Rejected",id:"5qaD7sDVxu"})}):t?q.jsx("span",{className:"animate-pulse",children:q.jsx(r,{defaultMessage:"Planning",id:"99OdS35+yZ"})}):q.jsx(r,{defaultMessage:"Browser automation",id:"2Gct3kUo/o"})})]}),q.jsx("div",{className:"flex items-end w-[100px] relative shrink-0",children:q.jsx("div",{className:"absolute right-2 flex flex-1 overflow-hidden w-[84px] h-[71px] rounded-t-lg border-[0.5px] border-border-200 select-none scale-[1] group-hover/artifact-block:scale-[1.035] rotate-[0.1rad] group-hover/artifact-block:rotate-[0.065rad] duration-300 ease-out group-hover/artifact-block:duration-400 group-hover/artifact-block:ease-[cubic-bezier(0,0.9,0.5,1.35)] transition-transform backface-hidden will-change-transform translate-y-[19%] bg-bg-000 text-text-500 whitespace-pre-wrap text-[0.35rem] leading-tight p-2 font-mono wrap-break-word hyphens-auto",children:e.approach.length>0?e.approach.slice(0,3).join("\n"):""})})]})}),a&&s&&q.jsx(Fi,{planStructure:e,onApprove:()=>{},onReject:()=>{},isReadOnly:!0,onClose:()=>{i(!1)}})]})},Wi=({dataUrl:e,className:t="",coordinates:n})=>{const r=s(),[i,o]=U.useState(!1),a=U.useRef(null),[l,c]=U.useState(1);return U.useEffect(()=>{const e=()=>{if(a.current&&n){const e=a.current.width/a.current.naturalWidth,t=a.current.height/a.current.naturalHeight;c(Math.min(e,t))}},t=a.current;if(t&&n){if(!t.complete)return t.addEventListener("load",e),()=>t.removeEventListener("load",e);e()}},[e,n]),q.jsxs(q.Fragment,{children:[q.jsxs("button",{onClick:()=>o(!0),className:`relative flex-shrink-0 w-9 h-7 rounded border border-border-300 hover:border-border-200 hover:rotate-2 transition-all duration-150 ease-out hover:shadow-sm overflow-hidden ${t}`,title:r.formatMessage({defaultMessage:"Click to view full screenshot",id:"LWiiXht89U"}),children:[q.jsx("img",{ref:a,src:e,alt:r.formatMessage({defaultMessage:"Screenshot thumbnail",id:"/oSRHC9/hb"}),className:"w-full h-full object-cover"}),n&&q.jsx("div",{className:"absolute pointer-events-none rounded-full border border-accent-main-100 w-1.5 h-1.5 bg-accent-main-100",style:{left:n[0]*l+"px",top:n[1]*l+"px",transform:"translate(-50%, -50%)"}})]}),q.jsx(at,{imageUrl:i?e:null,onClose:()=>o(!1),coordinates:n})]})},Zi=U.memo(function({toolName:e,toolDisplayName:t,serverName:n,serverIconUrl:i,toolUseId:o,input:a,toolResult:l,renderMode:c=ct.Standard,isFirstBlockOfMessage:d,isLastBlockOfMessage:u,isFirstItemInGroup:h,isLastItemInGroup:p,isStreaming:m,screenshotsByTab:f}){const[g,y]=U.useState(!1),[x,C]=U.useState(!1);U.useEffect(()=>{J(G.DEBUG_MODE).then(e=>{void 0!==e&&C(e)});const e=e=>{void 0!==e[G.DEBUG_MODE]?.newValue&&C(e[G.DEBUG_MODE].newValue)};return chrome.storage.onChanged.addListener(e),()=>{chrome.storage.onChanged.removeListener(e)}},[]);const b=!x&&"update_plan"!==e,w=s(),v={name:e,input:a,id:o},k=((e,t,n,s)=>{if("computer"===e){const e=t?.action;switch(e){case"screenshot":return{text:s.formatMessage({defaultMessage:"Take screenshot",id:"oqZjDDkxak"}),icon:q.jsx(et,{size:12})};case"left_click":return{text:s.formatMessage({defaultMessage:"Click",id:"X6qJ+Mle0d"}),icon:q.jsx(oi,{size:12})};case"right_click":return{text:s.formatMessage({defaultMessage:"Right-click",id:"Ri63Z85D7E"}),icon:q.jsx(oi,{size:12})};case"double_click":return{text:s.formatMessage({defaultMessage:"Double-click",id:"x0gJoMad7a"}),icon:q.jsx(oi,{size:12})};case"triple_click":return{text:s.formatMessage({defaultMessage:"Triple-click",id:"AG0gBvRduy"}),icon:q.jsx(oi,{size:12})};case"type":{const e=t?.text,n=e?`${e.substring(0,30)}${e.length>30?"...":""}`:"";return{text:e?s.formatMessage({defaultMessage:'Type: "{text}"',id:"b5Uf1JSpcI"},{text:n}):s.formatMessage({defaultMessage:"Type text",id:"ai0JAxDdlC"}),icon:q.jsx(gs,{size:12})}}case"wait":{const e=t?.duration;return{text:s.formatMessage({defaultMessage:"Wait {count, plural, one {# second} other {# seconds}}",id:"aLzfIziOrP"},{count:e}),icon:q.jsx(ks,{size:12})}}case"scroll":{const e=t?.scroll_direction||"down",n="up"===e?q.jsx(ls,{size:12}):q.jsx(is,{size:12});return{text:"up"===e?s.formatMessage({defaultMessage:"Scroll up",id:"06tSNl9YfF"}):s.formatMessage({defaultMessage:"Scroll down",id:"zQipeg7kSl"}),icon:n}}case"key":{const e=t?.text;return{text:e?s.formatMessage({defaultMessage:"Press key: {keys}",id:"BpjonN0qoV"},{keys:e}):s.formatMessage({defaultMessage:"Press key",id:"ZJn5qDfYOD"}),icon:q.jsx(gs,{size:12})}}case"left_click_drag":return{text:s.formatMessage({defaultMessage:"Drag",id:"r5pj/5J6ic"}),icon:q.jsx(oi,{size:12})};case"zoom":return{text:s.formatMessage({defaultMessage:"Zoom",id:"yMbKjuDH/n"}),icon:q.jsx(as,{size:12})};case"hover":return{text:s.formatMessage({defaultMessage:"Hover",id:"QNEFpq3fE/"}),icon:q.jsx(ps,{size:12})};case"scroll_to":return{text:s.formatMessage({defaultMessage:"Scroll to element",id:"CyQ6so5Xsy"}),icon:q.jsx(is,{size:12})};default:return{text:s.formatMessage({defaultMessage:"Computer action: {action}",id:"xLpBTyWHMH"},{action:e||"Unknown"}),icon:q.jsx(ps,{size:12})}}}if("screenshot"===e)return{text:s.formatMessage({defaultMessage:"Take screenshot",id:"oqZjDDkxak"}),icon:q.jsx(et,{size:12})};if("read_page"===e){const e=t?.filter?` (${t.filter})`:"";return{text:s.formatMessage({defaultMessage:"Read page",id:"hbWicV9xaa"})+e,icon:q.jsx(fs,{size:12})}}if("find"===e){const e=t?.query,n=e?`${e.substring(0,30)}${e.length>30?"...":""}`:"";return{text:e?s.formatMessage({defaultMessage:'Find: "{query}"',id:"ArrUF7Kfqw"},{query:n}):s.formatMessage({defaultMessage:"Find element",id:"C9scsm6HrW"}),icon:q.jsx(tt,{size:12})}}if("get_page_text"===e)return{text:s.formatMessage({defaultMessage:"Extract page text",id:"kwxxreL+i3"}),icon:q.jsx(fs,{size:12})};if("form_input"===e){const e=t?.value,n=e?`${String(e).substring(0,20)}${String(e).length>20?"...":""}`:"";return{text:e?s.formatMessage({defaultMessage:'Set input to "{value}"',id:"d1iFfHCXCd"},{value:n}):s.formatMessage({defaultMessage:"Set form value",id:"ceCuvzBxbw"}),icon:q.jsx(bs,{size:12})}}if("click"===e){const e=t?.text,n=e?`${e.substring(0,30)}${e.length>30?"...":""}`:"";return{text:e?s.formatMessage({defaultMessage:'Click: "{target}"',id:"fuoi35GbI+"},{target:n}):s.formatMessage({defaultMessage:"Click",id:"X6qJ+Mle0d"}),icon:q.jsx(oi,{size:12})}}if("navigate"===e){const e=t?.url?`${t.url.substring(0,30)}${t.url.length>30?"...":""}`:"";return{text:s.formatMessage({defaultMessage:"Navigate to {url}",id:"B5amdqFEtT"},{url:e}),icon:q.jsx(ai,{size:12})}}if("type"===e){const e=t?.text?`${t.text.substring(0,30)}${t.text.length>30?"...":""}`:"";return{text:s.formatMessage({defaultMessage:'Type: "{text}"',id:"b5Uf1JSpcI"},{text:e}),icon:q.jsx(gs,{size:12})}}if("wait"===e){const e=t?.duration;return{text:s?s.formatMessage({defaultMessage:"Wait {count, plural, one {# second} other {# seconds}}",id:"aLzfIziOrP"},{count:e}):`Wait ${e} second${1===e?"":"s"}`,icon:q.jsx(ks,{size:12})}}if("tabs_create"===e)return{text:s.formatMessage({defaultMessage:"Create new tab",id:"hjoV9zJZVT"}),icon:q.jsx(li,{size:12})};if("tabs_context"===e)return{text:s.formatMessage({defaultMessage:"Get tabs",id:"PytICQxIDI"}),icon:q.jsx(li,{size:12})};if("upload_image"===e)return{text:s.formatMessage({defaultMessage:"Upload image",id:"vMUomPyEk+"}),icon:q.jsx(Ms,{size:12})};if("update_plan"===e){const e=Array.isArray(n?.content)?n.content.filter(e=>"text"===e.type).map(e=>e.text).join(""):"string"==typeof n?.content?n.content:"",t=e.includes("approved your plan")||e.includes("User has approved");return e.includes("rejected")||e.includes("Permission denied")?{icon:q.jsx(nt,{size:12}),text:s.formatMessage({defaultMessage:"Plan rejected",id:"7wJz7kSrLT"})}:t?{icon:q.jsx(nt,{size:12}),text:s.formatMessage({defaultMessage:"Created a plan",id:"aXfQ2L8ErF"})}:{icon:q.jsx(nt,{size:12}),text:s.formatMessage({defaultMessage:"Follow a plan",id:"8QvDObQuPZ"})}}if("javascript_tool"===e)return{text:s.formatMessage({defaultMessage:"Execute JavaScript",id:"MtIcfsBa83"}),icon:q.jsx(hs,{size:12})};if("WebSearch"===e)return{text:s.formatMessage({defaultMessage:"Web search",id:"x0W7xxxEcv"}),icon:q.jsx(tt,{size:12})};if("WebFetch"===e){const e=t?.url||"";if(e)try{const t=new URL(e);return{text:s.formatMessage({defaultMessage:"Fetch from {hostname}",id:"YR6CGakwNu"},{hostname:t.hostname}),icon:q.jsx(st,{size:12})}}catch{const t=`${e.substring(0,30)}${e.length>30?"...":""}`;return{text:s.formatMessage({defaultMessage:"Fetch {url}",id:"GhHvcgGjy9"},{url:t}),icon:q.jsx(st,{size:12})}}return{text:s.formatMessage({defaultMessage:"Web fetch",id:"4Bom+nABM6"}),icon:q.jsx(st,{size:12})}}return"read_console_messages"===e?{text:s.formatMessage({defaultMessage:"Read console messages",id:"/cUj2zoCtz"}),icon:q.jsx(rt,{size:12})}:"read_network_requests"===e?{text:s.formatMessage({defaultMessage:"Read network requests",id:"6UuyKKMuCv"}),icon:q.jsx(rt,{size:12})}:"resize_window"===e?{text:s.formatMessage({defaultMessage:"Resize window",id:"mH4wEOlsQs"}),icon:q.jsx(ps,{size:12})}:"gif_creator"===e?{text:s.formatMessage({defaultMessage:"Create GIF",id:"KtjIeAooNb"}),icon:q.jsx(et,{size:12})}:{text:ci(e)}})(e,a,l,w),M=ii(e)&&n,S=t||k.text,N=M?q.jsx(lt,{name:n,iconUrl:i}):k.icon||void 0,T=U.useMemo(()=>{if(c!==ct.TimelineGroup)return null;if(!l?.content)return null;const e=Array.isArray(l.content)?l.content.find(e=>"image"===e.type):null;return e&&"base64"===e.source?.type&&e.source?.media_type?`data:${e.source.media_type};base64,${e.source.data}`:null},[c,l]),E=a?.tabId,j=E&&f?f.get(E):void 0,A="click"===e||"computer"===e&&["left_click","right_click","double_click","triple_click"].includes(a?.action)?a?.coordinate:void 0,I=c===ct.TimelineGroup?T?q.jsx(Wi,{dataUrl:T}):j&&A?q.jsx(Wi,{dataUrl:j,coordinates:A}):null:void 0;return"update_plan"===e?q.jsx(Bi,{plan:{domains:a?.domains||[],approach:a?.approach||[]},isStreaming:m,toolResult:l}):q.jsx(dt,{isExpanded:g,setIsExpanded:y,isStreaming:m,icon:N,text:S,isFirstBlockOfMessage:d,isLastBlockOfMessage:u,renderMode:c,isFirstItemInGroup:h,isLastItemInGroup:p,isExpandingDisabled:b,secondaryElement:I,children:q.jsx(ut,{isExpanded:g,children:l?q.jsx(Hi,{result:l,toolName:e,toolInfo:v,debugMode:!0,lastScreenshot:j}):q.jsx("div",{className:"font-small text-text-500 p-3",children:m?q.jsx(r,{defaultMessage:"Executing...",id:"g8ctzHRk8U"}):q.jsx(r,{defaultMessage:"No result available",id:"MZEyK3VcKi"})})})})});function Ui({text:e,onComputerFileClick:t,textColor:n}){const[s,r]=U.useState(e),i=U.useRef(null),o=U.useRef(0);return U.useEffect(()=>{const t=o.current,n=e.slice(t);n&&(o.current=e.length,i.current||(i.current=new ht,i.current.start(e=>{r(e)}).catch(e=>{})),i.current.addText(n))},[e]),q.jsx(Zr,{text:s,variant:"assistant",onComputerFileClick:t,textColor:n})}const qi=({input:e,toolResult:t,renderMode:n=ct.Standard,isFirstBlockOfMessage:r,isLastBlockOfMessage:i,isFirstItemInGroup:o,isLastItemInGroup:a,isStreaming:l})=>{const c=s(),[d,u]=U.useState(!1),h=U.useMemo(()=>{let e=document.getElementById("modal-portal");return e||(e=document.createElement("div"),e.id="modal-portal",document.body.appendChild(e)),e},[]),m=(e=>e?{domains:e.domains||[],approach:e.approach||[]}:null)(e),f=((e,t)=>{if(t||!e)return"creating";if(e?.content){const t="string"==typeof e.content?e.content:Array.isArray(e.content)?e.content.filter(e=>"text"===e.type).map(e=>e.text).join("\n"):"";if(t.includes("approved")||t.includes("Approved"))return"approved";if(t.includes("rejected")||t.includes("Rejected"))return"rejected"}return e?.is_error?"rejected":"approved"})(t,l),g=U.useCallback(()=>{m&&u(!0)},[m]),y=U.useCallback(()=>{u(!1)},[]);let x=c.formatMessage({defaultMessage:"Plan",id:"fz0z4cb6fQ"});return"creating"===f?x=c.formatMessage({defaultMessage:"Creating plan...",id:"P0iWYFMJG2"}):"approved"===f?x=c.formatMessage({defaultMessage:"Created a plan",id:"aXfQ2L8ErF"}):"rejected"===f&&(x=c.formatMessage({defaultMessage:"Plan rejected",id:"7wJz7kSrLT"})),q.jsxs(q.Fragment,{children:[q.jsx(pt,{icon:q.jsx(nt,{size:12,className:"text-text-500"}),text:x,isStreaming:l,hideCaret:!0,renderMode:n,isFirstBlockOfMessage:r,isLastBlockOfMessage:i,isFirstItemInGroup:o,isLastItemInGroup:a,handleClick:m?g:void 0,isDisabled:!m}),d&&m&&p.createPortal(q.jsx(Fi,{planStructure:m,onApprove:y,onReject:y,isReadOnly:!0,onClose:y}),h)]})};const Ji=U.memo(({block:e,toolResult:t,index:n,blocks:s,renderMode:r=ct.Standard,isFirstItemInGroup:i=!1,isLastItemInGroup:o=!1,isStreaming:a,allMessages:l=[],messageIndex:c=0,screenshotsByTab:d,onComputerFileClick:u})=>{const h=0===n,p=n===s.length-1;if("text"===e.type){const t=e.text;return a&&t?q.jsx(Ui,{text:t,onComputerFileClick:u,textColor:r===ct.TimelineGroup?"text-text-100":void 0}):q.jsx(Zr,{text:t,variant:"assistant",onComputerFileClick:u,textColor:r===ct.TimelineGroup?"text-text-100":void 0})}if("tool_use"===e.type){let n,s=t;if(!s&&l&&c<l.length-1)for(let t=c+1;t<l.length;t++){const n=l[t];if("user"===n.role&&Array.isArray(n.content)){const t=n.content.find(t=>"tool_result"===t.type&&t.tool_use_id===e.id);if(t){s=t;break}}}if("turn_answer_start"===e.name)return null;if("WebSearch"===e.name)return q.jsx(mt,{toolName:e.name,toolUseId:e.id,input:e.input,toolResult:s,renderMode:r,isFirstBlockOfMessage:h,isLastBlockOfMessage:p,isFirstItemInGroup:i,isLastItemInGroup:o,isStreaming:a,iconSize:12,onResultClick:e=>chrome.tabs.create({url:e})});if("WebFetch"===e.name)return q.jsx(ft,{toolName:e.name,toolUseId:e.id,input:e.input,toolResult:s,renderMode:r,isFirstBlockOfMessage:h,isLastBlockOfMessage:p,isFirstItemInGroup:i,isLastItemInGroup:o,isStreaming:a,iconSize:16,onUrlClick:e=>window.open(e,"_blank")});if("update_plan"===e.name)return q.jsx(qi,{toolName:e.name,toolUseId:e.id,input:e.input,toolResult:s,renderMode:r,isFirstBlockOfMessage:h,isLastBlockOfMessage:p,isFirstItemInGroup:i,isLastItemInGroup:o,isStreaming:a});if(di.has(e.name))return q.jsx(Zi,{toolName:e.name,toolUseId:e.id,input:e.input,toolResult:s,renderMode:r,isFirstBlockOfMessage:h,isLastBlockOfMessage:p,isFirstItemInGroup:i,isLastItemInGroup:o,isStreaming:a,screenshotsByTab:d});if("create_file"===e.name||"open_file"===e.name||"update_file"===e.name||"view"===e.name){const t=e.input,n=t?.path||"",l=t?.file_text||"";let c;c="create_file"===e.name?"create":"open_file"===e.name||"view"===e.name?"read":"edit";const d=!!s||!a;return q.jsx(gt,{action:c,path:n,fileText:l,displayText:t?.description,iconSize:12,isStreaming:a,isComplete:d,renderMode:r,isFirstBlockOfMessage:h,isLastBlockOfMessage:p,isFirstItemInGroup:i,isLastItemInGroup:o})}if("bash"===e.name||"Bash"===e.name||"bash_tool"===e.name){const t=e.input;n=t?.description||t?.command||void 0}else if("str_replace"===e.name||"str_replace_editor"===e.name||"Edit"===e.name){const t=e.input;n=t?.path?`Editing ${t.path}`:void 0}else if("Read"===e.name){const t=e.input;n=t?.file_path||void 0}else if("Write"===e.name){const t=e.input;n=t?.file_path?`Writing ${t.file_path}`:void 0}else if("Glob"===e.name||"Grep"===e.name){const t=e.input;n=t?.pattern||void 0}else if("Task"===e.name){const t=e.input;n=t?.description||void 0}const u=ii(e.name)?function(e){const t=function(e){const t=e.match(/^mcp__([0-9a-f-]+)__(.+)$/);return t?t[1]:null}(e);if(!t)return null;const n=On.getState(),s=n.remoteServers[t],r=n.remoteTools[t];if(!s)return null;const i=function(e){const t=e.match(/^mcp__[0-9a-f-]+__(.+)$/);return t?t[1]:e}(e),o=r?.find(e=>e.name===i);return{serverName:s.name,serverUrl:s.url,toolDisplayName:o?.displayName||i,uuid:s.uuid,alwaysApprovedKey:o?.always_approved_key}}(e.name):null;return q.jsx(yt,{toolName:e.name,toolDisplayName:n||u?.toolDisplayName,toolUseId:e.id,input:e.input,toolResult:s,renderMode:r,isFirstBlockOfMessage:h,isLastBlockOfMessage:p,isFirstItemInGroup:i,isLastItemInGroup:o,isStreaming:a,iconSize:12,integrationIconUrl:u?.serverUrl})}return e.type,null}),Gi=({blocks:e,isStreaming:t,allMessages:n=[],messageIndex:s=0,screenshotsByTab:r,onComputerFileClick:i})=>{const{blocksBeforeAnswer:o,blocksAfterAnswer:a,hasFinalAnswer:l}=U.useMemo(()=>{let t=-1;for(let n=0;n<e.length;n++){const s=e[n];if("tool_use"===s.type&&"turn_answer_start"===s.name){t=n;break}}return-1===t?{blocksBeforeAnswer:e,blocksAfterAnswer:[],hasFinalAnswer:!1}:{blocksBeforeAnswer:e.slice(0,t),blocksAfterAnswer:e.slice(t+1),hasFinalAnswer:!0}},[e]),c=U.useMemo(()=>(e=>{const t=[],n=new Set;return e.forEach((s,r)=>{if(!n.has(r))if(Yr(s)){const i={items:[{block:s,index:r,renderable:Qr(s)}],startIndex:r,isLastBlockOfMessage:!1};for(let t=r+1;t<e.length;t++){const s=e[t];if(!Yr(s))break;i.items.push({block:s,index:t,renderable:Qr(s)}),n.add(t),t===e.length-1&&(i.isLastBlockOfMessage=!0)}const o=i.items.filter(e=>e.renderable);0===o.length?t.push({type:"single",content:s,index:r}):t.push({type:"group",content:i,index:r})}else t.push({type:"single",content:s,index:r})}),t})(o),[o]);return l?q.jsxs(q.Fragment,{children:[o.length>0&&q.jsx(xt,{isFirstBlockOfMessage:!0,isLastBlockOfMessage:0===a.length,isStreaming:t,borderless:!0,autoCollapse:!0,children:o.map((e,t)=>q.jsx(Ji,{block:e,index:t,blocks:o,renderMode:ct.TimelineGroup,isFirstItemInGroup:0===t,isLastItemInGroup:t===o.length-1,isStreaming:!1,allMessages:n,messageIndex:s,screenshotsByTab:r,onComputerFileClick:i},`before-answer-${t}`))}),a.map((e,t)=>q.jsx(Ji,{block:e,index:t,blocks:a,isStreaming:!1,allMessages:n,messageIndex:s,screenshotsByTab:r,onComputerFileClick:i},`after-answer-${t}`))]}):q.jsx(q.Fragment,{children:c.map(o=>{if("group"===o.type){const a=o.content,l=a.items.filter(e=>e.renderable);if(l.length<=1){const l=a.items[0];return l?q.jsx(Ji,{block:l.block,index:l.index,blocks:e,isStreaming:t,allMessages:n,messageIndex:s,screenshotsByTab:r,onComputerFileClick:i},`block-${o.type}-${o.index}`):null}return q.jsx(xt,{isFirstBlockOfMessage:0===a.startIndex,isLastBlockOfMessage:a.isLastBlockOfMessage,isStreaming:t,autoCollapse:!0,children:l.map((o,a)=>q.jsx(Ji,{block:o.block,index:o.index,blocks:e,renderMode:ct.TimelineGroup,isFirstItemInGroup:0===a,isLastItemInGroup:a===l.length-1,isStreaming:t,allMessages:n,messageIndex:s,screenshotsByTab:r,onComputerFileClick:i},o.index))},`block-${o.type}-${o.index}`)}return q.jsx(Ji,{block:o.content,index:o.index,blocks:e,isStreaming:t,allMessages:n,messageIndex:s,screenshotsByTab:r,onComputerFileClick:i},`block-${o.type}-${o.index}`)})})},Ki=e=>q.jsx("svg",{width:e.size||20,height:e.size||20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:q.jsx("path",{d:"M14.5 3C15.8807 3 17 4.11929 17 5.5V14.5C17 15.7943 16.0164 16.8592 14.7559 16.9873L14.5 17H5.5L5.24414 16.9873C4.06772 16.8677 3.13227 15.9323 3.0127 14.7559L3 14.5V5.5C3 4.11929 4.11929 3 5.5 3H14.5ZM5.5 4C4.67157 4 4 4.67157 4 5.5V14.5C4 15.3284 4.67157 16 5.5 16H14.5C15.3284 16 16 15.3284 16 14.5V5.5C16 4.67157 15.3284 4 14.5 4H5.5ZM11.1377 6.01953C11.403 6.09555 11.5563 6.37231 11.4805 6.6377L9.48047 13.6377C9.40445 13.903 9.12769 14.0563 8.8623 13.9805C8.59702 13.9044 8.44371 13.6277 8.51953 13.3623L10.5195 6.3623C10.5956 6.09702 10.8723 5.94371 11.1377 6.01953Z",fill:"currentColor"})});function Yi({name:e,content:t,onClick:n}){const s=q.jsxs("span",{onClick:n,className:u("inline-flex relative group","text-accent-secondary-100","select-none","mx-0.5","cursor-pointer"),children:[q.jsx("span",{className:u("absolute -inset-y-0.5 -left-0.5 -right-1 rounded-md pointer-events-none","opacity-0 group-hover:opacity-100","bg-accent-secondary-900","transition-opacity duration-150")}),q.jsxs("span",{className:"relative pl-5 flex items-center",children:[q.jsx("span",{className:"absolute top-1/2 -translate-y-1/2 left-0 w-4 h-4 flex items-center justify-center",children:q.jsx(Ki,{size:16})}),q.jsx("span",{className:"relative",children:e})]})]});return t?q.jsx(h,{tooltipContent:q.jsx("div",{className:"max-w-[200px] max-h-[100px] overflow-hidden text-xs",children:t.length>150?`${t.slice(0,150)}...`:t}),side:"top",children:s}):s}const Qi=/\[\[shortcut:([^:]+):([^\]]+)\]\]/g;function Xi(e,t){const n=[];let s,r=0;for(Qi.lastIndex=0;null!==(s=Qi.exec(e));){s.index>r&&n.push(e.slice(r,s.index));const[,i,o]=s;n.push(q.jsx(Yi,{id:i,name:o,onClick:t?()=>t(i):void 0},`chip-${s.index}`)),r=s.index+s[0].length}return r<e.length&&n.push(e.slice(r)),n.length>0?n:e}function eo(e){return Qi.lastIndex=0,Qi.test(e)}const to=U.memo(function({message:e,previousMessages:t=[],isLastMessage:n=!1,isStreaming:r=!1,submittedFeedback:i=null,onThumbsUp:o,onThumbsDown:a,showThumbs:l=!1,onSavePrompt:c,onEditShortcut:d,messageIndex:p=0,allMessages:f=[],onComputerFileClick:g}){const y=s(),[x,C]=U.useState(!1),[b,w]=U.useState(!1),[v,k]=U.useState(!1),[M,S]=U.useState(!1),[N,T]=U.useState(null);U.useEffect(()=>{J(G.SHOW_TRACE_IDS).then(e=>{void 0!==e&&w(e)}),J(G.SHOW_SYSTEM_REMINDERS).then(e=>{void 0!==e&&k(e)});const e=e=>{void 0!==e[G.SHOW_TRACE_IDS]?.newValue&&w(e[G.SHOW_TRACE_IDS].newValue),void 0!==e[G.SHOW_SYSTEM_REMINDERS]?.newValue&&k(e[G.SHOW_SYSTEM_REMINDERS].newValue)};return chrome.storage.onChanged.addListener(e),()=>{chrome.storage.onChanged.removeListener(e)}},[]);const E=Array.isArray(e.content)?e.content.filter(e=>"text"===e.type):[],j=Array.isArray(e.content)?e.content.filter(e=>"image"===e.type):[],A=j.filter((t,n)=>{if(Array.isArray(e.content)){const t=e.content.findIndex(e=>e===j[n]);if(t>0){const n=e.content[t-1];if("text"===n.type&&n.text?.includes("[Image ID: workflow-step-"))return!1}}return!0}),I="string"==typeof e.content?e.content:E.map(e=>e.text).join(""),O=v?I:fe(I),L=async()=>{if(O){const e=await async function(e){if(!e.includes("[[shortcut:"))return e;const t=await Q.getAllPrompts(),n=new Map(t.map(e=>[e.id,e]));return e.replace(Jr,(e,t,s)=>{const r=n.get(t);return r?.prompt?r.prompt:`/${s}`})}(O);await navigator.clipboard.writeText(e),S(!0),setTimeout(()=>S(!1),2e3)}},D=new Map,R=new Map;if([...t,e].forEach(e=>{"assistant"===e.role&&Array.isArray(e.content)&&e.content.forEach(e=>{"tool_use"===e.type&&e.id&&D.set(e.id,{name:e.name,input:e.input,id:e.id})}),"user"===e.role&&Array.isArray(e.content)&&e.content.forEach(e=>{if("tool_result"===e.type&&Array.isArray(e.content)){let t=null;const n=e.tool_use_id?D.get(e.tool_use_id):void 0;n?.input&&(t=n.input.tabId??null),e.content.forEach(e=>{if("image"===e.type&&"base64"===e.source?.type){const n=`data:${e.source.media_type};base64,${e.source.data}`;null!==t&&R.set(t,n)}})}})}),"user"===e.role){const t=Array.isArray(e.content)?e.content.filter(e=>"tool_result"===e.type):[],n=t.length>0&&!O;return q.jsxs("div",{className:u(n?"w-full py-3":"flex justify-end","group"),children:[q.jsxs("div",{className:n?"w-full":"flex flex-col items-end max-w-[85%] min-w-0",children:[A.length>0&&q.jsx("div",{className:u("flex flex-wrap gap-2 justify-end",O?"mb-2":"py-5"),children:A.map((e,t)=>{const n=e;if("base64"===n.source?.type){const e=`data:${n.source.media_type};base64,${n.source.data}`;return q.jsx("div",{className:"w-[120px] h-[120px] rounded-lg overflow-hidden border border-border-300/50 hover:border-border-200 shadow-sm shadow-always-black/5 cursor-pointer transition-all",onClick:()=>T(e),children:q.jsx("img",{src:e,alt:y.formatMessage({defaultMessage:"Attached image {imageNumber}",id:"ehDw1cvHNn"},{imageNumber:t+1}),className:"w-full h-full object-cover"})},t)}return null})}),q.jsx("div",{className:u("relative inline-flex flex-col break-words max-w-full",O&&0==t.length?"px-4 py-3 bg-bg-300 rounded-[14px]":"w-full"),children:O&&q.jsxs("div",{className:u("relative transition-all duration-300 ease-in-out",t.length>0&&"ml-auto px-4 py-3 bg-bg-300 rounded-[14px]",!x&&O.length>500&&"max-h-[300px] overflow-hidden",x&&O.length>500&&"max-h-[50000px] overflow-hidden"),children:[eo(O)?q.jsx("div",{className:"font-base",children:Xi(O,d)}):q.jsx(Zr,{text:O,variant:"user"}),!x&&O.length>500&&q.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-16 bg-gradient-to-t from-bg-300 to-transparent pointer-events-none transition-opacity duration-300"}),O.length>500&&q.jsx("button",{onClick:()=>C(!x),className:"absolute bottom-0.5 right-0 p-1.5 bg-bg-500 hover:bg-bg-200 rounded-full transition-colors border-[0.5px] border-border-400/50 opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto","aria-label":x?y.formatMessage({defaultMessage:"Collapse message",id:"PwZL2cdrCr"}):y.formatMessage({defaultMessage:"Expand message",id:"CZn1nvWlQF"}),children:q.jsx("div",{className:u("transition-transform duration-300",x&&"rotate-180"),children:q.jsx(cs,{size:12,className:"text-text-300"})})})]})}),O&&q.jsx("div",{className:"h-7 flex justify-end items-center",children:q.jsxs("div",{className:"flex items-center gap-0.5 pr-1 opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto",children:[c&&q.jsx(h,{tooltipContent:y.formatMessage({defaultMessage:"Save as shortcut",id:"z9VjDwhyoe"}),side:"bottom",children:q.jsx("button",{onClick:()=>c(O),className:"p-1.5 rounded-md transition-colors text-text-300 hover:bg-bg-300 hover:text-text-100","aria-label":y.formatMessage({defaultMessage:"Save as shortcut",id:"z9VjDwhyoe"}),children:q.jsx(ys,{size:12})})}),q.jsx(h,{tooltipContent:M?y.formatMessage({defaultMessage:"Copied",id:"p556q3uvbn"}):y.formatMessage({defaultMessage:"Copy",id:"4l6vz1/eZ5"}),side:"bottom",open:!!M||void 0,delayDuration:M?0:200,children:q.jsx("button",{onClick:L,className:"p-1.5 rounded-md transition-colors text-text-300 hover:bg-bg-300 hover:text-text-100","aria-label":y.formatMessage({defaultMessage:"Copy message",id:"8Rj4WgXPcB"}),children:M?q.jsx(m,{size:12}):q.jsx(Ct,{size:12})})})]})})]}),q.jsx(at,{imageUrl:N,fileName:y.formatMessage({defaultMessage:"image.png",id:"1mTUAYpy10"}),onClose:()=>T(null)})]})}if("assistant"===e.role){const t=Array.isArray(e.content)?e.content:[],s=n&&!r;return q.jsx("div",{className:u("flex items-start","group"),children:q.jsxs("div",{className:"max-w-4xl claude-response w-full break-words",children:[b&&e.traceId&&q.jsx("div",{className:"mb-2",children:q.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-mono bg-bg-300 text-text-400",children:["(Ant-only) TraceID: ",e.traceId]})}),q.jsx(Gi,{blocks:t,isStreaming:r,allMessages:f,messageIndex:p,screenshotsByTab:R,onComputerFileClick:g}),l&&o&&a&&q.jsx("div",{className:"h-7 flex items-center",children:q.jsxs("div",{className:u("flex items-center gap-0.5 mt-2 -ml-1.5",s?"opacity-100":"opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto"),children:[q.jsx(h,{tooltipContent:y.formatMessage({defaultMessage:"Give positive feedback",id:"FGCv00cdfW"}),side:"bottom",children:q.jsx("button",{onClick:o,className:"p-1.5 rounded-md transition-colors "+("positive"===i?"text-text-100":"text-text-300 hover:bg-bg-300 hover:text-text-100"),"aria-label":y.formatMessage({defaultMessage:"Good response",id:"OSbNg+1qqF"}),children:"positive"===i?q.jsx(Ur,{size:12}):q.jsx(vs,{size:12})})}),q.jsx(h,{tooltipContent:y.formatMessage({defaultMessage:"Give negative feedback",id:"ngzzQUJCXB"}),side:"bottom",children:q.jsx("button",{onClick:a,className:"p-1.5 rounded-md transition-colors "+("negative"===i?"text-text-100":"text-text-300 hover:bg-bg-300 hover:text-text-100"),"aria-label":y.formatMessage({defaultMessage:"Bad response",id:"tuJiA0ZNUD"}),children:"negative"===i?q.jsx(qr,{size:12}):q.jsx(ws,{size:12})})})]})})]})})}return null}),no=e=>Symbol.iterator in e,so=e=>"entries"in e,ro=(e,t)=>{const n=e instanceof Map?e:new Map(e.entries()),s=t instanceof Map?t:new Map(t.entries());if(n.size!==s.size)return!1;for(const[r,i]of n)if(!s.has(r)||!Object.is(i,s.get(r)))return!1;return!0};function io(e,t){return!!Object.is(e,t)||"object"==typeof e&&null!==e&&"object"==typeof t&&null!==t&&(Object.getPrototypeOf(e)===Object.getPrototypeOf(t)&&(no(e)&&no(t)?so(e)&&so(t)?ro(e,t):((e,t)=>{const n=e[Symbol.iterator](),s=t[Symbol.iterator]();let r=n.next(),i=s.next();for(;!r.done&&!i.done;){if(!Object.is(r.value,i.value))return!1;r=n.next(),i=s.next()}return!!r.done&&!!i.done})(e,t):ro({entries:()=>Object.entries(e)},{entries:()=>Object.entries(t)})))}function oo(e){const t=Y.useRef(void 0);return n=>{const s=e(n);return io(t.current,s)?t.current:t.current=s}}const ao=Ln(e=>({showCommandMenu:!1,showWorkflowModeSelectionModal:!1,showSkipPermissionsOverlay:!1,showShareWarningModal:!1,showAntBuildUpsell:!1,showFeedbackForm:!1,showNotificationBanner:!1,announcementDismissed:!1,skipPermissionsWarningDismissed:!1,isMessageLimitDismissed:!1,showTopGradient:!1,hasBlockingWarning:!1,commandSearchTerm:"",isGeneratingSummary:!1,pendingContinue:!1,lastGroupShowExpandedTimeline:!1,lastGroupAnimationCompletedAt:0,setShowCommandMenu:t=>e({showCommandMenu:t}),setShowWorkflowModeSelectionModal:t=>e({showWorkflowModeSelectionModal:t}),setShowSkipPermissionsOverlay:t=>e({showSkipPermissionsOverlay:t}),setShowShareWarningModal:t=>e({showShareWarningModal:t}),setShowAntBuildUpsell:t=>e({showAntBuildUpsell:t}),setShowFeedbackForm:t=>e({showFeedbackForm:t}),setShowNotificationBanner:t=>e({showNotificationBanner:t}),setAnnouncementDismissed:t=>e({announcementDismissed:t}),setSkipPermissionsWarningDismissed:t=>e({skipPermissionsWarningDismissed:t}),setIsMessageLimitDismissed:t=>e({isMessageLimitDismissed:t}),setShowTopGradient:t=>e({showTopGradient:t}),setHasBlockingWarning:t=>e({hasBlockingWarning:t}),setCommandSearchTerm:t=>e({commandSearchTerm:t}),setIsGeneratingSummary:t=>e({isGeneratingSummary:t}),setPendingContinue:t=>e({pendingContinue:t}),setLastGroupShowExpandedTimeline:t=>e({lastGroupShowExpandedTimeline:t}),setLastGroupAnimationCompletedAt:t=>e({lastGroupAnimationCompletedAt:t}),resetOnSessionClear:()=>e({hasBlockingWarning:!1,skipPermissionsWarningDismissed:!1,lastGroupShowExpandedTimeline:!1,lastGroupAnimationCompletedAt:0})})),lo=U.memo(function({messages:e,allMessages:t,startIndex:n,endIndex:r,isStreaming:i,isAgentRunning:o=!1,currentStatusProp:a,onComputerFileClick:l}){const c=s(),d=ao(e=>e.setLastGroupShowExpandedTimeline),{timelineBlocks:u,finalBlocks:h,hasCompletionSignal:p,foundTurnAnswerStart:m}=U.useMemo(()=>{const s=[],i=[];let o=!1,a=!1;const l=t.slice(r+1).find(e=>"result"===e.type);let c="";return l&&l.result&&(c=l.result.trim(),a=!0),e.forEach((e,t)=>{if("assistant"!==e.role||!Array.isArray(e.content))return;const r="stop_reason"in e?e.stop_reason:void 0;e.content.forEach(e=>{const a=n+t;"tool_use"!==e.type||"turn_answer_start"!==e.name?"text"===e.type?o?i.push({type:"text",block:e,messageIndex:a,stopReason:r}):"end_turn"===r?e.text?.trim()&&i.push({type:"text",block:e,messageIndex:a,stopReason:r}):c&&e.text?.trim()===c?i.push({type:"text",block:e,messageIndex:a,stopReason:r}):e.text?.trim()&&s.push({type:"text",block:e,messageIndex:a,stopReason:r}):"tool_use"===e.type&&(o?i:s).push({type:"tool_use",block:e,messageIndex:a,stopReason:r}):o=!0})}),{timelineBlocks:s,finalBlocks:i,hasCompletionSignal:a,foundTurnAnswerStart:o}},[e,n,t,r]),f=U.useMemo(()=>{const e=new Map;return t.forEach(t=>{"user"===t.role&&Array.isArray(t.content)&&t.content.forEach(t=>{"tool_result"===t.type&&t.tool_use_id&&e.set(t.tool_use_id,t)})}),e},[t]),g=U.useCallback((e,n,s)=>{const r="tool_use"===e.type&&f.has(e.block.id),a="tool_use"===e.type?!r&&o:i&&s.isLastItem;return"text"===e.type?s.isInExpandedTimeline?null:q.jsx(bt,{isFirstItem:s.isFirstItem,isLastItem:s.isLastItem,isActive:a,showDotFallback:!0,children:q.jsx("div",{className:"px-2.5 text-text-400",children:q.jsx(Zr,{text:e.block.text,variant:"assistant",onComputerFileClick:l})})},`timeline-${n}`):q.jsx(Ji,{block:e.block,toolResult:f.get(e.block.id),index:n,blocks:u.map(e=>e.block),renderMode:ct.TimelineGroup,isFirstItemInGroup:s.isFirstItem,isLastItemInGroup:s.isLastItem,isStreaming:!r&&o,allMessages:t,messageIndex:e.messageIndex,onComputerFileClick:l},`timeline-tool-${e.block.id}`)},[f,o,i,u,t,l]),y=U.useCallback(e=>"text"===e.type?i?q.jsx(Ui,{text:e.block.text,onComputerFileClick:l}):q.jsx(Zr,{text:e.block.text,variant:"assistant",onComputerFileClick:l}):q.jsx(Zr,{text:`Tool: ${e.block.name}`,variant:"assistant",onComputerFileClick:l}),[i,l]),x=t.slice(r+1).some(e=>"result"===e.type||!("user"!==e.role||!Array.isArray(e.content))&&e.content.some(e=>"text"===e.type&&e.text?.trim())),C=h.some(e=>"text"===e.type&&e.block.text?.trim()),b=u.length>0,w=b?C||x||p:m||x||p,v=U.useCallback(e=>{d(e&&b)},[d,b]);if(0===u.length&&0===h.length)return null;const k=a||c.formatMessage({defaultMessage:"Working",id:"gAR0atqpRn"});return q.jsx(wt,{blocks:u,isStreaming:o,statusText:k,turnIsOver:w,renderBlock:g,fadeToolsOnStatusChange:!0,blocksAfterTimeline:h,renderBlockAfterTimeline:y,onStatusDisplayVisibilityChange:v})}),co=({message:e})=>{const[t,n]=U.useState(!1),s="string"==typeof e.content?e.content:"";return q.jsxs("div",{className:"mb-5 overflow-hidden border-[0.5px] border-border-200 rounded-[10px]",children:[q.jsxs("button",{onClick:()=>n(!t),className:"w-full px-4 py-2 transition-colors flex items-center justify-between text-left cursor-pointer "+(t?"bg-bg-000":"bg-bg-100 hover:bg-bg-200"),children:[q.jsx("span",{className:"font-small text-text-300",children:q.jsx(r,{defaultMessage:"Conversation summary",id:"c0ZeCgLvCL"})}),q.jsx(Ci,{className:"w-4 h-4 text-text-400 transition-transform "+(t?"rotate-90":"")})]}),t&&q.jsx("div",{className:"px-4 pt-2 pb-4 bg-bg-000",children:q.jsx("div",{className:"font-claude-response text-xs text-text-200 whitespace-pre-wrap",children:s})})]})},uo=U.memo(function({messageGroups:e,messages:t,isAgentRunning:n,hasPermissionPrompt:s,currentStatus:r,submittedFeedback:i,scrollRefs:o,onThumbsUp:a,onThumbsDown:l,onSavePrompt:c,onEditShortcut:d,onComputerFileClick:u}){const h=U.useCallback(e=>{if("user"!==e.role)return!1;if("string"==typeof e.content){return fe(e.content).length>0}return!!Array.isArray(e.content)&&e.content.some(e=>{if("text"===e.type){return fe(e.text).length>0}return!1})},[]);let p=-1;for(let y=e.length-1;y>=0;y--){const t=e[y];if("tool_group"!==t.type){const e=t.messages[0];if(e&&h(e)){p=y;break}}}const m=(p,m)=>{if("tool_group"===p.type){const i=m===e.length-1,o=p.messages[p.messages.length-1],a=i&&"assistant"===o?.role&&n;return q.jsx("div",{children:q.jsx(lo,{messages:p.messages,allMessages:t,startIndex:p.startIndex,endIndex:p.endIndex,allMessagesLength:t.length,isStreaming:a,isAgentRunning:n,hasPermissionPrompt:s,currentStatusProp:r,isLastGroup:i,onComputerFileClick:u})},p.startIndex)}const f=p.messages[0],g=p.startIndex;if(!f)return null;if("type"in f&&"result"===f.type)return null;if(f.isCompactSummary)return q.jsx(co,{message:f},g);const y=(()=>{for(let e=t.length-1;e>g;e--){const n=t[e];if((!("type"in n)||"result"!==n.type)&&"user"!==n.role)return!1}return!0})(),x="assistant"===f.role;let C=!1;if(x&&!f.isCompactionMessage){const e=t.slice(g+1).some(e=>h(e));C=y||e}const b=f.isCompactionMessage,w=h(f)&&!t.slice(g+1).some(e=>h(e));return q.jsx("div",{className:b?"mb-5":"",ref:(()=>{if(w)return o.lastHumanMessage})(),children:q.jsx(to,{message:f,previousMessages:t.slice(0,g),allMessages:t,messageIndex:g,isLastMessage:y,isStreaming:y&&x&&n,submittedFeedback:i.get(g)||null,onThumbsUp:()=>a(g),onThumbsDown:()=>l(g),showThumbs:C,onSavePrompt:"user"===f.role?e=>c(e):void 0,onEditShortcut:"user"===f.role?d:void 0,onComputerFileClick:u})},g)},f=e.slice(0,p+1),g=e.slice(p+1);return q.jsxs(q.Fragment,{children:[f.map((e,t)=>m(e,t)),g.length>0&&q.jsx("div",{ref:o.lastAssistantMessage,className:"flex flex-col",children:g.map((e,t)=>m(e,p+1+t))})]})}),ho=U.forwardRef((e,t)=>q.jsx("div",{ref:t,"aria-hidden":"true",className:"h-px w-full pointer-events-none"}));ho.displayName="LastMessageSentinel";const po=Ln(e=>({messages:[],messageByIndex:new Map,isStreaming:!1,sessionId:null,hasApprovedPlan:!1,setMessages:t=>{const n=new Map;t.forEach((e,t)=>{n.set(t,e)}),e({messages:t,messageByIndex:n})},appendMessage:t=>e(e=>{const n=[...e.messages,t],s=n.length-1,r=new Map(e.messageByIndex);return r.set(s,t),{messages:n,messageByIndex:r}}),updateMessage:(t,n)=>e(e=>{const s=[...e.messages];s[t]=n;const r=new Map(e.messageByIndex);return r.set(t,n),{messages:s,messageByIndex:r}}),clearMessages:()=>e({messages:[],messageByIndex:new Map,hasApprovedPlan:!1}),setStreaming:t=>e({isStreaming:t}),setSessionId:t=>e({sessionId:t}),setHasApprovedPlan:t=>e({hasApprovedPlan:t})})),mo=U.memo(function({messages:e,messageGroups:t,messageHistory:n,isAgentRunning:r,isCompacting:i,isInitializing:o,showConversionError:a,conversionError:l,hasPermissionPrompt:c,currentStatus:d,tokensSaved:u,isDarkMode:h,tabId:p,autoScrollRef:m,scrollRefs:f,sentinelRef:g,submittedFeedback:y,onThumbsUp:x,onThumbsDown:C,onSavePrompt:b,onEditShortcut:w,onComputerFileClick:v,onPromptClick:k,children:M}){const S=s(),N=ao(e=>e.lastGroupShowExpandedTimeline),T=po(e=>{let t=0,n=!1;for(const s of e.messages)if("user"===s.role){const e=s.content;(Array.isArray(e)?e.some(e=>"type"in e&&"tool_result"!==e.type):"string"==typeof e)&&(t++,n=!0)}else"assistant"===s.role&&n&&(t++,n=!1);return t});return q.jsx(qn,{ref:m,parentClassName:"flex-1 "+(0===e.length?"!overflow-hidden":""),innerClassName:"h-full",children:q.jsxs("div",{className:"mx-auto flex size-full max-w-3xl flex-col md:px-2",children:[q.jsxs("div",{className:"flex-1 flex flex-col px-4 max-w-3xl mx-auto w-full pt-1",children:[0===e.length&&q.jsx(ts,{tabId:p,onPromptClick:k}),n.length>0&&q.jsxs(q.Fragment,{children:[n.map((e,t)=>q.jsx("div",{className:"opacity-60",children:q.jsx(to,{message:e,previousMessages:n.slice(0,t),messageIndex:t,allMessages:n,isLastMessage:!1,isStreaming:!1,onEditShortcut:"user"===e.role?w:void 0,onComputerFileClick:v})},`history-${t}`)),q.jsx(ns,{tokensSaved:u??void 0})]}),q.jsx(uo,{messageGroups:t,messages:e,isAgentRunning:r,hasPermissionPrompt:c,currentStatus:d,submittedFeedback:y,scrollRefs:{lastAssistantMessage:f.lastAssistantMessage,lastHumanMessage:f.lastHumanMessage},onThumbsUp:x,onThumbsDown:C,onSavePrompt:b,onEditShortcut:w,onComputerFileClick:v}),q.jsx(ho,{ref:g}),q.jsxs("div",{ref:f.extras,className:"min-h-8",children:[q.jsxs("div",{className:"flex items-center gap-3 "+(!(r||i||o)||c||N?"invisible":""),children:[q.jsx(vt,{state:i||o?"shimmer":"thinking",isInteractive:!1,className:"[&_svg]:!fill-[#D97757]"}),i&&q.jsx(ss,{isDarkMode:h,text:S.formatMessage({defaultMessage:"Compacting...",id:"zqQotfDw3h"})}),o&&q.jsx(ss,{isDarkMode:h,text:S.formatMessage({defaultMessage:"Starting up...",id:"GsEWS8NyxJ"})})]}),a&&q.jsx(rs,{error:l,tabId:p,title:S.formatMessage({defaultMessage:"Create Scheduled Task",id:"mHmhCARyh8"})})]}),q.jsx(Jn,{scrollRefs:f,autoScrollRef:m,messageCount:T})]}),M&&q.jsxs("div",{ref:f.chatInput,className:"sticky bottom-0 mx-auto w-full z-[5]",children:[M,q.jsx("div",{className:"bg-bg-100 h-0.5"})]})]})})});function fo({autoscrollRef:e,sentinelElement:t,isStreaming:n=!1,children:s,className:r,wrapperClassName:i,ariaLabel:o="Scroll to bottom",scrollThreshold:a=150}){const[l,c]=U.useState(!1),d=U.useCallback(()=>{const t=e.current;t&&(t.scrollToBottom("instant"),n&&t.setPinToBottom(!0))},[e,n]);return U.useEffect(()=>{n||e.current?.setPinToBottom(!1)},[n,e]),U.useEffect(()=>{if(!t)return;const n=e.current?.getScrollContainer();if(!n)return;const s=new IntersectionObserver(([e])=>{c(!e.isIntersecting)},{root:n,threshold:.01,rootMargin:`0px 0px ${a}px 0px`});return s.observe(t),()=>{s.disconnect()}},[t,e,a]),q.jsx("div",{className:u("flex justify-center pb-2",i),children:q.jsxs("button",{onClick:d,"aria-label":o,className:u("size-9 inline-flex items-center justify-center","border-0.5 overflow-hidden !rounded-full p-1","shadow-md hover:shadow-lg","bg-bg-000/80 hover:bg-bg-000","backdrop-blur transition-opacity duration-200",n?"border-accent-brand/30":"border-border-300",l?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none",r),children:[s,q.jsx(mi,{className:"mix-blend-luminosity"})]})})}function go(e,t){return kt(e)?e[((e,t,n)=>{const s=t-e;return((n-e)%s+s)%s+e})(0,e.length,t)]:e}class yo{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>e.finished))}getAll(e){return this.animations[0][e]}setAll(e,t){for(let n=0;n<this.animations.length;n++)this.animations[n][e]=t}attachTimeline(e){const t=this.animations.map(t=>t.attachTimeline(e));return()=>{t.forEach((e,t)=>{e&&e(),this.animations[t].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get state(){return this.getAll("state")}get startTime(){return this.getAll("startTime")}get duration(){return xo(this.animations,"duration")}get iterationDuration(){return xo(this.animations,"iterationDuration")}runAll(e){this.animations.forEach(t=>t[e]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}function xo(e,t){let n=0;for(let s=0;s<e.length;s++){const r=e[s][t];null!==r&&r>n&&(n=r)}return n}class Co extends yo{then(e,t){return this.finished.finally(e).then(()=>{})}}function bo(e){const t=St(()=>Nt(e)),{isStatic:n}=U.useContext(Tt);if(n){const[,n]=U.useState(e);U.useEffect(()=>t.on("change",n),[])}return t}function wo(e,t){const n=bo(t()),s=()=>n.set(t());return s(),Et(()=>{const t=()=>jt.preRender(s,!1,!0),n=e.map(e=>e.on("change",t));return()=>{n.forEach(e=>e()),At(s)}}),n}function vo(e,...t){const n=e.length;return wo(t.filter(It),function(){let s="";for(let r=0;r<n;r++){s+=e[r];const n=t[r];n&&(s+=It(n)?n.get():n)}return s})}function ko(e,t,n,s){if("function"==typeof e)return function(e){Ot.current=[],e();const t=wo(Ot.current,e);return Ot.current=void 0,t}(e);const r="function"==typeof t?t:function(...e){const t=!Array.isArray(e[0]),n=t?0:-1,s=e[0+n],r=e[1+n],i=e[2+n],o=e[3+n],a=Mt(r,i,o);return t?a(s):a}(t,n,s);return Array.isArray(e)?Mo(e,r):Mo([e],([e])=>r(e))}function Mo(e,t){const n=St(()=>[]);return wo(e,()=>{n.length=0;const s=e.length;for(let t=0;t<s;t++)n[t]=e[t].get();return t(n)})}function So(e){return"object"==typeof e&&!Array.isArray(e)}function No(e,t,n,s){return"string"==typeof e&&So(t)?Lt(e,n,s):e instanceof NodeList?Array.from(e):Array.isArray(e)?e:[e]}function To(e,t,n){return e*(t+1)}function Eo(e,t,n,s){return"number"==typeof t?t:t.startsWith("-")||t.startsWith("+")?Math.max(0,e+parseFloat(t)):"<"===t?n:t.startsWith("<")?Math.max(0,n+parseFloat(t.slice(1))):s.get(t)??e}function jo(e,t,n,s,r,i){!function(e,t,n){for(let s=0;s<e.length;s++){const r=e[s];r.at>t&&r.at<n&&(Rt(e,r),s--)}}(e,r,i);for(let o=0;o<t.length;o++)e.push({value:t[o],at:Dt(r,i,s[o]),easing:go(n,o)})}function Ao(e,t){for(let n=0;n<e.length;n++)e[n]=e[n]/(t+1)}function Io(e,t){return e.at===t.at?null===e.value?1:null===t.value?-1:0:e.at-t.at}function Oo(e,t){return!t.has(e)&&t.set(e,{}),t.get(e)}function Lo(e,t){return t[e]||(t[e]=[]),t[e]}function Do(e){return Array.isArray(e)?e:[e]}function Ro(e,t){return e&&e[t]?{...e,...e[t]}:{...e}}const _o=e=>"number"==typeof e,Po=e=>e.every(_o);class Vo extends Ft{constructor(){super(...arguments),this.type="object"}readValueFromInstance(e,t){if(function(e,t){return e in t}(t,e)){const n=e[t];if("string"==typeof n||"number"==typeof n)return n}}getBaseTargetFromProps(){}removeValueFromRenderState(e,t){delete t.output[e]}measureInstanceViewportBox(){return Bt()}build(e,t){Object.assign(e.output,t)}renderInstance(e,{output:t}){Object.assign(e,t)}sortInstanceNodePosition(){return 0}}function Ho(e){const t={presenceContext:null,props:{},visualState:{renderState:{transform:{},transformOrigin:{},style:{},vars:{},attrs:{}},latestValues:{}}},n=Wt(e)&&!Zt(e)?new Ut(t):new qt(t);n.mount(e),Jt.set(e,n)}function $o(e){const t=new Vo({presenceContext:null,props:{},visualState:{renderState:{output:{}},latestValues:{}}});t.mount(e),Jt.set(e,t)}function zo(e,t,n,s){const r=[];if(function(e,t){return It(e)||"number"==typeof e||"string"==typeof e&&!So(t)}(e,t))r.push(Gt(e,So(t)&&t.default||t,n&&n.default||n));else{const i=No(e,t,s),o=i.length;for(let e=0;e<o;e++){const s=i[e],a=s instanceof Element?Ho:$o;Jt.has(s)||a(s);const l=Jt.get(s),c={...n};"delay"in c&&"function"==typeof c.delay&&(c.delay=c.delay(e,o)),r.push(...Kt(l,{...t,transition:c},{}))}}return r}function Fo(e,t,n){const s=[],r=function(e,{defaultTransition:t={},...n}={},s,r){const i=t.duration||.3,o=new Map,a=new Map,l={},c=new Map;let d=0,u=0,h=0;for(let p=0;p<e.length;p++){const n=e[p];if("string"==typeof n){c.set(n,u);continue}if(!Array.isArray(n)){c.set(n.name,Eo(u,n.at,d,c));continue}let[o,m,f={}]=n;void 0!==f.at&&(u=Eo(u,f.at,d,c));let g=0;const y=(e,n,s,o=0,a=0)=>{const l=Do(e),{delay:c=0,times:d=_t(l),type:p="keyframes",repeat:m,repeatType:f,repeatDelay:y=0,...x}=n;let{ease:C=t.ease||"easeOut",duration:b}=n;const w="function"==typeof c?c(o,a):c,v=l.length,k=Ht(p)?p:r?.[p||"keyframes"];if(v<=2&&k){let e=100;if(2===v&&Po(l)){const t=l[1]-l[0];e=Math.abs(t)}const t={...x};void 0!==b&&(t.duration=$t(b));const n=Pt(t,e,k);C=n.ease,b=n.duration}b??(b=i);const M=u+w;1===d.length&&0===d[0]&&(d[1]=1);const S=d.length-l.length;if(S>0&&Vt(d,S),1===l.length&&l.unshift(null),m){b=To(b,m);const e=[...l],t=[...d];C=Array.isArray(C)?[...C]:[C];const n=[...C];for(let s=0;s<m;s++){l.push(...e);for(let r=0;r<e.length;r++)d.push(t[r]+(s+1)),C.push(0===r?"linear":go(n,r-1))}Ao(d,m)}const N=M+b;jo(s,l,C,d,M,N),g=Math.max(w+b,g),h=Math.max(N,h)};if(It(o))y(m,f,Lo("default",Oo(o,a)));else{const e=No(o,m,s,l),t=e.length;for(let n=0;n<t;n++){const s=Oo(e[n],a);for(const e in m)y(m[e],Ro(f,e),Lo(e,s),n,t)}}d=u,u+=g}return a.forEach((e,s)=>{for(const r in e){const i=e[r];i.sort(Io);const a=[],l=[],c=[];for(let e=0;e<i.length;e++){const{at:t,value:n,easing:s}=i[e];a.push(n),l.push(zt(0,h,t)),c.push(s||"easeOut")}0!==l[0]&&(l.unshift(0),a.unshift(a[0]),c.unshift("easeInOut")),1!==l[l.length-1]&&(l.push(1),a.push(null)),o.has(s)||o.set(s,{keyframes:{},transition:{}});const d=o.get(s);d.keyframes[r]=a,d.transition[r]={...t,duration:h,ease:c,times:l,...n}}}),o}(e,t,n,{spring:Yt});return r.forEach(({keyframes:e,transition:t},n)=>{s.push(...zo(n,e,t))}),s}const Bo=function(e,t,n){let s,r=[];if(i=e,Array.isArray(i)&&i.some(Array.isArray))r=Fo(e,t,Wo);else{const{onComplete:i,...o}=n||{};"function"==typeof i&&(s=i),r=zo(e,t,o,Wo)}var i;const o=new Co(r);return s&&o.finished.then(s),o};var Wo;const Zo=({type:e,children:t,onAction:n,onDismiss:r,actionText:i,actionIcon:o,dismissWithGradient:a=!1})=>{const l=s(),[c,d]=U.useState(!1),u=(e=>{switch(e){case"high-risk":return"bg-[#F7ECC1] dark:bg-[#F5DB9A]";case"refusal":case"error":case"danger":return"bg-danger-900";case"announcement":return"bg-[#D4E7F7] dark:bg-[#2B5278]";default:return"bg-bg-300 dark:bg-bg-400"}})(e),h=(e=>{switch(e){case"high-risk":return"text-[#141413]";case"refusal":case"error":case"danger":return"text-danger-100 dark:text-danger-000";case"announcement":return"text-[#1E5A8E] dark:text-[#D4E7F7]";default:return"text-text-200 dark:text-text-300"}})(e);return q.jsx(Qt.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.15,ease:"easeOut"},className:"overflow-hidden",children:q.jsxs("div",{className:`${u} ${h} rounded-t-[14px] px-4 py-2 flex items-center justify-between relative`,...a&&r&&{onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1)},children:[q.jsx("div",{className:"text-xs flex-1",children:t}),!a&&(n||r)&&q.jsxs("div",{className:"flex items-center gap-2 ml-3",children:[n&&i&&q.jsxs("button",{onClick:n,className:("high-risk"===e?"bg-[#141413] text-[#F7ECC1] dark:text-[#F5DB9A]":"refusal"===e||"danger"===e?"bg-danger-100 text-danger-900 dark:bg-danger-000 dark:text-danger-900":"bg-text-100 text-bg-000")+" px-3 py-1 rounded-md text-xs font-medium hover:opacity-90 transition-opacity flex items-center gap-1",children:[o,i]}),r&&q.jsx("button",{onClick:r,className:"p-1 hover:opacity-70 rounded transition-opacity","aria-label":l.formatMessage({defaultMessage:"Dismiss",id:"TDaF6JVgG6"}),children:q.jsx(f,{size:12})})]}),a&&r&&q.jsxs(q.Fragment,{children:[q.jsx("div",{className:"absolute inset-0 pointer-events-none rounded-t-[14px] transition-all duration-300 ease-out\n                "+(c?"opacity-100":"opacity-0"),style:{background:"high-risk"===e?"linear-gradient(45deg, transparent 70%, rgba(247, 236, 193, 0.5) 85%, rgba(247, 236, 193, 0.9) 100%)":"refusal"===e||"error"===e||"danger"===e?"linear-gradient(45deg, transparent 70%, rgba(249, 236, 236, 0.5) 85%, rgba(249, 236, 236, 0.9) 100%)":"announcement"===e?"linear-gradient(45deg, transparent 70%, rgba(212, 231, 247, 0.5) 85%, rgba(212, 231, 247, 0.9) 100%)":"linear-gradient(45deg, transparent 70%, rgba(255, 255, 255, 0.3) 85%, rgba(255, 255, 255, 0.6) 100%)"}}),q.jsx("button",{onClick:r,className:"absolute top-3 right-3 p-0.5 transition-all duration-300 ease-out\n                "+(c?"opacity-70 hover:opacity-100":"opacity-0 pointer-events-none"),"aria-label":l.formatMessage({defaultMessage:"Dismiss",id:"TDaF6JVgG6"}),children:q.jsx(f,{vectorSizeOverride:11})})]})]})})},Uo=({currentModelName:e,fallbackModelName:t,fallbackDisplayName:n,learnMoreUrl:s,onRetry:o,onSendFeedback:a})=>q.jsxs("div",{className:"bg-bg-000 rounded-2xl border-[0.5px] border-border-300 px-4 py-4",style:{boxShadow:"0 4px 20px 0 rgba(0, 0, 0, 0.04)"},children:[q.jsx("h3",{className:"font-ui text-[16px] font-medium leading-[140%] text-text-100 mb-2",children:q.jsx(r,{defaultMessage:"Chat paused",id:"bL7dVUkHa0"})}),q.jsx("p",{className:"font-base text-text-100 mb-0",children:q.jsx(r,{defaultMessage:"{currentModelName}'s safety filters flagged this chat. Due to its advanced capabilities, {currentModelName} has additional safety measures that occasionally pause normal, safe chats. We're working to improve this. Continue your chat with {fallbackDisplayName}, {sendFeedbackLink}, or {learnMoreLink}.",id:"DLwrrxRpu/",values:{currentModelName:e,fallbackDisplayName:n,sendFeedbackLink:q.jsx("button",{onClick:a,className:"inline-link hover:opacity-70 transition-opacity",children:q.jsx(r,{defaultMessage:"send feedback",id:"Rtb80IDfRS"})}),learnMoreLink:q.jsx("button",{onClick:()=>chrome.tabs.create({url:s}),className:"inline-link hover:opacity-70 transition-opacity",children:q.jsx(r,{defaultMessage:"learn more",id:"JpNRENzqW2"})})}})}),q.jsx(i,{variant:"primary",onClick:()=>o(t),className:"mt-4 w-full",children:q.jsx(r,{defaultMessage:"Retry with {fallbackDisplayName}",id:"yeVBln6MC+",values:{fallbackDisplayName:n}})})]});class qo extends Error{}class Jo extends qo{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class Go extends qo{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class Ko extends qo{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class Yo extends qo{}class Qo extends qo{constructor(e){super(`Invalid unit ${e}`)}}class Xo extends qo{}class ea extends qo{constructor(){super("Zone is an abstract class")}}const ta="numeric",na="short",sa="long",ra={year:ta,month:ta,day:ta},ia={year:ta,month:na,day:ta},oa={year:ta,month:na,day:ta,weekday:na},aa={year:ta,month:sa,day:ta},la={year:ta,month:sa,day:ta,weekday:sa},ca={hour:ta,minute:ta},da={hour:ta,minute:ta,second:ta},ua={hour:ta,minute:ta,second:ta,timeZoneName:na},ha={hour:ta,minute:ta,second:ta,timeZoneName:sa},pa={hour:ta,minute:ta,hourCycle:"h23"},ma={hour:ta,minute:ta,second:ta,hourCycle:"h23"},fa={hour:ta,minute:ta,second:ta,hourCycle:"h23",timeZoneName:na},ga={hour:ta,minute:ta,second:ta,hourCycle:"h23",timeZoneName:sa},ya={year:ta,month:ta,day:ta,hour:ta,minute:ta},xa={year:ta,month:ta,day:ta,hour:ta,minute:ta,second:ta},Ca={year:ta,month:na,day:ta,hour:ta,minute:ta},ba={year:ta,month:na,day:ta,hour:ta,minute:ta,second:ta},wa={year:ta,month:na,day:ta,weekday:na,hour:ta,minute:ta},va={year:ta,month:sa,day:ta,hour:ta,minute:ta,timeZoneName:na},ka={year:ta,month:sa,day:ta,hour:ta,minute:ta,second:ta,timeZoneName:na},Ma={year:ta,month:sa,day:ta,weekday:sa,hour:ta,minute:ta,timeZoneName:sa},Sa={year:ta,month:sa,day:ta,weekday:sa,hour:ta,minute:ta,second:ta,timeZoneName:sa};class Na{get type(){throw new ea}get name(){throw new ea}get ianaName(){return this.name}get isUniversal(){throw new ea}offsetName(e,t){throw new ea}formatOffset(e,t){throw new ea}offset(e){throw new ea}equals(e){throw new ea}get isValid(){throw new ea}}let Ta=null;class Ea extends Na{static get instance(){return null===Ta&&(Ta=new Ea),Ta}get type(){return"system"}get name(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:t,locale:n}){return zl(e,t,n)}formatOffset(e,t){return Zl(this.offset(e),t)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return"system"===e.type}get isValid(){return!0}}let ja={};const Aa={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};let Ia={};class Oa extends Na{static create(e){return Ia[e]||(Ia[e]=new Oa(e)),Ia[e]}static resetCache(){Ia={},ja={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch(t){return!1}}constructor(e){super(),this.zoneName=e,this.valid=Oa.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:t,locale:n}){return zl(e,t,n,this.name)}formatOffset(e,t){return Zl(this.offset(e),t)}offset(e){const t=new Date(e);if(isNaN(t))return NaN;const n=(s=this.name,ja[s]||(ja[s]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:s,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),ja[s]);var s;let[r,i,o,a,l,c,d]=n.formatToParts?function(e,t){const n=e.formatToParts(t),s=[];for(let r=0;r<n.length;r++){const{type:e,value:t}=n[r],i=Aa[e];"era"===e?s[i]=t:bl(i)||(s[i]=parseInt(t,10))}return s}(n,t):function(e,t){const n=e.format(t).replace(/\u200E/g,""),s=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(n),[,r,i,o,a,l,c,d]=s;return[o,r,i,a,l,c,d]}(n,t);"BC"===a&&(r=1-Math.abs(r));let u=+t;const h=u%1e3;return u-=h>=0?h:1e3+h,(Pl({year:r,month:i,day:o,hour:24===l?0:l,minute:c,second:d,millisecond:0})-u)/6e4}equals(e){return"iana"===e.type&&e.name===this.name}get isValid(){return this.valid}}let La={};let Da={};function Ra(e,t={}){const n=JSON.stringify([e,t]);let s=Da[n];return s||(s=new Intl.DateTimeFormat(e,t),Da[n]=s),s}let _a={};let Pa={};let Va=null;let Ha={};function $a(e,t,n,s){const r=e.listingMode();return"error"===r?null:"en"===r?n(t):s(t)}class za{constructor(e,t,n){this.padTo=n.padTo||0,this.floor=n.floor||!1;const{padTo:s,floor:r,...i}=n;if(!t||Object.keys(i).length>0){const t={useGrouping:!1,...n};n.padTo>0&&(t.minimumIntegerDigits=n.padTo),this.inf=function(e,t={}){const n=JSON.stringify([e,t]);let s=_a[n];return s||(s=new Intl.NumberFormat(e,t),_a[n]=s),s}(e,t)}}format(e){if(this.inf){const t=this.floor?Math.floor(e):e;return this.inf.format(t)}return jl(this.floor?Math.floor(e):Ll(e,3),this.padTo)}}class Fa{constructor(e,t,n){let s;if(this.opts=n,this.originalZone=void 0,this.opts.timeZone)this.dt=e;else if("fixed"===e.zone.type){const t=e.offset/60*-1,n=t>=0?`Etc/GMT+${t}`:`Etc/GMT${t}`;0!==e.offset&&Oa.create(n).valid?(s=n,this.dt=e):(s="UTC",this.dt=0===e.offset?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else"system"===e.zone.type?this.dt=e:"iana"===e.zone.type?(this.dt=e,s=e.zone.name):(s="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const r={...this.opts};r.timeZone=r.timeZone||s,this.dtf=Ra(t,r)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(e=>{if("timeZoneName"===e.type){const t=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...e,value:t}}return e}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class Ba{constructor(e,t,n){this.opts={style:"long",...n},!t&&kl()&&(this.rtf=function(e,t={}){const{base:n,...s}=t,r=JSON.stringify([e,s]);let i=Pa[r];return i||(i=new Intl.RelativeTimeFormat(e,t),Pa[r]=i),i}(e,n))}format(e,t){return this.rtf?this.rtf.format(e,t):function(e,t,n="always",s=!1){const r={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},i=-1===["hours","minutes","seconds"].indexOf(e);if("auto"===n&&i){const n="days"===e;switch(t){case 1:return n?"tomorrow":`next ${r[e][0]}`;case-1:return n?"yesterday":`last ${r[e][0]}`;case 0:return n?"today":`this ${r[e][0]}`}}const o=Object.is(t,-0)||t<0,a=Math.abs(t),l=1===a,c=r[e],d=s?l?c[1]:c[2]||c[1]:l?r[e][0]:e;return o?`${a} ${d} ago`:`in ${a} ${d}`}(t,e,this.opts.numeric,"long"!==this.opts.style)}formatToParts(e,t){return this.rtf?this.rtf.formatToParts(e,t):[]}}const Wa={firstDay:1,minimalDays:4,weekend:[6,7]};class Za{static fromOpts(e){return Za.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,t,n,s,r=!1){const i=e||rl.defaultLocale,o=i||(r?"en-US":Va||(Va=(new Intl.DateTimeFormat).resolvedOptions().locale,Va)),a=t||rl.defaultNumberingSystem,l=n||rl.defaultOutputCalendar,c=Tl(s)||rl.defaultWeekSettings;return new Za(o,a,l,c,i)}static resetCache(){Va=null,Da={},_a={},Pa={}}static fromObject({locale:e,numberingSystem:t,outputCalendar:n,weekSettings:s}={}){return Za.create(e,t,n,s)}constructor(e,t,n,s,r){const[i,o,a]=function(e){const t=e.indexOf("-x-");-1!==t&&(e=e.substring(0,t));const n=e.indexOf("-u-");if(-1===n)return[e];{let t,r;try{t=Ra(e).resolvedOptions(),r=e}catch(s){const i=e.substring(0,n);t=Ra(i).resolvedOptions(),r=i}const{numberingSystem:i,calendar:o}=t;return[r,i,o]}}(e);this.locale=i,this.numberingSystem=t||o||null,this.outputCalendar=n||a||null,this.weekSettings=s,this.intl=function(e,t,n){return n||t?(e.includes("-u-")||(e+="-u"),n&&(e+=`-ca-${n}`),t&&(e+=`-nu-${t}`),e):e}(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=r,this.fastNumbersCached=null}get fastNumbers(){var e;return null==this.fastNumbersCached&&(this.fastNumbersCached=(!(e=this).numberingSystem||"latn"===e.numberingSystem)&&("latn"===e.numberingSystem||!e.locale||e.locale.startsWith("en")||"latn"===new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),t=!(null!==this.numberingSystem&&"latn"!==this.numberingSystem||null!==this.outputCalendar&&"gregory"!==this.outputCalendar);return e&&t?"en":"intl"}clone(e){return e&&0!==Object.getOwnPropertyNames(e).length?Za.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,Tl(e.weekSettings)||this.weekSettings,e.defaultToEN||!1):this}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,t=!1){return $a(this,e,Kl,()=>{const n=t?{month:e,day:"numeric"}:{month:e},s=t?"format":"standalone";return this.monthsCache[s][e]||(this.monthsCache[s][e]=function(e){const t=[];for(let n=1;n<=12;n++){const s=eu.utc(2009,n,1);t.push(e(s))}return t}(e=>this.extract(e,n,"month"))),this.monthsCache[s][e]})}weekdays(e,t=!1){return $a(this,e,ec,()=>{const n=t?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},s=t?"format":"standalone";return this.weekdaysCache[s][e]||(this.weekdaysCache[s][e]=function(e){const t=[];for(let n=1;n<=7;n++){const s=eu.utc(2016,11,13+n);t.push(e(s))}return t}(e=>this.extract(e,n,"weekday"))),this.weekdaysCache[s][e]})}meridiems(){return $a(this,void 0,()=>tc,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[eu.utc(2016,11,13,9),eu.utc(2016,11,13,19)].map(t=>this.extract(t,e,"dayperiod"))}return this.meridiemCache})}eras(e){return $a(this,e,ic,()=>{const t={era:e};return this.eraCache[e]||(this.eraCache[e]=[eu.utc(-40,1,1),eu.utc(2017,1,1)].map(e=>this.extract(e,t,"era"))),this.eraCache[e]})}extract(e,t,n){const s=this.dtFormatter(e,t).formatToParts().find(e=>e.type.toLowerCase()===n);return s?s.value:null}numberFormatter(e={}){return new za(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,t={}){return new Fa(e,this.intl,t)}relFormatter(e={}){return new Ba(this.intl,this.isEnglish(),e)}listFormatter(e={}){return function(e,t={}){const n=JSON.stringify([e,t]);let s=La[n];return s||(s=new Intl.ListFormat(e,t),La[n]=s),s}(this.intl,e)}isEnglish(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:Ml()?function(e){let t=Ha[e];if(!t){const n=new Intl.Locale(e);t="getWeekInfo"in n?n.getWeekInfo():n.weekInfo,Ha[e]=t}return t}(this.locale):Wa}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let Ua=null;class qa extends Na{static get utcInstance(){return null===Ua&&(Ua=new qa(0)),Ua}static instance(e){return 0===e?qa.utcInstance:new qa(e)}static parseSpecifier(e){if(e){const t=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(t)return new qa(Fl(t[1],t[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return 0===this.fixed?"UTC":`UTC${Zl(this.fixed,"narrow")}`}get ianaName(){return 0===this.fixed?"Etc/UTC":`Etc/GMT${Zl(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,t){return Zl(this.fixed,t)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return"fixed"===e.type&&e.fixed===this.fixed}get isValid(){return!0}}class Ja extends Na{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function Ga(e,t){if(bl(e)||null===e)return t;if(e instanceof Na)return e;if("string"==typeof e){const n=e.toLowerCase();return"default"===n?t:"local"===n||"system"===n?Ea.instance:"utc"===n||"gmt"===n?qa.utcInstance:qa.parseSpecifier(n)||Oa.create(e)}return wl(e)?qa.instance(e):"object"==typeof e&&"offset"in e&&"function"==typeof e.offset?e:new Ja(e)}let Ka,Ya=()=>Date.now(),Qa="system",Xa=null,el=null,tl=null,nl=60,sl=null;class rl{static get now(){return Ya}static set now(e){Ya=e}static set defaultZone(e){Qa=e}static get defaultZone(){return Ga(Qa,Ea.instance)}static get defaultLocale(){return Xa}static set defaultLocale(e){Xa=e}static get defaultNumberingSystem(){return el}static set defaultNumberingSystem(e){el=e}static get defaultOutputCalendar(){return tl}static set defaultOutputCalendar(e){tl=e}static get defaultWeekSettings(){return sl}static set defaultWeekSettings(e){sl=Tl(e)}static get twoDigitCutoffYear(){return nl}static set twoDigitCutoffYear(e){nl=e%100}static get throwOnInvalid(){return Ka}static set throwOnInvalid(e){Ka=e}static resetCaches(){Za.resetCache(),Oa.resetCache()}}class il{constructor(e,t){this.reason=e,this.explanation=t}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const ol=[0,31,59,90,120,151,181,212,243,273,304,334],al=[0,31,60,91,121,152,182,213,244,274,305,335];function ll(e,t){return new il("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${e}, which is invalid`)}function cl(e,t,n){const s=new Date(Date.UTC(e,t-1,n));e<100&&e>=0&&s.setUTCFullYear(s.getUTCFullYear()-1900);const r=s.getUTCDay();return 0===r?7:r}function dl(e,t,n){return n+(Dl(e)?al:ol)[t-1]}function ul(e,t){const n=Dl(e)?al:ol,s=n.findIndex(e=>e<t);return{month:s+1,day:t-n[s]}}function hl(e,t){return(e-t+7)%7+1}function pl(e,t=4,n=1){const{year:s,month:r,day:i}=e,o=dl(s,r,i),a=hl(cl(s,r,i),n);let l,c=Math.floor((o-a+14-t)/7);return c<1?(l=s-1,c=Hl(l,t,n)):c>Hl(s,t,n)?(l=s+1,c=1):l=s,{weekYear:l,weekNumber:c,weekday:a,...Ul(e)}}function ml(e,t=4,n=1){const{weekYear:s,weekNumber:r,weekday:i}=e,o=hl(cl(s,1,t),n),a=Rl(s);let l,c=7*r+i-o-7+t;c<1?(l=s-1,c+=Rl(l)):c>a?(l=s+1,c-=Rl(s)):l=s;const{month:d,day:u}=ul(l,c);return{year:l,month:d,day:u,...Ul(e)}}function fl(e){const{year:t,month:n,day:s}=e;return{year:t,ordinal:dl(t,n,s),...Ul(e)}}function gl(e){const{year:t,ordinal:n}=e,{month:s,day:r}=ul(t,n);return{year:t,month:s,day:r,...Ul(e)}}function yl(e,t){if(!bl(e.localWeekday)||!bl(e.localWeekNumber)||!bl(e.localWeekYear)){if(!bl(e.weekday)||!bl(e.weekNumber)||!bl(e.weekYear))throw new Yo("Cannot mix locale-based week fields with ISO-based week fields");return bl(e.localWeekday)||(e.weekday=e.localWeekday),bl(e.localWeekNumber)||(e.weekNumber=e.localWeekNumber),bl(e.localWeekYear)||(e.weekYear=e.localWeekYear),delete e.localWeekday,delete e.localWeekNumber,delete e.localWeekYear,{minDaysInFirstWeek:t.getMinDaysInFirstWeek(),startOfWeek:t.getStartOfWeek()}}return{minDaysInFirstWeek:4,startOfWeek:1}}function xl(e){const t=vl(e.year),n=El(e.month,1,12),s=El(e.day,1,_l(e.year,e.month));return t?n?!s&&ll("day",e.day):ll("month",e.month):ll("year",e.year)}function Cl(e){const{hour:t,minute:n,second:s,millisecond:r}=e,i=El(t,0,23)||24===t&&0===n&&0===s&&0===r,o=El(n,0,59),a=El(s,0,59),l=El(r,0,999);return i?o?a?!l&&ll("millisecond",r):ll("second",s):ll("minute",n):ll("hour",t)}function bl(e){return void 0===e}function wl(e){return"number"==typeof e}function vl(e){return"number"==typeof e&&e%1==0}function kl(){try{return"undefined"!=typeof Intl&&!!Intl.RelativeTimeFormat}catch(e){return!1}}function Ml(){try{return"undefined"!=typeof Intl&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch(e){return!1}}function Sl(e,t,n){if(0!==e.length)return e.reduce((e,s)=>{const r=[t(s),s];return e&&n(e[0],r[0])===e[0]?e:r},null)[1]}function Nl(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Tl(e){if(null==e)return null;if("object"!=typeof e)throw new Xo("Week settings must be an object");if(!El(e.firstDay,1,7)||!El(e.minimalDays,1,7)||!Array.isArray(e.weekend)||e.weekend.some(e=>!El(e,1,7)))throw new Xo("Invalid week settings");return{firstDay:e.firstDay,minimalDays:e.minimalDays,weekend:Array.from(e.weekend)}}function El(e,t,n){return vl(e)&&e>=t&&e<=n}function jl(e,t=2){let n;return n=e<0?"-"+(""+-e).padStart(t,"0"):(""+e).padStart(t,"0"),n}function Al(e){return bl(e)||null===e||""===e?void 0:parseInt(e,10)}function Il(e){return bl(e)||null===e||""===e?void 0:parseFloat(e)}function Ol(e){if(!bl(e)&&null!==e&&""!==e){const t=1e3*parseFloat("0."+e);return Math.floor(t)}}function Ll(e,t,n=!1){const s=10**t;return(n?Math.trunc:Math.round)(e*s)/s}function Dl(e){return e%4==0&&(e%100!=0||e%400==0)}function Rl(e){return Dl(e)?366:365}function _l(e,t){const n=(s=t-1)-(r=12)*Math.floor(s/r)+1;var s,r;return 2===n?Dl(e+(t-n)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][n-1]}function Pl(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(e.year,e.month-1,e.day)),+t}function Vl(e,t,n){return-hl(cl(e,1,t),n)+t-1}function Hl(e,t=4,n=1){const s=Vl(e,t,n),r=Vl(e+1,t,n);return(Rl(e)-s+r)/7}function $l(e){return e>99?e:e>rl.twoDigitCutoffYear?1900+e:2e3+e}function zl(e,t,n,s=null){const r=new Date(e),i={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};s&&(i.timeZone=s);const o={timeZoneName:t,...i},a=new Intl.DateTimeFormat(n,o).formatToParts(r).find(e=>"timezonename"===e.type.toLowerCase());return a?a.value:null}function Fl(e,t){let n=parseInt(e,10);Number.isNaN(n)&&(n=0);const s=parseInt(t,10)||0;return 60*n+(n<0||Object.is(n,-0)?-s:s)}function Bl(e){const t=Number(e);if("boolean"==typeof e||""===e||Number.isNaN(t))throw new Xo(`Invalid unit value ${e}`);return t}function Wl(e,t){const n={};for(const s in e)if(Nl(e,s)){const r=e[s];if(null==r)continue;n[t(s)]=Bl(r)}return n}function Zl(e,t){const n=Math.trunc(Math.abs(e/60)),s=Math.trunc(Math.abs(e%60)),r=e>=0?"+":"-";switch(t){case"short":return`${r}${jl(n,2)}:${jl(s,2)}`;case"narrow":return`${r}${n}${s>0?`:${s}`:""}`;case"techie":return`${r}${jl(n,2)}${jl(s,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function Ul(e){return function(e,t){return t.reduce((t,n)=>(t[n]=e[n],t),{})}(e,["hour","minute","second","millisecond"])}const ql=["January","February","March","April","May","June","July","August","September","October","November","December"],Jl=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Gl=["J","F","M","A","M","J","J","A","S","O","N","D"];function Kl(e){switch(e){case"narrow":return[...Gl];case"short":return[...Jl];case"long":return[...ql];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const Yl=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Ql=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],Xl=["M","T","W","T","F","S","S"];function ec(e){switch(e){case"narrow":return[...Xl];case"short":return[...Ql];case"long":return[...Yl];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const tc=["AM","PM"],nc=["Before Christ","Anno Domini"],sc=["BC","AD"],rc=["B","A"];function ic(e){switch(e){case"narrow":return[...rc];case"short":return[...sc];case"long":return[...nc];default:return null}}function oc(e,t){let n="";for(const s of e)s.literal?n+=s.val:n+=t(s.val);return n}const ac={D:ra,DD:ia,DDD:aa,DDDD:la,t:ca,tt:da,ttt:ua,tttt:ha,T:pa,TT:ma,TTT:fa,TTTT:ga,f:ya,ff:Ca,fff:va,ffff:Ma,F:xa,FF:ba,FFF:ka,FFFF:Sa};class lc{static create(e,t={}){return new lc(e,t)}static parseFormat(e){let t=null,n="",s=!1;const r=[];for(let i=0;i<e.length;i++){const o=e.charAt(i);"'"===o?(n.length>0&&r.push({literal:s||/^\s+$/.test(n),val:n}),t=null,n="",s=!s):s||o===t?n+=o:(n.length>0&&r.push({literal:/^\s+$/.test(n),val:n}),n=o,t=o)}return n.length>0&&r.push({literal:s||/^\s+$/.test(n),val:n}),r}static macroTokenToFormatOpts(e){return ac[e]}constructor(e,t){this.opts=t,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,t){null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem());return this.systemLoc.dtFormatter(e,{...this.opts,...t}).format()}dtFormatter(e,t={}){return this.loc.dtFormatter(e,{...this.opts,...t})}formatDateTime(e,t){return this.dtFormatter(e,t).format()}formatDateTimeParts(e,t){return this.dtFormatter(e,t).formatToParts()}formatInterval(e,t){return this.dtFormatter(e.start,t).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,t){return this.dtFormatter(e,t).resolvedOptions()}num(e,t=0){if(this.opts.forceSimple)return jl(e,t);const n={...this.opts};return t>0&&(n.padTo=t),this.loc.numberFormatter(n).format(e)}formatDateTimeFromString(e,t){const n="en"===this.loc.listingMode(),s=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar,r=(t,n)=>this.loc.extract(e,t,n),i=t=>e.isOffsetFixed&&0===e.offset&&t.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,t.format):"",o=()=>n?function(e){return tc[e.hour<12?0:1]}(e):r({hour:"numeric",hourCycle:"h12"},"dayperiod"),a=(t,s)=>n?function(e,t){return Kl(t)[e.month-1]}(e,t):r(s?{month:t}:{month:t,day:"numeric"},"month"),l=(t,s)=>n?function(e,t){return ec(t)[e.weekday-1]}(e,t):r(s?{weekday:t}:{weekday:t,month:"long",day:"numeric"},"weekday"),c=t=>{const n=lc.macroTokenToFormatOpts(t);return n?this.formatWithSystemDefault(e,n):t},d=t=>n?function(e,t){return ic(t)[e.year<0?0:1]}(e,t):r({era:t},"era");return oc(lc.parseFormat(t),t=>{switch(t){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12==0?12:e.hour%12);case"hh":return this.num(e.hour%12==0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return i({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return i({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return i({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return o();case"d":return s?r({day:"numeric"},"day"):this.num(e.day);case"dd":return s?r({day:"2-digit"},"day"):this.num(e.day,2);case"c":case"E":return this.num(e.weekday);case"ccc":return l("short",!0);case"cccc":return l("long",!0);case"ccccc":return l("narrow",!0);case"EEE":return l("short",!1);case"EEEE":return l("long",!1);case"EEEEE":return l("narrow",!1);case"L":return s?r({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?r({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return a("short",!0);case"LLLL":return a("long",!0);case"LLLLL":return a("narrow",!0);case"M":return s?r({month:"numeric"},"month"):this.num(e.month);case"MM":return s?r({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return a("short",!1);case"MMMM":return a("long",!1);case"MMMMM":return a("narrow",!1);case"y":return s?r({year:"numeric"},"year"):this.num(e.year);case"yy":return s?r({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?r({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?r({year:"numeric"},"year"):this.num(e.year,6);case"G":return d("short");case"GG":return d("long");case"GGGGG":return d("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return c(t)}})}formatDurationFromString(e,t){const n=e=>{switch(e[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=lc.parseFormat(t),r=s.reduce((e,{literal:t,val:n})=>t?e:e.concat(n),[]);return oc(s,(e=>t=>{const s=n(t);return s?this.num(e.get(s),t.length):t})(e.shiftTo(...r.map(n).filter(e=>e))))}}const cc=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function dc(...e){const t=e.reduce((e,t)=>e+t.source,"");return RegExp(`^${t}$`)}function uc(...e){return t=>e.reduce(([e,n,s],r)=>{const[i,o,a]=r(t,s);return[{...e,...i},o||n,a]},[{},null,1]).slice(0,2)}function hc(e,...t){if(null==e)return[null,null];for(const[n,s]of t){const t=n.exec(e);if(t)return s(t)}return[null,null]}function pc(...e){return(t,n)=>{const s={};let r;for(r=0;r<e.length;r++)s[e[r]]=Al(t[n+r]);return[s,null,n+r]}}const mc=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,fc=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,gc=RegExp(`${fc.source}${`(?:${mc.source}?(?:\\[(${cc.source})\\])?)?`}`),yc=RegExp(`(?:T${gc.source})?`),xc=pc("weekYear","weekNumber","weekDay"),Cc=pc("year","ordinal"),bc=RegExp(`${fc.source} ?(?:${mc.source}|(${cc.source}))?`),wc=RegExp(`(?: ${bc.source})?`);function vc(e,t,n){const s=e[t];return bl(s)?n:Al(s)}function kc(e,t){return[{hours:vc(e,t,0),minutes:vc(e,t+1,0),seconds:vc(e,t+2,0),milliseconds:Ol(e[t+3])},null,t+4]}function Mc(e,t){const n=!e[t]&&!e[t+1],s=Fl(e[t+1],e[t+2]);return[{},n?null:qa.instance(s),t+3]}function Sc(e,t){return[{},e[t]?Oa.create(e[t]):null,t+1]}const Nc=RegExp(`^T?${fc.source}$`),Tc=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function Ec(e){const[t,n,s,r,i,o,a,l,c]=e,d="-"===t[0],u=l&&"-"===l[0],h=(e,t=!1)=>void 0!==e&&(t||e&&d)?-e:e;return[{years:h(Il(n)),months:h(Il(s)),weeks:h(Il(r)),days:h(Il(i)),hours:h(Il(o)),minutes:h(Il(a)),seconds:h(Il(l),"-0"===l),milliseconds:h(Ol(c),u)}]}const jc={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function Ac(e,t,n,s,r,i,o){const a={year:2===t.length?$l(Al(t)):Al(t),month:Jl.indexOf(n)+1,day:Al(s),hour:Al(r),minute:Al(i)};return o&&(a.second=Al(o)),e&&(a.weekday=e.length>3?Yl.indexOf(e)+1:Ql.indexOf(e)+1),a}const Ic=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Oc(e){const[,t,n,s,r,i,o,a,l,c,d,u]=e,h=Ac(t,r,s,n,i,o,a);let p;return p=l?jc[l]:c?0:Fl(d,u),[h,new qa(p)]}const Lc=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Dc=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,Rc=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function _c(e){const[,t,n,s,r,i,o,a]=e;return[Ac(t,r,s,n,i,o,a),qa.utcInstance]}function Pc(e){const[,t,n,s,r,i,o,a]=e;return[Ac(t,a,n,s,r,i,o),qa.utcInstance]}const Vc=dc(/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,yc),Hc=dc(/(\d{4})-?W(\d\d)(?:-?(\d))?/,yc),$c=dc(/(\d{4})-?(\d{3})/,yc),zc=dc(gc),Fc=uc(function(e,t){return[{year:vc(e,t),month:vc(e,t+1,1),day:vc(e,t+2,1)},null,t+3]},kc,Mc,Sc),Bc=uc(xc,kc,Mc,Sc),Wc=uc(Cc,kc,Mc,Sc),Zc=uc(kc,Mc,Sc);const Uc=uc(kc);const qc=dc(/(\d{4})-(\d\d)-(\d\d)/,wc),Jc=dc(bc),Gc=uc(kc,Mc,Sc);const Kc="Invalid Duration",Yc={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048e5},days:{hours:24,minutes:1440,seconds:86400,milliseconds:864e5},hours:{minutes:60,seconds:3600,milliseconds:36e5},minutes:{seconds:60,milliseconds:6e4},seconds:{milliseconds:1e3}},Qc={years:{quarters:4,months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536e3,milliseconds:31536e6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624e5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592e3,milliseconds:2592e6},...Yc},Xc=365.2425,ed=30.436875,td={years:{quarters:4,months:12,weeks:52.1775,days:Xc,hours:8765.82,minutes:525949.2,seconds:525949.2*60,milliseconds:525949.2*60*1e3},quarters:{months:3,weeks:13.044375,days:91.310625,hours:2191.455,minutes:131487.3,seconds:525949.2*60/4,milliseconds:7889237999.999999},months:{weeks:4.3481250000000005,days:ed,hours:730.485,minutes:43829.1,seconds:2629746,milliseconds:2629746e3},...Yc},nd=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],sd=nd.slice(0).reverse();function rd(e,t,n=!1){const s={values:n?t.values:{...e.values,...t.values||{}},loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy,matrix:t.matrix||e.matrix};return new ad(s)}function id(e,t){let n=t.milliseconds??0;for(const s of sd.slice(1))t[s]&&(n+=t[s]*e[s].milliseconds);return n}function od(e,t){const n=id(e,t)<0?-1:1;nd.reduceRight((s,r)=>{if(bl(t[r]))return s;if(s){const i=t[s]*n,o=e[r][s],a=Math.floor(i/o);t[r]+=a*n,t[s]-=a*o*n}return r},null),nd.reduce((n,s)=>{if(bl(t[s]))return n;if(n){const r=t[n]%1;t[n]-=r,t[s]+=r*e[n][s]}return s},null)}class ad{constructor(e){const t="longterm"===e.conversionAccuracy||!1;let n=t?td:Qc;e.matrix&&(n=e.matrix),this.values=e.values,this.loc=e.loc||Za.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=n,this.isLuxonDuration=!0}static fromMillis(e,t){return ad.fromObject({milliseconds:e},t)}static fromObject(e,t={}){if(null==e||"object"!=typeof e)throw new Xo("Duration.fromObject: argument expected to be an object, got "+(null===e?"null":typeof e));return new ad({values:Wl(e,ad.normalizeUnit),loc:Za.fromObject(t),conversionAccuracy:t.conversionAccuracy,matrix:t.matrix})}static fromDurationLike(e){if(wl(e))return ad.fromMillis(e);if(ad.isDuration(e))return e;if("object"==typeof e)return ad.fromObject(e);throw new Xo(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,t){const[n]=hc(e,[Tc,Ec]);return n?ad.fromObject(n,t):ad.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,t){const[n]=hc(e,[Nc,Uc]);return n?ad.fromObject(n,t):ad.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,t=null){if(!e)throw new Xo("need to specify a reason the Duration is invalid");const n=e instanceof il?e:new il(e,t);if(rl.throwOnInvalid)throw new Ko(n);return new ad({invalid:n})}static normalizeUnit(e){const t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e?e.toLowerCase():e];if(!t)throw new Qo(e);return t}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,t={}){const n={...t,floor:!1!==t.round&&!1!==t.floor};return this.isValid?lc.create(this.loc,n).formatDurationFromString(this,e):Kc}toHuman(e={}){if(!this.isValid)return Kc;const t=nd.map(t=>{const n=this.values[t];return bl(n)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:t.slice(0,-1)}).format(n)}).filter(e=>e);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(t)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return 0!==this.years&&(e+=this.years+"Y"),0===this.months&&0===this.quarters||(e+=this.months+3*this.quarters+"M"),0!==this.weeks&&(e+=this.weeks+"W"),0!==this.days&&(e+=this.days+"D"),0===this.hours&&0===this.minutes&&0===this.seconds&&0===this.milliseconds||(e+="T"),0!==this.hours&&(e+=this.hours+"H"),0!==this.minutes&&(e+=this.minutes+"M"),0===this.seconds&&0===this.milliseconds||(e+=Ll(this.seconds+this.milliseconds/1e3,3)+"S"),"P"===e&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const t=this.toMillis();if(t<0||t>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1};return eu.fromMillis(t,{zone:"UTC"}).toISOTime(e)}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?id(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const t=ad.fromDurationLike(e),n={};for(const s of nd)(Nl(t.values,s)||Nl(this.values,s))&&(n[s]=t.get(s)+this.get(s));return rd(this,{values:n},!0)}minus(e){if(!this.isValid)return this;const t=ad.fromDurationLike(e);return this.plus(t.negate())}mapUnits(e){if(!this.isValid)return this;const t={};for(const n of Object.keys(this.values))t[n]=Bl(e(this.values[n],n));return rd(this,{values:t},!0)}get(e){return this[ad.normalizeUnit(e)]}set(e){if(!this.isValid)return this;return rd(this,{values:{...this.values,...Wl(e,ad.normalizeUnit)}})}reconfigure({locale:e,numberingSystem:t,conversionAccuracy:n,matrix:s}={}){return rd(this,{loc:this.loc.clone({locale:e,numberingSystem:t}),matrix:s,conversionAccuracy:n})}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return od(this.matrix,e),rd(this,{values:e},!0)}rescale(){if(!this.isValid)return this;return rd(this,{values:function(e){const t={};for(const[n,s]of Object.entries(e))0!==s&&(t[n]=s);return t}(this.normalize().shiftToAll().toObject())},!0)}shiftTo(...e){if(!this.isValid)return this;if(0===e.length)return this;e=e.map(e=>ad.normalizeUnit(e));const t={},n={},s=this.toObject();let r;for(const i of nd)if(e.indexOf(i)>=0){r=i;let e=0;for(const t in n)e+=this.matrix[t][i]*n[t],n[t]=0;wl(s[i])&&(e+=s[i]);const o=Math.trunc(e);t[i]=o,n[i]=(1e3*e-1e3*o)/1e3}else wl(s[i])&&(n[i]=s[i]);for(const i in n)0!==n[i]&&(t[r]+=i===r?n[i]:n[i]/this.matrix[r][i]);return od(this.matrix,t),rd(this,{values:t},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const t of Object.keys(this.values))e[t]=0===this.values[t]?0:-this.values[t];return rd(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid)return!1;if(!this.loc.equals(e.loc))return!1;function t(e,t){return void 0===e||0===e?void 0===t||0===t:e===t}for(const n of nd)if(!t(this.values[n],e.values[n]))return!1;return!0}}const ld="Invalid Interval";class cd{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,t=null){if(!e)throw new Xo("need to specify a reason the Interval is invalid");const n=e instanceof il?e:new il(e,t);if(rl.throwOnInvalid)throw new Go(n);return new cd({invalid:n})}static fromDateTimes(e,t){const n=tu(e),s=tu(t),r=function(e,t){return e&&e.isValid?t&&t.isValid?t<e?cd.invalid("end before start",`The end of an interval must be after its start, but you had start=${e.toISO()} and end=${t.toISO()}`):null:cd.invalid("missing or invalid end"):cd.invalid("missing or invalid start")}(n,s);return null==r?new cd({start:n,end:s}):r}static after(e,t){const n=ad.fromDurationLike(t),s=tu(e);return cd.fromDateTimes(s,s.plus(n))}static before(e,t){const n=ad.fromDurationLike(t),s=tu(e);return cd.fromDateTimes(s.minus(n),s)}static fromISO(e,t){const[n,s]=(e||"").split("/",2);if(n&&s){let e,i,o,a;try{e=eu.fromISO(n,t),i=e.isValid}catch(r){i=!1}try{o=eu.fromISO(s,t),a=o.isValid}catch(r){a=!1}if(i&&a)return cd.fromDateTimes(e,o);if(i){const n=ad.fromISO(s,t);if(n.isValid)return cd.after(e,n)}else if(a){const e=ad.fromISO(n,t);if(e.isValid)return cd.before(o,e)}}return cd.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return null===this.invalidReason}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",t){if(!this.isValid)return NaN;const n=this.start.startOf(e,t);let s;return s=t?.useLocaleWeeks?this.end.reconfigure({locale:n.locale}):this.end,s=s.startOf(e,t),Math.floor(s.diff(n,e).get(e))+(s.valueOf()!==this.end.valueOf())}hasSame(e){return!!this.isValid&&(this.isEmpty()||this.e.minus(1).hasSame(this.s,e))}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return!!this.isValid&&this.s>e}isBefore(e){return!!this.isValid&&this.e<=e}contains(e){return!!this.isValid&&(this.s<=e&&this.e>e)}set({start:e,end:t}={}){return this.isValid?cd.fromDateTimes(e||this.s,t||this.e):this}splitAt(...e){if(!this.isValid)return[];const t=e.map(tu).filter(e=>this.contains(e)).sort((e,t)=>e.toMillis()-t.toMillis()),n=[];let{s:s}=this,r=0;for(;s<this.e;){const e=t[r]||this.e,i=+e>+this.e?this.e:e;n.push(cd.fromDateTimes(s,i)),s=i,r+=1}return n}splitBy(e){const t=ad.fromDurationLike(e);if(!this.isValid||!t.isValid||0===t.as("milliseconds"))return[];let n,{s:s}=this,r=1;const i=[];for(;s<this.e;){const e=this.start.plus(t.mapUnits(e=>e*r));n=+e>+this.e?this.e:e,i.push(cd.fromDateTimes(s,n)),s=n,r+=1}return i}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return!!this.isValid&&+this.e===+e.s}abutsEnd(e){return!!this.isValid&&+e.e===+this.s}engulfs(e){return!!this.isValid&&(this.s<=e.s&&this.e>=e.e)}equals(e){return!(!this.isValid||!e.isValid)&&(this.s.equals(e.s)&&this.e.equals(e.e))}intersection(e){if(!this.isValid)return this;const t=this.s>e.s?this.s:e.s,n=this.e<e.e?this.e:e.e;return t>=n?null:cd.fromDateTimes(t,n)}union(e){if(!this.isValid)return this;const t=this.s<e.s?this.s:e.s,n=this.e>e.e?this.e:e.e;return cd.fromDateTimes(t,n)}static merge(e){const[t,n]=e.sort((e,t)=>e.s-t.s).reduce(([e,t],n)=>t?t.overlaps(n)||t.abutsStart(n)?[e,t.union(n)]:[e.concat([t]),n]:[e,n],[[],null]);return n&&t.push(n),t}static xor(e){let t=null,n=0;const s=[],r=e.map(e=>[{time:e.s,type:"s"},{time:e.e,type:"e"}]),i=Array.prototype.concat(...r).sort((e,t)=>e.time-t.time);for(const o of i)n+="s"===o.type?1:-1,1===n?t=o.time:(t&&+t!==+o.time&&s.push(cd.fromDateTimes(t,o.time)),t=null);return cd.merge(s)}difference(...e){return cd.xor([this].concat(e)).map(e=>this.intersection(e)).filter(e=>e&&!e.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:ld}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(e=ra,t={}){return this.isValid?lc.create(this.s.loc.clone(t),e).formatInterval(this):ld}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:ld}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:ld}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:ld}toFormat(e,{separator:t=" – "}={}){return this.isValid?`${this.s.toFormat(e)}${t}${this.e.toFormat(e)}`:ld}toDuration(e,t){return this.isValid?this.e.diff(this.s,e,t):ad.invalid(this.invalidReason)}mapEndpoints(e){return cd.fromDateTimes(e(this.s),e(this.e))}}class dd{static hasDST(e=rl.defaultZone){const t=eu.now().setZone(e).set({month:12});return!e.isUniversal&&t.offset!==t.set({month:6}).offset}static isValidIANAZone(e){return Oa.isValidZone(e)}static normalizeZone(e){return Ga(e,rl.defaultZone)}static getStartOfWeek({locale:e=null,locObj:t=null}={}){return(t||Za.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:t=null}={}){return(t||Za.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:t=null}={}){return(t||Za.create(e)).getWeekendDays().slice()}static months(e="long",{locale:t=null,numberingSystem:n=null,locObj:s=null,outputCalendar:r="gregory"}={}){return(s||Za.create(t,n,r)).months(e)}static monthsFormat(e="long",{locale:t=null,numberingSystem:n=null,locObj:s=null,outputCalendar:r="gregory"}={}){return(s||Za.create(t,n,r)).months(e,!0)}static weekdays(e="long",{locale:t=null,numberingSystem:n=null,locObj:s=null}={}){return(s||Za.create(t,n,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:t=null,numberingSystem:n=null,locObj:s=null}={}){return(s||Za.create(t,n,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return Za.create(e).meridiems()}static eras(e="short",{locale:t=null}={}){return Za.create(t,null,"gregory").eras(e)}static features(){return{relative:kl(),localeWeek:Ml()}}}function ud(e,t){const n=e=>e.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),s=n(t)-n(e);return Math.floor(ad.fromMillis(s).as("days"))}function hd(e,t,n,s){let[r,i,o,a]=function(e,t,n){const s=[["years",(e,t)=>t.year-e.year],["quarters",(e,t)=>t.quarter-e.quarter+4*(t.year-e.year)],["months",(e,t)=>t.month-e.month+12*(t.year-e.year)],["weeks",(e,t)=>{const n=ud(e,t);return(n-n%7)/7}],["days",ud]],r={},i=e;let o,a;for(const[l,c]of s)n.indexOf(l)>=0&&(o=l,r[l]=c(e,t),a=i.plus(r),a>t?(r[l]--,(e=i.plus(r))>t&&(a=e,r[l]--,e=i.plus(r))):e=a);return[e,r,a,o]}(e,t,n);const l=t-r,c=n.filter(e=>["hours","minutes","seconds","milliseconds"].indexOf(e)>=0);0===c.length&&(o<t&&(o=r.plus({[a]:1})),o!==r&&(i[a]=(i[a]||0)+l/(o-r)));const d=ad.fromObject(i,s);return c.length>0?ad.fromMillis(l,s).shiftTo(...c).plus(d):d}const pd={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},md={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},fd=pd.hanidec.replace(/[\[|\]]/g,"").split("");function gd({numberingSystem:e},t=""){return new RegExp(`${pd[e||"latn"]}${t}`)}function yd(e,t=e=>e){return{regex:e,deser:([e])=>t(function(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let n=0;n<e.length;n++){const s=e.charCodeAt(n);if(-1!==e[n].search(pd.hanidec))t+=fd.indexOf(e[n]);else for(const e in md){const[n,r]=md[e];s>=n&&s<=r&&(t+=s-n)}}return parseInt(t,10)}return t}(e))}}const xd=`[ ${String.fromCharCode(160)}]`,Cd=new RegExp(xd,"g");function bd(e){return e.replace(/\./g,"\\.?").replace(Cd,xd)}function wd(e){return e.replace(/\./g,"").replace(Cd," ").toLowerCase()}function vd(e,t){return null===e?null:{regex:RegExp(e.map(bd).join("|")),deser:([n])=>e.findIndex(e=>wd(n)===wd(e))+t}}function kd(e,t){return{regex:e,deser:([,e,t])=>Fl(e,t),groups:t}}function Md(e){return{regex:e,deser:([e])=>e}}const Sd={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};let Nd=null;function Td(e,t){return Array.prototype.concat(...e.map(e=>function(e,t){if(e.literal)return e;const n=jd(lc.macroTokenToFormatOpts(e.val),t);return null==n||n.includes(void 0)?e:n}(e,t)))}function Ed(e,t,n){const s=Td(lc.parseFormat(n),e),r=s.map(t=>function(e,t){const n=gd(t),s=gd(t,"{2}"),r=gd(t,"{3}"),i=gd(t,"{4}"),o=gd(t,"{6}"),a=gd(t,"{1,2}"),l=gd(t,"{1,3}"),c=gd(t,"{1,6}"),d=gd(t,"{1,9}"),u=gd(t,"{2,4}"),h=gd(t,"{4,6}"),p=e=>{return{regex:RegExp((t=e.val,t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"))),deser:([e])=>e,literal:!0};var t},m=(m=>{if(e.literal)return p(m);switch(m.val){case"G":return vd(t.eras("short"),0);case"GG":return vd(t.eras("long"),0);case"y":return yd(c);case"yy":case"kk":return yd(u,$l);case"yyyy":case"kkkk":return yd(i);case"yyyyy":return yd(h);case"yyyyyy":return yd(o);case"M":case"L":case"d":case"H":case"h":case"m":case"q":case"s":case"W":return yd(a);case"MM":case"LL":case"dd":case"HH":case"hh":case"mm":case"qq":case"ss":case"WW":return yd(s);case"MMM":return vd(t.months("short",!0),1);case"MMMM":return vd(t.months("long",!0),1);case"LLL":return vd(t.months("short",!1),1);case"LLLL":return vd(t.months("long",!1),1);case"o":case"S":return yd(l);case"ooo":case"SSS":return yd(r);case"u":return Md(d);case"uu":return Md(a);case"uuu":case"E":case"c":return yd(n);case"a":return vd(t.meridiems(),0);case"EEE":return vd(t.weekdays("short",!1),1);case"EEEE":return vd(t.weekdays("long",!1),1);case"ccc":return vd(t.weekdays("short",!0),1);case"cccc":return vd(t.weekdays("long",!0),1);case"Z":case"ZZ":return kd(new RegExp(`([+-]${a.source})(?::(${s.source}))?`),2);case"ZZZ":return kd(new RegExp(`([+-]${a.source})(${s.source})?`),2);case"z":return Md(/[a-z_+-/]{1,256}?/i);case" ":return Md(/[^\S\n\r]/);default:return p(m)}})(e)||{invalidReason:"missing Intl.DateTimeFormat.formatToParts support"};return m.token=e,m}(t,e)),i=r.find(e=>e.invalidReason);if(i)return{input:t,tokens:s,invalidReason:i.invalidReason};{const[e,n]=function(e){return[`^${e.map(e=>e.regex).reduce((e,t)=>`${e}(${t.source})`,"")}$`,e]}(r),i=RegExp(e,"i"),[o,a]=function(e,t,n){const s=e.match(t);if(s){const e={};let t=1;for(const r in n)if(Nl(n,r)){const i=n[r],o=i.groups?i.groups+1:1;!i.literal&&i.token&&(e[i.token.val[0]]=i.deser(s.slice(t,t+o))),t+=o}return[s,e]}return[s,{}]}(t,i,n),[l,c,d]=a?function(e){let t,n=null;return bl(e.z)||(n=Oa.create(e.z)),bl(e.Z)||(n||(n=new qa(e.Z)),t=e.Z),bl(e.q)||(e.M=3*(e.q-1)+1),bl(e.h)||(e.h<12&&1===e.a?e.h+=12:12===e.h&&0===e.a&&(e.h=0)),0===e.G&&e.y&&(e.y=-e.y),bl(e.u)||(e.S=Ol(e.u)),[Object.keys(e).reduce((t,n)=>{const s=(e=>{switch(e){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}})(n);return s&&(t[s]=e[n]),t},{}),n,t]}(a):[null,null,void 0];if(Nl(a,"a")&&Nl(a,"H"))throw new Yo("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:s,regex:i,rawMatches:o,matches:a,result:l,zone:c,specificOffset:d}}}function jd(e,t){if(!e)return null;const n=lc.create(t,e).dtFormatter((Nd||(Nd=eu.fromMillis(1555555555555)),Nd)),s=n.formatToParts(),r=n.resolvedOptions();return s.map(t=>function(e,t,n){const{type:s,value:r}=e;if("literal"===s){const e=/^\s+$/.test(r);return{literal:!e,val:e?" ":r}}const i=t[s];let o=s;"hour"===s&&(o=null!=t.hour12?t.hour12?"hour12":"hour24":null!=t.hourCycle?"h11"===t.hourCycle||"h12"===t.hourCycle?"hour12":"hour24":n.hour12?"hour12":"hour24");let a=Sd[o];if("object"==typeof a&&(a=a[i]),a)return{literal:!1,val:a}}(t,e,r))}const Ad="Invalid DateTime",Id=864e13;function Od(e){return new il("unsupported zone",`the zone "${e.name}" is not supported`)}function Ld(e){return null===e.weekData&&(e.weekData=pl(e.c)),e.weekData}function Dd(e){return null===e.localWeekData&&(e.localWeekData=pl(e.c,e.loc.getMinDaysInFirstWeek(),e.loc.getStartOfWeek())),e.localWeekData}function Rd(e,t){const n={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new eu({...n,...t,old:n})}function _d(e,t,n){let s=e-60*t*1e3;const r=n.offset(s);if(t===r)return[s,t];s-=60*(r-t)*1e3;const i=n.offset(s);return r===i?[s,r]:[e-60*Math.min(r,i)*1e3,Math.max(r,i)]}function Pd(e,t){const n=new Date(e+=60*t*1e3);return{year:n.getUTCFullYear(),month:n.getUTCMonth()+1,day:n.getUTCDate(),hour:n.getUTCHours(),minute:n.getUTCMinutes(),second:n.getUTCSeconds(),millisecond:n.getUTCMilliseconds()}}function Vd(e,t,n){return _d(Pl(e),t,n)}function Hd(e,t){const n=e.o,s=e.c.year+Math.trunc(t.years),r=e.c.month+Math.trunc(t.months)+3*Math.trunc(t.quarters),i={...e.c,year:s,month:r,day:Math.min(e.c.day,_l(s,r))+Math.trunc(t.days)+7*Math.trunc(t.weeks)},o=ad.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),a=Pl(i);let[l,c]=_d(a,n,e.zone);return 0!==o&&(l+=o,c=e.zone.offset(l)),{ts:l,o:c}}function $d(e,t,n,s,r,i){const{setZone:o,zone:a}=n;if(e&&0!==Object.keys(e).length||t){const s=t||a,r=eu.fromObject(e,{...n,zone:s,specificOffset:i});return o?r:r.setZone(a)}return eu.invalid(new il("unparsable",`the input "${r}" can't be parsed as ${s}`))}function zd(e,t,n=!0){return e.isValid?lc.create(Za.create("en-US"),{allowZ:n,forceSimple:!0}).formatDateTimeFromString(e,t):null}function Fd(e,t){const n=e.c.year>9999||e.c.year<0;let s="";return n&&e.c.year>=0&&(s+="+"),s+=jl(e.c.year,n?6:4),t?(s+="-",s+=jl(e.c.month),s+="-",s+=jl(e.c.day)):(s+=jl(e.c.month),s+=jl(e.c.day)),s}function Bd(e,t,n,s,r,i){let o=jl(e.c.hour);return t?(o+=":",o+=jl(e.c.minute),0===e.c.millisecond&&0===e.c.second&&n||(o+=":")):o+=jl(e.c.minute),0===e.c.millisecond&&0===e.c.second&&n||(o+=jl(e.c.second),0===e.c.millisecond&&s||(o+=".",o+=jl(e.c.millisecond,3))),r&&(e.isOffsetFixed&&0===e.offset&&!i?o+="Z":e.o<0?(o+="-",o+=jl(Math.trunc(-e.o/60)),o+=":",o+=jl(Math.trunc(-e.o%60))):(o+="+",o+=jl(Math.trunc(e.o/60)),o+=":",o+=jl(Math.trunc(e.o%60)))),i&&(o+="["+e.zone.ianaName+"]"),o}const Wd={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},Zd={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},Ud={ordinal:1,hour:0,minute:0,second:0,millisecond:0},qd=["year","month","day","hour","minute","second","millisecond"],Jd=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],Gd=["year","ordinal","hour","minute","second","millisecond"];function Kd(e){switch(e.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return function(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new Qo(e);return t}(e)}}function Yd(e,t){const n=Ga(t.zone,rl.defaultZone),s=Za.fromObject(t),r=rl.now();let i,o;if(bl(e.year))i=r;else{for(const n of qd)bl(e[n])&&(e[n]=Wd[n]);const t=xl(e)||Cl(e);if(t)return eu.invalid(t);const s=n.offset(r);[i,o]=Vd(e,s,n)}return new eu({ts:i,zone:n,loc:s,o:o})}function Qd(e,t,n){const s=!!bl(n.round)||n.round,r=(e,r)=>{e=Ll(e,s||n.calendary?0:2,!0);return t.loc.clone(n).relFormatter(n).format(e,r)},i=s=>n.calendary?t.hasSame(e,s)?0:t.startOf(s).diff(e.startOf(s),s).get(s):t.diff(e,s).get(s);if(n.unit)return r(i(n.unit),n.unit);for(const o of n.units){const e=i(o);if(Math.abs(e)>=1)return r(e,o)}return r(e>t?-0:0,n.units[n.units.length-1])}function Xd(e){let t,n={};return e.length>0&&"object"==typeof e[e.length-1]?(n=e[e.length-1],t=Array.from(e).slice(0,e.length-1)):t=Array.from(e),[n,t]}class eu{constructor(e){const t=e.zone||rl.defaultZone;let n=e.invalid||(Number.isNaN(e.ts)?new il("invalid input"):null)||(t.isValid?null:Od(t));this.ts=bl(e.ts)?rl.now():e.ts;let s=null,r=null;if(!n){if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t))[s,r]=[e.old.c,e.old.o];else{const e=t.offset(this.ts);s=Pd(this.ts,e),n=Number.isNaN(s.year)?new il("invalid input"):null,s=n?null:s,r=n?null:e}}this._zone=t,this.loc=e.loc||Za.create(),this.invalid=n,this.weekData=null,this.localWeekData=null,this.c=s,this.o=r,this.isLuxonDateTime=!0}static now(){return new eu({})}static local(){const[e,t]=Xd(arguments),[n,s,r,i,o,a,l]=t;return Yd({year:n,month:s,day:r,hour:i,minute:o,second:a,millisecond:l},e)}static utc(){const[e,t]=Xd(arguments),[n,s,r,i,o,a,l]=t;return e.zone=qa.utcInstance,Yd({year:n,month:s,day:r,hour:i,minute:o,second:a,millisecond:l},e)}static fromJSDate(e,t={}){const n=(s=e,"[object Date]"===Object.prototype.toString.call(s)?e.valueOf():NaN);var s;if(Number.isNaN(n))return eu.invalid("invalid input");const r=Ga(t.zone,rl.defaultZone);return r.isValid?new eu({ts:n,zone:r,loc:Za.fromObject(t)}):eu.invalid(Od(r))}static fromMillis(e,t={}){if(wl(e))return e<-Id||e>Id?eu.invalid("Timestamp out of range"):new eu({ts:e,zone:Ga(t.zone,rl.defaultZone),loc:Za.fromObject(t)});throw new Xo(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,t={}){if(wl(e))return new eu({ts:1e3*e,zone:Ga(t.zone,rl.defaultZone),loc:Za.fromObject(t)});throw new Xo("fromSeconds requires a numerical input")}static fromObject(e,t={}){e=e||{};const n=Ga(t.zone,rl.defaultZone);if(!n.isValid)return eu.invalid(Od(n));const s=Za.fromObject(t),r=Wl(e,Kd),{minDaysInFirstWeek:i,startOfWeek:o}=yl(r,s),a=rl.now(),l=bl(t.specificOffset)?n.offset(a):t.specificOffset,c=!bl(r.ordinal),d=!bl(r.year),u=!bl(r.month)||!bl(r.day),h=d||u,p=r.weekYear||r.weekNumber;if((h||c)&&p)throw new Yo("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(u&&c)throw new Yo("Can't mix ordinal dates with month/day");const m=p||r.weekday&&!h;let f,g,y=Pd(a,l);m?(f=Jd,g=Zd,y=pl(y,i,o)):c?(f=Gd,g=Ud,y=fl(y)):(f=qd,g=Wd);let x=!1;for(const S of f){bl(r[S])?r[S]=x?g[S]:y[S]:x=!0}const C=m?function(e,t=4,n=1){const s=vl(e.weekYear),r=El(e.weekNumber,1,Hl(e.weekYear,t,n)),i=El(e.weekday,1,7);return s?r?!i&&ll("weekday",e.weekday):ll("week",e.weekNumber):ll("weekYear",e.weekYear)}(r,i,o):c?function(e){const t=vl(e.year),n=El(e.ordinal,1,Rl(e.year));return t?!n&&ll("ordinal",e.ordinal):ll("year",e.year)}(r):xl(r),b=C||Cl(r);if(b)return eu.invalid(b);const w=m?ml(r,i,o):c?gl(r):r,[v,k]=Vd(w,l,n),M=new eu({ts:v,zone:n,o:k,loc:s});return r.weekday&&h&&e.weekday!==M.weekday?eu.invalid("mismatched weekday",`you can't specify both a weekday of ${r.weekday} and a date of ${M.toISO()}`):M}static fromISO(e,t={}){const[n,s]=hc(e,[Vc,Fc],[Hc,Bc],[$c,Wc],[zc,Zc]);return $d(n,s,t,"ISO 8601",e)}static fromRFC2822(e,t={}){const[n,s]=hc(function(e){return e.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}(e),[Ic,Oc]);return $d(n,s,t,"RFC 2822",e)}static fromHTTP(e,t={}){const[n,s]=hc(e,[Lc,_c],[Dc,_c],[Rc,Pc]);return $d(n,s,t,"HTTP",t)}static fromFormat(e,t,n={}){if(bl(e)||bl(t))throw new Xo("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:r=null}=n,i=Za.fromOpts({locale:s,numberingSystem:r,defaultToEN:!0}),[o,a,l,c]=function(e,t,n){const{result:s,zone:r,specificOffset:i,invalidReason:o}=Ed(e,t,n);return[s,r,i,o]}(i,e,t);return c?eu.invalid(c):$d(o,a,n,`format ${t}`,e,l)}static fromString(e,t,n={}){return eu.fromFormat(e,t,n)}static fromSQL(e,t={}){const[n,s]=hc(e,[qc,Fc],[Jc,Gc]);return $d(n,s,t,"SQL",e)}static invalid(e,t=null){if(!e)throw new Xo("need to specify a reason the DateTime is invalid");const n=e instanceof il?e:new il(e,t);if(rl.throwOnInvalid)throw new Jo(n);return new eu({invalid:n})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,t={}){const n=jd(e,Za.fromObject(t));return n?n.map(e=>e?e.val:null).join(""):null}static expandFormat(e,t={}){return Td(lc.parseFormat(e),Za.fromObject(t)).map(e=>e.val).join("")}get(e){return this[e]}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?Ld(this).weekYear:NaN}get weekNumber(){return this.isValid?Ld(this).weekNumber:NaN}get weekday(){return this.isValid?Ld(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?Dd(this).weekday:NaN}get localWeekNumber(){return this.isValid?Dd(this).weekNumber:NaN}get localWeekYear(){return this.isValid?Dd(this).weekYear:NaN}get ordinal(){return this.isValid?fl(this.c).ordinal:NaN}get monthShort(){return this.isValid?dd.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?dd.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?dd.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?dd.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return!this.isOffsetFixed&&(this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset)}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,t=6e4,n=Pl(this.c),s=this.zone.offset(n-e),r=this.zone.offset(n+e),i=this.zone.offset(n-s*t),o=this.zone.offset(n-r*t);if(i===o)return[this];const a=n-i*t,l=n-o*t,c=Pd(a,i),d=Pd(l,o);return c.hour===d.hour&&c.minute===d.minute&&c.second===d.second&&c.millisecond===d.millisecond?[Rd(this,{ts:a}),Rd(this,{ts:l})]:[this]}get isInLeapYear(){return Dl(this.year)}get daysInMonth(){return _l(this.year,this.month)}get daysInYear(){return this.isValid?Rl(this.year):NaN}get weeksInWeekYear(){return this.isValid?Hl(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?Hl(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:t,numberingSystem:n,calendar:s}=lc.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t,numberingSystem:n,outputCalendar:s}}toUTC(e=0,t={}){return this.setZone(qa.instance(e),t)}toLocal(){return this.setZone(rl.defaultZone)}setZone(e,{keepLocalTime:t=!1,keepCalendarTime:n=!1}={}){if((e=Ga(e,rl.defaultZone)).equals(this.zone))return this;if(e.isValid){let s=this.ts;if(t||n){const t=e.offset(this.ts),n=this.toObject();[s]=Vd(n,t,e)}return Rd(this,{ts:s,zone:e})}return eu.invalid(Od(e))}reconfigure({locale:e,numberingSystem:t,outputCalendar:n}={}){return Rd(this,{loc:this.loc.clone({locale:e,numberingSystem:t,outputCalendar:n})})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const t=Wl(e,Kd),{minDaysInFirstWeek:n,startOfWeek:s}=yl(t,this.loc),r=!bl(t.weekYear)||!bl(t.weekNumber)||!bl(t.weekday),i=!bl(t.ordinal),o=!bl(t.year),a=!bl(t.month)||!bl(t.day),l=o||a,c=t.weekYear||t.weekNumber;if((l||i)&&c)throw new Yo("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(a&&i)throw new Yo("Can't mix ordinal dates with month/day");let d;r?d=ml({...pl(this.c,n,s),...t},n,s):bl(t.ordinal)?(d={...this.toObject(),...t},bl(t.day)&&(d.day=Math.min(_l(d.year,d.month),d.day))):d=gl({...fl(this.c),...t});const[u,h]=Vd(d,this.o,this.zone);return Rd(this,{ts:u,o:h})}plus(e){if(!this.isValid)return this;return Rd(this,Hd(this,ad.fromDurationLike(e)))}minus(e){if(!this.isValid)return this;return Rd(this,Hd(this,ad.fromDurationLike(e).negate()))}startOf(e,{useLocaleWeeks:t=!1}={}){if(!this.isValid)return this;const n={},s=ad.normalizeUnit(e);switch(s){case"years":n.month=1;case"quarters":case"months":n.day=1;case"weeks":case"days":n.hour=0;case"hours":n.minute=0;case"minutes":n.second=0;case"seconds":n.millisecond=0}if("weeks"===s)if(t){const e=this.loc.getStartOfWeek(),{weekday:t}=this;t<e&&(n.weekNumber=this.weekNumber-1),n.weekday=e}else n.weekday=1;if("quarters"===s){const e=Math.ceil(this.month/3);n.month=3*(e-1)+1}return this.set(n)}endOf(e,t){return this.isValid?this.plus({[e]:1}).startOf(e,t).minus(1):this}toFormat(e,t={}){return this.isValid?lc.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):Ad}toLocaleString(e=ra,t={}){return this.isValid?lc.create(this.loc.clone(t),e).formatDateTime(this):Ad}toLocaleParts(e={}){return this.isValid?lc.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:t=!1,suppressMilliseconds:n=!1,includeOffset:s=!0,extendedZone:r=!1}={}){if(!this.isValid)return null;const i="extended"===e;let o=Fd(this,i);return o+="T",o+=Bd(this,i,t,n,s,r),o}toISODate({format:e="extended"}={}){return this.isValid?Fd(this,"extended"===e):null}toISOWeekDate(){return zd(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:t=!1,includeOffset:n=!0,includePrefix:s=!1,extendedZone:r=!1,format:i="extended"}={}){if(!this.isValid)return null;return(s?"T":"")+Bd(this,"extended"===i,t,e,n,r)}toRFC2822(){return zd(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return zd(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?Fd(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:t=!1,includeOffsetSpace:n=!0}={}){let s="HH:mm:ss.SSS";return(t||e)&&(n&&(s+=" "),t?s+="z":e&&(s+="ZZ")),zd(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():Ad}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const t={...this.c};return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,t="milliseconds",n={}){if(!this.isValid||!e.isValid)return ad.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...n},r=(a=t,Array.isArray(a)?a:[a]).map(ad.normalizeUnit),i=e.valueOf()>this.valueOf(),o=hd(i?this:e,i?e:this,r,s);var a;return i?o.negate():o}diffNow(e="milliseconds",t={}){return this.diff(eu.now(),e,t)}until(e){return this.isValid?cd.fromDateTimes(this,e):this}hasSame(e,t,n){if(!this.isValid)return!1;const s=e.valueOf(),r=this.setZone(e.zone,{keepLocalTime:!0});return r.startOf(t,n)<=s&&s<=r.endOf(t,n)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const t=e.base||eu.fromObject({},{zone:this.zone}),n=e.padding?this<t?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],r=e.unit;return Array.isArray(e.unit)&&(s=e.unit,r=void 0),Qd(t,this.plus(n),{...e,numeric:"always",units:s,unit:r})}toRelativeCalendar(e={}){return this.isValid?Qd(e.base||eu.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(eu.isDateTime))throw new Xo("min requires all arguments be DateTimes");return Sl(e,e=>e.valueOf(),Math.min)}static max(...e){if(!e.every(eu.isDateTime))throw new Xo("max requires all arguments be DateTimes");return Sl(e,e=>e.valueOf(),Math.max)}static fromFormatExplain(e,t,n={}){const{locale:s=null,numberingSystem:r=null}=n;return Ed(Za.fromOpts({locale:s,numberingSystem:r,defaultToEN:!0}),e,t)}static fromStringExplain(e,t,n={}){return eu.fromFormatExplain(e,t,n)}static get DATE_SHORT(){return ra}static get DATE_MED(){return ia}static get DATE_MED_WITH_WEEKDAY(){return oa}static get DATE_FULL(){return aa}static get DATE_HUGE(){return la}static get TIME_SIMPLE(){return ca}static get TIME_WITH_SECONDS(){return da}static get TIME_WITH_SHORT_OFFSET(){return ua}static get TIME_WITH_LONG_OFFSET(){return ha}static get TIME_24_SIMPLE(){return pa}static get TIME_24_WITH_SECONDS(){return ma}static get TIME_24_WITH_SHORT_OFFSET(){return fa}static get TIME_24_WITH_LONG_OFFSET(){return ga}static get DATETIME_SHORT(){return ya}static get DATETIME_SHORT_WITH_SECONDS(){return xa}static get DATETIME_MED(){return Ca}static get DATETIME_MED_WITH_SECONDS(){return ba}static get DATETIME_MED_WITH_WEEKDAY(){return wa}static get DATETIME_FULL(){return va}static get DATETIME_FULL_WITH_SECONDS(){return ka}static get DATETIME_HUGE(){return Ma}static get DATETIME_HUGE_WITH_SECONDS(){return Sa}}function tu(e){if(eu.isDateTime(e))return e;if(e&&e.valueOf&&wl(e.valueOf()))return eu.fromJSDate(e);if(e&&"object"==typeof e)return eu.fromObject(e);throw new Xo(`Unknown datetime argument: ${e}, of type ${typeof e}`)}const nu=()=>{const{userProfile:e}=g(),t=e?.organization?.organization_type;return"claude_team"===t||"claude_enterprise"===t},su=()=>{const{userProfile:e}=g();return e?.account?.has_claude_pro??!1},ru=()=>{const{userProfile:e}=g();return e?.account?.has_claude_max??!1};const iu=" · ",ou="Wallet empty",au="Spending cap reached",lu="Limit reached - contact an admin to keep working",cu="Limit reached",du="Usage limit reached",uu="continuing with extra usage",hu="contact an admin to keep working",pu="Add credits",mu="Manage",fu="Keep working",gu="Approaching 5-hour limit",yu="Approaching weekly limit",xu="You have 1 message left before hitting usage limits",Cu={"5h":"5-hour","7d":"Weekly","7d_opus":"Opus"},bu=({messageLimit:e,currentModel:t,onBlockingStateChange:n,onDismiss:s})=>{const[r,i]=U.useState(!1),o=nu(),a=su(),l=ru(),c=(()=>{const{userProfile:e}=g(),t=e?.account?.has_claude_max,n=e?.organization?.rate_limit_tier;if(t)return"default_claude_max_20x"===n?"max_20x":"max_5x"})(),d="https://claude.ai",u={UPGRADE_GENERIC:`${d}/upgrade?hide_free=true`,UPGRADE_MAX:`${d}/upgrade?hide_pro=true`,ADD_CREDITS:`${d}/settings/billing`,MANAGE_SPENDING:`${d}/settings/usage`,ENABLE_OVERAGES:`${d}/settings/usage`},h="within_limit"===e.type,p=function(e){if(!e||"within_limit"===e.type)return{isOverageScenario:!1,isBlocking:!1,isActive:!1};const t=!!e.overageDisabledReason&&"overage_not_provisioned"!==e.overageDisabledReason&&"org_level_disabled"!==e.overageDisabledReason,n=!!e.windows?.overage||t,s="exceeded_limit"===e.windows?.overage?.status||t;return{isOverageScenario:n,isBlocking:s,isActive:!s&&n}}(e),{windowName:m,status:f}=function(e,t){if(!e)return{windowName:null,status:null};const n=t?.startsWith("claude-opus")??!0,s="exceeded_limit"===e["5h"]?.status,r="exceeded_limit"===e["7d"]?.status,i=n&&"exceeded_limit"===e["7d_opus"]?.status,o="exceeded_limit"===e.overage?.status;if((r||s||i)&&o)return{windowName:"overage",status:e.overage};const a=[];if(s&&a.push({name:"5h",resetTime:e["5h"].resets_at}),r&&a.push({name:"7d",resetTime:e["7d"].resets_at}),i&&a.push({name:"7d_opus",resetTime:e["7d_opus"].resets_at}),a.length>1){const t=a.reduce((e,t)=>t.resetTime>e.resetTime?t:e);return{windowName:t.name,status:e[t.name]}}return i?{windowName:"7d_opus",status:e["7d_opus"]}:r?{windowName:"7d",status:e["7d"]}:s||"approaching_limit"===e["5h"]?.status?{windowName:"5h",status:e["5h"]}:"approaching_limit"===e["7d"]?.status?{windowName:"7d",status:e["7d"]}:"approaching_limit"===e.overage?.status?{windowName:"overage",status:e.overage}:{windowName:null,status:null}}(e.windows,t),y=f?.resets_at||("within_limit"!==e.type?e.resetsAt:void 0),x=y?eu.fromSeconds(y):null,C="exceeded_limit"===e.type||"approaching_limit"===e.type&&0===e.remaining,b=!h&&(C&&!p.isActive||p.isBlocking),w=!o&&"max_20x"!==c,v=()=>(a||l)&&(a&&!l||"max_5x"===c)?u.UPGRADE_MAX:u.UPGRADE_GENERIC,k=()=>(a||l)&&a&&!l?"Subscribe to Max":"Upgrade",M=({url:e,text:t,opacity:n=90})=>q.jsx("button",{onClick:t=>((e,t)=>{e.stopPropagation(),chrome.tabs.create({url:t})})(t,e),className:`underline cursor-pointer text-text-100 opacity-${n} hover:opacity-100`,children:t}),S=(e,t)=>{const n=e.toLocaleString(eu.TIME_SIMPLE);if("7d"===t||"7d_opus"===t){return`${e.toFormat("cccc")} ${n}`}return n};if(U.useEffect(()=>{n?.(!h&&b)},[h,b,n]),h)return null;if(!b&&r)return null;if(r&&!b)return null;const N=p.isBlocking?"danger":"info";return q.jsx(Zo,{type:N,onDismiss:b?void 0:()=>{i(!0),s?.()},children:(()=>{if(p.isOverageScenario){if(p.isBlocking)return o?lu:"out_of_credits"===e.overageDisabledReason?q.jsxs(q.Fragment,{children:[ou,iu,q.jsx(M,{url:u.ADD_CREDITS,text:pu})]}):q.jsxs(q.Fragment,{children:[au,iu,q.jsx(M,{url:u.MANAGE_SPENDING,text:mu})]});if(p.isActive&&x){const e=S(x,m),t=m?Cu[m]:null;return t?`${t} limit resets ${e}${iu}${uu}`:`${cu}${iu}${uu}`}}if(C){if(!x)return du;const r=S(x,m),i=m?Cu[m]:null,a="max_20x"===c&&("overage_not_provisioned"===e.overageDisabledReason||"org_level_disabled"===e.overageDisabledReason);if(i){if(o)return`${i} limit resets ${r} - ${hu}`;const e=a?q.jsx(M,{url:u.ENABLE_OVERAGES,text:fu}):w?q.jsx(M,{url:v(),text:k()}):null;return t=`${i} limit reached · resets`,n=r,(s=e)?q.jsxs(q.Fragment,{children:[t," ",n,iu,s]}):`${t} ${n}`}return`${du} · resets ${r}`}{const t=w?q.jsx(M,{url:v(),text:k(),opacity:75}):null;if("5h"===m)return t?q.jsxs(q.Fragment,{children:[gu,iu,t]}):gu;if("7d"===m)return t?q.jsxs(q.Fragment,{children:[yu,iu,t]}):yu;const n=e.remaining;return 1===n?xu:`You have ${n} messages left before hitting usage limits`}var t,n,s})()})},wu=({isEligible:e,onBlockingStateChange:t})=>{const{value:s}=n.useFeatureGate("crochet_velvet_thunder_butterfly"),i="https://claude.ai",o=s?`${i}/upgrade?hide_free=true`:`${i}/upgrade?max=c`;return U.useEffect(()=>{t?.(!e)},[e,t]),e?null:q.jsx(Zo,{type:"info",children:q.jsxs("div",{className:"flex justify-between items-center w-full",children:[q.jsx("span",{children:s?q.jsx(r,{defaultMessage:"Claude in Chrome requires a paid plan",id:"hg/DxQvpUn"}):q.jsx(r,{defaultMessage:"Claude in Chrome requires a Max plan",id:"bnxXVwsd9r"})}),q.jsx("button",{onClick:e=>{e.stopPropagation(),chrome.tabs.create({url:o})},className:"underline cursor-pointer text-text-100 opacity-90 hover:opacity-100",children:q.jsx(r,{defaultMessage:"Upgrade plan",id:"c5+JRMBv/Y"})})]})})};const vu=U.memo(({placeholders:e,isVisible:t})=>{const n=function(){const e=s();return[e.formatMessage({defaultMessage:"How can I help you today?",id:"XLcM6WHfQR"}),e.formatMessage({defaultMessage:"Type / for commands",id:"fHClqd2+bS"})]}(),r=e??n,[i,o]=U.useState(0),[a,l]=U.useState(!1);return U.useEffect(()=>{if(!t||r.length<=1)return;const e=setInterval(()=>{l(!0),o(e=>(e+1)%r.length)},3e3);return()=>clearInterval(e)},[t,r.length]),U.useEffect(()=>{t&&(o(0),l(!1))},[t]),t?q.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden pl-0 pt-0",children:q.jsx(Xt,{mode:"wait",initial:!1,children:q.jsx(Qt.span,{initial:!!a&&{y:6,opacity:0},animate:{y:0,opacity:1},exit:{y:-6,opacity:0},transition:{duration:.2,ease:"easeInOut"},className:"block text-text-500 text-sm",children:r[i]},i)})}):null});vu.displayName="RotatingPlaceholder";const ku="https://support.claude.com/en/articles/12012173-getting-started-with-claude-for-chrome#h_91c6e5a1ee";var Mu,Su,Nu={exports:{}},Tu={};function Eu(){return Su||(Su=1,Nu.exports=function(){if(Mu)return Tu;Mu=1;var e=X(),t="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},n=e.useState,s=e.useEffect,r=e.useLayoutEffect,i=e.useDebugValue;function o(e){var n=e.getSnapshot;e=e.value;try{var s=n();return!t(e,s)}catch(r){return!0}}var a="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var a=t(),l=n({inst:{value:a,getSnapshot:t}}),c=l[0].inst,d=l[1];return r(function(){c.value=a,c.getSnapshot=t,o(c)&&d({inst:c})},[e,a,t]),s(function(){return o(c)&&d({inst:c}),e(function(){o(c)&&d({inst:c})})},[e]),i(a),a};return Tu.useSyncExternalStore=void 0!==e.useSyncExternalStore?e.useSyncExternalStore:a,Tu}()),Nu.exports}var ju=Eu();function Au(e){this.content=e}function Iu(e,t,n){for(let s=0;;s++){if(s==e.childCount||s==t.childCount)return e.childCount==t.childCount?null:n;let r=e.child(s),i=t.child(s);if(r!=i){if(!r.sameMarkup(i))return n;if(r.isText&&r.text!=i.text){for(let e=0;r.text[e]==i.text[e];e++)n++;return n}if(r.content.size||i.content.size){let e=Iu(r.content,i.content,n+1);if(null!=e)return e}n+=r.nodeSize}else n+=r.nodeSize}}function Ou(e,t,n,s){for(let r=e.childCount,i=t.childCount;;){if(0==r||0==i)return r==i?null:{a:n,b:s};let o=e.child(--r),a=t.child(--i),l=o.nodeSize;if(o!=a){if(!o.sameMarkup(a))return{a:n,b:s};if(o.isText&&o.text!=a.text){let e=0,t=Math.min(o.text.length,a.text.length);for(;e<t&&o.text[o.text.length-e-1]==a.text[a.text.length-e-1];)e++,n--,s--;return{a:n,b:s}}if(o.content.size||a.content.size){let e=Ou(o.content,a.content,n-1,s-1);if(e)return e}n-=l,s-=l}else n-=l,s-=l}}Au.prototype={constructor:Au,find:function(e){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===e)return t;return-1},get:function(e){var t=this.find(e);return-1==t?void 0:this.content[t+1]},update:function(e,t,n){var s=n&&n!=e?this.remove(n):this,r=s.find(e),i=s.content.slice();return-1==r?i.push(n||e,t):(i[r+1]=t,n&&(i[r]=n)),new Au(i)},remove:function(e){var t=this.find(e);if(-1==t)return this;var n=this.content.slice();return n.splice(t,2),new Au(n)},addToStart:function(e,t){return new Au([e,t].concat(this.remove(e).content))},addToEnd:function(e,t){var n=this.remove(e).content.slice();return n.push(e,t),new Au(n)},addBefore:function(e,t,n){var s=this.remove(t),r=s.content.slice(),i=s.find(e);return r.splice(-1==i?r.length:i,0,t,n),new Au(r)},forEach:function(e){for(var t=0;t<this.content.length;t+=2)e(this.content[t],this.content[t+1])},prepend:function(e){return(e=Au.from(e)).size?new Au(e.content.concat(this.subtract(e).content)):this},append:function(e){return(e=Au.from(e)).size?new Au(this.subtract(e).content.concat(e.content)):this},subtract:function(e){var t=this;e=Au.from(e);for(var n=0;n<e.content.length;n+=2)t=t.remove(e.content[n]);return t},toObject:function(){var e={};return this.forEach(function(t,n){e[t]=n}),e},get size(){return this.content.length>>1}},Au.from=function(e){if(e instanceof Au)return e;var t=[];if(e)for(var n in e)t.push(n,e[n]);return new Au(t)};class Lu{constructor(e,t){if(this.content=e,this.size=t||0,null==t)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,t,n,s=0,r){for(let i=0,o=0;o<t;i++){let a=this.content[i],l=o+a.nodeSize;if(l>e&&!1!==n(a,s+o,r||null,i)&&a.content.size){let r=o+1;a.nodesBetween(Math.max(0,e-r),Math.min(a.content.size,t-r),n,s+r)}o=l}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,s){let r="",i=!0;return this.nodesBetween(e,t,(o,a)=>{let l=o.isText?o.text.slice(Math.max(e,a)-a,t-a):o.isLeaf?s?"function"==typeof s?s(o):s:o.type.spec.leafText?o.type.spec.leafText(o):"":"";o.isBlock&&(o.isLeaf&&l||o.isTextblock)&&n&&(i?i=!1:r+=n),r+=l},0),r}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,s=this.content.slice(),r=0;for(t.isText&&t.sameMarkup(n)&&(s[s.length-1]=t.withText(t.text+n.text),r=1);r<e.content.length;r++)s.push(e.content[r]);return new Lu(s,this.size+e.size)}cut(e,t=this.size){if(0==e&&t==this.size)return this;let n=[],s=0;if(t>e)for(let r=0,i=0;i<t;r++){let o=this.content[r],a=i+o.nodeSize;a>e&&((i<e||a>t)&&(o=o.isText?o.cut(Math.max(0,e-i),Math.min(o.text.length,t-i)):o.cut(Math.max(0,e-i-1),Math.min(o.content.size,t-i-1))),n.push(o),s+=o.nodeSize),i=a}return new Lu(n,s)}cutByIndex(e,t){return e==t?Lu.empty:0==e&&t==this.content.length?this:new Lu(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let s=this.content.slice(),r=this.size+t.nodeSize-n.nodeSize;return s[e]=t,new Lu(s,r)}addToStart(e){return new Lu([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new Lu(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let s=this.content[t];e(s,n,t),n+=s.nodeSize}}findDiffStart(e,t=0){return Iu(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return Ou(this,e,t,n)}findIndex(e){if(0==e)return Ru(0,e);if(e==this.size)return Ru(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let t=0,n=0;;t++){let s=n+this.child(t).nodeSize;if(s>=e)return s==e?Ru(t+1,s):Ru(t,n);n=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return Lu.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new Lu(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return Lu.empty;let t,n=0;for(let s=0;s<e.length;s++){let r=e[s];n+=r.nodeSize,s&&r.isText&&e[s-1].sameMarkup(r)?(t||(t=e.slice(0,s)),t[t.length-1]=r.withText(t[t.length-1].text+r.text)):t&&t.push(r)}return new Lu(t||e,n)}static from(e){if(!e)return Lu.empty;if(e instanceof Lu)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new Lu([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Lu.empty=new Lu([],0);const Du={index:0,offset:0};function Ru(e,t){return Du.index=e,Du.offset=t,Du}function _u(e,t){if(e===t)return!0;if(!e||"object"!=typeof e||!t||"object"!=typeof t)return!1;let n=Array.isArray(e);if(Array.isArray(t)!=n)return!1;if(n){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!_u(e[n],t[n]))return!1}else{for(let n in e)if(!(n in t)||!_u(e[n],t[n]))return!1;for(let n in t)if(!(n in e))return!1}return!0}let Pu=class e{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let s=0;s<e.length;s++){let r=e[s];if(this.eq(r))return e;if(this.type.excludes(r.type))t||(t=e.slice(0,s));else{if(r.type.excludes(this.type))return e;!n&&r.type.rank>this.type.rank&&(t||(t=e.slice(0,s)),t.push(this),n=!0),t&&t.push(r)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&_u(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);let s=n.create(t.attrs);return n.checkAttrs(s.attrs),s}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&0==t.length)return e.none;if(t instanceof e)return[t];let n=t.slice();return n.sort((e,t)=>e.type.rank-t.type.rank),n}};Pu.none=[];class Vu extends Error{}class Hu{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=zu(this.content,e+this.openStart,t);return n&&new Hu(n,this.openStart,this.openEnd)}removeBetween(e,t){return new Hu($u(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return Hu.empty;let n=t.openStart||0,s=t.openEnd||0;if("number"!=typeof n||"number"!=typeof s)throw new RangeError("Invalid input for Slice.fromJSON");return new Hu(Lu.fromJSON(e,t.content),n,s)}static maxOpen(e,t=!0){let n=0,s=0;for(let r=e.firstChild;r&&!r.isLeaf&&(t||!r.type.spec.isolating);r=r.firstChild)n++;for(let r=e.lastChild;r&&!r.isLeaf&&(t||!r.type.spec.isolating);r=r.lastChild)s++;return new Hu(e,n,s)}}function $u(e,t,n){let{index:s,offset:r}=e.findIndex(t),i=e.maybeChild(s),{index:o,offset:a}=e.findIndex(n);if(r==t||i.isText){if(a!=n&&!e.child(o).isText)throw new RangeError("Removing non-flat range");return e.cut(0,t).append(e.cut(n))}if(s!=o)throw new RangeError("Removing non-flat range");return e.replaceChild(s,i.copy($u(i.content,t-r-1,n-r-1)))}function zu(e,t,n,s){let{index:r,offset:i}=e.findIndex(t),o=e.maybeChild(r);if(i==t||o.isText)return s&&!s.canReplace(r,r,n)?null:e.cut(0,t).append(n).append(e.cut(t));let a=zu(o.content,t-i-1,n,o);return a&&e.replaceChild(r,o.copy(a))}function Fu(e,t,n){if(n.openStart>e.depth)throw new Vu("Inserted content deeper than insertion position");if(e.depth-n.openStart!=t.depth-n.openEnd)throw new Vu("Inconsistent open depths");return Bu(e,t,n,0)}function Bu(e,t,n,s){let r=e.index(s),i=e.node(s);if(r==t.index(s)&&s<e.depth-n.openStart){let o=Bu(e,t,n,s+1);return i.copy(i.content.replaceChild(r,o))}if(n.content.size){if(n.openStart||n.openEnd||e.depth!=s||t.depth!=s){let{start:r,end:o}=function(e,t){let n=t.depth-e.openStart,s=t.node(n).copy(e.content);for(let r=n-1;r>=0;r--)s=t.node(r).copy(Lu.from(s));return{start:s.resolveNoCache(e.openStart+n),end:s.resolveNoCache(s.content.size-e.openEnd-n)}}(n,e);return Ju(i,Gu(e,r,o,t,s))}{let s=e.parent,r=s.content;return Ju(s,r.cut(0,e.parentOffset).append(n.content).append(r.cut(t.parentOffset)))}}return Ju(i,Ku(e,t,s))}function Wu(e,t){if(!t.type.compatibleContent(e.type))throw new Vu("Cannot join "+t.type.name+" onto "+e.type.name)}function Zu(e,t,n){let s=e.node(n);return Wu(s,t.node(n)),s}function Uu(e,t){let n=t.length-1;n>=0&&e.isText&&e.sameMarkup(t[n])?t[n]=e.withText(t[n].text+e.text):t.push(e)}function qu(e,t,n,s){let r=(t||e).node(n),i=0,o=t?t.index(n):r.childCount;e&&(i=e.index(n),e.depth>n?i++:e.textOffset&&(Uu(e.nodeAfter,s),i++));for(let a=i;a<o;a++)Uu(r.child(a),s);t&&t.depth==n&&t.textOffset&&Uu(t.nodeBefore,s)}function Ju(e,t){return e.type.checkContent(t),e.copy(t)}function Gu(e,t,n,s,r){let i=e.depth>r&&Zu(e,t,r+1),o=s.depth>r&&Zu(n,s,r+1),a=[];return qu(null,e,r,a),i&&o&&t.index(r)==n.index(r)?(Wu(i,o),Uu(Ju(i,Gu(e,t,n,s,r+1)),a)):(i&&Uu(Ju(i,Ku(e,t,r+1)),a),qu(t,n,r,a),o&&Uu(Ju(o,Ku(n,s,r+1)),a)),qu(s,null,r,a),new Lu(a)}function Ku(e,t,n){let s=[];if(qu(null,e,n,s),e.depth>n){Uu(Ju(Zu(e,t,n+1),Ku(e,t,n+1)),s)}return qu(t,null,n,s),new Lu(s)}Hu.empty=new Hu(Lu.empty,0,0);class Yu{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return null==e?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[3*this.resolveDepth(e)]}index(e){return this.path[3*this.resolveDepth(e)+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e!=this.depth||this.textOffset?1:0)}start(e){return 0==(e=this.resolveDepth(e))?0:this.path[3*e-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(!(e=this.resolveDepth(e)))throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[3*e-1]}after(e){if(!(e=this.resolveDepth(e)))throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[3*e-1]+this.path[3*e].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],s=e.child(t);return n?e.child(t).cut(n):s}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):0==e?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[3*t],s=0==t?0:this.path[3*t-1]+1;for(let r=0;r<e;r++)s+=n.child(r).nodeSize;return s}marks(){let e=this.parent,t=this.index();if(0==e.content.size)return Pu.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),s=e.maybeChild(t);if(!n){let e=n;n=s,s=e}let r=n.marks;for(var i=0;i<r.length;i++)!1!==r[i].type.spec.inclusive||s&&r[i].isInSet(s.marks)||(r=r[i--].removeFromSet(r));return r}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,s=e.parent.maybeChild(e.index());for(var r=0;r<n.length;r++)!1!==n[r].type.spec.inclusive||s&&n[r].isInSet(s.marks)||(n=n[r--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new th(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],s=0,r=t;for(let i=e;;){let{index:e,offset:t}=i.content.findIndex(r),o=r-t;if(n.push(i,e,s+t),!o)break;if(i=i.child(e),i.isText)break;r=o-1,s+=t+1}return new Yu(t,n,r)}static resolveCached(e,t){let n=eh.get(e);if(n)for(let r=0;r<n.elts.length;r++){let e=n.elts[r];if(e.pos==t)return e}else eh.set(e,n=new Qu);let s=n.elts[n.i]=Yu.resolve(e,t);return n.i=(n.i+1)%Xu,s}}class Qu{constructor(){this.elts=[],this.i=0}}const Xu=12,eh=new WeakMap;class th{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const nh=Object.create(null);class sh{constructor(e,t,n,s=Pu.none){this.type=e,this.attrs=t,this.marks=s,this.content=n||Lu.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,s=0){this.content.nodesBetween(e,t,n,s,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,s){return this.content.textBetween(e,t,n,s)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&_u(this.attrs,t||e.defaultAttrs||nh)&&Pu.sameSet(this.marks,n||Pu.none)}copy(e=null){return e==this.content?this:new sh(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new sh(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return 0==e&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return Hu.empty;let s=this.resolve(e),r=this.resolve(t),i=n?0:s.sharedDepth(t),o=s.start(i),a=s.node(i).content.cut(s.pos-o,r.pos-o);return new Hu(a,s.depth-i,r.depth-i)}replace(e,t,n){return Fu(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:s}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(s==e||t.isText)return t;e-=s+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(0==e)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let s=this.content.child(t-1);return{node:s,index:t-1,offset:n-s.nodeSize}}resolve(e){return Yu.resolveCached(this,e)}resolveNoCache(e){return Yu.resolve(this,e)}rangeHasMark(e,t,n){let s=!1;return t>e&&this.nodesBetween(e,t,e=>(n.isInSet(e.marks)&&(s=!0),!s)),s}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),ih(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=Lu.empty,s=0,r=n.childCount){let i=this.contentMatchAt(e).matchFragment(n,s,r),o=i&&i.matchFragment(this.content,t);if(!o||!o.validEnd)return!1;for(let a=s;a<r;a++)if(!this.type.allowsMarks(n.child(a).marks))return!1;return!0}canReplaceWith(e,t,n,s){if(s&&!this.type.allowsMarks(s))return!1;let r=this.contentMatchAt(e).matchType(n),i=r&&r.matchFragment(this.content,t);return!!i&&i.validEnd}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Pu.none;for(let t=0;t<this.marks.length;t++){let n=this.marks[t];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!Pu.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(e=>e.type.name)}`);this.content.forEach(e=>e.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(e=>e.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if("text"==t.type){if("string"!=typeof t.text)throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let s=Lu.fromJSON(e,t.content),r=e.nodeType(t.type).create(t.attrs,s,n);return r.type.checkAttrs(r.attrs),r}}sh.prototype.text=void 0;class rh extends sh{constructor(e,t,n,s){if(super(e,t,null,s),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):ih(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new rh(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new rh(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return 0==e&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function ih(e,t){for(let n=e.length-1;n>=0;n--)t=e[n].type.name+"("+t+")";return t}class oh{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new ah(e,t);if(null==n.next)return oh.empty;let s=lh(n);n.next&&n.err("Unexpected trailing text");let r=function(e){let t=Object.create(null);return n(mh(e,0));function n(s){let r=[];s.forEach(t=>{e[t].forEach(({term:t,to:n})=>{if(!t)return;let s;for(let e=0;e<r.length;e++)r[e][0]==t&&(s=r[e][1]);mh(e,n).forEach(e=>{s||r.push([t,s=[]]),-1==s.indexOf(e)&&s.push(e)})})});let i=t[s.join(",")]=new oh(s.indexOf(e.length-1)>-1);for(let e=0;e<r.length;e++){let s=r[e][1].sort(ph);i.next.push({type:r[e][0],next:t[s.join(",")]||n(s)})}return i}}(function(e){let t=[[]];return r(i(e,0),n()),t;function n(){return t.push([])-1}function s(e,n,s){let r={term:s,to:n};return t[e].push(r),r}function r(e,t){e.forEach(e=>e.to=t)}function i(e,t){if("choice"==e.type)return e.exprs.reduce((e,n)=>e.concat(i(n,t)),[]);if("seq"!=e.type){if("star"==e.type){let o=n();return s(t,o),r(i(e.expr,o),o),[s(o)]}if("plus"==e.type){let o=n();return r(i(e.expr,t),o),r(i(e.expr,o),o),[s(o)]}if("opt"==e.type)return[s(t)].concat(i(e.expr,t));if("range"==e.type){let o=t;for(let t=0;t<e.min;t++){let t=n();r(i(e.expr,o),t),o=t}if(-1==e.max)r(i(e.expr,o),o);else for(let t=e.min;t<e.max;t++){let t=n();s(o,t),r(i(e.expr,o),t),o=t}return[s(o)]}if("name"==e.type)return[s(t,void 0,e.value)];throw new Error("Unknown expr type")}for(let s=0;;s++){let o=i(e.exprs[s],t);if(s==e.exprs.length-1)return o;r(o,t=n())}}}(s));return function(e,t){for(let n=0,s=[e];n<s.length;n++){let e=s[n],r=!e.validEnd,i=[];for(let t=0;t<e.next.length;t++){let{type:n,next:o}=e.next[t];i.push(n.name),!r||n.isText||n.hasRequiredAttrs()||(r=!1),-1==s.indexOf(o)&&s.push(o)}r&&t.err("Only non-generatable nodes ("+i.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(r,n),r}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let s=this;for(let r=t;s&&r<n;r++)s=s.matchType(e.child(r).type);return s}get inlineContent(){return 0!=this.next.length&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!t.isText&&!t.hasRequiredAttrs())return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let s=[this];return function r(i,o){let a=i.matchFragment(e,n);if(a&&(!t||a.validEnd))return Lu.from(o.map(e=>e.createAndFill()));for(let e=0;e<i.next.length;e++){let{type:t,next:n}=i.next[e];if(!t.isText&&!t.hasRequiredAttrs()&&-1==s.indexOf(n)){s.push(n);let e=r(n,o.concat(t));if(e)return e}}return null}(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let s=n.shift(),r=s.match;if(r.matchType(e)){let e=[];for(let t=s;t.type;t=t.via)e.push(t.type);return e.reverse()}for(let e=0;e<r.next.length;e++){let{type:i,next:o}=r.next[e];i.isLeaf||i.hasRequiredAttrs()||i.name in t||s.type&&!o.validEnd||(n.push({match:i.contentMatch,type:i,via:s}),t[i.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];return function t(n){e.push(n);for(let s=0;s<n.next.length;s++)-1==e.indexOf(n.next[s].next)&&t(n.next[s].next)}(this),e.map((t,n)=>{let s=n+(t.validEnd?"*":" ")+" ";for(let r=0;r<t.next.length;r++)s+=(r?", ":"")+t.next[r].type.name+"->"+e.indexOf(t.next[r].next);return s}).join("\n")}}oh.empty=new oh(!0);class ah{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function lh(e){let t=[];do{t.push(ch(e))}while(e.eat("|"));return 1==t.length?t[0]:{type:"choice",exprs:t}}function ch(e){let t=[];do{t.push(dh(e))}while(e.next&&")"!=e.next&&"|"!=e.next);return 1==t.length?t[0]:{type:"seq",exprs:t}}function dh(e){let t=function(e){if(e.eat("(")){let t=lh(e);return e.eat(")")||e.err("Missing closing paren"),t}if(!/\W/.test(e.next)){let t=function(e,t){let n=e.nodeTypes,s=n[t];if(s)return[s];let r=[];for(let i in n){let e=n[i];e.isInGroup(t)&&r.push(e)}0==r.length&&e.err("No node type or group '"+t+"' found");return r}(e,e.next).map(t=>(null==e.inline?e.inline=t.isInline:e.inline!=t.isInline&&e.err("Mixing inline and block content"),{type:"name",value:t}));return e.pos++,1==t.length?t[0]:{type:"choice",exprs:t}}e.err("Unexpected token '"+e.next+"'")}(e);for(;;)if(e.eat("+"))t={type:"plus",expr:t};else if(e.eat("*"))t={type:"star",expr:t};else if(e.eat("?"))t={type:"opt",expr:t};else{if(!e.eat("{"))break;t=hh(e,t)}return t}function uh(e){/\D/.test(e.next)&&e.err("Expected number, got '"+e.next+"'");let t=Number(e.next);return e.pos++,t}function hh(e,t){let n=uh(e),s=n;return e.eat(",")&&(s="}"!=e.next?uh(e):-1),e.eat("}")||e.err("Unclosed braced range"),{type:"range",min:n,max:s,expr:t}}function ph(e,t){return t-e}function mh(e,t){let n=[];return function t(s){let r=e[s];if(1==r.length&&!r[0].term)return t(r[0].to);n.push(s);for(let e=0;e<r.length;e++){let{term:s,to:i}=r[e];s||-1!=n.indexOf(i)||t(i)}}(t),n.sort(ph)}function fh(e){let t=Object.create(null);for(let n in e){let s=e[n];if(!s.hasDefault)return null;t[n]=s.default}return t}function gh(e,t){let n=Object.create(null);for(let s in e){let r=t&&t[s];if(void 0===r){let t=e[s];if(!t.hasDefault)throw new RangeError("No value supplied for attribute "+s);r=t.default}n[s]=r}return n}function yh(e,t,n,s){for(let r in t)if(!(r in e))throw new RangeError(`Unsupported attribute ${r} for ${n} of type ${r}`);for(let r in e){let n=e[r];n.validate&&n.validate(t[r])}}function xh(e,t){let n=Object.create(null);if(t)for(let s in t)n[s]=new bh(e,s,t[s]);return n}let Ch=class e{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=xh(e,n.attrs),this.defaultAttrs=fh(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==e),this.isText="text"==e}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==oh.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:gh(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new sh(this,this.computeAttrs(e),Lu.from(t),Pu.setFrom(n))}createChecked(e=null,t,n){return t=Lu.from(t),this.checkContent(t),new sh(this,this.computeAttrs(e),t,Pu.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),(t=Lu.from(t)).size){let e=this.contentMatch.fillBefore(t);if(!e)return null;t=e.append(t)}let s=this.contentMatch.matchFragment(t),r=s&&s.fillBefore(Lu.empty,!0);return r?new sh(this,e,t.append(r),Pu.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){yh(this.attrs,e,"node",this.name)}allowsMarkType(e){return null==this.markSet||this.markSet.indexOf(e)>-1}allowsMarks(e){if(null==this.markSet)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(null==this.markSet)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:Pu.none:e}static compile(t,n){let s=Object.create(null);t.forEach((t,r)=>s[t]=new e(t,n,r));let r=n.spec.topNode||"doc";if(!s[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!s.text)throw new RangeError("Every schema needs a 'text' type");for(let e in s.text.attrs)throw new RangeError("The text node type should not have attributes");return s}};class bh{constructor(e,t,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate="string"==typeof n.validate?function(e,t,n){let s=n.split("|");return n=>{let r=null===n?"null":typeof n;if(s.indexOf(r)<0)throw new RangeError(`Expected value of type ${s} for attribute ${t} on type ${e}, got ${r}`)}}(e,t,n.validate):n.validate}get isRequired(){return!this.hasDefault}}class wh{constructor(e,t,n,s){this.name=e,this.rank=t,this.schema=n,this.spec=s,this.attrs=xh(e,s.attrs),this.excluded=null;let r=fh(this.attrs);this.instance=r?new Pu(this,r):null}create(e=null){return!e&&this.instance?this.instance:new Pu(this,gh(this.attrs,e))}static compile(e,t){let n=Object.create(null),s=0;return e.forEach((e,r)=>n[e]=new wh(e,s++,t,r)),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){yh(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class vh{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let s in e)t[s]=e[s];t.nodes=Au.from(e.nodes),t.marks=Au.from(e.marks||{}),this.nodes=Ch.compile(this.spec.nodes,this),this.marks=wh.compile(this.spec.marks,this);let n=Object.create(null);for(let s in this.nodes){if(s in this.marks)throw new RangeError(s+" can not be both a node and a mark");let e=this.nodes[s],t=e.spec.content||"",r=e.spec.marks;if(e.contentMatch=n[t]||(n[t]=oh.parse(t,this.nodes)),e.inlineContent=e.contentMatch.inlineContent,e.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!e.isInline||!e.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=e}e.markSet="_"==r?null:r?kh(this,r.split(" ")):""!=r&&e.inlineContent?null:[]}for(let s in this.marks){let e=this.marks[s],t=e.spec.excludes;e.excluded=null==t?[e]:""==t?[]:kh(this,t.split(" "))}this.nodeFromJSON=e=>sh.fromJSON(this,e),this.markFromJSON=e=>Pu.fromJSON(this,e),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,s){if("string"==typeof e)e=this.nodeType(e);else{if(!(e instanceof Ch))throw new RangeError("Invalid node type: "+e);if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}return e.createChecked(t,n,s)}text(e,t){let n=this.nodes.text;return new rh(n,n.defaultAttrs,e,Pu.setFrom(t))}mark(e,t){return"string"==typeof e&&(e=this.marks[e]),e.create(t)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}}function kh(e,t){let n=[];for(let s=0;s<t.length;s++){let r=t[s],i=e.marks[r],o=i;if(i)n.push(i);else for(let t in e.marks){let s=e.marks[t];("_"==r||s.spec.group&&s.spec.group.split(" ").indexOf(r)>-1)&&n.push(o=s)}if(!o)throw new SyntaxError("Unknown mark type: '"+t[s]+"'")}return n}class Mh{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let n=this.matchedStyles=[];t.forEach(e=>{if(function(e){return null!=e.tag}(e))this.tags.push(e);else if(function(e){return null!=e.style}(e)){let t=/[^=]*/.exec(e.style)[0];n.indexOf(t)<0&&n.push(t),this.styles.push(e)}}),this.normalizeLists=!this.tags.some(t=>{if(!/^(ul|ol)\b/.test(t.tag)||!t.node)return!1;let n=e.nodes[t.node];return n.contentMatch.matchType(n)})}parse(e,t={}){let n=new Ah(this,t,!1);return n.addAll(e,Pu.none,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new Ah(this,t,!0);return n.addAll(e,Pu.none,t.from,t.to),Hu.maxOpen(n.finish())}matchTag(e,t,n){for(let s=n?this.tags.indexOf(n)+1:0;s<this.tags.length;s++){let n=this.tags[s];if(Ih(e,n.tag)&&(void 0===n.namespace||e.namespaceURI==n.namespace)&&(!n.context||t.matchesContext(n.context))){if(n.getAttrs){let t=n.getAttrs(e);if(!1===t)continue;n.attrs=t||void 0}return n}}}matchStyle(e,t,n,s){for(let r=s?this.styles.indexOf(s)+1:0;r<this.styles.length;r++){let s=this.styles[r],i=s.style;if(!(0!=i.indexOf(e)||s.context&&!n.matchesContext(s.context)||i.length>e.length&&(61!=i.charCodeAt(e.length)||i.slice(e.length+1)!=t))){if(s.getAttrs){let e=s.getAttrs(t);if(!1===e)continue;s.attrs=e||void 0}return s}}}static schemaRules(e){let t=[];function n(e){let n=null==e.priority?50:e.priority,s=0;for(;s<t.length;s++){let e=t[s];if((null==e.priority?50:e.priority)<n)break}t.splice(s,0,e)}for(let s in e.marks){let t=e.marks[s].spec.parseDOM;t&&t.forEach(e=>{n(e=Oh(e)),e.mark||e.ignore||e.clearMark||(e.mark=s)})}for(let s in e.nodes){let t=e.nodes[s].spec.parseDOM;t&&t.forEach(e=>{n(e=Oh(e)),e.node||e.ignore||e.mark||(e.node=s)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Mh(e,Mh.schemaRules(e)))}}const Sh={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Nh={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Th={ol:!0,ul:!0};function Eh(e,t,n){return null!=t?(t?1:0)|("full"===t?2:0):e&&"pre"==e.whitespace?3:-5&n}class jh{constructor(e,t,n,s,r,i){this.type=e,this.attrs=t,this.marks=n,this.solid=s,this.options=i,this.content=[],this.activeMarks=Pu.none,this.match=r||(4&i?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(Lu.from(e));if(!t){let t,n=this.type.contentMatch;return(t=n.findWrapping(e.type))?(this.match=n,t):null}this.match=this.type.contentMatch.matchFragment(t)}return this.match.findWrapping(e.type)}finish(e){if(!(1&this.options)){let e,t=this.content[this.content.length-1];if(t&&t.isText&&(e=/[ \t\r\n\u000c]+$/.exec(t.text))){let n=t;t.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-e[0].length))}}let t=Lu.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(Lu.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Sh.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class Ah{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let s,r=t.topNode,i=Eh(null,t.preserveWhitespace,0)|(n?4:0);s=r?new jh(r.type,r.attrs,Pu.none,!0,t.topMatch||r.type.contentMatch,i):new jh(n?null:e.schema.topNodeType,null,Pu.none,!0,null,i),this.nodes=[s],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){3==e.nodeType?this.addTextNode(e,t):1==e.nodeType&&this.addElement(e,t)}addTextNode(e,t){let n=e.nodeValue,s=this.top,r=2&s.options?"full":this.localPreserveWS||(1&s.options)>0;if("full"===r||s.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(r)n="full"!==r?n.replace(/\r?\n|\r/g," "):n.replace(/\r\n?/g,"\n");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let t=s.content[s.content.length-1],r=e.previousSibling;(!t||r&&"BR"==r.nodeName||t.isText&&/[ \t\r\n\u000c]$/.test(t.text))&&(n=n.slice(1))}n&&this.insertNode(this.parser.schema.text(n),t,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,t,n){let s=this.localPreserveWS,r=this.top;("PRE"==e.tagName||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let i,o=e.nodeName.toLowerCase();Th.hasOwnProperty(o)&&this.parser.normalizeLists&&function(e){for(let t=e.firstChild,n=null;t;t=t.nextSibling){let e=1==t.nodeType?t.nodeName.toLowerCase():null;e&&Th.hasOwnProperty(e)&&n?(n.appendChild(t),t=n):"li"==e?n=t:e&&(n=null)}}(e);let a=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(i=this.parser.matchTag(e,this,n));e:if(a?a.ignore:Nh.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,t);else if(!a||a.skip||a.closeParent){a&&a.closeParent?this.open=Math.max(0,this.open-1):a&&a.skip.nodeType&&(e=a.skip);let n,s=this.needsBlock;if(Sh.hasOwnProperty(o))r.content.length&&r.content[0].isInline&&this.open&&(this.open--,r=this.top),n=!0,r.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let i=a&&a.skip?t:this.readStyles(e,t);i&&this.addAll(e,i),n&&this.sync(r),this.needsBlock=s}else{let n=this.readStyles(e,t);n&&this.addElementByRule(e,a,n,!1===a.consuming?i:void 0)}this.localPreserveWS=s}leafFallback(e,t){"BR"==e.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode("\n"),t)}ignoreFallback(e,t){"BR"!=e.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"),t,!0)}readStyles(e,t){let n=e.style;if(n&&n.length)for(let s=0;s<this.parser.matchedStyles.length;s++){let e=this.parser.matchedStyles[s],r=n.getPropertyValue(e);if(r)for(let n;;){let s=this.parser.matchStyle(e,r,this,n);if(!s)break;if(s.ignore)return null;if(t=s.clearMark?t.filter(e=>!s.clearMark(e)):t.concat(this.parser.schema.marks[s.mark].create(s.attrs)),!1!==s.consuming)break;n=s}}return t}addElementByRule(e,t,n,s){let r,i;if(t.node)if(i=this.parser.schema.nodes[t.node],i.isLeaf)this.insertNode(i.create(t.attrs),n,"BR"==e.nodeName)||this.leafFallback(e,n);else{let e=this.enter(i,t.attrs||null,n,t.preserveWhitespace);e&&(r=!0,n=e)}else{let e=this.parser.schema.marks[t.mark];n=n.concat(e.create(t.attrs))}let o=this.top;if(i&&i.isLeaf)this.findInside(e);else if(s)this.addElement(e,n,s);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(e=>this.insertNode(e,n,!1));else{let s=e;"string"==typeof t.contentElement?s=e.querySelector(t.contentElement):"function"==typeof t.contentElement?s=t.contentElement(e):t.contentElement&&(s=t.contentElement),this.findAround(e,s,!0),this.addAll(s,n),this.findAround(e,s,!1)}r&&this.sync(o)&&this.open--}addAll(e,t,n,s){let r=n||0;for(let i=n?e.childNodes[n]:e.firstChild,o=null==s?null:e.childNodes[s];i!=o;i=i.nextSibling,++r)this.findAtPoint(e,r),this.addDOM(i,t);this.findAtPoint(e,r)}findPlace(e,t,n){let s,r;for(let i=this.open,o=0;i>=0;i--){let t=this.nodes[i],a=t.findWrapping(e);if(a&&(!s||s.length>a.length+o)&&(s=a,r=t,!a.length))break;if(t.solid){if(n)break;o+=2}}if(!s)return null;this.sync(r);for(let i=0;i<s.length;i++)t=this.enterInner(s[i],null,t,!1);return t}insertNode(e,t,n){if(e.isInline&&this.needsBlock&&!this.top.type){let e=this.textblockFromContext();e&&(t=this.enterInner(e,null,t))}let s=this.findPlace(e,t,n);if(s){this.closeExtra();let t=this.top;t.match&&(t.match=t.match.matchType(e.type));let n=Pu.none;for(let r of s.concat(e.marks))(t.type?t.type.allowsMarkType(r.type):Lh(r.type,e.type))&&(n=r.addToSet(n));return t.content.push(e.mark(n)),!0}return!1}enter(e,t,n,s){let r=this.findPlace(e.create(t),n,!1);return r&&(r=this.enterInner(e,t,n,!0,s)),r}enterInner(e,t,n,s=!1,r){this.closeExtra();let i=this.top;i.match=i.match&&i.match.matchType(e);let o=Eh(e,r,i.options);4&i.options&&0==i.content.length&&(o|=4);let a=Pu.none;return n=n.filter(t=>!(i.type?i.type.allowsMarkType(t.type):Lh(t.type,e))||(a=t.addToSet(a),!1)),this.nodes.push(new jh(e,t,a,s,null,o)),this.open++,n}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!(!this.isOpen&&!this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=1)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let t=n.length-1;t>=0;t--)e+=n[t].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)null==this.find[t].pos&&1==e.nodeType&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let s=0;s<this.find.length;s++)if(null==this.find[s].pos&&1==e.nodeType&&e.contains(this.find[s].node)){t.compareDocumentPosition(this.find[s].node)&(n?2:4)&&(this.find[s].pos=this.currentPos)}}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,s=!(this.isOpen||n&&n.parent.type!=this.nodes[0].type),r=-(n?n.depth+1:0)+(s?0:1),i=(e,o)=>{for(;e>=0;e--){let a=t[e];if(""==a){if(e==t.length-1||0==e)continue;for(;o>=r;o--)if(i(e-1,o))return!0;return!1}{let e=o>0||0==o&&s?this.nodes[o].type:n&&o>=r?n.node(o-r).type:null;if(!e||e.name!=a&&!e.isInGroup(a))return!1;o--}}return!0};return i(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let e=this.parser.schema.nodes[t];if(e.isTextblock&&e.defaultAttrs)return e}}}function Ih(e,t){return(e.matches||e.msMatchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector).call(e,t)}function Oh(e){let t={};for(let n in e)t[n]=e[n];return t}function Lh(e,t){let n=t.schema.nodes;for(let s in n){let r=n[s];if(!r.allowsMarkType(e))continue;let i=[],o=e=>{i.push(e);for(let n=0;n<e.edgeCount;n++){let{type:s,next:r}=e.edge(n);if(s==t)return!0;if(i.indexOf(r)<0&&o(r))return!0}};if(o(r.contentMatch))return!0}}class Dh{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},n){n||(n=_h(t).createDocumentFragment());let s=n,r=[];return e.forEach(e=>{if(r.length||e.marks.length){let n=0,i=0;for(;n<r.length&&i<e.marks.length;){let t=e.marks[i];if(this.marks[t.type.name]){if(!t.eq(r[n][0])||!1===t.type.spec.spanning)break;n++,i++}else i++}for(;n<r.length;)s=r.pop()[1];for(;i<e.marks.length;){let n=e.marks[i++],o=this.serializeMark(n,e.isInline,t);o&&(r.push([n,s]),s.appendChild(o.dom),s=o.contentDOM||o.dom)}}s.appendChild(this.serializeNodeInner(e,t))}),n}serializeNodeInner(e,t){let{dom:n,contentDOM:s}=Hh(_h(t),this.nodes[e.type.name](e),null,e.attrs);if(s){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,s)}return n}serializeNode(e,t={}){let n=this.serializeNodeInner(e,t);for(let s=e.marks.length-1;s>=0;s--){let r=this.serializeMark(e.marks[s],e.isInline,t);r&&((r.contentDOM||r.dom).appendChild(n),n=r.dom)}return n}serializeMark(e,t,n={}){let s=this.marks[e.type.name];return s&&Hh(_h(n),s(e,t),null,e.attrs)}static renderSpec(e,t,n=null,s){return Hh(e,t,n,s)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new Dh(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=Rh(e.nodes);return t.text||(t.text=e=>e.text),t}static marksFromSchema(e){return Rh(e.marks)}}function Rh(e){let t={};for(let n in e){let s=e[n].spec.toDOM;s&&(t[n]=s)}return t}function _h(e){return e.document||window.document}const Ph=new WeakMap;function Vh(e){let t=Ph.get(e);return void 0===t&&Ph.set(e,t=function(e){let t=null;function n(e){if(e&&"object"==typeof e)if(Array.isArray(e))if("string"==typeof e[0])t||(t=[]),t.push(e);else for(let t=0;t<e.length;t++)n(e[t]);else for(let t in e)n(e[t])}return n(e),t}(e)),t}function Hh(e,t,n,s){if("string"==typeof t)return{dom:e.createTextNode(t)};if(null!=t.nodeType)return{dom:t};if(t.dom&&null!=t.dom.nodeType)return t;let r,i=t[0];if("string"!=typeof i)throw new RangeError("Invalid array passed to renderSpec");if(s&&(r=Vh(s))&&r.indexOf(t)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o,a=i.indexOf(" ");a>0&&(n=i.slice(0,a),i=i.slice(a+1));let l=n?e.createElementNS(n,i):e.createElement(i),c=t[1],d=1;if(c&&"object"==typeof c&&null==c.nodeType&&!Array.isArray(c)){d=2;for(let e in c)if(null!=c[e]){let t=e.indexOf(" ");t>0?l.setAttributeNS(e.slice(0,t),e.slice(t+1),c[e]):"style"==e&&l.style?l.style.cssText=c[e]:l.setAttribute(e,c[e])}}for(let u=d;u<t.length;u++){let r=t[u];if(0===r){if(u<t.length-1||u>d)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}{let{dom:t,contentDOM:i}=Hh(e,r,n,s);if(l.appendChild(t),i){if(o)throw new RangeError("Multiple content holes");o=i}}}return{dom:l,contentDOM:o}}const $h=Math.pow(2,16);function zh(e,t){return e+t*$h}function Fh(e){return 65535&e}let Bh=class{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}},Wh=class e{constructor(t,n=!1){if(this.ranges=t,this.inverted=n,!t.length&&e.empty)return e.empty}recover(e){let t=0,n=Fh(e);if(!this.inverted)for(let s=0;s<n;s++)t+=this.ranges[3*s+2]-this.ranges[3*s+1];return this.ranges[3*n]+t+function(e){return(e-(65535&e))/$h}(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let s=0,r=this.inverted?2:1,i=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let a=this.ranges[o]-(this.inverted?s:0);if(a>e)break;let l=this.ranges[o+r],c=this.ranges[o+i],d=a+l;if(e<=d){let r=a+s+((l?e==a?-1:e==d?1:t:t)<0?0:c);if(n)return r;let i=e==(t<0?a:d)?null:zh(o/3,e-a),u=e==a?2:e==d?1:4;return(t<0?e!=a:e!=d)&&(u|=8),new Bh(r,u,i)}s+=c-l}return n?e+s:new Bh(e+s,0,null)}touches(e,t){let n=0,s=Fh(t),r=this.inverted?2:1,i=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let t=this.ranges[o]-(this.inverted?n:0);if(t>e)break;let a=this.ranges[o+r];if(e<=t+a&&o==3*s)return!0;n+=this.ranges[o+i]-a}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let s=0,r=0;s<this.ranges.length;s+=3){let i=this.ranges[s],o=i-(this.inverted?r:0),a=i+(this.inverted?0:r),l=this.ranges[s+t],c=this.ranges[s+n];e(o,o+l,a,a+c),r+=c-l}}invert(){return new e(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return 0==t?e.empty:new e(t<0?[0,-t,0]:[0,0,t])}};Wh.empty=new Wh([]);let Zh=class e{constructor(e=[],t,n=0,s=e.length){this.maps=e,this.mirror=t,this.from=n,this.to=s}slice(t=0,n=this.maps.length){return new e(this.maps,this.mirror,t,n)}copy(){return new e(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(e,t){this.to=this.maps.push(e),null!=t&&this.setMirror(this.maps.length-1,t)}appendMapping(e){for(let t=0,n=this.maps.length;t<e.maps.length;t++){let s=e.getMirror(t);this.appendMap(e.maps[t],null!=s&&s<t?n+s:void 0)}}getMirror(e){if(this.mirror)for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this.maps.length+e.maps.length;t>=0;t--){let s=e.getMirror(t);this.appendMap(e.maps[t].invert(),null!=s&&s>t?n-s-1:void 0)}}invert(){let t=new e;return t.appendMappingInverted(this),t}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this.maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let s=0;for(let r=this.from;r<this.to;r++){let n=this.maps[r].mapResult(e,t);if(null!=n.recover){let t=this.getMirror(r);if(null!=t&&t>r&&t<this.to){r=t,e=this.maps[t].recover(n.recover);continue}}s|=n.delInfo,e=n.pos}return n?e:new Bh(e,s,null)}};const Uh=Object.create(null);let qh=class{getMap(){return Wh.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=Uh[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in Uh)throw new RangeError("Duplicate use of step JSON ID "+e);return Uh[e]=t,t.prototype.jsonID=e,t}},Jh=class e{constructor(e,t){this.doc=e,this.failed=t}static ok(t){return new e(t,null)}static fail(t){return new e(null,t)}static fromReplace(t,n,s,r){try{return e.ok(t.replace(n,s,r))}catch(i){if(i instanceof Vu)return e.fail(i.message);throw i}}};function Gh(e,t,n){let s=[];for(let r=0;r<e.childCount;r++){let i=e.child(r);i.content.size&&(i=i.copy(Gh(i.content,t,i))),i.isInline&&(i=t(i,n,r)),s.push(i)}return Lu.fromArray(s)}let Kh=class e extends qh{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),s=n.node(n.sharedDepth(this.to)),r=new Hu(Gh(t.content,(e,t)=>e.isAtom&&t.type.allowsMarkType(this.mark.type)?e.mark(this.mark.addToSet(e.marks)):e,s),t.openStart,t.openEnd);return Jh.fromReplace(e,this.from,this.to,r)}invert(){return new Yh(this.from,this.to,this.mark)}map(t){let n=t.mapResult(this.from,1),s=t.mapResult(this.to,-1);return n.deleted&&s.deleted||n.pos>=s.pos?null:new e(n.pos,s.pos,this.mark)}merge(t){return t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))}};qh.jsonID("addMark",Kh);let Yh=class e extends qh{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new Hu(Gh(t.content,e=>e.mark(this.mark.removeFromSet(e.marks)),e),t.openStart,t.openEnd);return Jh.fromReplace(e,this.from,this.to,n)}invert(){return new Kh(this.from,this.to,this.mark)}map(t){let n=t.mapResult(this.from,1),s=t.mapResult(this.to,-1);return n.deleted&&s.deleted||n.pos>=s.pos?null:new e(n.pos,s.pos,this.mark)}merge(t){return t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))}};qh.jsonID("removeMark",Yh);let Qh=class e extends qh{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Jh.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return Jh.fromReplace(e,this.pos,this.pos+1,new Hu(Lu.from(n),0,t.isLeaf?0:1))}invert(t){let n=t.nodeAt(this.pos);if(n){let t=this.mark.addToSet(n.marks);if(t.length==n.marks.length){for(let s=0;s<n.marks.length;s++)if(!n.marks[s].isInSet(t))return new e(this.pos,n.marks[s]);return new e(this.pos,this.mark)}}return new Xh(this.pos,this.mark)}map(t){let n=t.mapResult(this.pos,1);return n.deletedAfter?null:new e(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,n){if("number"!=typeof n.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new e(n.pos,t.markFromJSON(n.mark))}};qh.jsonID("addNodeMark",Qh);let Xh=class e extends qh{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Jh.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return Jh.fromReplace(e,this.pos,this.pos+1,new Hu(Lu.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return t&&this.mark.isInSet(t.marks)?new Qh(this.pos,this.mark):this}map(t){let n=t.mapResult(this.pos,1);return n.deletedAfter?null:new e(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,n){if("number"!=typeof n.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new e(n.pos,t.markFromJSON(n.mark))}};qh.jsonID("removeNodeMark",Xh);let ep=class e extends qh{constructor(e,t,n,s=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=s}apply(e){return this.structure&&np(e,this.from,this.to)?Jh.fail("Structure replace would overwrite content"):Jh.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Wh([this.from,this.to-this.from,this.slice.size])}invert(t){return new e(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let n=t.mapResult(this.from,1),s=t.mapResult(this.to,-1);return n.deletedAcross&&s.deletedAcross?null:new e(n.pos,Math.max(n.pos,s.pos),this.slice)}merge(t){if(!(t instanceof e)||t.structure||this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;{let n=this.slice.size+t.slice.size==0?Hu.empty:new Hu(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new e(t.from,this.to,n,this.structure)}}{let n=this.slice.size+t.slice.size==0?Hu.empty:new Hu(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new e(this.from,this.to+(t.to-t.from),n,this.structure)}}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(n.from,n.to,Hu.fromJSON(t,n.slice),!!n.structure)}};qh.jsonID("replace",ep);let tp=class e extends qh{constructor(e,t,n,s,r,i,o=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=s,this.slice=r,this.insert=i,this.structure=o}apply(e){if(this.structure&&(np(e,this.from,this.gapFrom)||np(e,this.gapTo,this.to)))return Jh.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return Jh.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?Jh.fromReplace(e,this.from,this.to,n):Jh.fail("Content does not fit in gap")}getMap(){return new Wh([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let n=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let n=t.mapResult(this.from,1),s=t.mapResult(this.to,-1),r=t.map(this.gapFrom,-1),i=t.map(this.gapTo,1);return n.deletedAcross&&s.deletedAcross||r<n.pos||i>s.pos?null:new e(n.pos,s.pos,r,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(t,n){if("number"!=typeof n.from||"number"!=typeof n.to||"number"!=typeof n.gapFrom||"number"!=typeof n.gapTo||"number"!=typeof n.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(n.from,n.to,n.gapFrom,n.gapTo,Hu.fromJSON(t,n.slice),n.insert,!!n.structure)}};function np(e,t,n){let s=e.resolve(t),r=n-t,i=s.depth;for(;r>0&&i>0&&s.indexAfter(i)==s.node(i).childCount;)i--,r--;if(r>0){let e=s.node(i).maybeChild(s.indexAfter(i));for(;r>0;){if(!e||e.isLeaf)return!0;e=e.firstChild,r--}}return!1}function sp(e,t,n){let s=e.resolve(t);if(!n.content.size)return t;let r=n.content;for(let i=0;i<n.openStart;i++)r=r.firstChild.content;for(let i=1;i<=(0==n.openStart&&n.size?2:1);i++)for(let e=s.depth;e>=0;e--){let t=e==s.depth?0:s.pos<=(s.start(e+1)+s.end(e+1))/2?-1:1,n=s.index(e)+(t>0?1:0),o=s.node(e),a=!1;if(1==i)a=o.canReplace(n,n,r);else{let e=o.contentMatchAt(n).findWrapping(r.firstChild.type);a=e&&o.canReplaceWith(n,n,e[0])}if(a)return 0==t?s.pos:t<0?s.before(e+1):s.after(e+1)}return null}function rp(e,t,n){return!n.openStart&&!n.openEnd&&e.start()==t.start()&&e.parent.canReplace(e.index(),t.index(),n.content)}qh.jsonID("replaceAround",tp);let ip=class{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=Lu.empty;for(let s=0;s<=e.depth;s++){let t=e.node(s);this.frontier.push({type:t.type,match:t.contentMatchAt(e.indexAfter(s))})}for(let s=e.depth;s>0;s--)this.placed=Lu.from(e.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,s=this.close(e<0?this.$to:n.doc.resolve(e));if(!s)return null;let r=this.placed,i=n.depth,o=s.depth;for(;i&&o&&1==r.childCount;)r=r.firstChild.content,i--,o--;let a=new Hu(r,i,o);return e>-1?new tp(n.pos,e,this.$to.pos,this.$to.end(),a,t):a.size||n.pos!=this.$to.pos?new ep(n.pos,s.pos,a):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,s=this.unplaced.openEnd;n<e;n++){let r=t.firstChild;if(t.childCount>1&&(s=0),r.type.spec.isolating&&s<=n){e=n;break}t=r.content}for(let t=1;t<=2;t++)for(let n=1==t?e:this.unplaced.openStart;n>=0;n--){let e,s=null;n?(s=lp(this.unplaced.content,n-1).firstChild,e=s.content):e=this.unplaced.content;let r=e.firstChild;for(let i=this.depth;i>=0;i--){let e,{type:o,match:a}=this.frontier[i],l=null;if(1==t&&(r?a.matchType(r.type)||(l=a.fillBefore(Lu.from(r),!1)):s&&o.compatibleContent(s.type)))return{sliceDepth:n,frontierDepth:i,parent:s,inject:l};if(2==t&&r&&(e=a.findWrapping(r.type)))return{sliceDepth:n,frontierDepth:i,parent:s,wrap:e};if(s&&a.matchType(s.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,s=lp(e,t);return!(!s.childCount||s.firstChild.isLeaf)&&(this.unplaced=new Hu(e,t+1,Math.max(n,s.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,s=lp(e,t);if(s.childCount<=1&&t>0){let r=e.size-t<=t+s.size;this.unplaced=new Hu(op(e,t-1,1),t-1,r?t-1:n)}else this.unplaced=new Hu(op(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:s,wrap:r}){for(;this.depth>t;)this.closeFrontierNode();if(r)for(let m=0;m<r.length;m++)this.openFrontierNode(r[m]);let i=this.unplaced,o=n?n.content:i.content,a=i.openStart-e,l=0,c=[],{match:d,type:u}=this.frontier[t];if(s){for(let e=0;e<s.childCount;e++)c.push(s.child(e));d=d.matchFragment(s)}let h=o.size+e-(i.content.size-i.openEnd);for(;l<o.childCount;){let e=o.child(l),t=d.matchType(e.type);if(!t)break;l++,(l>1||0==a||e.content.size)&&(d=t,c.push(cp(e.mark(u.allowedMarks(e.marks)),1==l?a:0,l==o.childCount?h:-1)))}let p=l==o.childCount;p||(h=-1),this.placed=ap(this.placed,t,Lu.from(c)),this.frontier[t].match=d,p&&h<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,f=o;m<h;m++){let e=f.lastChild;this.frontier.push({type:e.type,match:e.contentMatchAt(e.childCount)}),f=e.content}this.unplaced=p?0==e?Hu.empty:new Hu(op(i.content,e-1,1),e-1,h<0?i.openEnd:e-1):new Hu(op(i.content,e,l),i.openStart,i.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e,t=this.frontier[this.depth];if(!t.type.isTextblock||!dp(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;let{depth:n}=this.$to,s=this.$to.after(n);for(;n>1&&s==this.$to.end(--n);)++s;return s}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:s}=this.frontier[t],r=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),i=dp(e,t,s,n,r);if(i){for(let n=t-1;n>=0;n--){let{match:t,type:s}=this.frontier[n],r=dp(e,n,s,t,!0);if(!r||r.childCount)continue e}return{depth:t,fit:i,move:r?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=ap(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let t=e.node(n),s=t.type.contentMatch.fillBefore(t.content,!0,e.index(n));this.openFrontierNode(t.type,t.attrs,s)}return e}openFrontierNode(e,t=null,n){let s=this.frontier[this.depth];s.match=s.match.matchType(e),this.placed=ap(this.placed,this.depth,Lu.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let e=this.frontier.pop().match.fillBefore(Lu.empty,!0);e.childCount&&(this.placed=ap(this.placed,this.frontier.length,e))}};function op(e,t,n){return 0==t?e.cutByIndex(n,e.childCount):e.replaceChild(0,e.firstChild.copy(op(e.firstChild.content,t-1,n)))}function ap(e,t,n){return 0==t?e.append(n):e.replaceChild(e.childCount-1,e.lastChild.copy(ap(e.lastChild.content,t-1,n)))}function lp(e,t){for(let n=0;n<t;n++)e=e.firstChild.content;return e}function cp(e,t,n){if(t<=0)return e;let s=e.content;return t>1&&(s=s.replaceChild(0,cp(s.firstChild,t-1,1==s.childCount?n-1:0))),t>0&&(s=e.type.contentMatch.fillBefore(s).append(s),n<=0&&(s=s.append(e.type.contentMatch.matchFragment(s).fillBefore(Lu.empty,!0)))),e.copy(s)}function dp(e,t,n,s,r){let i=e.node(t),o=r?e.indexAfter(t):e.index(t);if(o==i.childCount&&!n.compatibleContent(i.type))return null;let a=s.fillBefore(i.content,!0,o);return a&&!function(e,t,n){for(let s=n;s<t.childCount;s++)if(!e.allowsMarks(t.child(s).marks))return!0;return!1}(n,i.content,o)?a:null}function up(e){return e.spec.defining||e.spec.definingForContent}function hp(e,t,n,s,r){if(t<n){let r=e.firstChild;e=e.replaceChild(0,r.copy(hp(r.content,t+1,n,s,r)))}if(t>s){let t=r.contentMatchAt(0),n=t.fillBefore(e).append(e);e=n.append(t.matchFragment(n).fillBefore(Lu.empty,!0))}return e}function pp(e,t){let n=[];for(let s=Math.min(e.depth,t.depth);s>=0;s--){let r=e.start(s);if(r<e.pos-(e.depth-s)||t.end(s)>t.pos+(t.depth-s)||e.node(s).type.spec.isolating||t.node(s).type.spec.isolating)break;(r==t.start(s)||s==e.depth&&s==t.depth&&e.parent.inlineContent&&t.parent.inlineContent&&s&&t.start(s-1)==r-1)&&n.push(s)}return n}let mp=class e extends qh{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return Jh.fail("No node at attribute step's position");let n=Object.create(null);for(let r in t.attrs)n[r]=t.attrs[r];n[this.attr]=this.value;let s=t.type.create(n,null,t.marks);return Jh.fromReplace(e,this.pos,this.pos+1,new Hu(Lu.from(s),0,t.isLeaf?0:1))}getMap(){return Wh.empty}invert(t){return new e(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let n=t.mapResult(this.pos,1);return n.deletedAfter?null:new e(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,n){if("number"!=typeof n.pos||"string"!=typeof n.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new e(n.pos,n.attr,n.value)}};qh.jsonID("attr",mp);let fp=class extends Error{};fp=function e(t){let n=Error.call(this,t);return n.__proto__=e.prototype,n},(fp.prototype=Object.create(Error.prototype)).constructor=fp,fp.prototype.name="TransformError";let gp=class{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Zh}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new fp(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=Hu.empty){let s=function(e,t,n=t,s=Hu.empty){if(t==n&&!s.size)return null;let r=e.resolve(t),i=e.resolve(n);return rp(r,i,s)?new ep(t,n,s):new ip(r,i,s).fit()}(this.doc,e,t,n);return s&&this.step(s),this}replaceWith(e,t,n){return this.replace(e,t,new Hu(Lu.from(n),0,0))}delete(e,t){return this.replace(e,t,Hu.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return function(e,t,n,s){if(!s.size)return e.deleteRange(t,n);let r=e.doc.resolve(t),i=e.doc.resolve(n);if(rp(r,i,s))return e.step(new ep(t,n,s));let o=pp(r,e.doc.resolve(n));0==o[o.length-1]&&o.pop();let a=-(r.depth+1);o.unshift(a);for(let h=r.depth,p=r.pos-1;h>0;h--,p--){let e=r.node(h).type.spec;if(e.defining||e.definingAsContext||e.isolating)break;o.indexOf(h)>-1?a=h:r.before(h)==p&&o.splice(1,0,-h)}let l=o.indexOf(a),c=[],d=s.openStart;for(let h=s.content,p=0;;p++){let e=h.firstChild;if(c.push(e),p==s.openStart)break;h=e.content}for(let h=d-1;h>=0;h--){let e=c[h].type,t=up(e);if(t&&r.node(l).type!=e)d=h;else if(t||!e.isTextblock)break}for(let h=s.openStart;h>=0;h--){let t=(h+d+1)%(s.openStart+1),a=c[t];if(a)for(let c=0;c<o.length;c++){let d=o[(c+l)%o.length],u=!0;d<0&&(u=!1,d=-d);let h=r.node(d-1),p=r.index(d-1);if(h.canReplaceWith(p,p,a.type,a.marks))return e.replace(r.before(d),u?i.after(d):n,new Hu(hp(s.content,0,s.openStart,t),t,s.openEnd))}}let u=e.steps.length;for(let h=o.length-1;h>=0&&(e.replace(t,n,s),!(e.steps.length>u));h--){let e=o[h];e<0||(t=r.before(e),n=i.after(e))}}(this,e,t,n),this}replaceRangeWith(e,t,n){return function(e,t,n,s){if(!s.isInline&&t==n&&e.doc.resolve(t).parent.content.size){let r=function(e,t,n){let s=e.resolve(t);if(s.parent.canReplaceWith(s.index(),s.index(),n))return t;if(0==s.parentOffset)for(let r=s.depth-1;r>=0;r--){let e=s.index(r);if(s.node(r).canReplaceWith(e,e,n))return s.before(r+1);if(e>0)return null}if(s.parentOffset==s.parent.content.size)for(let r=s.depth-1;r>=0;r--){let e=s.indexAfter(r);if(s.node(r).canReplaceWith(e,e,n))return s.after(r+1);if(e<s.node(r).childCount)return null}return null}(e.doc,t,s.type);null!=r&&(t=n=r)}e.replaceRange(t,n,new Hu(Lu.from(s),0,0))}(this,e,t,n),this}deleteRange(e,t){return function(e,t,n){let s=e.doc.resolve(t),r=e.doc.resolve(n),i=pp(s,r);for(let o=0;o<i.length;o++){let t=i[o],n=o==i.length-1;if(n&&0==t||s.node(t).type.contentMatch.validEnd)return e.delete(s.start(t),r.end(t));if(t>0&&(n||s.node(t-1).canReplace(s.index(t-1),r.indexAfter(t-1))))return e.delete(s.before(t),r.after(t))}for(let o=1;o<=s.depth&&o<=r.depth;o++)if(t-s.start(o)==s.depth-o&&n>s.end(o)&&r.end(o)-n!=r.depth-o)return e.delete(s.before(o),n);e.delete(t,n)}(this,e,t),this}lift(e,t){return function(e,t,n){let{$from:s,$to:r,depth:i}=t,o=s.before(i+1),a=r.after(i+1),l=o,c=a,d=Lu.empty,u=0;for(let m=i,f=!1;m>n;m--)f||s.index(m)>0?(f=!0,d=Lu.from(s.node(m).copy(d)),u++):l--;let h=Lu.empty,p=0;for(let m=i,f=!1;m>n;m--)f||r.after(m+1)<r.end(m)?(f=!0,h=Lu.from(r.node(m).copy(h)),p++):c++;e.step(new tp(l,c,o,a,new Hu(d.append(h),u,p),d.size-u,!0))}(this,e,t),this}join(e,t=1){return function(e,t,n){let s=new ep(t-n,t+n,Hu.empty,!0);e.step(s)}(this,e,t),this}wrap(e,t){return function(e,t,n){let s=Lu.empty;for(let o=n.length-1;o>=0;o--){if(s.size){let e=n[o].type.contentMatch.matchFragment(s);if(!e||!e.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}s=Lu.from(n[o].type.create(n[o].attrs,s))}let r=t.start,i=t.end;e.step(new tp(r,i,r,i,new Hu(s,0,0),n.length,!0))}(this,e,t),this}setBlockType(e,t=e,n,s=null){return function(e,t,n,s,r){if(!s.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=e.steps.length;e.doc.nodesBetween(t,n,(t,n)=>{if(t.isTextblock&&!t.hasMarkup(s,r)&&function(e,t,n){let s=e.resolve(t),r=s.index();return s.parent.canReplaceWith(r,r+1,n)}(e.doc,e.mapping.slice(i).map(n),s)){e.clearIncompatible(e.mapping.slice(i).map(n,1),s);let o=e.mapping.slice(i),a=o.map(n,1),l=o.map(n+t.nodeSize,1);return e.step(new tp(a,l,a+1,l-1,new Hu(Lu.from(s.create(r,null,t.marks)),0,0),1,!0)),!1}})}(this,e,t,n,s),this}setNodeMarkup(e,t,n=null,s){return function(e,t,n,s,r){let i=e.doc.nodeAt(t);if(!i)throw new RangeError("No node at given position");n||(n=i.type);let o=n.create(s,null,r||i.marks);if(i.isLeaf)return e.replaceWith(t,t+i.nodeSize,o);if(!n.validContent(i.content))throw new RangeError("Invalid content for node type "+n.name);e.step(new tp(t,t+i.nodeSize,t+1,t+i.nodeSize-1,new Hu(Lu.from(o),0,0),1,!0))}(this,e,t,n,s),this}setNodeAttribute(e,t,n){return this.step(new mp(e,t,n)),this}addNodeMark(e,t){return this.step(new Qh(e,t)),this}removeNodeMark(e,t){if(!(t instanceof Pu)){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(!(t=t.isInSet(n.marks)))return this}return this.step(new Xh(e,t)),this}split(e,t=1,n){return function(e,t,n=1,s){let r=e.doc.resolve(t),i=Lu.empty,o=Lu.empty;for(let a=r.depth,l=r.depth-n,c=n-1;a>l;a--,c--){i=Lu.from(r.node(a).copy(i));let e=s&&s[c];o=Lu.from(e?e.type.create(e.attrs,o):r.node(a).copy(o))}e.step(new ep(t,t,new Hu(i.append(o),n,n),!0))}(this,e,t,n),this}addMark(e,t,n){return function(e,t,n,s){let r,i,o=[],a=[];e.doc.nodesBetween(t,n,(e,l,c)=>{if(!e.isInline)return;let d=e.marks;if(!s.isInSet(d)&&c.type.allowsMarkType(s.type)){let c=Math.max(l,t),u=Math.min(l+e.nodeSize,n),h=s.addToSet(d);for(let e=0;e<d.length;e++)d[e].isInSet(h)||(r&&r.to==c&&r.mark.eq(d[e])?r.to=u:o.push(r=new Yh(c,u,d[e])));i&&i.to==c?i.to=u:a.push(i=new Kh(c,u,s))}}),o.forEach(t=>e.step(t)),a.forEach(t=>e.step(t))}(this,e,t,n),this}removeMark(e,t,n){return function(e,t,n,s){let r=[],i=0;e.doc.nodesBetween(t,n,(e,o)=>{if(!e.isInline)return;i++;let a=null;if(s instanceof wh){let t,n=e.marks;for(;t=s.isInSet(n);)(a||(a=[])).push(t),n=t.removeFromSet(n)}else s?s.isInSet(e.marks)&&(a=[s]):a=e.marks;if(a&&a.length){let s=Math.min(o+e.nodeSize,n);for(let e=0;e<a.length;e++){let n,l=a[e];for(let e=0;e<r.length;e++){let t=r[e];t.step==i-1&&l.eq(r[e].style)&&(n=t)}n?(n.to=s,n.step=i):r.push({style:l,from:Math.max(o,t),to:s,step:i})}}}),r.forEach(t=>e.step(new Yh(t.from,t.to,t.style)))}(this,e,t,n),this}clearIncompatible(e,t,n){return function(e,t,n,s=n.contentMatch){let r=e.doc.nodeAt(t),i=[],o=t+1;for(let a=0;a<r.childCount;a++){let t=r.child(a),l=o+t.nodeSize,c=s.matchType(t.type);if(c){s=c;for(let s=0;s<t.marks.length;s++)n.allowsMarkType(t.marks[s].type)||e.step(new Yh(o,l,t.marks[s]))}else i.push(new ep(o,l,Hu.empty));o=l}if(!s.validEnd){let t=s.fillBefore(Lu.empty,!0);e.replace(o,o,new Hu(t,0,0))}for(let a=i.length-1;a>=0;a--)e.step(i[a])}(this,e,t,n),this}};const yp=Object.create(null);class xp{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new Cp(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=Hu.empty){let n=t.content.lastChild,s=null;for(let o=0;o<t.openEnd;o++)s=n,n=n.lastChild;let r=e.steps.length,i=this.ranges;for(let o=0;o<i.length;o++){let{$from:a,$to:l}=i[o],c=e.mapping.slice(r);e.replaceRange(c.map(a.pos),c.map(l.pos),o?Hu.empty:t),0==o&&jp(e,r,(n?n.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,s=this.ranges;for(let r=0;r<s.length;r++){let{$from:i,$to:o}=s[r],a=e.mapping.slice(n),l=a.map(i.pos),c=a.map(o.pos);r?e.deleteRange(l,c):(e.replaceRangeWith(l,c,t),jp(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let s=e.parent.inlineContent?new vp(e):Ep(e.node(0),e.parent,e.pos,e.index(),t,n);if(s)return s;for(let r=e.depth-1;r>=0;r--){let s=t<0?Ep(e.node(0),e.node(r),e.before(r+1),e.index(r),t,n):Ep(e.node(0),e.node(r),e.after(r+1),e.index(r)+1,t,n);if(s)return s}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new Np(e.node(0))}static atStart(e){return Ep(e,e,0,0,1)||new Np(e)}static atEnd(e){return Ep(e,e,e.content.size,e.childCount,-1)||new Np(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=yp[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in yp)throw new RangeError("Duplicate use of selection JSON ID "+e);return yp[e]=t,t.prototype.jsonID=e,t}getBookmark(){return vp.between(this.$anchor,this.$head).getBookmark()}}xp.prototype.visible=!0;class Cp{constructor(e,t){this.$from=e,this.$to=t}}let bp=!1;function wp(e){bp||e.parent.inlineContent||(bp=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+e.parent.type.name+")"))}class vp extends xp{constructor(e,t=e){wp(e),wp(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return xp.near(n);let s=e.resolve(t.map(this.anchor));return new vp(s.parent.inlineContent?s:n,n)}replace(e,t=Hu.empty){if(super.replace(e,t),t==Hu.empty){let t=this.$from.marksAcross(this.$to);t&&e.ensureMarks(t)}}eq(e){return e instanceof vp&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new kp(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if("number"!=typeof t.anchor||"number"!=typeof t.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new vp(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let s=e.resolve(t);return new this(s,n==t?s:e.resolve(n))}static between(e,t,n){let s=e.pos-t.pos;if(n&&!s||(n=s>=0?1:-1),!t.parent.inlineContent){let e=xp.findFrom(t,n,!0)||xp.findFrom(t,-n,!0);if(!e)return xp.near(t,n);t=e.$head}return e.parent.inlineContent||(0==s||(e=(xp.findFrom(e,-n,!0)||xp.findFrom(e,n,!0)).$anchor).pos<t.pos!=s<0)&&(e=t),new vp(e,t)}}xp.jsonID("text",vp);class kp{constructor(e,t){this.anchor=e,this.head=t}map(e){return new kp(e.map(this.anchor),e.map(this.head))}resolve(e){return vp.between(e.resolve(this.anchor),e.resolve(this.head))}}class Mp extends xp{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:s}=t.mapResult(this.anchor),r=e.resolve(s);return n?xp.near(r):new Mp(r)}content(){return new Hu(Lu.from(this.node),0,0)}eq(e){return e instanceof Mp&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Sp(this.anchor)}static fromJSON(e,t){if("number"!=typeof t.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Mp(e.resolve(t.anchor))}static create(e,t){return new Mp(e.resolve(t))}static isSelectable(e){return!e.isText&&!1!==e.type.spec.selectable}}Mp.prototype.visible=!1,xp.jsonID("node",Mp);class Sp{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new kp(n,n):new Sp(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&Mp.isSelectable(n)?new Mp(t):xp.near(t)}}class Np extends xp{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=Hu.empty){if(t==Hu.empty){e.delete(0,e.doc.content.size);let t=xp.atStart(e.doc);t.eq(e.selection)||e.setSelection(t)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new Np(e)}map(e){return new Np(e)}eq(e){return e instanceof Np}getBookmark(){return Tp}}xp.jsonID("all",Np);const Tp={map(){return this},resolve:e=>new Np(e)};function Ep(e,t,n,s,r,i=!1){if(t.inlineContent)return vp.create(e,n);for(let o=s-(r>0?0:1);r>0?o<t.childCount:o>=0;o+=r){let s=t.child(o);if(s.isAtom){if(!i&&Mp.isSelectable(s))return Mp.create(e,n-(r<0?s.nodeSize:0))}else{let t=Ep(e,s,n+r,r<0?s.childCount:0,r,i);if(t)return t}n+=s.nodeSize*r}return null}function jp(e,t,n){let s=e.steps.length-1;if(s<t)return;let r,i=e.steps[s];(i instanceof ep||i instanceof tp)&&(e.mapping.maps[s].forEach((e,t,n,s)=>{null==r&&(r=s)}),e.setSelection(xp.near(e.doc.resolve(r),n)))}class Ap extends gp{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=-3&this.updated|1,this.storedMarks=null,this}get selectionSet(){return(1&this.updated)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=2,this}ensureMarks(e){return Pu.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(2&this.updated)>0}addStep(e,t){super.addStep(e,t),this.updated=-3&this.updated,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let n=this.selection;return t&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||Pu.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,n){let s=this.doc.type.schema;if(null==t)return e?this.replaceSelectionWith(s.text(e),!0):this.deleteSelection();{if(null==n&&(n=t),n=null==n?t:n,!e)return this.deleteRange(t,n);let r=this.storedMarks;if(!r){let e=this.doc.resolve(t);r=n==t?e.marks():e.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(t,n,s.text(e,r)),this.selection.empty||this.setSelection(xp.near(this.selection.$to)),this}}setMeta(e,t){return this.meta["string"==typeof e?e:e.key]=t,this}getMeta(e){return this.meta["string"==typeof e?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=4,this}get scrolledIntoView(){return(4&this.updated)>0}}function Ip(e,t){return t&&e?e.bind(t):e}class Op{constructor(e,t,n){this.name=e,this.init=Ip(t.init,n),this.apply=Ip(t.apply,n)}}const Lp=[new Op("doc",{init:e=>e.doc||e.schema.topNodeType.createAndFill(),apply:e=>e.doc}),new Op("selection",{init:(e,t)=>e.selection||xp.atStart(t.doc),apply:e=>e.selection}),new Op("storedMarks",{init:e=>e.storedMarks||null,apply:(e,t,n,s)=>s.selection.$cursor?e.storedMarks:null}),new Op("scrollToSelection",{init:()=>0,apply:(e,t)=>e.scrolledIntoView?t+1:t})];class Dp{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=Lp.slice(),t&&t.forEach(e=>{if(this.pluginsByKey[e.key])throw new RangeError("Adding different instances of a keyed plugin ("+e.key+")");this.plugins.push(e),this.pluginsByKey[e.key]=e,e.spec.state&&this.fields.push(new Op(e.key,e.spec.state,e))})}}class Rp{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=t){let t=this.config.plugins[n];if(t.spec.filterTransaction&&!t.spec.filterTransaction.call(t,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],n=this.applyInner(e),s=null;for(;;){let r=!1;for(let i=0;i<this.config.plugins.length;i++){let o=this.config.plugins[i];if(o.spec.appendTransaction){let a=s?s[i].n:0,l=s?s[i].state:this,c=a<t.length&&o.spec.appendTransaction.call(o,a?t.slice(a):t,l,n);if(c&&n.filterTransaction(c,i)){if(c.setMeta("appendedTransaction",e),!s){s=[];for(let e=0;e<this.config.plugins.length;e++)s.push(e<i?{state:n,n:t.length}:{state:this,n:0})}t.push(c),n=n.applyInner(c),r=!0}s&&(s[i]={state:n,n:t.length})}}if(!r)return{state:n,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new Rp(this.config),n=this.config.fields;for(let s=0;s<n.length;s++){let r=n[s];t[r.name]=r.apply(e,this[r.name],this,t)}return t}get tr(){return new Ap(this)}static create(e){let t=new Dp(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new Rp(t);for(let s=0;s<t.fields.length;s++)n[t.fields[s].name]=t.fields[s].init(e,n);return n}reconfigure(e){let t=new Dp(this.schema,e.plugins),n=t.fields,s=new Rp(t);for(let r=0;r<n.length;r++){let t=n[r].name;s[t]=this.hasOwnProperty(t)?this[t]:n[r].init(e,s)}return s}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(e=>e.toJSON())),e&&"object"==typeof e)for(let n in e){if("doc"==n||"selection"==n)throw new RangeError("The JSON fields `doc` and `selection` are reserved");let s=e[n],r=s.spec.state;r&&r.toJSON&&(t[n]=r.toJSON.call(s,this[s.key]))}return t}static fromJSON(e,t,n){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let s=new Dp(e.schema,e.plugins),r=new Rp(s);return s.fields.forEach(s=>{if("doc"==s.name)r.doc=sh.fromJSON(e.schema,t.doc);else if("selection"==s.name)r.selection=xp.fromJSON(r.doc,t.selection);else if("storedMarks"==s.name)t.storedMarks&&(r.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(n)for(let i in n){let o=n[i],a=o.spec.state;if(o.key==s.name&&a&&a.fromJSON&&Object.prototype.hasOwnProperty.call(t,i))return void(r[s.name]=a.fromJSON.call(o,e,t[i],r))}r[s.name]=s.init(e,r)}}),r}}function _p(e,t,n){for(let s in e){let r=e[s];r instanceof Function?r=r.bind(t):"handleDOMEvents"==s&&(r=_p(r,t,{})),n[s]=r}return n}class Pp{constructor(e){this.spec=e,this.props={},e.props&&_p(e.props,this,this.props),this.key=e.key?e.key.key:Hp("plugin")}getState(e){return e[this.key]}}const Vp=Object.create(null);function Hp(e){return e in Vp?e+"$"+ ++Vp[e]:(Vp[e]=0,e+"$")}class $p{constructor(e="key"){this.key=Hp(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const zp=function(e){for(var t=0;;t++)if(!(e=e.previousSibling))return t},Fp=function(e){let t=e.assignedSlot||e.parentNode;return t&&11==t.nodeType?t.host:t};let Bp=null;const Wp=function(e,t,n){let s=Bp||(Bp=document.createRange());return s.setEnd(e,null==n?e.nodeValue.length:n),s.setStart(e,t||0),s},Zp=function(e,t,n,s){return n&&(qp(e,t,n,s,-1)||qp(e,t,n,s,1))},Up=/^(img|br|input|textarea|hr)$/i;function qp(e,t,n,s,r){for(var i;;){if(e==n&&t==s)return!0;if(t==(r<0?0:Jp(e))){let n=e.parentNode;if(!n||1!=n.nodeType||Gp(e)||Up.test(e.nodeName)||"false"==e.contentEditable)return!1;t=zp(e)+(r<0?0:1),e=n}else{if(1!=e.nodeType)return!1;{let n=e.childNodes[t+(r<0?-1:0)];if(1==n.nodeType&&"false"==n.contentEditable){if(!(null===(i=n.pmViewDesc)||void 0===i?void 0:i.ignoreForSelection))return!1;t+=r}else e=n,t=r<0?Jp(e):0}}}}function Jp(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function Gp(e){let t;for(let n=e;n&&!(t=n.pmViewDesc);n=n.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==e||t.contentDOM==e)}const Kp=function(e){return e.focusNode&&Zp(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)};function Yp(e,t){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=e,n.key=n.code=t,n}const Qp="undefined"!=typeof navigator?navigator:null,Xp="undefined"!=typeof document?document:null,em=Qp&&Qp.userAgent||"",tm=/Edge\/(\d+)/.exec(em),nm=/MSIE \d/.exec(em),sm=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(em),rm=!!(nm||sm||tm),im=nm?document.documentMode:sm?+sm[1]:tm?+tm[1]:0,om=!rm&&/gecko\/(\d+)/i.test(em);om&&(/Firefox\/(\d+)/.exec(em)||[0,0])[1];const am=!rm&&/Chrome\/(\d+)/.exec(em),lm=!!am,cm=am?+am[1]:0,dm=!rm&&!!Qp&&/Apple Computer/.test(Qp.vendor),um=dm&&(/Mobile\/\w+/.test(em)||!!Qp&&Qp.maxTouchPoints>2),hm=um||!!Qp&&/Mac/.test(Qp.platform),pm=!!Qp&&/Win/.test(Qp.platform),mm=/Android \d/.test(em),fm=!!Xp&&"webkitFontSmoothing"in Xp.documentElement.style,gm=fm?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function ym(e){let t=e.defaultView&&e.defaultView.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:e.documentElement.clientWidth,top:0,bottom:e.documentElement.clientHeight}}function xm(e,t){return"number"==typeof e?e:e[t]}function Cm(e){let t=e.getBoundingClientRect(),n=t.width/e.offsetWidth||1,s=t.height/e.offsetHeight||1;return{left:t.left,right:t.left+e.clientWidth*n,top:t.top,bottom:t.top+e.clientHeight*s}}function bm(e,t,n){let s=e.someProp("scrollThreshold")||0,r=e.someProp("scrollMargin")||5,i=e.dom.ownerDocument;for(let o=n||e.dom;o;){if(1!=o.nodeType){o=Fp(o);continue}let e=o,n=e==i.body,a=n?ym(i):Cm(e),l=0,c=0;if(t.top<a.top+xm(s,"top")?c=-(a.top-t.top+xm(r,"top")):t.bottom>a.bottom-xm(s,"bottom")&&(c=t.bottom-t.top>a.bottom-a.top?t.top+xm(r,"top")-a.top:t.bottom-a.bottom+xm(r,"bottom")),t.left<a.left+xm(s,"left")?l=-(a.left-t.left+xm(r,"left")):t.right>a.right-xm(s,"right")&&(l=t.right-a.right+xm(r,"right")),l||c)if(n)i.defaultView.scrollBy(l,c);else{let n=e.scrollLeft,s=e.scrollTop;c&&(e.scrollTop+=c),l&&(e.scrollLeft+=l);let r=e.scrollLeft-n,i=e.scrollTop-s;t={left:t.left-r,top:t.top-i,right:t.right-r,bottom:t.bottom-i}}let d=n?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(d))break;o="absolute"==d?o.offsetParent:Fp(o)}}function wm(e){let t=[],n=e.ownerDocument;for(let s=e;s&&(t.push({dom:s,top:s.scrollTop,left:s.scrollLeft}),e!=n);s=Fp(s));return t}function vm(e,t){for(let n=0;n<e.length;n++){let{dom:s,top:r,left:i}=e[n];s.scrollTop!=r+t&&(s.scrollTop=r+t),s.scrollLeft!=i&&(s.scrollLeft=i)}}let km=null;function Mm(e,t){let n,s,r,i,o=2e8,a=0,l=t.top,c=t.top;for(let d=e.firstChild,u=0;d;d=d.nextSibling,u++){let e;if(1==d.nodeType)e=d.getClientRects();else{if(3!=d.nodeType)continue;e=Wp(d).getClientRects()}for(let h=0;h<e.length;h++){let p=e[h];if(p.top<=l&&p.bottom>=c){l=Math.max(p.bottom,l),c=Math.min(p.top,c);let e=p.left>t.left?p.left-t.left:p.right<t.left?t.left-p.right:0;if(e<o){n=d,o=e,s=e&&3==n.nodeType?{left:p.right<t.left?p.right:p.left,top:t.top}:t,1==d.nodeType&&e&&(a=u+(t.left>=(p.left+p.right)/2?1:0));continue}}else p.top>t.top&&!r&&p.left<=t.left&&p.right>=t.left&&(r=d,i={left:Math.max(p.left,Math.min(p.right,t.left)),top:p.top});!n&&(t.left>=p.right&&t.top>=p.top||t.left>=p.left&&t.top>=p.bottom)&&(a=u+1)}}return!n&&r&&(n=r,s=i,o=0),n&&3==n.nodeType?function(e,t){let n=e.nodeValue.length,s=document.createRange();for(let r=0;r<n;r++){s.setEnd(e,r+1),s.setStart(e,r);let n=jm(s,1);if(n.top!=n.bottom&&Sm(t,n))return{node:e,offset:r+(t.left>=(n.left+n.right)/2?1:0)}}return{node:e,offset:0}}(n,s):!n||o&&1==n.nodeType?{node:e,offset:a}:Mm(n,s)}function Sm(e,t){return e.left>=t.left-1&&e.left<=t.right+1&&e.top>=t.top-1&&e.top<=t.bottom+1}function Nm(e,t,n){let s=e.childNodes.length;if(s&&n.top<n.bottom)for(let r=Math.max(0,Math.min(s-1,Math.floor(s*(t.top-n.top)/(n.bottom-n.top))-2)),i=r;;){let n=e.childNodes[i];if(1==n.nodeType){let e=n.getClientRects();for(let s=0;s<e.length;s++){let r=e[s];if(Sm(t,r))return Nm(n,t,r)}}if((i=(i+1)%s)==r)break}return e}function Tm(e,t){let n,s=e.dom.ownerDocument,r=0,i=function(e,t,n){if(e.caretPositionFromPoint)try{let s=e.caretPositionFromPoint(t,n);if(s)return{node:s.offsetNode,offset:Math.min(Jp(s.offsetNode),s.offset)}}catch(s){}if(e.caretRangeFromPoint){let s=e.caretRangeFromPoint(t,n);if(s)return{node:s.startContainer,offset:Math.min(Jp(s.startContainer),s.startOffset)}}}(s,t.left,t.top);i&&({node:n,offset:r}=i);let o,a=(e.root.elementFromPoint?e.root:s).elementFromPoint(t.left,t.top);if(!a||!e.dom.contains(1!=a.nodeType?a.parentNode:a)){let n=e.dom.getBoundingClientRect();if(!Sm(t,n))return null;if(a=Nm(e.dom,t,n),!a)return null}if(dm)for(let c=a;n&&c;c=Fp(c))c.draggable&&(n=void 0);if(a=function(e,t){let n=e.parentNode;return n&&/^li$/i.test(n.nodeName)&&t.left<e.getBoundingClientRect().left?n:e}(a,t),n){if(om&&1==n.nodeType&&(r=Math.min(r,n.childNodes.length),r<n.childNodes.length)){let e,s=n.childNodes[r];"IMG"==s.nodeName&&(e=s.getBoundingClientRect()).right<=t.left&&e.bottom>t.top&&r++}let s;fm&&r&&1==n.nodeType&&1==(s=n.childNodes[r-1]).nodeType&&"false"==s.contentEditable&&s.getBoundingClientRect().top>=t.top&&r--,n==e.dom&&r==n.childNodes.length-1&&1==n.lastChild.nodeType&&t.top>n.lastChild.getBoundingClientRect().bottom?o=e.state.doc.content.size:0!=r&&1==n.nodeType&&"BR"==n.childNodes[r-1].nodeName||(o=function(e,t,n,s){let r=-1;for(let i=t,o=!1;i!=e.dom;){let t,n=e.docView.nearestDesc(i,!0);if(!n)return null;if(1==n.dom.nodeType&&(n.node.isBlock&&n.parent||!n.contentDOM)&&((t=n.dom.getBoundingClientRect()).width||t.height)&&(n.node.isBlock&&n.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(n.dom.nodeName)&&(!o&&t.left>s.left||t.top>s.top?r=n.posBefore:(!o&&t.right<s.left||t.bottom<s.top)&&(r=n.posAfter),o=!0),!n.contentDOM&&r<0&&!n.node.isText))return(n.node.isBlock?s.top<(t.top+t.bottom)/2:s.left<(t.left+t.right)/2)?n.posBefore:n.posAfter;i=n.dom.parentNode}return r>-1?r:e.docView.posFromDOM(t,n,-1)}(e,n,r,t))}null==o&&(o=function(e,t,n){let{node:s,offset:r}=Mm(t,n),i=-1;if(1==s.nodeType&&!s.firstChild){let e=s.getBoundingClientRect();i=e.left!=e.right&&n.left>(e.left+e.right)/2?1:-1}return e.docView.posFromDOM(s,r,i)}(e,a,t));let l=e.docView.nearestDesc(a,!0);return{pos:o,inside:l?l.posAtStart-l.border:-1}}function Em(e){return e.top<e.bottom||e.left<e.right}function jm(e,t){let n=e.getClientRects();if(n.length){let e=n[t<0?0:n.length-1];if(Em(e))return e}return Array.prototype.find.call(n,Em)||e.getBoundingClientRect()}const Am=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function Im(e,t,n){let{node:s,offset:r,atom:i}=e.docView.domFromPos(t,n<0?-1:1),o=fm||om;if(3==s.nodeType){if(!o||!Am.test(s.nodeValue)&&(n<0?r:r!=s.nodeValue.length)){let e=r,t=r,i=n<0?1:-1;return n<0&&!r?(t++,i=-1):n>=0&&r==s.nodeValue.length?(e--,i=1):n<0?e--:t++,Om(jm(Wp(s,e,t),i),i<0)}{let e=jm(Wp(s,r,r),n);if(om&&r&&/\s/.test(s.nodeValue[r-1])&&r<s.nodeValue.length){let t=jm(Wp(s,r-1,r-1),-1);if(t.top==e.top){let n=jm(Wp(s,r,r+1),-1);if(n.top!=e.top)return Om(n,n.left<t.left)}}return e}}if(!e.state.doc.resolve(t-(i||0)).parent.inlineContent){if(null==i&&r&&(n<0||r==Jp(s))){let e=s.childNodes[r-1];if(1==e.nodeType)return Lm(e.getBoundingClientRect(),!1)}if(null==i&&r<Jp(s)){let e=s.childNodes[r];if(1==e.nodeType)return Lm(e.getBoundingClientRect(),!0)}return Lm(s.getBoundingClientRect(),n>=0)}if(null==i&&r&&(n<0||r==Jp(s))){let e=s.childNodes[r-1],t=3==e.nodeType?Wp(e,Jp(e)-(o?0:1)):1!=e.nodeType||"BR"==e.nodeName&&e.nextSibling?null:e;if(t)return Om(jm(t,1),!1)}if(null==i&&r<Jp(s)){let e=s.childNodes[r];for(;e.pmViewDesc&&e.pmViewDesc.ignoreForCoords;)e=e.nextSibling;let t=e?3==e.nodeType?Wp(e,0,o?0:1):1==e.nodeType?e:null:null;if(t)return Om(jm(t,-1),!0)}return Om(jm(3==s.nodeType?Wp(s):s,-n),n>=0)}function Om(e,t){if(0==e.width)return e;let n=t?e.left:e.right;return{top:e.top,bottom:e.bottom,left:n,right:n}}function Lm(e,t){if(0==e.height)return e;let n=t?e.top:e.bottom;return{top:n,bottom:n,left:e.left,right:e.right}}function Dm(e,t,n){let s=e.state,r=e.root.activeElement;s!=t&&e.updateState(t),r!=e.dom&&e.focus();try{return n()}finally{s!=t&&e.updateState(s),r!=e.dom&&r&&r.focus()}}const Rm=/[\u0590-\u08ac]/;let _m=null,Pm=null,Vm=!1;function Hm(e,t,n){return _m==t&&Pm==n?Vm:(_m=t,Pm=n,Vm="up"==n||"down"==n?function(e,t,n){let s=t.selection,r="up"==n?s.$from:s.$to;return Dm(e,t,()=>{let{node:t}=e.docView.domFromPos(r.pos,"up"==n?-1:1);for(;;){let n=e.docView.nearestDesc(t,!0);if(!n)break;if(n.node.isBlock){t=n.contentDOM||n.dom;break}t=n.dom.parentNode}let s=Im(e,r.pos,1);for(let e=t.firstChild;e;e=e.nextSibling){let t;if(1==e.nodeType)t=e.getClientRects();else{if(3!=e.nodeType)continue;t=Wp(e,0,e.nodeValue.length).getClientRects()}for(let e=0;e<t.length;e++){let r=t[e];if(r.bottom>r.top+1&&("up"==n?s.top-r.top>2*(r.bottom-s.top):r.bottom-s.bottom>2*(s.bottom-r.top)))return!1}}return!0})}(e,t,n):function(e,t,n){let{$head:s}=t.selection;if(!s.parent.isTextblock)return!1;let r=s.parentOffset,i=!r,o=r==s.parent.content.size,a=e.domSelection();return a?Rm.test(s.parent.textContent)&&a.modify?Dm(e,t,()=>{let{focusNode:t,focusOffset:r,anchorNode:i,anchorOffset:o}=e.domSelectionRange(),l=a.caretBidiLevel;a.modify("move",n,"character");let c=s.depth?e.docView.domAfterPos(s.before()):e.dom,{focusNode:d,focusOffset:u}=e.domSelectionRange(),h=d&&!c.contains(1==d.nodeType?d:d.parentNode)||t==d&&r==u;try{a.collapse(i,o),t&&(t!=i||r!=o)&&a.extend&&a.extend(t,r)}catch(p){}return null!=l&&(a.caretBidiLevel=l),h}):"left"==n||"backward"==n?i:o:s.pos==s.start()||s.pos==s.end()}(e,t,n))}class $m{constructor(e,t,n,s){this.parent=e,this.children=t,this.dom=n,this.contentDOM=s,this.dirty=0,n.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,n){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,n=this.posAtStart;;t++){let s=this.children[t];if(s==e)return n;n+=s.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,n){if(this.contentDOM&&this.contentDOM.contains(1==e.nodeType?e:e.parentNode)){if(n<0){let n,s;if(e==this.contentDOM)n=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;n=e.previousSibling}for(;n&&(!(s=n.pmViewDesc)||s.parent!=this);)n=n.previousSibling;return n?this.posBeforeChild(s)+s.size:this.posAtStart}{let n,s;if(e==this.contentDOM)n=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;n=e.nextSibling}for(;n&&(!(s=n.pmViewDesc)||s.parent!=this);)n=n.nextSibling;return n?this.posBeforeChild(s):this.posAtEnd}}let s;if(e==this.dom&&this.contentDOM)s=t>zp(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))s=2&e.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==t)for(let t=e;;t=t.parentNode){if(t==this.dom){s=!1;break}if(t.previousSibling)break}if(null==s&&t==e.childNodes.length)for(let t=e;;t=t.parentNode){if(t==this.dom){s=!0;break}if(t.nextSibling)break}}return(null==s?n>0:s)?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let n=!0,s=e;s;s=s.parentNode){let r,i=this.getDesc(s);if(i&&(!t||i.node)){if(!n||!(r=i.nodeDOM)||(1==r.nodeType?r.contains(1==e.nodeType?e:e.parentNode):r==e))return i;n=!1}}}getDesc(e){let t=e.pmViewDesc;for(let n=t;n;n=n.parent)if(n==this)return t}posFromDOM(e,t,n){for(let s=e;s;s=s.parentNode){let r=this.getDesc(s);if(r)return r.localPosFromDOM(e,t,n)}return-1}descAt(e){for(let t=0,n=0;t<this.children.length;t++){let s=this.children[t],r=n+s.size;if(n==e&&r!=n){for(;!s.border&&s.children.length;)for(let e=0;e<s.children.length;e++){let t=s.children[e];if(t.size){s=t;break}}return s}if(e<r)return s.descAt(e-n-s.border);n=r}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let n=0,s=0;for(let r=0;n<this.children.length;n++){let t=this.children[n],i=r+t.size;if(i>e||t instanceof qm){s=e-r;break}r=i}if(s)return this.children[n].domFromPos(s-this.children[n].border,t);for(let r;n&&!(r=this.children[n-1]).size&&r instanceof zm&&r.side>=0;n--);if(t<=0){let e,s=!0;for(;e=n?this.children[n-1]:null,e&&e.dom.parentNode!=this.contentDOM;n--,s=!1);return e&&t&&s&&!e.border&&!e.domAtom?e.domFromPos(e.size,t):{node:this.contentDOM,offset:e?zp(e.dom)+1:0}}{let e,s=!0;for(;e=n<this.children.length?this.children[n]:null,e&&e.dom.parentNode!=this.contentDOM;n++,s=!1);return e&&s&&!e.border&&!e.domAtom?e.domFromPos(0,t):{node:this.contentDOM,offset:e?zp(e.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,n=0){if(0==this.children.length)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let s=-1,r=-1;for(let i=n,o=0;;o++){let n=this.children[o],a=i+n.size;if(-1==s&&e<=a){let r=i+n.border;if(e>=r&&t<=a-n.border&&n.node&&n.contentDOM&&this.contentDOM.contains(n.contentDOM))return n.parseRange(e,t,r);e=i;for(let t=o;t>0;t--){let n=this.children[t-1];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(1)){s=zp(n.dom)+1;break}e-=n.size}-1==s&&(s=0)}if(s>-1&&(a>t||o==this.children.length-1)){t=a;for(let e=o+1;e<this.children.length;e++){let n=this.children[e];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(-1)){r=zp(n.dom);break}t+=n.size}-1==r&&(r=this.contentDOM.childNodes.length);break}i=a}return{node:this.contentDOM,from:e,to:t,fromOffset:s,toOffset:r}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return 0==t.size||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:n}=this.domFromPos(e,0);if(1!=t.nodeType||n==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[n]}setSelection(e,t,n,s=!1){let r=Math.min(e,t),i=Math.max(e,t);for(let p=0,m=0;p<this.children.length;p++){let o=this.children[p],a=m+o.size;if(r>m&&i<a)return o.setSelection(e-m-o.border,t-m-o.border,n,s);m=a}let o=this.domFromPos(e,e?-1:1),a=t==e?o:this.domFromPos(t,t?-1:1),l=n.root.getSelection(),c=n.domSelectionRange(),d=!1;if((om||dm)&&e==t){let{node:e,offset:t}=o;if(3==e.nodeType){if(d=!(!t||"\n"!=e.nodeValue[t-1]),d&&t==e.nodeValue.length)for(let n,s=e;s;s=s.parentNode){if(n=s.nextSibling){"BR"==n.nodeName&&(o=a={node:n.parentNode,offset:zp(n)+1});break}let e=s.pmViewDesc;if(e&&e.node&&e.node.isBlock)break}}else{let n=e.childNodes[t-1];d=n&&("BR"==n.nodeName||"false"==n.contentEditable)}}if(om&&c.focusNode&&c.focusNode!=a.node&&1==c.focusNode.nodeType){let e=c.focusNode.childNodes[c.focusOffset];e&&"false"==e.contentEditable&&(s=!0)}if(!(s||d&&dm)&&Zp(o.node,o.offset,c.anchorNode,c.anchorOffset)&&Zp(a.node,a.offset,c.focusNode,c.focusOffset))return;let u=!1;if((l.extend||e==t)&&(!d||!om)){l.collapse(o.node,o.offset);try{e!=t&&l.extend(a.node,a.offset),u=!0}catch(h){}}if(!u){if(e>t){let e=o;o=a,a=e}let n=document.createRange();n.setEnd(a.node,a.offset),n.setStart(o.node,o.offset),l.removeAllRanges(),l.addRange(n)}}ignoreMutation(e){return!this.contentDOM&&"selection"!=e.type}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let n=0,s=0;s<this.children.length;s++){let r=this.children[s],i=n+r.size;if(n==i?e<=i&&t>=n:e<i&&t>n){let s=n+r.border,o=i-r.border;if(e>=s&&t<=o)return this.dirty=e==n||t==i?2:1,void(e!=s||t!=o||!r.contentLost&&r.dom.parentNode==this.contentDOM?r.markDirty(e-s,t-s):r.dirty=3);r.dirty=r.dom!=r.contentDOM||r.dom.parentNode!=this.contentDOM||r.children.length?3:2}n=i}this.dirty=2}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let n=1==e?2:1;t.dirty<n&&(t.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class zm extends $m{constructor(e,t,n,s){let r,i=t.type.toDOM;if("function"==typeof i&&(i=i(n,()=>r?r.parent?r.parent.posBeforeChild(r):void 0:s)),!t.type.spec.raw){if(1!=i.nodeType){let e=document.createElement("span");e.appendChild(i),i=e}i.contentEditable="false",i.classList.add("ProseMirror-widget")}super(e,[],i,null),this.widget=t,this.widget=t,r=this}matchesWidget(e){return 0==this.dirty&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return!!t&&t(e)}ignoreMutation(e){return"selection"!=e.type||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class Fm extends $m{constructor(e,t,n,s){super(e,[],t,null),this.textDOM=n,this.text=s}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return"characterData"===e.type&&e.target.nodeValue==e.oldValue}}class Bm extends $m{constructor(e,t,n,s,r){super(e,[],n,s),this.mark=t,this.spec=r}static create(e,t,n,s){let r=s.nodeViews[t.type.name],i=r&&r(t,s,n);return i&&i.dom||(i=Dh.renderSpec(document,t.type.spec.toDOM(t,n),null,t.attrs)),new Bm(e,t,i.dom,i.contentDOM||i.dom,i)}parseRule(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return 3!=this.dirty&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),0!=this.dirty){let e=this.parent;for(;!e.node;)e=e.parent;e.dirty<this.dirty&&(e.dirty=this.dirty),this.dirty=0}}slice(e,t,n){let s=Bm.create(this.parent,this.mark,!0,n),r=this.children,i=this.size;t<i&&(r=af(r,t,i,n)),e>0&&(r=af(r,0,e,n));for(let o=0;o<r.length;o++)r[o].parent=s;return s.children=r,s}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Wm extends $m{constructor(e,t,n,s,r,i,o,a,l){super(e,[],r,i),this.node=t,this.outerDeco=n,this.innerDeco=s,this.nodeDOM=o}static create(e,t,n,s,r,i){let o,a=r.nodeViews[t.type.name],l=a&&a(t,r,()=>o?o.parent?o.parent.posBeforeChild(o):void 0:i,n,s),c=l&&l.dom,d=l&&l.contentDOM;if(t.isText)if(c){if(3!=c.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else c=document.createTextNode(t.text);else if(!c){let e=Dh.renderSpec(document,t.type.spec.toDOM(t),null,t.attrs);({dom:c,contentDOM:d}=e)}d||t.isText||"BR"==c.nodeName||(c.hasAttribute("contenteditable")||(c.contentEditable="false"),t.type.spec.draggable&&(c.draggable=!0));let u=c;return c=tf(c,n,t),l?o=new Jm(e,t,n,s,c,d||null,u,l,r,i+1):t.isText?new Um(e,t,n,s,c,u,r):new Wm(e,t,n,s,c,d||null,u,r,i+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(e.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(let t=this.children.length-1;t>=0;t--){let n=this.children[t];if(this.dom.contains(n.dom.parentNode)){e.contentElement=n.dom.parentNode;break}}e.contentElement||(e.getContent=()=>Lu.empty)}else e.contentElement=this.contentDOM;else e.getContent=()=>this.node.content;return e}matchesNode(e,t,n){return 0==this.dirty&&e.eq(this.node)&&nf(t,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let n=this.node.inlineContent,s=t,r=e.composing?this.localCompositionInfo(e,t):null,i=r&&r.pos>-1?r:null,o=r&&r.pos<0,a=new rf(this,i&&i.node,e);!function(e,t,n,s){let r=t.locals(e),i=0;if(0==r.length){for(let n=0;n<e.childCount;n++){let o=e.child(n);s(o,r,t.forChild(i,o),n),i+=o.nodeSize}return}let o=0,a=[],l=null;for(let c=0;;){let d,u,h,p;for(;o<r.length&&r[o].to==i;){let e=r[o++];e.widget&&(d?(u||(u=[d])).push(e):d=e)}if(d)if(u){u.sort(of);for(let e=0;e<u.length;e++)n(u[e],c,!!l)}else n(d,c,!!l);if(l)p=-1,h=l,l=null;else{if(!(c<e.childCount))break;p=c,h=e.child(c++)}for(let e=0;e<a.length;e++)a[e].to<=i&&a.splice(e--,1);for(;o<r.length&&r[o].from<=i&&r[o].to>i;)a.push(r[o++]);let m=i+h.nodeSize;if(h.isText){let e=m;o<r.length&&r[o].from<e&&(e=r[o].from);for(let t=0;t<a.length;t++)a[t].to<e&&(e=a[t].to);e<m&&(l=h.cut(e-i),h=h.cut(0,e-i),m=e,p=-1)}else for(;o<r.length&&r[o].to<m;)o++;s(h,h.isInline&&!h.isLeaf?a.filter(e=>!e.inline):a.slice(),t.forChild(i,h),p),i=m}}(this.node,this.innerDeco,(t,r,i)=>{t.spec.marks?a.syncToMarks(t.spec.marks,n,e):t.type.side>=0&&!i&&a.syncToMarks(r==this.node.childCount?Pu.none:this.node.child(r).marks,n,e),a.placeWidget(t,e,s)},(t,i,l,c)=>{let d;a.syncToMarks(t.marks,n,e),a.findNodeMatch(t,i,l,c)||o&&e.state.selection.from>s&&e.state.selection.to<s+t.nodeSize&&(d=a.findIndexWithChild(r.node))>-1&&a.updateNodeAt(t,i,l,d,e)||a.updateNextNode(t,i,l,e,c,s)||a.addNode(t,i,l,e,s),s+=t.nodeSize}),a.syncToMarks([],n,e),this.node.isTextblock&&a.addTextblockHacks(),a.destroyRest(),(a.changed||2==this.dirty)&&(i&&this.protectLocalComposition(e,i),Gm(this.contentDOM,this.children,e),um&&function(e){if("UL"==e.nodeName||"OL"==e.nodeName){let t=e.style.cssText;e.style.cssText=t+"; list-style: square !important",window.getComputedStyle(e).listStyle,e.style.cssText=t}}(this.dom))}localCompositionInfo(e,t){let{from:n,to:s}=e.state.selection;if(!(e.state.selection instanceof vp)||n<t||s>t+this.node.content.size)return null;let r=e.input.compositionNode;if(!r||!this.dom.contains(r.parentNode))return null;if(this.node.inlineContent){let e=r.nodeValue,i=function(e,t,n,s){for(let r=0,i=0;r<e.childCount&&i<=s;){let o=e.child(r++),a=i;if(i+=o.nodeSize,!o.isText)continue;let l=o.text;for(;r<e.childCount;){let t=e.child(r++);if(i+=t.nodeSize,!t.isText)break;l+=t.text}if(i>=n){if(i>=s&&l.slice(s-t.length-a,s-a)==t)return s-t.length;let e=a<s?l.lastIndexOf(t,s-a-1):-1;if(e>=0&&e+t.length+a>=n)return a+e;if(n==s&&l.length>=s+t.length-a&&l.slice(s-a,s-a+t.length)==t)return s}}return-1}(this.node.content,e,n-t,s-t);return i<0?null:{node:r,pos:i,text:e}}return{node:r,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:n,text:s}){if(this.getDesc(t))return;let r=t;for(;r.parentNode!=this.contentDOM;r=r.parentNode){for(;r.previousSibling;)r.parentNode.removeChild(r.previousSibling);for(;r.nextSibling;)r.parentNode.removeChild(r.nextSibling);r.pmViewDesc&&(r.pmViewDesc=void 0)}let i=new Fm(this,r,t,s);e.input.compositionNodes.push(i),this.children=af(this.children,n,n+s.length,e,i)}update(e,t,n,s){return!(3==this.dirty||!e.sameMarkup(this.node))&&(this.updateInner(e,t,n,s),!0)}updateInner(e,t,n,s){this.updateOuterDeco(t),this.node=e,this.innerDeco=n,this.contentDOM&&this.updateChildren(s,this.posAtStart),this.dirty=0}updateOuterDeco(e){if(nf(e,this.outerDeco))return;let t=1!=this.nodeDOM.nodeType,n=this.dom;this.dom=Xm(this.dom,this.nodeDOM,Qm(this.outerDeco,this.node,t),Qm(e,this.node,t)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){1==this.nodeDOM.nodeType&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||(this.nodeDOM.draggable=!0))}deselectNode(){1==this.nodeDOM.nodeType&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function Zm(e,t,n,s,r){tf(s,t,e);let i=new Wm(void 0,e,t,n,s,s,s,r,0);return i.contentDOM&&i.updateChildren(r,0),i}class Um extends Wm{constructor(e,t,n,s,r,i,o){super(e,t,n,s,r,null,i,o,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,n,s){return!(3==this.dirty||0!=this.dirty&&!this.inParent()||!e.sameMarkup(this.node))&&(this.updateOuterDeco(t),0==this.dirty&&e.text==this.node.text||e.text==this.nodeDOM.nodeValue||(this.nodeDOM.nodeValue=e.text,s.trackWrites==this.nodeDOM&&(s.trackWrites=null)),this.node=e,this.dirty=0,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,n){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,n)}ignoreMutation(e){return"characterData"!=e.type&&"selection"!=e.type}slice(e,t,n){let s=this.node.cut(e,t),r=document.createTextNode(s.text);return new Um(this.parent,s,this.outerDeco,this.innerDeco,r,r,n)}markDirty(e,t){super.markDirty(e,t),this.dom==this.nodeDOM||0!=e&&t!=this.nodeDOM.nodeValue.length||(this.dirty=3)}get domAtom(){return!1}isText(e){return this.node.text==e}}class qm extends $m{parseRule(){return{ignore:!0}}matchesHack(e){return 0==this.dirty&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return"IMG"==this.dom.nodeName}}class Jm extends Wm{constructor(e,t,n,s,r,i,o,a,l,c){super(e,t,n,s,r,i,o,l,c),this.spec=a}update(e,t,n,s){if(3==this.dirty)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let r=this.spec.update(e,t,n);return r&&this.updateInner(e,t,n,s),r}return!(!this.contentDOM&&!e.isLeaf)&&super.update(e,t,n,s)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,n,s){this.spec.setSelection?this.spec.setSelection(e,t,n.root):super.setSelection(e,t,n,s)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return!!this.spec.stopEvent&&this.spec.stopEvent(e)}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function Gm(e,t,n){let s=e.firstChild,r=!1;for(let i=0;i<t.length;i++){let o=t[i],a=o.dom;if(a.parentNode==e){for(;a!=s;)s=sf(s),r=!0;s=s.nextSibling}else r=!0,e.insertBefore(a,s);if(o instanceof Bm){let t=s?s.previousSibling:e.lastChild;Gm(o.contentDOM,o.children,n),s=t?t.nextSibling:e.firstChild}}for(;s;)s=sf(s),r=!0;r&&n.trackWrites==e&&(n.trackWrites=null)}const Km=function(e){e&&(this.nodeName=e)};Km.prototype=Object.create(null);const Ym=[new Km];function Qm(e,t,n){if(0==e.length)return Ym;let s=n?Ym[0]:new Km,r=[s];for(let i=0;i<e.length;i++){let o=e[i].type.attrs;if(o){o.nodeName&&r.push(s=new Km(o.nodeName));for(let e in o){let i=o[e];null!=i&&(n&&1==r.length&&r.push(s=new Km(t.isInline?"span":"div")),"class"==e?s.class=(s.class?s.class+" ":"")+i:"style"==e?s.style=(s.style?s.style+";":"")+i:"nodeName"!=e&&(s[e]=i))}}}return r}function Xm(e,t,n,s){if(n==Ym&&s==Ym)return t;let r=t;for(let i=0;i<s.length;i++){let t=s[i],o=n[i];if(i){let n;o&&o.nodeName==t.nodeName&&r!=e&&(n=r.parentNode)&&n.nodeName.toLowerCase()==t.nodeName||(n=document.createElement(t.nodeName),n.pmIsDeco=!0,n.appendChild(r),o=Ym[0]),r=n}ef(r,o||Ym[0],t)}return r}function ef(e,t,n){for(let s in t)"class"==s||"style"==s||"nodeName"==s||s in n||e.removeAttribute(s);for(let s in n)"class"!=s&&"style"!=s&&"nodeName"!=s&&n[s]!=t[s]&&e.setAttribute(s,n[s]);if(t.class!=n.class){let s=t.class?t.class.split(" ").filter(Boolean):[],r=n.class?n.class.split(" ").filter(Boolean):[];for(let t=0;t<s.length;t++)-1==r.indexOf(s[t])&&e.classList.remove(s[t]);for(let t=0;t<r.length;t++)-1==s.indexOf(r[t])&&e.classList.add(r[t]);0==e.classList.length&&e.removeAttribute("class")}if(t.style!=n.style){if(t.style){let n,s=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;for(;n=s.exec(t.style);)e.style.removeProperty(n[1])}n.style&&(e.style.cssText+=n.style)}}function tf(e,t,n){return Xm(e,e,Ym,Qm(t,n,1!=e.nodeType))}function nf(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].type.eq(t[n].type))return!1;return!0}function sf(e){let t=e.nextSibling;return e.parentNode.removeChild(e),t}class rf{constructor(e,t,n){this.lock=t,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=function(e,t){let n=t,s=n.children.length,r=e.childCount,i=new Map,o=[];e:for(;r>0;){let a;for(;;)if(s){let e=n.children[s-1];if(!(e instanceof Bm)){a=e,s--;break}n=e,s=e.children.length}else{if(n==t)break e;s=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=e.child(r-1))break;--r,i.set(a,r),o.push(a)}}return{index:r,matched:i,matches:o.reverse()}}(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let n=e;n<t;n++)this.top.children[n].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,n){let s=0,r=this.stack.length>>1,i=Math.min(r,e.length);for(;s<i&&(s==r-1?this.top:this.stack[s+1<<1]).matchesMark(e[s])&&!1!==e[s].type.spec.spanning;)s++;for(;s<r;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),r--;for(;r<e.length;){this.stack.push(this.top,this.index+1);let s=-1;for(let t=this.index;t<Math.min(this.index+3,this.top.children.length);t++){let n=this.top.children[t];if(n.matchesMark(e[r])&&!this.isLocked(n.dom)){s=t;break}}if(s>-1)s>this.index&&(this.changed=!0,this.destroyBetween(this.index,s)),this.top=this.top.children[this.index];else{let s=Bm.create(this.top,e[r],t,n);this.top.children.splice(this.index,0,s),this.top=s,this.changed=!0}this.index=0,r++}}findNodeMatch(e,t,n,s){let r,i=-1;if(s>=this.preMatch.index&&(r=this.preMatch.matches[s-this.preMatch.index]).parent==this.top&&r.matchesNode(e,t,n))i=this.top.children.indexOf(r,this.index);else for(let o=this.index,a=Math.min(this.top.children.length,o+5);o<a;o++){let s=this.top.children[o];if(s.matchesNode(e,t,n)&&!this.preMatch.matched.has(s)){i=o;break}}return!(i<0)&&(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,t,n,s,r){let i=this.top.children[s];return 3==i.dirty&&i.dom==i.contentDOM&&(i.dirty=2),!!i.update(e,t,n,r)&&(this.destroyBetween(this.index,s),this.index++,!0)}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let t=e.pmViewDesc;if(t)for(let e=this.index;e<this.top.children.length;e++)if(this.top.children[e]==t)return e;return-1}e=t}}updateNextNode(e,t,n,s,r,i){for(let o=this.index;o<this.top.children.length;o++){let a=this.top.children[o];if(a instanceof Wm){let l=this.preMatch.matched.get(a);if(null!=l&&l!=r)return!1;let c,d=a.dom,u=this.isLocked(d)&&!(e.isText&&a.node&&a.node.isText&&a.nodeDOM.nodeValue==e.text&&3!=a.dirty&&nf(t,a.outerDeco));if(!u&&a.update(e,t,n,s))return this.destroyBetween(this.index,o),a.dom!=d&&(this.changed=!0),this.index++,!0;if(!u&&(c=this.recreateWrapper(a,e,t,n,s,i)))return this.destroyBetween(this.index,o),this.top.children[this.index]=c,c.contentDOM&&(c.dirty=2,c.updateChildren(s,i+1),c.dirty=0),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,t,n,s,r,i){if(e.dirty||t.isAtom||!e.children.length||!e.node.content.eq(t.content)||!nf(n,e.outerDeco)||!s.eq(e.innerDeco))return null;let o=Wm.create(this.top,t,n,s,r,i);if(o.contentDOM){o.children=e.children,e.children=[];for(let e of o.children)e.parent=o}return e.destroy(),o}addNode(e,t,n,s,r){let i=Wm.create(this.top,e,t,n,s,r);i.contentDOM&&i.updateChildren(s,r+1),this.top.children.splice(this.index++,0,i),this.changed=!0}placeWidget(e,t,n){let s=this.index<this.top.children.length?this.top.children[this.index]:null;if(!s||!s.matchesWidget(e)||e!=s.widget&&s.widget.type.toDOM.parentNode){let s=new zm(this.top,e,t,n);this.top.children.splice(this.index++,0,s),this.changed=!0}else this.index++}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof Bm;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof Um)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((dm||lm)&&e&&"false"==e.dom.contentEditable&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let n=document.createElement(e);"IMG"==e&&(n.className="ProseMirror-separator",n.alt=""),"BR"==e&&(n.className="ProseMirror-trailingBreak");let s=new qm(this.top,[],n,null);t!=this.top?t.children.push(s):t.children.splice(this.index++,0,s),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||1==e.nodeType&&e.contains(this.lock.parentNode))}}function of(e,t){return e.type.side-t.type.side}function af(e,t,n,s,r){let i=[];for(let o=0,a=0;o<e.length;o++){let l=e[o],c=a,d=a+=l.size;c>=n||d<=t?i.push(l):(c<t&&i.push(l.slice(0,t-c,s)),r&&(i.push(r),r=void 0),d>n&&i.push(l.slice(n-c,l.size,s)))}return i}function lf(e,t=null){let n=e.domSelectionRange(),s=e.state.doc;if(!n.focusNode)return null;let r=e.docView.nearestDesc(n.focusNode),i=r&&0==r.size,o=e.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let a,l,c=s.resolve(o);if(Kp(n)){for(a=o;r&&!r.node;)r=r.parent;let e=r.node;if(r&&e.isAtom&&Mp.isSelectable(e)&&r.parent&&(!e.isInline||!function(e,t,n){for(let s=0==t,r=t==Jp(e);s||r;){if(e==n)return!0;let t=zp(e);if(!(e=e.parentNode))return!1;s=s&&0==t,r=r&&t==Jp(e)}}(n.focusNode,n.focusOffset,r.dom))){let e=r.posBefore;l=new Mp(o==e?c:s.resolve(e))}}else{if(n instanceof e.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let t=o,r=o;for(let s=0;s<n.rangeCount;s++){let i=n.getRangeAt(s);t=Math.min(t,e.docView.posFromDOM(i.startContainer,i.startOffset,1)),r=Math.max(r,e.docView.posFromDOM(i.endContainer,i.endOffset,-1))}if(t<0)return null;[a,o]=r==e.state.selection.anchor?[r,t]:[t,r],c=s.resolve(o)}else a=e.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(a<0)return null}let d=s.resolve(a);if(!l){l=yf(e,d,c,"pointer"==t||e.state.selection.head<c.pos&&!i?1:-1)}return l}function cf(e){return e.editable?e.hasFocus():Cf(e)&&document.activeElement&&document.activeElement.contains(e.dom)}function df(e,t=!1){let n=e.state.selection;if(ff(e,n),cf(e)){if(!t&&e.input.mouseDown&&e.input.mouseDown.allowDefault&&lm){let t=e.domSelectionRange(),n=e.domObserver.currentSelection;if(t.anchorNode&&n.anchorNode&&Zp(t.anchorNode,t.anchorOffset,n.anchorNode,n.anchorOffset))return e.input.mouseDown.delayedSelectionSync=!0,void e.domObserver.setCurSelection()}if(e.domObserver.disconnectSelection(),e.cursorWrapper)!function(e){let t=e.domSelection();if(!t)return;let n=e.cursorWrapper.dom,s="IMG"==n.nodeName;s?t.collapse(n.parentNode,zp(n)+1):t.collapse(n,0);!s&&!e.state.selection.visible&&rm&&im<=11&&(n.disabled=!0,n.disabled=!1)}(e);else{let s,r,{anchor:i,head:o}=n;!uf||n instanceof vp||(n.$from.parent.inlineContent||(s=hf(e,n.from)),n.empty||n.$from.parent.inlineContent||(r=hf(e,n.to))),e.docView.setSelection(i,o,e,t),uf&&(s&&mf(s),r&&mf(r)),n.visible?e.dom.classList.remove("ProseMirror-hideselection"):(e.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function(e){let t=e.dom.ownerDocument;t.removeEventListener("selectionchange",e.input.hideSelectionGuard);let n=e.domSelectionRange(),s=n.anchorNode,r=n.anchorOffset;t.addEventListener("selectionchange",e.input.hideSelectionGuard=()=>{n.anchorNode==s&&n.anchorOffset==r||(t.removeEventListener("selectionchange",e.input.hideSelectionGuard),setTimeout(()=>{cf(e)&&!e.state.selection.visible||e.dom.classList.remove("ProseMirror-hideselection")},20))})}(e))}e.domObserver.setCurSelection(),e.domObserver.connectSelection()}}const uf=dm||lm&&cm<63;function hf(e,t){let{node:n,offset:s}=e.docView.domFromPos(t,0),r=s<n.childNodes.length?n.childNodes[s]:null,i=s?n.childNodes[s-1]:null;if(dm&&r&&"false"==r.contentEditable)return pf(r);if(!(r&&"false"!=r.contentEditable||i&&"false"!=i.contentEditable)){if(r)return pf(r);if(i)return pf(i)}}function pf(e){return e.contentEditable="true",dm&&e.draggable&&(e.draggable=!1,e.wasDraggable=!0),e}function mf(e){e.contentEditable="false",e.wasDraggable&&(e.draggable=!0,e.wasDraggable=null)}function ff(e,t){if(t instanceof Mp){let n=e.docView.descAt(t.from);n!=e.lastSelectedViewDesc&&(gf(e),n&&n.selectNode(),e.lastSelectedViewDesc=n)}else gf(e)}function gf(e){e.lastSelectedViewDesc&&(e.lastSelectedViewDesc.parent&&e.lastSelectedViewDesc.deselectNode(),e.lastSelectedViewDesc=void 0)}function yf(e,t,n,s){return e.someProp("createSelectionBetween",s=>s(e,t,n))||vp.between(t,n,s)}function xf(e){return!(e.editable&&!e.hasFocus())&&Cf(e)}function Cf(e){let t=e.domSelectionRange();if(!t.anchorNode)return!1;try{return e.dom.contains(3==t.anchorNode.nodeType?t.anchorNode.parentNode:t.anchorNode)&&(e.editable||e.dom.contains(3==t.focusNode.nodeType?t.focusNode.parentNode:t.focusNode))}catch(n){return!1}}function bf(e,t){let{$anchor:n,$head:s}=e.selection,r=t>0?n.max(s):n.min(s),i=r.parent.inlineContent?r.depth?e.doc.resolve(t>0?r.after():r.before()):null:r;return i&&xp.findFrom(i,t)}function wf(e,t){return e.dispatch(e.state.tr.setSelection(t).scrollIntoView()),!0}function vf(e,t,n){let s=e.state.selection;if(!(s instanceof vp)){if(s instanceof Mp&&s.node.isInline)return wf(e,new vp(t>0?s.$to:s.$from));{let n=bf(e.state,t);return!!n&&wf(e,n)}}if(n.indexOf("s")>-1){let{$head:n}=s,r=n.textOffset?null:t<0?n.nodeBefore:n.nodeAfter;if(!r||r.isText||!r.isLeaf)return!1;let i=e.state.doc.resolve(n.pos+r.nodeSize*(t<0?-1:1));return wf(e,new vp(s.$anchor,i))}if(!s.empty)return!1;if(e.endOfTextblock(t>0?"forward":"backward")){let n=bf(e.state,t);return!!(n&&n instanceof Mp)&&wf(e,n)}if(!(hm&&n.indexOf("m")>-1)){let n,r=s.$head,i=r.textOffset?null:t<0?r.nodeBefore:r.nodeAfter;if(!i||i.isText)return!1;let o=t<0?r.pos-i.nodeSize:r.pos;return!!(i.isAtom||(n=e.docView.descAt(o))&&!n.contentDOM)&&(Mp.isSelectable(i)?wf(e,new Mp(t<0?e.state.doc.resolve(r.pos-i.nodeSize):r)):!!fm&&wf(e,new vp(e.state.doc.resolve(t<0?o:o+i.nodeSize))))}}function kf(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function Mf(e,t){let n=e.pmViewDesc;return n&&0==n.size&&(t<0||e.nextSibling||"BR"!=e.nodeName)}function Sf(e,t){return t<0?function(e){let t=e.domSelectionRange(),n=t.focusNode,s=t.focusOffset;if(!n)return;let r,i,o=!1;om&&1==n.nodeType&&s<kf(n)&&Mf(n.childNodes[s],-1)&&(o=!0);for(;;)if(s>0){if(1!=n.nodeType)break;{let e=n.childNodes[s-1];if(Mf(e,-1))r=n,i=--s;else{if(3!=e.nodeType)break;n=e,s=n.nodeValue.length}}}else{if(Nf(n))break;{let t=n.previousSibling;for(;t&&Mf(t,-1);)r=n.parentNode,i=zp(t),t=t.previousSibling;if(t)n=t,s=kf(n);else{if(n=n.parentNode,n==e.dom)break;s=0}}}o?Tf(e,n,s):r&&Tf(e,r,i)}(e):function(e){let t=e.domSelectionRange(),n=t.focusNode,s=t.focusOffset;if(!n)return;let r,i,o=kf(n);for(;;)if(s<o){if(1!=n.nodeType)break;if(!Mf(n.childNodes[s],1))break;r=n,i=++s}else{if(Nf(n))break;{let t=n.nextSibling;for(;t&&Mf(t,1);)r=t.parentNode,i=zp(t)+1,t=t.nextSibling;if(t)n=t,s=0,o=kf(n);else{if(n=n.parentNode,n==e.dom)break;s=o=0}}}r&&Tf(e,r,i)}(e)}function Nf(e){let t=e.pmViewDesc;return t&&t.node&&t.node.isBlock}function Tf(e,t,n){if(3!=t.nodeType){let e,s;(s=function(e,t){for(;e&&t==e.childNodes.length&&!Gp(e);)t=zp(e)+1,e=e.parentNode;for(;e&&t<e.childNodes.length;){let n=e.childNodes[t];if(3==n.nodeType)return n;if(1==n.nodeType&&"false"==n.contentEditable)break;e=n,t=0}}(t,n))?(t=s,n=0):(e=function(e,t){for(;e&&!t&&!Gp(e);)t=zp(e),e=e.parentNode;for(;e&&t;){let n=e.childNodes[t-1];if(3==n.nodeType)return n;if(1==n.nodeType&&"false"==n.contentEditable)break;t=(e=n).childNodes.length}}(t,n))&&(t=e,n=e.nodeValue.length)}let s=e.domSelection();if(!s)return;if(Kp(s)){let e=document.createRange();e.setEnd(t,n),e.setStart(t,n),s.removeAllRanges(),s.addRange(e)}else s.extend&&s.extend(t,n);e.domObserver.setCurSelection();let{state:r}=e;setTimeout(()=>{e.state==r&&df(e)},50)}function Ef(e,t){let n=e.state.doc.resolve(t);if(!lm&&!pm&&n.parent.inlineContent){let s=e.coordsAtPos(t);if(t>n.start()){let n=e.coordsAtPos(t-1),r=(n.top+n.bottom)/2;if(r>s.top&&r<s.bottom&&Math.abs(n.left-s.left)>1)return n.left<s.left?"ltr":"rtl"}if(t<n.end()){let n=e.coordsAtPos(t+1),r=(n.top+n.bottom)/2;if(r>s.top&&r<s.bottom&&Math.abs(n.left-s.left)>1)return n.left>s.left?"ltr":"rtl"}}return"rtl"==getComputedStyle(e.dom).direction?"rtl":"ltr"}function jf(e,t,n){let s=e.state.selection;if(s instanceof vp&&!s.empty||n.indexOf("s")>-1)return!1;if(hm&&n.indexOf("m")>-1)return!1;let{$from:r,$to:i}=s;if(!r.parent.inlineContent||e.endOfTextblock(t<0?"up":"down")){let n=bf(e.state,t);if(n&&n instanceof Mp)return wf(e,n)}if(!r.parent.inlineContent){let n=t<0?r:i,o=s instanceof Np?xp.near(n,t):xp.findFrom(n,t);return!!o&&wf(e,o)}return!1}function Af(e,t){if(!(e.state.selection instanceof vp))return!0;let{$head:n,$anchor:s,empty:r}=e.state.selection;if(!n.sameParent(s))return!0;if(!r)return!1;if(e.endOfTextblock(t>0?"forward":"backward"))return!0;let i=!n.textOffset&&(t<0?n.nodeBefore:n.nodeAfter);if(i&&!i.isText){let s=e.state.tr;return t<0?s.delete(n.pos-i.nodeSize,n.pos):s.delete(n.pos,n.pos+i.nodeSize),e.dispatch(s),!0}return!1}function If(e,t,n){e.domObserver.stop(),t.contentEditable=n,e.domObserver.start()}function Of(e,t){let n=t.keyCode,s=function(e){let t="";return e.ctrlKey&&(t+="c"),e.metaKey&&(t+="m"),e.altKey&&(t+="a"),e.shiftKey&&(t+="s"),t}(t);if(8==n||hm&&72==n&&"c"==s)return Af(e,-1)||Sf(e,-1);if(46==n&&!t.shiftKey||hm&&68==n&&"c"==s)return Af(e,1)||Sf(e,1);if(13==n||27==n)return!0;if(37==n||hm&&66==n&&"c"==s){let t=37==n?"ltr"==Ef(e,e.state.selection.from)?-1:1:-1;return vf(e,t,s)||Sf(e,t)}if(39==n||hm&&70==n&&"c"==s){let t=39==n?"ltr"==Ef(e,e.state.selection.from)?1:-1:1;return vf(e,t,s)||Sf(e,t)}return 38==n||hm&&80==n&&"c"==s?jf(e,-1,s)||Sf(e,-1):40==n||hm&&78==n&&"c"==s?function(e){if(!dm||e.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:n}=e.domSelectionRange();if(t&&1==t.nodeType&&0==n&&t.firstChild&&"false"==t.firstChild.contentEditable){let n=t.firstChild;If(e,n,"true"),setTimeout(()=>If(e,n,"false"),20)}return!1}(e)||jf(e,1,s)||Sf(e,1):s==(hm?"m":"c")&&(66==n||73==n||89==n||90==n)}function Lf(e,t){e.someProp("transformCopied",n=>{t=n(t,e)});let n=[],{content:s,openStart:r,openEnd:i}=t;for(;r>1&&i>1&&1==s.childCount&&1==s.firstChild.childCount;){r--,i--;let e=s.firstChild;n.push(e.type.name,e.attrs!=e.type.defaultAttrs?e.attrs:null),s=e.content}let o=e.someProp("clipboardSerializer")||Dh.fromSchema(e.state.schema),a=Bf(),l=a.createElement("div");l.appendChild(o.serializeFragment(s,{document:a}));let c,d=l.firstChild,u=0;for(;d&&1==d.nodeType&&(c=zf[d.nodeName.toLowerCase()]);){for(let e=c.length-1;e>=0;e--){let t=a.createElement(c[e]);for(;l.firstChild;)t.appendChild(l.firstChild);l.appendChild(t),u++}d=l.firstChild}return d&&1==d.nodeType&&d.setAttribute("data-pm-slice",`${r} ${i}${u?` -${u}`:""} ${JSON.stringify(n)}`),{dom:l,text:e.someProp("clipboardTextSerializer",n=>n(t,e))||t.content.textBetween(0,t.content.size,"\n\n"),slice:t}}function Df(e,t,n,s,r){let i,o,a=r.parent.type.spec.code;if(!n&&!t)return null;let l=!!t&&(s||a||!n);if(l){if(e.someProp("transformPastedText",n=>{t=n(t,a||s,e)}),a)return o=new Hu(Lu.from(e.state.schema.text(t.replace(/\r\n?/g,"\n"))),0,0),e.someProp("transformPasted",t=>{o=t(o,e,!0)}),o;let n=e.someProp("clipboardTextParser",n=>n(t,r,s,e));if(n)o=n;else{let n=r.marks(),{schema:s}=e.state,o=Dh.fromSchema(s);i=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach(e=>{let t=i.appendChild(document.createElement("p"));e&&t.appendChild(o.serializeNode(s.text(e,n)))})}}else e.someProp("transformPastedHTML",t=>{n=t(n,e)}),i=function(e){let t=/^(\s*<meta [^>]*>)*/.exec(e);t&&(e=e.slice(t[0].length));let n,s=Bf().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(e);(n=r&&zf[r[1].toLowerCase()])&&(e=n.map(e=>"<"+e+">").join("")+e+n.map(e=>"</"+e+">").reverse().join(""));if(s.innerHTML=function(e){let t=window.trustedTypes;if(!t)return e;Wf||(Wf=t.defaultPolicy||t.createPolicy("ProseMirrorClipboard",{createHTML:e=>e}));return Wf.createHTML(e)}(e),n)for(let i=0;i<n.length;i++)s=s.querySelector(n[i])||s;return s}(n),fm&&function(e){let t=e.querySelectorAll(lm?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<t.length;n++){let s=t[n];1==s.childNodes.length&&" "==s.textContent&&s.parentNode&&s.parentNode.replaceChild(e.ownerDocument.createTextNode(" "),s)}}(i);let c=i&&i.querySelector("[data-pm-slice]"),d=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(d&&d[3])for(let u=+d[3];u>0;u--){let e=i.firstChild;for(;e&&1!=e.nodeType;)e=e.nextSibling;if(!e)break;i=e}if(!o){let t=e.someProp("clipboardParser")||e.someProp("domParser")||Mh.fromSchema(e.state.schema);o=t.parseSlice(i,{preserveWhitespace:!(!l&&!d),context:r,ruleFromNode:e=>"BR"!=e.nodeName||e.nextSibling||!e.parentNode||Rf.test(e.parentNode.nodeName)?null:{ignore:!0}})}if(d)o=function(e,t){if(!e.size)return e;let n,s=e.content.firstChild.type.schema;try{n=JSON.parse(t)}catch(a){return e}let{content:r,openStart:i,openEnd:o}=e;for(let l=n.length-2;l>=0;l-=2){let e=s.nodes[n[l]];if(!e||e.hasRequiredAttrs())break;r=Lu.from(e.create(n[l+1],r)),i++,o++}return new Hu(r,i,o)}($f(o,+d[1],+d[2]),d[4]);else if(o=Hu.maxOpen(function(e,t){if(e.childCount<2)return e;for(let n=t.depth;n>=0;n--){let s,r=t.node(n).contentMatchAt(t.index(n)),i=[];if(e.forEach(e=>{if(!i)return;let t,n=r.findWrapping(e.type);if(!n)return i=null;if(t=i.length&&s.length&&Pf(n,s,e,i[i.length-1],0))i[i.length-1]=t;else{i.length&&(i[i.length-1]=Vf(i[i.length-1],s.length));let t=_f(e,n);i.push(t),r=r.matchType(t.type),s=n}}),i)return Lu.from(i)}return e}(o.content,r),!0),o.openStart||o.openEnd){let e=0,t=0;for(let n=o.content.firstChild;e<o.openStart&&!n.type.spec.isolating;e++,n=n.firstChild);for(let n=o.content.lastChild;t<o.openEnd&&!n.type.spec.isolating;t++,n=n.lastChild);o=$f(o,e,t)}return e.someProp("transformPasted",t=>{o=t(o,e,l)}),o}const Rf=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function _f(e,t,n=0){for(let s=t.length-1;s>=n;s--)e=t[s].create(null,Lu.from(e));return e}function Pf(e,t,n,s,r){if(r<e.length&&r<t.length&&e[r]==t[r]){let i=Pf(e,t,n,s.lastChild,r+1);if(i)return s.copy(s.content.replaceChild(s.childCount-1,i));if(s.contentMatchAt(s.childCount).matchType(r==e.length-1?n.type:e[r+1]))return s.copy(s.content.append(Lu.from(_f(n,e,r+1))))}}function Vf(e,t){if(0==t)return e;let n=e.content.replaceChild(e.childCount-1,Vf(e.lastChild,t-1)),s=e.contentMatchAt(e.childCount).fillBefore(Lu.empty,!0);return e.copy(n.append(s))}function Hf(e,t,n,s,r,i){let o=t<0?e.firstChild:e.lastChild,a=o.content;return e.childCount>1&&(i=0),r<s-1&&(a=Hf(a,t,n,s,r+1,i)),r>=n&&(a=t<0?o.contentMatchAt(0).fillBefore(a,i<=r).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(Lu.empty,!0))),e.replaceChild(t<0?0:e.childCount-1,o.copy(a))}function $f(e,t,n){return t<e.openStart&&(e=new Hu(Hf(e.content,-1,t,e.openStart,0,e.openEnd),t,e.openEnd)),n<e.openEnd&&(e=new Hu(Hf(e.content,1,n,e.openEnd,0,0),e.openStart,n)),e}const zf={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Ff=null;function Bf(){return Ff||(Ff=document.implementation.createHTMLDocument("title"))}let Wf=null;const Zf={},Uf={},qf={touchstart:!0,touchmove:!0};class Jf{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function Gf(e,t){e.input.lastSelectionOrigin=t,e.input.lastSelectionTime=Date.now()}function Kf(e){e.someProp("handleDOMEvents",t=>{for(let n in t)e.input.eventHandlers[n]||e.dom.addEventListener(n,e.input.eventHandlers[n]=t=>Yf(e,t))})}function Yf(e,t){return e.someProp("handleDOMEvents",n=>{let s=n[t.type];return!!s&&(s(e,t)||t.defaultPrevented)})}function Qf(e,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let n=t.target;n!=e.dom;n=n.parentNode)if(!n||11==n.nodeType||n.pmViewDesc&&n.pmViewDesc.stopEvent(t))return!1;return!0}function Xf(e){return{left:e.clientX,top:e.clientY}}function eg(e,t,n,s,r){if(-1==s)return!1;let i=e.state.doc.resolve(s);for(let o=i.depth+1;o>0;o--)if(e.someProp(t,t=>o>i.depth?t(e,n,i.nodeAfter,i.before(o),r,!0):t(e,n,i.node(o),i.before(o),r,!1)))return!0;return!1}function tg(e,t,n){if(e.focused||e.focus(),e.state.selection.eq(t))return;let s=e.state.tr.setSelection(t);s.setMeta("pointer",!0),e.dispatch(s)}function ng(e,t,n,s,r){return eg(e,"handleClickOn",t,n,s)||e.someProp("handleClick",n=>n(e,t,s))||(r?function(e,t){if(-1==t)return!1;let n,s,r=e.state.selection;r instanceof Mp&&(n=r.node);let i=e.state.doc.resolve(t);for(let o=i.depth+1;o>0;o--){let e=o>i.depth?i.nodeAfter:i.node(o);if(Mp.isSelectable(e)){s=n&&r.$from.depth>0&&o>=r.$from.depth&&i.before(r.$from.depth+1)==r.$from.pos?i.before(r.$from.depth):i.before(o);break}}return null!=s&&(tg(e,Mp.create(e.state.doc,s)),!0)}(e,n):function(e,t){if(-1==t)return!1;let n=e.state.doc.resolve(t),s=n.nodeAfter;return!!(s&&s.isAtom&&Mp.isSelectable(s))&&(tg(e,new Mp(n)),!0)}(e,n))}function sg(e,t,n,s){return eg(e,"handleDoubleClickOn",t,n,s)||e.someProp("handleDoubleClick",n=>n(e,t,s))}function rg(e,t,n,s){return eg(e,"handleTripleClickOn",t,n,s)||e.someProp("handleTripleClick",n=>n(e,t,s))||function(e,t,n){if(0!=n.button)return!1;let s=e.state.doc;if(-1==t)return!!s.inlineContent&&(tg(e,vp.create(s,0,s.content.size)),!0);let r=s.resolve(t);for(let i=r.depth+1;i>0;i--){let t=i>r.depth?r.nodeAfter:r.node(i),n=r.before(i);if(t.inlineContent)tg(e,vp.create(s,n+1,n+1+t.content.size));else{if(!Mp.isSelectable(t))continue;tg(e,Mp.create(s,n))}return!0}}(e,n,s)}function ig(e){return pg(e)}Uf.keydown=(e,t)=>{let n=t;if(e.input.shiftKey=16==n.keyCode||n.shiftKey,!lg(e,n)&&(e.input.lastKeyCode=n.keyCode,e.input.lastKeyCodeTime=Date.now(),!mm||!lm||13!=n.keyCode))if(229!=n.keyCode&&e.domObserver.forceFlush(),!um||13!=n.keyCode||n.ctrlKey||n.altKey||n.metaKey)e.someProp("handleKeyDown",t=>t(e,n))||Of(e,n)?n.preventDefault():Gf(e,"key");else{let t=Date.now();e.input.lastIOSEnter=t,e.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{e.input.lastIOSEnter==t&&(e.someProp("handleKeyDown",t=>t(e,Yp(13,"Enter"))),e.input.lastIOSEnter=0)},200)}},Uf.keyup=(e,t)=>{16==t.keyCode&&(e.input.shiftKey=!1)},Uf.keypress=(e,t)=>{let n=t;if(lg(e,n)||!n.charCode||n.ctrlKey&&!n.altKey||hm&&n.metaKey)return;if(e.someProp("handleKeyPress",t=>t(e,n)))return void n.preventDefault();let s=e.state.selection;if(!(s instanceof vp&&s.$from.sameParent(s.$to))){let t=String.fromCharCode(n.charCode),r=()=>e.state.tr.insertText(t).scrollIntoView();/[\r\n]/.test(t)||e.someProp("handleTextInput",n=>n(e,s.$from.pos,s.$to.pos,t,r))||e.dispatch(r()),n.preventDefault()}};const og=hm?"metaKey":"ctrlKey";Zf.mousedown=(e,t)=>{let n=t;e.input.shiftKey=n.shiftKey;let s=ig(e),r=Date.now(),i="singleClick";r-e.input.lastClick.time<500&&function(e,t){let n=t.x-e.clientX,s=t.y-e.clientY;return n*n+s*s<100}(n,e.input.lastClick)&&!n[og]&&e.input.lastClick.button==n.button&&("singleClick"==e.input.lastClick.type?i="doubleClick":"doubleClick"==e.input.lastClick.type&&(i="tripleClick")),e.input.lastClick={time:r,x:n.clientX,y:n.clientY,type:i,button:n.button};let o=e.posAtCoords(Xf(n));o&&("singleClick"==i?(e.input.mouseDown&&e.input.mouseDown.done(),e.input.mouseDown=new ag(e,o,n,!!s)):("doubleClick"==i?sg:rg)(e,o.pos,o.inside,n)?n.preventDefault():Gf(e,"pointer"))};class ag{constructor(e,t,n,s){let r,i;if(this.view=e,this.pos=t,this.event=n,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!n[og],this.allowDefault=n.shiftKey,t.inside>-1)r=e.state.doc.nodeAt(t.inside),i=t.inside;else{let n=e.state.doc.resolve(t.pos);r=n.parent,i=n.depth?n.before():0}const o=s?null:n.target,a=o?e.docView.nearestDesc(o,!0):null;this.target=a&&1==a.nodeDOM.nodeType?a.nodeDOM:null;let{selection:l}=e.state;(0==n.button&&r.type.spec.draggable&&!1!==r.type.spec.selectable||l instanceof Mp&&l.from<=i&&l.to>i)&&(this.mightDrag={node:r,pos:i,addAttr:!(!this.target||this.target.draggable),setUneditable:!(!this.target||!om||this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Gf(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>df(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(Xf(e))),this.updateAllowDefault(e),this.allowDefault||!t?Gf(this.view,"pointer"):ng(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():0==e.button&&(this.flushed||dm&&this.mightDrag&&!this.mightDrag.node.isAtom||lm&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(tg(this.view,xp.near(this.view.state.doc.resolve(t.pos))),e.preventDefault()):Gf(this.view,"pointer")}move(e){this.updateAllowDefault(e),Gf(this.view,"pointer"),0==e.buttons&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}function lg(e,t){return!!e.composing||!!(dm&&Math.abs(t.timeStamp-e.input.compositionEndedAt)<500)&&(e.input.compositionEndedAt=-2e8,!0)}Zf.touchstart=e=>{e.input.lastTouch=Date.now(),ig(e),Gf(e,"pointer")},Zf.touchmove=e=>{e.input.lastTouch=Date.now(),Gf(e,"pointer")},Zf.contextmenu=e=>ig(e);const cg=mm?5e3:-1;function dg(e,t){clearTimeout(e.input.composingTimeout),t>-1&&(e.input.composingTimeout=setTimeout(()=>pg(e),t))}function ug(e){for(e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=function(){let e=document.createEvent("Event");return e.initEvent("event",!0,!0),e.timeStamp}());e.input.compositionNodes.length>0;)e.input.compositionNodes.pop().markParentsDirty()}function hg(e){let t=e.domSelectionRange();if(!t.focusNode)return null;let n=function(e,t){for(;;){if(3==e.nodeType&&t)return e;if(1==e.nodeType&&t>0){if("false"==e.contentEditable)return null;t=Jp(e=e.childNodes[t-1])}else{if(!e.parentNode||Gp(e))return null;t=zp(e),e=e.parentNode}}}(t.focusNode,t.focusOffset),s=function(e,t){for(;;){if(3==e.nodeType&&t<e.nodeValue.length)return e;if(1==e.nodeType&&t<e.childNodes.length){if("false"==e.contentEditable)return null;e=e.childNodes[t],t=0}else{if(!e.parentNode||Gp(e))return null;t=zp(e)+1,e=e.parentNode}}}(t.focusNode,t.focusOffset);if(n&&s&&n!=s){let t=s.pmViewDesc,r=e.domObserver.lastChangedTextNode;if(n==r||s==r)return r;if(!t||!t.isText(s.nodeValue))return s;if(e.input.compositionNode==s){let e=n.pmViewDesc;if(e&&e.isText(n.nodeValue))return s}}return n||s}function pg(e,t=!1){if(!(mm&&e.domObserver.flushingSoon>=0)){if(e.domObserver.forceFlush(),ug(e),t||e.docView&&e.docView.dirty){let n=lf(e),s=e.state.selection;return n&&!n.eq(s)?e.dispatch(e.state.tr.setSelection(n)):!e.markCursor&&!t||s.$from.node(s.$from.sharedDepth(s.to)).inlineContent?e.updateState(e.state):e.dispatch(e.state.tr.deleteSelection()),!0}return!1}}Uf.compositionstart=Uf.compositionupdate=e=>{if(!e.composing){e.domObserver.flush();let{state:t}=e,n=t.selection.$to;if(t.selection instanceof vp&&(t.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(e=>!1===e.type.spec.inclusive)))e.markCursor=e.state.storedMarks||n.marks(),pg(e,!0),e.markCursor=null;else if(pg(e,!t.selection.empty),om&&t.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let t=e.domSelectionRange();for(let n=t.focusNode,s=t.focusOffset;n&&1==n.nodeType&&0!=s;){let t=s<0?n.lastChild:n.childNodes[s-1];if(!t)break;if(3==t.nodeType){let n=e.domSelection();n&&n.collapse(t,t.nodeValue.length);break}n=t,s=-1}}e.input.composing=!0}dg(e,cg)},Uf.compositionend=(e,t)=>{e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=t.timeStamp,e.input.compositionPendingChanges=e.domObserver.pendingRecords().length?e.input.compositionID:0,e.input.compositionNode=null,e.input.compositionPendingChanges&&Promise.resolve().then(()=>e.domObserver.flush()),e.input.compositionID++,dg(e,20))};const mg=rm&&im<15||um&&gm<604;function fg(e,t,n,s,r){let i=Df(e,t,n,s,e.state.selection.$from);if(e.someProp("handlePaste",t=>t(e,r,i||Hu.empty)))return!0;if(!i)return!1;let o=function(e){return 0==e.openStart&&0==e.openEnd&&1==e.content.childCount?e.content.firstChild:null}(i),a=o?e.state.tr.replaceSelectionWith(o,s):e.state.tr.replaceSelection(i);return e.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function gg(e){let t=e.getData("text/plain")||e.getData("Text");if(t)return t;let n=e.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}Zf.copy=Uf.cut=(e,t)=>{let n=t,s=e.state.selection,r="cut"==n.type;if(s.empty)return;let i=mg?null:n.clipboardData,o=s.content(),{dom:a,text:l}=Lf(e,o);i?(n.preventDefault(),i.clearData(),i.setData("text/html",a.innerHTML),i.setData("text/plain",l)):function(e,t){if(!e.dom.parentNode)return;let n=e.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(t),n.style.cssText="position: fixed; left: -10000px; top: 10px";let s=getSelection(),r=document.createRange();r.selectNodeContents(t),e.dom.blur(),s.removeAllRanges(),s.addRange(r),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),e.focus()},50)}(e,a),r&&e.dispatch(e.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},Uf.paste=(e,t)=>{let n=t;if(e.composing&&!mm)return;let s=mg?null:n.clipboardData,r=e.input.shiftKey&&45!=e.input.lastKeyCode;s&&fg(e,gg(s),s.getData("text/html"),r,n)?n.preventDefault():function(e,t){if(!e.dom.parentNode)return;let n=e.input.shiftKey||e.state.selection.$from.parent.type.spec.code,s=e.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(s.contentEditable="true"),s.style.cssText="position: fixed; left: -10000px; top: 10px",s.focus();let r=e.input.shiftKey&&45!=e.input.lastKeyCode;setTimeout(()=>{e.focus(),s.parentNode&&s.parentNode.removeChild(s),n?fg(e,s.value,null,r,t):fg(e,s.textContent,s.innerHTML,r,t)},50)}(e,n)};class yg{constructor(e,t,n){this.slice=e,this.move=t,this.node=n}}const xg=hm?"altKey":"ctrlKey";function Cg(e,t){let n=e.someProp("dragCopies",e=>!e(t));return null!=n?n:!t[xg]}Zf.dragstart=(e,t)=>{let n=t,s=e.input.mouseDown;if(s&&s.done(),!n.dataTransfer)return;let r,i=e.state.selection,o=i.empty?null:e.posAtCoords(Xf(n));if(o&&o.pos>=i.from&&o.pos<=(i instanceof Mp?i.to-1:i.to));else if(s&&s.mightDrag)r=Mp.create(e.state.doc,s.mightDrag.pos);else if(n.target&&1==n.target.nodeType){let t=e.docView.nearestDesc(n.target,!0);t&&t.node.type.spec.draggable&&t!=e.docView&&(r=Mp.create(e.state.doc,t.posBefore))}let a=(r||e.state.selection).content(),{dom:l,text:c,slice:d}=Lf(e,a);(!n.dataTransfer.files.length||!lm||cm>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(mg?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",mg||n.dataTransfer.setData("text/plain",c),e.dragging=new yg(d,Cg(e,n),r)},Zf.dragend=e=>{let t=e.dragging;window.setTimeout(()=>{e.dragging==t&&(e.dragging=null)},50)},Uf.dragover=Uf.dragenter=(e,t)=>t.preventDefault(),Uf.drop=(e,t)=>{let n=t,s=e.dragging;if(e.dragging=null,!n.dataTransfer)return;let r=e.posAtCoords(Xf(n));if(!r)return;let i=e.state.doc.resolve(r.pos),o=s&&s.slice;o?e.someProp("transformPasted",t=>{o=t(o,e,!1)}):o=Df(e,gg(n.dataTransfer),mg?null:n.dataTransfer.getData("text/html"),!1,i);let a=!(!s||!Cg(e,n));if(e.someProp("handleDrop",t=>t(e,n,o||Hu.empty,a)))return void n.preventDefault();if(!o)return;n.preventDefault();let l=o?sp(e.state.doc,i.pos,o):i.pos;null==l&&(l=i.pos);let c=e.state.tr;if(a){let{node:e}=s;e?e.replace(c):c.deleteSelection()}let d=c.mapping.map(l),u=0==o.openStart&&0==o.openEnd&&1==o.content.childCount,h=c.doc;if(u?c.replaceRangeWith(d,d,o.content.firstChild):c.replaceRange(d,d,o),c.doc.eq(h))return;let p=c.doc.resolve(d);if(u&&Mp.isSelectable(o.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(o.content.firstChild))c.setSelection(new Mp(p));else{let t=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach((e,n,s,r)=>t=r),c.setSelection(yf(e,p,c.doc.resolve(t)))}e.focus(),e.dispatch(c.setMeta("uiEvent","drop"))},Zf.focus=e=>{e.input.lastFocus=Date.now(),e.focused||(e.domObserver.stop(),e.dom.classList.add("ProseMirror-focused"),e.domObserver.start(),e.focused=!0,setTimeout(()=>{e.docView&&e.hasFocus()&&!e.domObserver.currentSelection.eq(e.domSelectionRange())&&df(e)},20))},Zf.blur=(e,t)=>{let n=t;e.focused&&(e.domObserver.stop(),e.dom.classList.remove("ProseMirror-focused"),e.domObserver.start(),n.relatedTarget&&e.dom.contains(n.relatedTarget)&&e.domObserver.currentSelection.clear(),e.focused=!1)},Zf.beforeinput=(e,t)=>{if(lm&&mm&&"deleteContentBackward"==t.inputType){e.domObserver.flushSoon();let{domChangeCount:t}=e.input;setTimeout(()=>{if(e.input.domChangeCount!=t)return;if(e.dom.blur(),e.focus(),e.someProp("handleKeyDown",t=>t(e,Yp(8,"Backspace"))))return;let{$cursor:n}=e.state.selection;n&&n.pos>0&&e.dispatch(e.state.tr.delete(n.pos-1,n.pos).scrollIntoView())},50)}};for(let os in Uf)Zf[os]=Uf[os];function bg(e,t){if(e==t)return!0;for(let n in e)if(e[n]!==t[n])return!1;for(let n in t)if(!(n in e))return!1;return!0}class wg{constructor(e,t){this.toDOM=e,this.spec=t||Ng,this.side=this.spec.side||0}map(e,t,n,s){let{pos:r,deleted:i}=e.mapResult(t.from+s,this.side<0?-1:1);return i?null:new Mg(r-n,r-n,this)}valid(){return!0}eq(e){return this==e||e instanceof wg&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&bg(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class vg{constructor(e,t){this.attrs=e,this.spec=t||Ng}map(e,t,n,s){let r=e.map(t.from+s,this.spec.inclusiveStart?-1:1)-n,i=e.map(t.to+s,this.spec.inclusiveEnd?1:-1)-n;return r>=i?null:new Mg(r,i,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof vg&&bg(this.attrs,e.attrs)&&bg(this.spec,e.spec)}static is(e){return e.type instanceof vg}destroy(){}}class kg{constructor(e,t){this.attrs=e,this.spec=t||Ng}map(e,t,n,s){let r=e.mapResult(t.from+s,1);if(r.deleted)return null;let i=e.mapResult(t.to+s,-1);return i.deleted||i.pos<=r.pos?null:new Mg(r.pos-n,i.pos-n,this)}valid(e,t){let n,{index:s,offset:r}=e.content.findIndex(t.from);return r==t.from&&!(n=e.child(s)).isText&&r+n.nodeSize==t.to}eq(e){return this==e||e instanceof kg&&bg(this.attrs,e.attrs)&&bg(this.spec,e.spec)}destroy(){}}class Mg{constructor(e,t,n){this.from=e,this.to=t,this.type=n}copy(e,t){return new Mg(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,n){return this.type.map(e,this,t,n)}static widget(e,t,n){return new Mg(e,e,new wg(t,n))}static inline(e,t,n,s){return new Mg(e,t,new vg(n,s))}static node(e,t,n,s){return new Mg(e,t,new kg(n,s))}get spec(){return this.type.spec}get inline(){return this.type instanceof vg}get widget(){return this.type instanceof wg}}const Sg=[],Ng={};class Tg{constructor(e,t){this.local=e.length?e:Sg,this.children=t.length?t:Sg}static create(e,t){return t.length?Lg(t,e,0,Ng):Eg}find(e,t,n){let s=[];return this.findInner(null==e?0:e,null==t?1e9:t,s,0,n),s}findInner(e,t,n,s,r){for(let i=0;i<this.local.length;i++){let o=this.local[i];o.from<=t&&o.to>=e&&(!r||r(o.spec))&&n.push(o.copy(o.from+s,o.to+s))}for(let i=0;i<this.children.length;i+=3)if(this.children[i]<t&&this.children[i+1]>e){let o=this.children[i]+1;this.children[i+2].findInner(e-o,t-o,n,s+o,r)}}map(e,t,n){return this==Eg||0==e.maps.length?this:this.mapInner(e,t,0,0,n||Ng)}mapInner(e,t,n,s,r){let i;for(let o=0;o<this.local.length;o++){let a=this.local[o].map(e,n,s);a&&a.type.valid(t,a)?(i||(i=[])).push(a):r.onRemove&&r.onRemove(this.local[o].spec)}return this.children.length?function(e,t,n,s,r,i,o){let a=e.slice();for(let c=0,d=i;c<n.maps.length;c++){let e=0;n.maps[c].forEach((t,n,s,r)=>{let i=r-s-(n-t);for(let o=0;o<a.length;o+=3){let s=a[o+1];if(s<0||t>s+d-e)continue;let r=a[o]+d-e;n>=r?a[o+1]=t<=r?-2:-1:t>=d&&i&&(a[o]+=i,a[o+1]+=i)}e+=i}),d=n.maps[c].map(d,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(-2==a[c+1]){l=!0,a[c+1]=-1;continue}let t=n.map(e[c]+i),d=t-r;if(d<0||d>=s.content.size){l=!0;continue}let u=n.map(e[c+1]+i,-1)-r,{index:h,offset:p}=s.content.findIndex(d),m=s.maybeChild(h);if(m&&p==d&&p+m.nodeSize==u){let s=a[c+2].mapInner(n,m,t+1,e[c]+i+1,o);s!=Eg?(a[c]=d,a[c+1]=u,a[c+2]=s):(a[c+1]=-2,l=!0)}else l=!0}if(l){let l=function(e,t,n,s,r,i,o){function a(e,t){for(let i=0;i<e.local.length;i++){let a=e.local[i].map(s,r,t);a?n.push(a):o.onRemove&&o.onRemove(e.local[i].spec)}for(let n=0;n<e.children.length;n+=3)a(e.children[n+2],e.children[n]+t+1)}for(let l=0;l<e.length;l+=3)-1==e[l+1]&&a(e[l+2],t[l]+i+1);return n}(a,e,t,n,r,i,o),c=Lg(l,s,0,o);t=c.local;for(let e=0;e<a.length;e+=3)a[e+1]<0&&(a.splice(e,3),e-=3);for(let e=0,t=0;e<c.children.length;e+=3){let n=c.children[e];for(;t<a.length&&a[t]<n;)t+=3;a.splice(t,0,c.children[e],c.children[e+1],c.children[e+2])}}return new Tg(t.sort(Dg),a)}(this.children,i||[],e,t,n,s,r):i?new Tg(i.sort(Dg),Sg):Eg}add(e,t){return t.length?this==Eg?Tg.create(e,t):this.addInner(e,t,0):this}addInner(e,t,n){let s,r=0;e.forEach((e,i)=>{let o,a=i+n;if(o=Ig(t,e,a)){for(s||(s=this.children.slice());r<s.length&&s[r]<i;)r+=3;s[r]==i?s[r+2]=s[r+2].addInner(e,o,a+1):s.splice(r,0,i,i+e.nodeSize,Lg(o,e,a+1,Ng)),r+=3}});let i=Ag(r?Og(t):t,-n);for(let o=0;o<i.length;o++)i[o].type.valid(e,i[o])||i.splice(o--,1);return new Tg(i.length?this.local.concat(i).sort(Dg):this.local,s||this.children)}remove(e){return 0==e.length||this==Eg?this:this.removeInner(e,0)}removeInner(e,t){let n=this.children,s=this.local;for(let r=0;r<n.length;r+=3){let s,i=n[r]+t,o=n[r+1]+t;for(let t,n=0;n<e.length;n++)(t=e[n])&&t.from>i&&t.to<o&&(e[n]=null,(s||(s=[])).push(t));if(!s)continue;n==this.children&&(n=this.children.slice());let a=n[r+2].removeInner(s,i+1);a!=Eg?n[r+2]=a:(n.splice(r,3),r-=3)}if(s.length)for(let r,i=0;i<e.length;i++)if(r=e[i])for(let e=0;e<s.length;e++)s[e].eq(r,t)&&(s==this.local&&(s=this.local.slice()),s.splice(e--,1));return n==this.children&&s==this.local?this:s.length||n.length?new Tg(s,n):Eg}forChild(e,t){if(this==Eg)return this;if(t.isLeaf)return Tg.empty;let n,s;for(let o=0;o<this.children.length;o+=3)if(this.children[o]>=e){this.children[o]==e&&(n=this.children[o+2]);break}let r=e+1,i=r+t.content.size;for(let o=0;o<this.local.length;o++){let e=this.local[o];if(e.from<i&&e.to>r&&e.type instanceof vg){let t=Math.max(r,e.from)-r,n=Math.min(i,e.to)-r;t<n&&(s||(s=[])).push(e.copy(t,n))}}if(s){let e=new Tg(s.sort(Dg),Sg);return n?new jg([e,n]):e}return n||Eg}eq(e){if(this==e)return!0;if(!(e instanceof Tg)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return Rg(this.localsInner(e))}localsInner(e){if(this==Eg)return Sg;if(e.inlineContent||!this.local.some(vg.is))return this.local;let t=[];for(let n=0;n<this.local.length;n++)this.local[n].type instanceof vg||t.push(this.local[n]);return t}forEachSet(e){e(this)}}Tg.empty=new Tg([],[]),Tg.removeOverlap=Rg;const Eg=Tg.empty;class jg{constructor(e){this.members=e}map(e,t){const n=this.members.map(n=>n.map(e,t,Ng));return jg.from(n)}forChild(e,t){if(t.isLeaf)return Tg.empty;let n=[];for(let s=0;s<this.members.length;s++){let r=this.members[s].forChild(e,t);r!=Eg&&(r instanceof jg?n=n.concat(r.members):n.push(r))}return jg.from(n)}eq(e){if(!(e instanceof jg)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,n=!0;for(let s=0;s<this.members.length;s++){let r=this.members[s].localsInner(e);if(r.length)if(t){n&&(t=t.slice(),n=!1);for(let e=0;e<r.length;e++)t.push(r[e])}else t=r}return t?Rg(n?t:t.sort(Dg)):Sg}static from(e){switch(e.length){case 0:return Eg;case 1:return e[0];default:return new jg(e.every(e=>e instanceof Tg)?e:e.reduce((e,t)=>e.concat(t instanceof Tg?t:t.members),[]))}}forEachSet(e){for(let t=0;t<this.members.length;t++)this.members[t].forEachSet(e)}}function Ag(e,t){if(!t||!e.length)return e;let n=[];for(let s=0;s<e.length;s++){let r=e[s];n.push(new Mg(r.from+t,r.to+t,r.type))}return n}function Ig(e,t,n){if(t.isLeaf)return null;let s=n+t.nodeSize,r=null;for(let i,o=0;o<e.length;o++)(i=e[o])&&i.from>n&&i.to<s&&((r||(r=[])).push(i),e[o]=null);return r}function Og(e){let t=[];for(let n=0;n<e.length;n++)null!=e[n]&&t.push(e[n]);return t}function Lg(e,t,n,s){let r=[],i=!1;t.forEach((t,o)=>{let a=Ig(e,t,o+n);if(a){i=!0;let e=Lg(a,t,n+o+1,s);e!=Eg&&r.push(o,o+t.nodeSize,e)}});let o=Ag(i?Og(e):e,-n).sort(Dg);for(let a=0;a<o.length;a++)o[a].type.valid(t,o[a])||(s.onRemove&&s.onRemove(o[a].spec),o.splice(a--,1));return o.length||r.length?new Tg(o,r):Eg}function Dg(e,t){return e.from-t.from||e.to-t.to}function Rg(e){let t=e;for(let n=0;n<t.length-1;n++){let s=t[n];if(s.from!=s.to)for(let r=n+1;r<t.length;r++){let i=t[r];if(i.from!=s.from){i.from<s.to&&(t==e&&(t=e.slice()),t[n]=s.copy(s.from,i.from),_g(t,r,s.copy(i.from,s.to)));break}i.to!=s.to&&(t==e&&(t=e.slice()),t[r]=i.copy(i.from,s.to),_g(t,r+1,i.copy(s.to,i.to)))}}return t}function _g(e,t,n){for(;t<e.length&&Dg(n,e[t])>0;)t++;e.splice(t,0,n)}function Pg(e){let t=[];return e.someProp("decorations",n=>{let s=n(e.state);s&&s!=Eg&&t.push(s)}),e.cursorWrapper&&t.push(Tg.create(e.state.doc,[e.cursorWrapper.deco])),jg.from(t)}const Vg={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Hg=rm&&im<=11;class $g{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class zg{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new $g,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(e=>{for(let t=0;t<e.length;t++)this.queue.push(e[t]);rm&&im<=11&&e.some(e=>"childList"==e.type&&e.removedNodes.length||"characterData"==e.type&&e.oldValue.length>e.target.nodeValue.length)?this.flushSoon():this.flush()}),Hg&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Vg)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(xf(this.view)){if(this.suppressingSelectionUpdates)return df(this.view);if(rm&&im<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&Zp(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t,n=new Set;for(let r=e.focusNode;r;r=Fp(r))n.add(r);for(let r=e.anchorNode;r;r=Fp(r))if(n.has(r)){t=r;break}let s=t&&this.view.docView.nearestDesc(t);return s&&s.ignoreMutation({type:"selection",target:3==t.nodeType?t.parentNode:t})?(this.setCurSelection(),!0):void 0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.pendingRecords();t.length&&(this.queue=[]);let n=e.domSelectionRange(),s=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&xf(e)&&!this.ignoreSelectionChange(n),r=-1,i=-1,o=!1,a=[];if(e.editable)for(let c=0;c<t.length;c++){let e=this.registerMutation(t[c],a);e&&(r=r<0?e.from:Math.min(e.from,r),i=i<0?e.to:Math.max(e.to,i),e.typeOver&&(o=!0))}if(om&&a.length){let t=a.filter(e=>"BR"==e.nodeName);if(2==t.length){let[e,n]=t;e.parentNode&&e.parentNode.parentNode==n.parentNode?n.remove():e.remove()}else{let{focusNode:n}=this.currentSelection;for(let s of t){let t=s.parentNode;!t||"LI"!=t.nodeName||n&&Zg(e,n)==t||s.remove()}}}let l=null;r<0&&s&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&Kp(n)&&(l=lf(e))&&l.eq(xp.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,df(e),this.currentSelection.set(n),e.scrollToSelection()):(r>-1||s)&&(r>-1&&(e.docView.markDirty(r,i),function(e){if(Fg.has(e))return;if(Fg.set(e,null),-1!==["normal","nowrap","pre-line"].indexOf(getComputedStyle(e.dom).whiteSpace)){if(e.requiresGeckoHackNode=om,Bg)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),Bg=!0}}(e)),this.handleDOMChange(r,i,o,a),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(n)||df(e),this.currentSelection.set(n))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let n=this.view.docView.nearestDesc(e.target);if("attributes"==e.type&&(n==this.view.docView||"contenteditable"==e.attributeName||"style"==e.attributeName&&!e.oldValue&&!e.target.getAttribute("style")))return null;if(!n||n.ignoreMutation(e))return null;if("childList"==e.type){for(let n=0;n<e.addedNodes.length;n++){let s=e.addedNodes[n];t.push(s),3==s.nodeType&&(this.lastChangedTextNode=s)}if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(e.target))return{from:n.posBefore,to:n.posAfter};let s=e.previousSibling,r=e.nextSibling;if(rm&&im<=11&&e.addedNodes.length)for(let t=0;t<e.addedNodes.length;t++){let{previousSibling:n,nextSibling:i}=e.addedNodes[t];(!n||Array.prototype.indexOf.call(e.addedNodes,n)<0)&&(s=n),(!i||Array.prototype.indexOf.call(e.addedNodes,i)<0)&&(r=i)}let i=s&&s.parentNode==e.target?zp(s)+1:0,o=n.localPosFromDOM(e.target,i,-1),a=r&&r.parentNode==e.target?zp(r):e.target.childNodes.length;return{from:o,to:n.localPosFromDOM(e.target,a,1)}}return"attributes"==e.type?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:(this.lastChangedTextNode=e.target,{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let Fg=new WeakMap,Bg=!1;function Wg(e,t){let n=t.startContainer,s=t.startOffset,r=t.endContainer,i=t.endOffset,o=e.domAtPos(e.state.selection.anchor);return Zp(o.node,o.offset,r,i)&&([n,s,r,i]=[r,i,n,s]),{anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:i}}function Zg(e,t){for(let n=t.parentNode;n&&n!=e.dom;n=n.parentNode){let t=e.docView.nearestDesc(n,!0);if(t&&t.node.isBlock)return n}return null}function Ug(e){let t=e.pmViewDesc;if(t)return t.parseRule();if("BR"==e.nodeName&&e.parentNode){if(dm&&/^(ul|ol)$/i.test(e.parentNode.nodeName)){let e=document.createElement("div");return e.appendChild(document.createElement("li")),{skip:e}}if(e.parentNode.lastChild==e||dm&&/^(tr|table)$/i.test(e.parentNode.nodeName))return{ignore:!0}}else if("IMG"==e.nodeName&&e.getAttribute("mark-placeholder"))return{ignore:!0};return null}const qg=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function Jg(e,t,n,s,r){let i=e.input.compositionPendingChanges||(e.composing?e.input.compositionID:0);if(e.input.compositionPendingChanges=0,t<0){let t=e.input.lastSelectionTime>Date.now()-50?e.input.lastSelectionOrigin:null,n=lf(e,t);if(n&&!e.state.selection.eq(n)){if(lm&&mm&&13===e.input.lastKeyCode&&Date.now()-100<e.input.lastKeyCodeTime&&e.someProp("handleKeyDown",t=>t(e,Yp(13,"Enter"))))return;let s=e.state.tr.setSelection(n);"pointer"==t?s.setMeta("pointer",!0):"key"==t&&s.scrollIntoView(),i&&s.setMeta("composition",i),e.dispatch(s)}return}let o=e.state.doc.resolve(t),a=o.sharedDepth(n);t=o.before(a+1),n=e.state.doc.resolve(n).after(a+1);let l,c,d=e.state.selection,u=function(e,t,n){let s,{node:r,fromOffset:i,toOffset:o,from:a,to:l}=e.docView.parseRange(t,n),c=e.domSelectionRange(),d=c.anchorNode;if(d&&e.dom.contains(1==d.nodeType?d:d.parentNode)&&(s=[{node:d,offset:c.anchorOffset}],Kp(c)||s.push({node:c.focusNode,offset:c.focusOffset})),lm&&8===e.input.lastKeyCode)for(let g=o;g>i;g--){let e=r.childNodes[g-1],t=e.pmViewDesc;if("BR"==e.nodeName&&!t){o=g;break}if(!t||t.size)break}let u=e.state.doc,h=e.someProp("domParser")||Mh.fromSchema(e.state.schema),p=u.resolve(a),m=null,f=h.parse(r,{topNode:p.parent,topMatch:p.parent.contentMatchAt(p.index()),topOpen:!0,from:i,to:o,preserveWhitespace:"pre"!=p.parent.type.whitespace||"full",findPositions:s,ruleFromNode:Ug,context:p});if(s&&null!=s[0].pos){let e=s[0].pos,t=s[1]&&s[1].pos;null==t&&(t=e),m={anchor:e+a,head:t+a}}return{doc:f,sel:m,from:a,to:l}}(e,t,n),h=e.state.doc,p=h.slice(u.from,u.to);8===e.input.lastKeyCode&&Date.now()-100<e.input.lastKeyCodeTime?(l=e.state.selection.to,c="end"):(l=e.state.selection.from,c="start"),e.input.lastKeyCode=null;let m=function(e,t,n,s,r){let i=e.findDiffStart(t,n);if(null==i)return null;let{a:o,b:a}=e.findDiffEnd(t,n+e.size,n+t.size);if("end"==r){s-=o+Math.max(0,i-Math.min(o,a))-i}if(o<i&&e.size<t.size){let e=s<=i&&s>=o?i-s:0;i-=e,i&&i<t.size&&Yg(t.textBetween(i-1,i+1))&&(i+=e?1:-1),a=i+(a-o),o=i}else if(a<i){let t=s<=i&&s>=a?i-s:0;i-=t,i&&i<e.size&&Yg(e.textBetween(i-1,i+1))&&(i+=t?1:-1),o=i+(o-a),a=i}return{start:i,endA:o,endB:a}}(p.content,u.doc.content,u.from,l,c);if(m&&e.input.domChangeCount++,(um&&e.input.lastIOSEnter>Date.now()-225||mm)&&r.some(e=>1==e.nodeType&&!qg.test(e.nodeName))&&(!m||m.endA>=m.endB)&&e.someProp("handleKeyDown",t=>t(e,Yp(13,"Enter"))))return void(e.input.lastIOSEnter=0);if(!m){if(!(s&&d instanceof vp&&!d.empty&&d.$head.sameParent(d.$anchor))||e.composing||u.sel&&u.sel.anchor!=u.sel.head){if(u.sel){let t=Gg(e,e.state.doc,u.sel);if(t&&!t.eq(e.state.selection)){let n=e.state.tr.setSelection(t);i&&n.setMeta("composition",i),e.dispatch(n)}}return}m={start:d.from,endA:d.to,endB:d.to}}e.state.selection.from<e.state.selection.to&&m.start==m.endB&&e.state.selection instanceof vp&&(m.start>e.state.selection.from&&m.start<=e.state.selection.from+2&&e.state.selection.from>=u.from?m.start=e.state.selection.from:m.endA<e.state.selection.to&&m.endA>=e.state.selection.to-2&&e.state.selection.to<=u.to&&(m.endB+=e.state.selection.to-m.endA,m.endA=e.state.selection.to)),rm&&im<=11&&m.endB==m.start+1&&m.endA==m.start&&m.start>u.from&&"  "==u.doc.textBetween(m.start-u.from-1,m.start-u.from+1)&&(m.start--,m.endA--,m.endB--);let f=u.doc.resolveNoCache(m.start-u.from),g=u.doc.resolveNoCache(m.endB-u.from),y=h.resolve(m.start),x=f.sameParent(g)&&f.parent.inlineContent&&y.end()>=m.endA;if((um&&e.input.lastIOSEnter>Date.now()-225&&(!x||r.some(e=>"DIV"==e.nodeName||"P"==e.nodeName))||!x&&f.pos<u.doc.content.size&&(!f.sameParent(g)||!f.parent.inlineContent)&&f.pos<g.pos&&!/\S/.test(u.doc.textBetween(f.pos,g.pos,"","")))&&e.someProp("handleKeyDown",t=>t(e,Yp(13,"Enter"))))return void(e.input.lastIOSEnter=0);if(e.state.selection.anchor>m.start&&function(e,t,n,s,r){if(n-t<=r.pos-s.pos||Kg(s,!0,!1)<r.pos)return!1;let i=e.resolve(t);if(!s.parent.isTextblock){let e=i.nodeAfter;return null!=e&&n==t+e.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let o=e.resolve(Kg(i,!0,!0));return!(!o.parent.isTextblock||o.pos>n||Kg(o,!0,!1)<n)&&s.parent.content.cut(s.parentOffset).eq(o.parent.content)}(h,m.start,m.endA,f,g)&&e.someProp("handleKeyDown",t=>t(e,Yp(8,"Backspace"))))return void(mm&&lm&&e.domObserver.suppressSelectionUpdates());lm&&m.endB==m.start&&(e.input.lastChromeDelete=Date.now()),mm&&!x&&f.start()!=g.start()&&0==g.parentOffset&&f.depth==g.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==m.endA&&(m.endB-=2,g=u.doc.resolveNoCache(m.endB-u.from),setTimeout(()=>{e.someProp("handleKeyDown",function(t){return t(e,Yp(13,"Enter"))})},20));let C,b=m.start,w=m.endA,v=t=>{let n=t||e.state.tr.replace(b,w,u.doc.slice(m.start-u.from,m.endB-u.from));if(u.sel){let t=Gg(e,n.doc,u.sel);t&&!(lm&&e.composing&&t.empty&&(m.start!=m.endB||e.input.lastChromeDelete<Date.now()-100)&&(t.head==b||t.head==n.mapping.map(w)-1)||rm&&t.empty&&t.head==b)&&n.setSelection(t)}return i&&n.setMeta("composition",i),n.scrollIntoView()};if(x)if(f.pos==g.pos){rm&&im<=11&&0==f.parentOffset&&(e.domObserver.suppressSelectionUpdates(),setTimeout(()=>df(e),20));let t=v(e.state.tr.delete(b,w)),n=h.resolve(m.start).marksAcross(h.resolve(m.endA));n&&t.ensureMarks(n),e.dispatch(t)}else if(m.endA==m.endB&&(C=function(e,t){let n,s,r,i=e.firstChild.marks,o=t.firstChild.marks,a=i,l=o;for(let d=0;d<o.length;d++)a=o[d].removeFromSet(a);for(let d=0;d<i.length;d++)l=i[d].removeFromSet(l);if(1==a.length&&0==l.length)s=a[0],n="add",r=e=>e.mark(s.addToSet(e.marks));else{if(0!=a.length||1!=l.length)return null;s=l[0],n="remove",r=e=>e.mark(s.removeFromSet(e.marks))}let c=[];for(let d=0;d<t.childCount;d++)c.push(r(t.child(d)));if(Lu.from(c).eq(e))return{mark:s,type:n}}(f.parent.content.cut(f.parentOffset,g.parentOffset),y.parent.content.cut(y.parentOffset,m.endA-y.start())))){let t=v(e.state.tr);"add"==C.type?t.addMark(b,w,C.mark):t.removeMark(b,w,C.mark),e.dispatch(t)}else if(f.parent.child(f.index()).isText&&f.index()==g.index()-(g.textOffset?0:1)){let t=f.parent.textBetween(f.parentOffset,g.parentOffset),n=()=>v(e.state.tr.insertText(t,b,w));e.someProp("handleTextInput",s=>s(e,b,w,t,n))||e.dispatch(n())}else e.dispatch(v());else e.dispatch(v())}function Gg(e,t,n){return Math.max(n.anchor,n.head)>t.content.size?null:yf(e,t.resolve(n.anchor),t.resolve(n.head))}function Kg(e,t,n){let s=e.depth,r=t?e.end():e.pos;for(;s>0&&(t||e.indexAfter(s)==e.node(s).childCount);)s--,r++,t=!1;if(n){let t=e.node(s).maybeChild(e.indexAfter(s));for(;t&&!t.isLeaf;)t=t.firstChild,r++}return r}function Yg(e){if(2!=e.length)return!1;let t=e.charCodeAt(0),n=e.charCodeAt(1);return t>=56320&&t<=57343&&n>=55296&&n<=56319}class Qg{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new Jf,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(sy),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):"function"==typeof e?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=ty(this),ey(this),this.nodeViews=ny(this),this.docView=Zm(this.state.doc,Xg(this),Pg(this),this.dom,this),this.domObserver=new zg(this,(e,t,n,s)=>Jg(this,e,t,n,s)),this.domObserver.start(),function(e){for(let t in Zf){let n=Zf[t];e.dom.addEventListener(t,e.input.eventHandlers[t]=t=>{!Qf(e,t)||Yf(e,t)||!e.editable&&t.type in Uf||n(e,t)},qf[t]?{passive:!0}:void 0)}dm&&e.dom.addEventListener("input",()=>null),Kf(e)}(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&Kf(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(sy),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let n in this._props)t[n]=this._props[n];t.state=this.state;for(let n in e)t[n]=e[n];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){var n;let s=this.state,r=!1,i=!1;e.storedMarks&&this.composing&&(ug(this),i=!0),this.state=e;let o=s.plugins!=e.plugins||this._props.plugins!=t.plugins;if(o||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let e=ny(this);(function(e,t){let n=0,s=0;for(let r in e){if(e[r]!=t[r])return!0;n++}for(let r in t)s++;return n!=s})(e,this.nodeViews)&&(this.nodeViews=e,r=!0)}(o||t.handleDOMEvents!=this._props.handleDOMEvents)&&Kf(this),this.editable=ty(this),ey(this);let a=Pg(this),l=Xg(this),c=s.plugins==e.plugins||s.doc.eq(e.doc)?e.scrollToSelection>s.scrollToSelection?"to selection":"preserve":"reset",d=r||!this.docView.matchesNode(e.doc,l,a);!d&&e.selection.eq(s.selection)||(i=!0);let u="preserve"==c&&i&&null==this.dom.style.overflowAnchor&&function(e){let t,n,s=e.dom.getBoundingClientRect(),r=Math.max(0,s.top);for(let i=(s.left+s.right)/2,o=r+1;o<Math.min(innerHeight,s.bottom);o+=5){let s=e.root.elementFromPoint(i,o);if(!s||s==e.dom||!e.dom.contains(s))continue;let a=s.getBoundingClientRect();if(a.top>=r-20){t=s,n=a.top;break}}return{refDOM:t,refTop:n,stack:wm(e.dom)}}(this);if(i){this.domObserver.stop();let t=d&&(rm||lm)&&!this.composing&&!s.selection.empty&&!e.selection.empty&&function(e,t){let n=Math.min(e.$anchor.sharedDepth(e.head),t.$anchor.sharedDepth(t.head));return e.$anchor.start(n)!=t.$anchor.start(n)}(s.selection,e.selection);if(d){let n=lm?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=hg(this)),!r&&this.docView.update(e.doc,l,a,this)||(this.docView.updateOuterDeco(l),this.docView.destroy(),this.docView=Zm(e.doc,l,a,this.dom,this)),n&&!this.trackWrites&&(t=!0)}t||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&function(e){let t=e.docView.domFromPos(e.state.selection.anchor,0),n=e.domSelectionRange();return Zp(t.node,t.offset,n.anchorNode,n.anchorOffset)}(this))?df(this,t):(ff(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(s),(null===(n=this.dragging)||void 0===n?void 0:n.node)&&!s.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,s),"reset"==c?this.dom.scrollTop=0:"to selection"==c?this.scrollToSelection():u&&function({refDOM:e,refTop:t,stack:n}){let s=e?e.getBoundingClientRect().top:0;vm(n,0==s?0:s-t)}(u)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(e&&this.dom.contains(1==e.nodeType?e:e.parentNode))if(this.someProp("handleScrollToSelection",e=>e(this)));else if(this.state.selection instanceof Mp){let t=this.docView.domAfterPos(this.state.selection.from);1==t.nodeType&&bm(this,t.getBoundingClientRect(),e)}else bm(this,this.coordsAtPos(this.state.selection.head,1),e);else;}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(e&&e.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(let t=0;t<this.pluginViews.length;t++){let n=this.pluginViews[t];n.update&&n.update(this,e)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let e=0;e<this.directPlugins.length;e++){let t=this.directPlugins[e];t.spec.view&&this.pluginViews.push(t.spec.view(this))}for(let e=0;e<this.state.plugins.length;e++){let t=this.state.plugins[e];t.spec.view&&this.pluginViews.push(t.spec.view(this))}}}updateDraggedNode(e,t){let n=e.node,s=-1;if(this.state.doc.nodeAt(n.from)==n.node)s=n.from;else{let e=n.from+(this.state.doc.content.size-t.doc.content.size);(e>0&&this.state.doc.nodeAt(e))==n.node&&(s=e)}this.dragging=new yg(e.slice,e.move,s<0?void 0:Mp.create(this.state.doc,s))}someProp(e,t){let n,s=this._props&&this._props[e];if(null!=s&&(n=t?t(s):s))return n;for(let i=0;i<this.directPlugins.length;i++){let s=this.directPlugins[i].props[e];if(null!=s&&(n=t?t(s):s))return n}let r=this.state.plugins;if(r)for(let i=0;i<r.length;i++){let s=r[i].props[e];if(null!=s&&(n=t?t(s):s))return n}}hasFocus(){if(rm){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if("false"==e.contentEditable)return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&function(e){if(e.setActive)return e.setActive();if(km)return e.focus(km);let t=wm(e);e.focus(null==km?{get preventScroll(){return km={preventScroll:!0},!0}}:void 0),km||(km=!1,vm(t,0))}(this.dom),df(this),this.domObserver.start()}get root(){let e=this._root;if(null==e)for(let t=this.dom.parentNode;t;t=t.parentNode)if(9==t.nodeType||11==t.nodeType&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=()=>t.ownerDocument.getSelection()),this._root=t;return e||document}updateRoot(){this._root=null}posAtCoords(e){return Tm(this,e)}coordsAtPos(e,t=1){return Im(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,n=-1){let s=this.docView.posFromDOM(e,t,n);if(null==s)throw new RangeError("DOM position not inside the editor");return s}endOfTextblock(e,t){return Hm(this,t||this.state,e)}pasteHTML(e,t){return fg(this,"",e,!1,t||new ClipboardEvent("paste"))}pasteText(e,t){return fg(this,e,null,!0,t||new ClipboardEvent("paste"))}serializeForClipboard(e){return Lf(this,e)}destroy(){this.docView&&(!function(e){e.domObserver.stop();for(let t in e.input.eventHandlers)e.dom.removeEventListener(t,e.input.eventHandlers[t]);clearTimeout(e.input.composingTimeout),clearTimeout(e.input.lastIOSEnterFallbackTimeout)}(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Pg(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,Bp=null)}get isDestroyed(){return null==this.docView}dispatchEvent(e){return function(e,t){Yf(e,t)||!Zf[t.type]||!e.editable&&t.type in Uf||Zf[t.type](e,t)}(this,e)}domSelectionRange(){let e=this.domSelection();return e?dm&&11===this.root.nodeType&&function(e){let t=e.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}(this.dom.ownerDocument)==this.dom&&function(e,t){if(t.getComposedRanges){let n=t.getComposedRanges(e.root)[0];if(n)return Wg(e,n)}let n;function s(e){e.preventDefault(),e.stopImmediatePropagation(),n=e.getTargetRanges()[0]}return e.dom.addEventListener("beforeinput",s,!0),document.execCommand("indent"),e.dom.removeEventListener("beforeinput",s,!0),n?Wg(e,n):null}(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}function Xg(e){let t=Object.create(null);return t.class="ProseMirror",t.contenteditable=String(e.editable),e.someProp("attributes",n=>{if("function"==typeof n&&(n=n(e.state)),n)for(let e in n)"class"==e?t.class+=" "+n[e]:"style"==e?t.style=(t.style?t.style+";":"")+n[e]:t[e]||"contenteditable"==e||"nodeName"==e||(t[e]=String(n[e]))}),t.translate||(t.translate="no"),[Mg.node(0,e.state.doc.content.size,t)]}function ey(e){if(e.markCursor){let t=document.createElement("img");t.className="ProseMirror-separator",t.setAttribute("mark-placeholder","true"),t.setAttribute("alt",""),e.cursorWrapper={dom:t,deco:Mg.widget(e.state.selection.from,t,{raw:!0,marks:e.markCursor})}}else e.cursorWrapper=null}function ty(e){return!e.someProp("editable",t=>!1===t(e.state))}function ny(e){let t=Object.create(null);function n(e){for(let n in e)Object.prototype.hasOwnProperty.call(t,n)||(t[n]=e[n])}return e.someProp("nodeViews",n),e.someProp("markViews",n),t}function sy(e){if(e.spec.state||e.spec.filterTransaction||e.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}Qg.prototype.dispatch=function(e){let t=this._props.dispatchTransaction;t?t.call(this,e):this.updateState(this.state.apply(e))};for(var ry={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},iy={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},oy="undefined"!=typeof navigator&&/Chrome\/(\d+)/.exec(navigator.userAgent),ay="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),ly="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),cy=ay||oy&&+oy[1]<57,dy=0;dy<10;dy++)ry[48+dy]=ry[96+dy]=String(dy);for(dy=1;dy<=24;dy++)ry[dy+111]="F"+dy;for(dy=65;dy<=90;dy++)ry[dy]=String.fromCharCode(dy+32),iy[dy]=String.fromCharCode(dy);for(var uy in ry)iy.hasOwnProperty(uy)||(iy[uy]=ry[uy]);const hy="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),py="undefined"!=typeof navigator&&/Win/.test(navigator.platform);function my(e){let t,n,s,r,i=e.split(/-(?!$)/),o=i[i.length-1];"Space"==o&&(o=" ");for(let a=0;a<i.length-1;a++){let e=i[a];if(/^(cmd|meta|m)$/i.test(e))r=!0;else if(/^a(lt)?$/i.test(e))t=!0;else if(/^(c|ctrl|control)$/i.test(e))n=!0;else if(/^s(hift)?$/i.test(e))s=!0;else{if(!/^mod$/i.test(e))throw new Error("Unrecognized modifier name: "+e);hy?r=!0:n=!0}}return t&&(o="Alt-"+o),n&&(o="Ctrl-"+o),r&&(o="Meta-"+o),s&&(o="Shift-"+o),o}function fy(e,t,n=!0){return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),n&&t.shiftKey&&(e="Shift-"+e),e}function gy(e){let t=function(e){let t=Object.create(null);for(let n in e)t[my(n)]=e[n];return t}(e);return function(e,n){let s,r=function(e){var t=!(cy&&(e.ctrlKey||e.altKey||e.metaKey)||ly&&e.shiftKey&&e.key&&1==e.key.length||"Unidentified"==e.key)&&e.key||(e.shiftKey?iy:ry)[e.keyCode]||e.key||"Unidentified";return"Esc"==t&&(t="Escape"),"Del"==t&&(t="Delete"),"Left"==t&&(t="ArrowLeft"),"Up"==t&&(t="ArrowUp"),"Right"==t&&(t="ArrowRight"),"Down"==t&&(t="ArrowDown"),t}(n),i=t[fy(r,n)];if(i&&i(e.state,e.dispatch,e))return!0;if(1==r.length&&" "!=r){if(n.shiftKey){let s=t[fy(r,n,!1)];if(s&&s(e.state,e.dispatch,e))return!0}if((n.altKey||n.metaKey||n.ctrlKey)&&!(py&&n.ctrlKey&&n.altKey)&&(s=ry[n.keyCode])&&s!=r){let r=t[fy(s,n)];if(r&&r(e.state,e.dispatch,e))return!0}}return!1}}const yy=Math.pow(2,16);function xy(e,t){return e+t*yy}function Cy(e){return 65535&e}let by=class{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}},wy=class e{constructor(t,n=!1){if(this.ranges=t,this.inverted=n,!t.length&&e.empty)return e.empty}recover(e){let t=0,n=Cy(e);if(!this.inverted)for(let s=0;s<n;s++)t+=this.ranges[3*s+2]-this.ranges[3*s+1];return this.ranges[3*n]+t+function(e){return(e-(65535&e))/yy}(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let s=0,r=this.inverted?2:1,i=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let a=this.ranges[o]-(this.inverted?s:0);if(a>e)break;let l=this.ranges[o+r],c=this.ranges[o+i],d=a+l;if(e<=d){let r=a+s+((l?e==a?-1:e==d?1:t:t)<0?0:c);if(n)return r;let i=e==(t<0?a:d)?null:xy(o/3,e-a),u=e==a?2:e==d?1:4;return(t<0?e!=a:e!=d)&&(u|=8),new by(r,u,i)}s+=c-l}return n?e+s:new by(e+s,0,null)}touches(e,t){let n=0,s=Cy(t),r=this.inverted?2:1,i=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let t=this.ranges[o]-(this.inverted?n:0);if(t>e)break;let a=this.ranges[o+r];if(e<=t+a&&o==3*s)return!0;n+=this.ranges[o+i]-a}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let s=0,r=0;s<this.ranges.length;s+=3){let i=this.ranges[s],o=i-(this.inverted?r:0),a=i+(this.inverted?0:r),l=this.ranges[s+t],c=this.ranges[s+n];e(o,o+l,a,a+c),r+=c-l}}invert(){return new e(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return 0==t?e.empty:new e(t<0?[0,-t,0]:[0,0,t])}};wy.empty=new wy([]);class vy{constructor(e,t,n=0,s=(e?e.length:0)){this.mirror=t,this.from=n,this.to=s,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new vy(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),null!=t&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,n=this._maps.length;t<e._maps.length;t++){let s=e.getMirror(t);this.appendMap(e._maps[t],null!=s&&s<t?n+s:void 0)}}getMirror(e){if(this.mirror)for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this._maps.length+e._maps.length;t>=0;t--){let s=e.getMirror(t);this.appendMap(e._maps[t].invert(),null!=s&&s>t?n-s-1:void 0)}}invert(){let e=new vy;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let s=0;for(let r=this.from;r<this.to;r++){let n=this._maps[r].mapResult(e,t);if(null!=n.recover){let t=this.getMirror(r);if(null!=t&&t>r&&t<this.to){r=t,e=this._maps[t].recover(n.recover);continue}}s|=n.delInfo,e=n.pos}return n?e:new by(e,s,null)}}const ky=Object.create(null);let My=class{getMap(){return wy.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=ky[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in ky)throw new RangeError("Duplicate use of step JSON ID "+e);return ky[e]=t,t.prototype.jsonID=e,t}},Sy=class e{constructor(e,t){this.doc=e,this.failed=t}static ok(t){return new e(t,null)}static fail(t){return new e(null,t)}static fromReplace(t,n,s,r){try{return e.ok(t.replace(n,s,r))}catch(i){if(i instanceof Vu)return e.fail(i.message);throw i}}};function Ny(e,t,n){let s=[];for(let r=0;r<e.childCount;r++){let i=e.child(r);i.content.size&&(i=i.copy(Ny(i.content,t,i))),i.isInline&&(i=t(i,n,r)),s.push(i)}return Lu.fromArray(s)}let Ty=class e extends My{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),s=n.node(n.sharedDepth(this.to)),r=new Hu(Ny(t.content,(e,t)=>e.isAtom&&t.type.allowsMarkType(this.mark.type)?e.mark(this.mark.addToSet(e.marks)):e,s),t.openStart,t.openEnd);return Sy.fromReplace(e,this.from,this.to,r)}invert(){return new Ey(this.from,this.to,this.mark)}map(t){let n=t.mapResult(this.from,1),s=t.mapResult(this.to,-1);return n.deleted&&s.deleted||n.pos>=s.pos?null:new e(n.pos,s.pos,this.mark)}merge(t){return t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))}};My.jsonID("addMark",Ty);let Ey=class e extends My{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new Hu(Ny(t.content,e=>e.mark(this.mark.removeFromSet(e.marks)),e),t.openStart,t.openEnd);return Sy.fromReplace(e,this.from,this.to,n)}invert(){return new Ty(this.from,this.to,this.mark)}map(t){let n=t.mapResult(this.from,1),s=t.mapResult(this.to,-1);return n.deleted&&s.deleted||n.pos>=s.pos?null:new e(n.pos,s.pos,this.mark)}merge(t){return t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))}};My.jsonID("removeMark",Ey);let jy=class e extends My{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Sy.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return Sy.fromReplace(e,this.pos,this.pos+1,new Hu(Lu.from(n),0,t.isLeaf?0:1))}invert(t){let n=t.nodeAt(this.pos);if(n){let t=this.mark.addToSet(n.marks);if(t.length==n.marks.length){for(let s=0;s<n.marks.length;s++)if(!n.marks[s].isInSet(t))return new e(this.pos,n.marks[s]);return new e(this.pos,this.mark)}}return new Ay(this.pos,this.mark)}map(t){let n=t.mapResult(this.pos,1);return n.deletedAfter?null:new e(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,n){if("number"!=typeof n.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new e(n.pos,t.markFromJSON(n.mark))}};My.jsonID("addNodeMark",jy);let Ay=class e extends My{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Sy.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return Sy.fromReplace(e,this.pos,this.pos+1,new Hu(Lu.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return t&&this.mark.isInSet(t.marks)?new jy(this.pos,this.mark):this}map(t){let n=t.mapResult(this.pos,1);return n.deletedAfter?null:new e(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,n){if("number"!=typeof n.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new e(n.pos,t.markFromJSON(n.mark))}};My.jsonID("removeNodeMark",Ay);let Iy=class e extends My{constructor(e,t,n,s=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=s}apply(e){return this.structure&&Ly(e,this.from,this.to)?Sy.fail("Structure replace would overwrite content"):Sy.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new wy([this.from,this.to-this.from,this.slice.size])}invert(t){return new e(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let n=t.mapResult(this.from,1),s=t.mapResult(this.to,-1);return n.deletedAcross&&s.deletedAcross?null:new e(n.pos,Math.max(n.pos,s.pos),this.slice,this.structure)}merge(t){if(!(t instanceof e)||t.structure||this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;{let n=this.slice.size+t.slice.size==0?Hu.empty:new Hu(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new e(t.from,this.to,n,this.structure)}}{let n=this.slice.size+t.slice.size==0?Hu.empty:new Hu(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new e(this.from,this.to+(t.to-t.from),n,this.structure)}}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(n.from,n.to,Hu.fromJSON(t,n.slice),!!n.structure)}};My.jsonID("replace",Iy);let Oy=class e extends My{constructor(e,t,n,s,r,i,o=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=s,this.slice=r,this.insert=i,this.structure=o}apply(e){if(this.structure&&(Ly(e,this.from,this.gapFrom)||Ly(e,this.gapTo,this.to)))return Sy.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return Sy.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?Sy.fromReplace(e,this.from,this.to,n):Sy.fail("Content does not fit in gap")}getMap(){return new wy([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let n=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let n=t.mapResult(this.from,1),s=t.mapResult(this.to,-1),r=this.from==this.gapFrom?n.pos:t.map(this.gapFrom,-1),i=this.to==this.gapTo?s.pos:t.map(this.gapTo,1);return n.deletedAcross&&s.deletedAcross||r<n.pos||i>s.pos?null:new e(n.pos,s.pos,r,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(t,n){if("number"!=typeof n.from||"number"!=typeof n.to||"number"!=typeof n.gapFrom||"number"!=typeof n.gapTo||"number"!=typeof n.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(n.from,n.to,n.gapFrom,n.gapTo,Hu.fromJSON(t,n.slice),n.insert,!!n.structure)}};function Ly(e,t,n){let s=e.resolve(t),r=n-t,i=s.depth;for(;r>0&&i>0&&s.indexAfter(i)==s.node(i).childCount;)i--,r--;if(r>0){let e=s.node(i).maybeChild(s.indexAfter(i));for(;r>0;){if(!e||e.isLeaf)return!0;e=e.firstChild,r--}}return!1}function Dy(e,t,n,s=n.contentMatch,r=!0){let i=e.doc.nodeAt(t),o=[],a=t+1;for(let l=0;l<i.childCount;l++){let t=i.child(l),c=a+t.nodeSize,d=s.matchType(t.type);if(d){s=d;for(let s=0;s<t.marks.length;s++)n.allowsMarkType(t.marks[s].type)||e.step(new Ey(a,c,t.marks[s]));if(r&&t.isText&&"pre"!=n.whitespace){let e,s,r=/\r?\n|\r/g;for(;e=r.exec(t.text);)s||(s=new Hu(Lu.from(n.schema.text(" ",n.allowedMarks(t.marks))),0,0)),o.push(new Iy(a+e.index,a+e.index+e[0].length,s))}}else o.push(new Iy(a,c,Hu.empty));a=c}if(!s.validEnd){let t=s.fillBefore(Lu.empty,!0);e.replace(a,a,new Hu(t,0,0))}for(let l=o.length-1;l>=0;l--)e.step(o[l])}function Ry(e,t,n){return(0==t||e.canReplace(t,e.childCount))&&(n==e.childCount||e.canReplace(0,n))}function _y(e){return{type:e,attrs:null}}function Py(e,t,n,s){t.forEach((r,i)=>{if(r.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(r.text);){let r=e.mapping.slice(s).map(n+1+i+o.index);e.replaceWith(r,r+1,t.type.schema.linebreakReplacement.create())}}})}function Vy(e,t,n,s){t.forEach((r,i)=>{if(r.type==r.type.schema.linebreakReplacement){let r=e.mapping.slice(s).map(n+1+i);e.replaceWith(r,r+1,t.type.schema.text("\n"))}})}function Hy(e,t,n=1,s){let r=e.resolve(t),i=r.depth-n,o=s&&s[s.length-1]||r.parent;if(i<0||r.parent.type.spec.isolating||!r.parent.canReplace(r.index(),r.parent.childCount)||!o.type.validContent(r.parent.content.cutByIndex(r.index(),r.parent.childCount)))return!1;for(let c=r.depth-1,d=n-2;c>i;c--,d--){let e=r.node(c),t=r.index(c);if(e.type.spec.isolating)return!1;let n=e.content.cutByIndex(t,e.childCount),i=s&&s[d+1];i&&(n=n.replaceChild(0,i.type.create(i.attrs)));let o=s&&s[d]||e;if(!e.canReplace(t+1,e.childCount)||!o.type.validContent(n))return!1}let a=r.indexAfter(i),l=s&&s[0];return r.node(i).canReplaceWith(a,a,l?l.type:r.node(i+1).type)}function $y(e,t){let n=e.resolve(t),s=n.index();return zy(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(s,s+1)}function zy(e,t){return!(!e||!t||e.isLeaf||!function(e,t){t.content.size||e.type.compatibleContent(t.type);let n=e.contentMatchAt(e.childCount),{linebreakReplacement:s}=e.type.schema;for(let r=0;r<t.childCount;r++){let i=t.child(r),o=i.type==s?e.type.schema.nodes.text:i.type;if(n=n.matchType(o),!n)return!1;if(!e.type.allowsMarks(i.marks))return!1}return n.validEnd}(e,t))}function Fy(e,t,n=-1){let s=e.resolve(t);for(let r=s.depth;;r--){let e,i,o=s.index(r);if(r==s.depth?(e=s.nodeBefore,i=s.nodeAfter):n>0?(e=s.node(r+1),o++,i=s.node(r).maybeChild(o)):(e=s.node(r).maybeChild(o-1),i=s.node(r+1)),e&&!e.isTextblock&&zy(e,i)&&s.node(r).canReplace(o,o+1))return t;if(0==r)break;t=n<0?s.before(r):s.after(r)}}function By(e,t,n){return!n.openStart&&!n.openEnd&&e.start()==t.start()&&e.parent.canReplace(e.index(),t.index(),n.content)}My.jsonID("replaceAround",Oy);let Wy=class{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=Lu.empty;for(let s=0;s<=e.depth;s++){let t=e.node(s);this.frontier.push({type:t.type,match:t.contentMatchAt(e.indexAfter(s))})}for(let s=e.depth;s>0;s--)this.placed=Lu.from(e.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,s=this.close(e<0?this.$to:n.doc.resolve(e));if(!s)return null;let r=this.placed,i=n.depth,o=s.depth;for(;i&&o&&1==r.childCount;)r=r.firstChild.content,i--,o--;let a=new Hu(r,i,o);return e>-1?new Oy(n.pos,e,this.$to.pos,this.$to.end(),a,t):a.size||n.pos!=this.$to.pos?new Iy(n.pos,s.pos,a):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,s=this.unplaced.openEnd;n<e;n++){let r=t.firstChild;if(t.childCount>1&&(s=0),r.type.spec.isolating&&s<=n){e=n;break}t=r.content}for(let t=1;t<=2;t++)for(let n=1==t?e:this.unplaced.openStart;n>=0;n--){let e,s=null;n?(s=qy(this.unplaced.content,n-1).firstChild,e=s.content):e=this.unplaced.content;let r=e.firstChild;for(let i=this.depth;i>=0;i--){let e,{type:o,match:a}=this.frontier[i],l=null;if(1==t&&(r?a.matchType(r.type)||(l=a.fillBefore(Lu.from(r),!1)):s&&o.compatibleContent(s.type)))return{sliceDepth:n,frontierDepth:i,parent:s,inject:l};if(2==t&&r&&(e=a.findWrapping(r.type)))return{sliceDepth:n,frontierDepth:i,parent:s,wrap:e};if(s&&a.matchType(s.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,s=qy(e,t);return!(!s.childCount||s.firstChild.isLeaf)&&(this.unplaced=new Hu(e,t+1,Math.max(n,s.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,s=qy(e,t);if(s.childCount<=1&&t>0){let r=e.size-t<=t+s.size;this.unplaced=new Hu(Zy(e,t-1,1),t-1,r?t-1:n)}else this.unplaced=new Hu(Zy(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:s,wrap:r}){for(;this.depth>t;)this.closeFrontierNode();if(r)for(let m=0;m<r.length;m++)this.openFrontierNode(r[m]);let i=this.unplaced,o=n?n.content:i.content,a=i.openStart-e,l=0,c=[],{match:d,type:u}=this.frontier[t];if(s){for(let e=0;e<s.childCount;e++)c.push(s.child(e));d=d.matchFragment(s)}let h=o.size+e-(i.content.size-i.openEnd);for(;l<o.childCount;){let e=o.child(l),t=d.matchType(e.type);if(!t)break;l++,(l>1||0==a||e.content.size)&&(d=t,c.push(Jy(e.mark(u.allowedMarks(e.marks)),1==l?a:0,l==o.childCount?h:-1)))}let p=l==o.childCount;p||(h=-1),this.placed=Uy(this.placed,t,Lu.from(c)),this.frontier[t].match=d,p&&h<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,f=o;m<h;m++){let e=f.lastChild;this.frontier.push({type:e.type,match:e.contentMatchAt(e.childCount)}),f=e.content}this.unplaced=p?0==e?Hu.empty:new Hu(Zy(i.content,e-1,1),e-1,h<0?i.openEnd:e-1):new Hu(Zy(i.content,e,l),i.openStart,i.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e,t=this.frontier[this.depth];if(!t.type.isTextblock||!Gy(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;let{depth:n}=this.$to,s=this.$to.after(n);for(;n>1&&s==this.$to.end(--n);)++s;return s}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:s}=this.frontier[t],r=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),i=Gy(e,t,s,n,r);if(i){for(let n=t-1;n>=0;n--){let{match:t,type:s}=this.frontier[n],r=Gy(e,n,s,t,!0);if(!r||r.childCount)continue e}return{depth:t,fit:i,move:r?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=Uy(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let t=e.node(n),s=t.type.contentMatch.fillBefore(t.content,!0,e.index(n));this.openFrontierNode(t.type,t.attrs,s)}return e}openFrontierNode(e,t=null,n){let s=this.frontier[this.depth];s.match=s.match.matchType(e),this.placed=Uy(this.placed,this.depth,Lu.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let e=this.frontier.pop().match.fillBefore(Lu.empty,!0);e.childCount&&(this.placed=Uy(this.placed,this.frontier.length,e))}};function Zy(e,t,n){return 0==t?e.cutByIndex(n,e.childCount):e.replaceChild(0,e.firstChild.copy(Zy(e.firstChild.content,t-1,n)))}function Uy(e,t,n){return 0==t?e.append(n):e.replaceChild(e.childCount-1,e.lastChild.copy(Uy(e.lastChild.content,t-1,n)))}function qy(e,t){for(let n=0;n<t;n++)e=e.firstChild.content;return e}function Jy(e,t,n){if(t<=0)return e;let s=e.content;return t>1&&(s=s.replaceChild(0,Jy(s.firstChild,t-1,1==s.childCount?n-1:0))),t>0&&(s=e.type.contentMatch.fillBefore(s).append(s),n<=0&&(s=s.append(e.type.contentMatch.matchFragment(s).fillBefore(Lu.empty,!0)))),e.copy(s)}function Gy(e,t,n,s,r){let i=e.node(t),o=r?e.indexAfter(t):e.index(t);if(o==i.childCount&&!n.compatibleContent(i.type))return null;let a=s.fillBefore(i.content,!0,o);return a&&!function(e,t,n){for(let s=n;s<t.childCount;s++)if(!e.allowsMarks(t.child(s).marks))return!0;return!1}(n,i.content,o)?a:null}function Ky(e){return e.spec.defining||e.spec.definingForContent}function Yy(e,t,n,s,r){if(t<n){let r=e.firstChild;e=e.replaceChild(0,r.copy(Yy(r.content,t+1,n,s,r)))}if(t>s){let t=r.contentMatchAt(0),n=t.fillBefore(e).append(e);e=n.append(t.matchFragment(n).fillBefore(Lu.empty,!0))}return e}function Qy(e,t){let n=[];for(let s=Math.min(e.depth,t.depth);s>=0;s--){let r=e.start(s);if(r<e.pos-(e.depth-s)||t.end(s)>t.pos+(t.depth-s)||e.node(s).type.spec.isolating||t.node(s).type.spec.isolating)break;(r==t.start(s)||s==e.depth&&s==t.depth&&e.parent.inlineContent&&t.parent.inlineContent&&s&&t.start(s-1)==r-1)&&n.push(s)}return n}let Xy=class e extends My{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return Sy.fail("No node at attribute step's position");let n=Object.create(null);for(let r in t.attrs)n[r]=t.attrs[r];n[this.attr]=this.value;let s=t.type.create(n,null,t.marks);return Sy.fromReplace(e,this.pos,this.pos+1,new Hu(Lu.from(s),0,t.isLeaf?0:1))}getMap(){return wy.empty}invert(t){return new e(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let n=t.mapResult(this.pos,1);return n.deletedAfter?null:new e(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,n){if("number"!=typeof n.pos||"string"!=typeof n.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new e(n.pos,n.attr,n.value)}};My.jsonID("attr",Xy);let ex=class e extends My{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let s in e.attrs)t[s]=e.attrs[s];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return Sy.ok(n)}getMap(){return wy.empty}invert(t){return new e(this.attr,t.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(t,n){if("string"!=typeof n.attr)throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new e(n.attr,n.value)}};My.jsonID("docAttr",ex);let tx=class extends Error{};tx=function e(t){let n=Error.call(this,t);return n.__proto__=e.prototype,n},(tx.prototype=Object.create(Error.prototype)).constructor=tx,tx.prototype.name="TransformError";class nx{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new vy}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new tx(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=Hu.empty){let s=function(e,t,n=t,s=Hu.empty){if(t==n&&!s.size)return null;let r=e.resolve(t),i=e.resolve(n);return By(r,i,s)?new Iy(t,n,s):new Wy(r,i,s).fit()}(this.doc,e,t,n);return s&&this.step(s),this}replaceWith(e,t,n){return this.replace(e,t,new Hu(Lu.from(n),0,0))}delete(e,t){return this.replace(e,t,Hu.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return function(e,t,n,s){if(!s.size)return e.deleteRange(t,n);let r=e.doc.resolve(t),i=e.doc.resolve(n);if(By(r,i,s))return e.step(new Iy(t,n,s));let o=Qy(r,e.doc.resolve(n));0==o[o.length-1]&&o.pop();let a=-(r.depth+1);o.unshift(a);for(let h=r.depth,p=r.pos-1;h>0;h--,p--){let e=r.node(h).type.spec;if(e.defining||e.definingAsContext||e.isolating)break;o.indexOf(h)>-1?a=h:r.before(h)==p&&o.splice(1,0,-h)}let l=o.indexOf(a),c=[],d=s.openStart;for(let h=s.content,p=0;;p++){let e=h.firstChild;if(c.push(e),p==s.openStart)break;h=e.content}for(let h=d-1;h>=0;h--){let e=c[h],t=Ky(e.type);if(t&&!e.sameMarkup(r.node(Math.abs(a)-1)))d=h;else if(t||!e.type.isTextblock)break}for(let h=s.openStart;h>=0;h--){let t=(h+d+1)%(s.openStart+1),a=c[t];if(a)for(let c=0;c<o.length;c++){let d=o[(c+l)%o.length],u=!0;d<0&&(u=!1,d=-d);let h=r.node(d-1),p=r.index(d-1);if(h.canReplaceWith(p,p,a.type,a.marks))return e.replace(r.before(d),u?i.after(d):n,new Hu(Yy(s.content,0,s.openStart,t),t,s.openEnd))}}let u=e.steps.length;for(let h=o.length-1;h>=0&&(e.replace(t,n,s),!(e.steps.length>u));h--){let e=o[h];e<0||(t=r.before(e),n=i.after(e))}}(this,e,t,n),this}replaceRangeWith(e,t,n){return function(e,t,n,s){if(!s.isInline&&t==n&&e.doc.resolve(t).parent.content.size){let r=function(e,t,n){let s=e.resolve(t);if(s.parent.canReplaceWith(s.index(),s.index(),n))return t;if(0==s.parentOffset)for(let r=s.depth-1;r>=0;r--){let e=s.index(r);if(s.node(r).canReplaceWith(e,e,n))return s.before(r+1);if(e>0)return null}if(s.parentOffset==s.parent.content.size)for(let r=s.depth-1;r>=0;r--){let e=s.indexAfter(r);if(s.node(r).canReplaceWith(e,e,n))return s.after(r+1);if(e<s.node(r).childCount)return null}return null}(e.doc,t,s.type);null!=r&&(t=n=r)}e.replaceRange(t,n,new Hu(Lu.from(s),0,0))}(this,e,t,n),this}deleteRange(e,t){return function(e,t,n){let s=e.doc.resolve(t),r=e.doc.resolve(n),i=Qy(s,r);for(let o=0;o<i.length;o++){let t=i[o],n=o==i.length-1;if(n&&0==t||s.node(t).type.contentMatch.validEnd)return e.delete(s.start(t),r.end(t));if(t>0&&(n||s.node(t-1).canReplace(s.index(t-1),r.indexAfter(t-1))))return e.delete(s.before(t),r.after(t))}for(let o=1;o<=s.depth&&o<=r.depth;o++)if(t-s.start(o)==s.depth-o&&n>s.end(o)&&r.end(o)-n!=r.depth-o&&s.start(o-1)==r.start(o-1)&&s.node(o-1).canReplace(s.index(o-1),r.index(o-1)))return e.delete(s.before(o),n);e.delete(t,n)}(this,e,t),this}lift(e,t){return function(e,t,n){let{$from:s,$to:r,depth:i}=t,o=s.before(i+1),a=r.after(i+1),l=o,c=a,d=Lu.empty,u=0;for(let m=i,f=!1;m>n;m--)f||s.index(m)>0?(f=!0,d=Lu.from(s.node(m).copy(d)),u++):l--;let h=Lu.empty,p=0;for(let m=i,f=!1;m>n;m--)f||r.after(m+1)<r.end(m)?(f=!0,h=Lu.from(r.node(m).copy(h)),p++):c++;e.step(new Oy(l,c,o,a,new Hu(d.append(h),u,p),d.size-u,!0))}(this,e,t),this}join(e,t=1){return function(e,t,n){let s=null,{linebreakReplacement:r}=e.doc.type.schema,i=e.doc.resolve(t-n),o=i.node().type;if(r&&o.inlineContent){let e="pre"==o.whitespace,t=!!o.contentMatch.matchType(r);e&&!t?s=!1:!e&&t&&(s=!0)}let a=e.steps.length;if(!1===s){let s=e.doc.resolve(t+n);Vy(e,s.node(),s.before(),a)}o.inlineContent&&Dy(e,t+n-1,o,i.node().contentMatchAt(i.index()),null==s);let l=e.mapping.slice(a),c=l.map(t-n);if(e.step(new Iy(c,l.map(t+n,-1),Hu.empty,!0)),!0===s){let t=e.doc.resolve(c);Py(e,t.node(),t.before(),e.steps.length)}}(this,e,t),this}wrap(e,t){return function(e,t,n){let s=Lu.empty;for(let o=n.length-1;o>=0;o--){if(s.size){let e=n[o].type.contentMatch.matchFragment(s);if(!e||!e.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}s=Lu.from(n[o].type.create(n[o].attrs,s))}let r=t.start,i=t.end;e.step(new Oy(r,i,r,i,new Hu(s,0,0),n.length,!0))}(this,e,t),this}setBlockType(e,t=e,n,s=null){return function(e,t,n,s,r){if(!s.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=e.steps.length;e.doc.nodesBetween(t,n,(t,n)=>{let o="function"==typeof r?r(t):r;if(t.isTextblock&&!t.hasMarkup(s,o)&&function(e,t,n){let s=e.resolve(t),r=s.index();return s.parent.canReplaceWith(r,r+1,n)}(e.doc,e.mapping.slice(i).map(n),s)){let r=null;if(s.schema.linebreakReplacement){let e="pre"==s.whitespace,t=!!s.contentMatch.matchType(s.schema.linebreakReplacement);e&&!t?r=!1:!e&&t&&(r=!0)}!1===r&&Vy(e,t,n,i),Dy(e,e.mapping.slice(i).map(n,1),s,void 0,null===r);let a=e.mapping.slice(i),l=a.map(n,1),c=a.map(n+t.nodeSize,1);return e.step(new Oy(l,c,l+1,c-1,new Hu(Lu.from(s.create(o,null,t.marks)),0,0),1,!0)),!0===r&&Py(e,t,n,i),!1}})}(this,e,t,n,s),this}setNodeMarkup(e,t,n=null,s){return function(e,t,n,s,r){let i=e.doc.nodeAt(t);if(!i)throw new RangeError("No node at given position");n||(n=i.type);let o=n.create(s,null,r||i.marks);if(i.isLeaf)return e.replaceWith(t,t+i.nodeSize,o);if(!n.validContent(i.content))throw new RangeError("Invalid content for node type "+n.name);e.step(new Oy(t,t+i.nodeSize,t+1,t+i.nodeSize-1,new Hu(Lu.from(o),0,0),1,!0))}(this,e,t,n,s),this}setNodeAttribute(e,t,n){return this.step(new Xy(e,t,n)),this}setDocAttribute(e,t){return this.step(new ex(e,t)),this}addNodeMark(e,t){return this.step(new jy(e,t)),this}removeNodeMark(e,t){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(t instanceof Pu)t.isInSet(n.marks)&&this.step(new Ay(e,t));else{let s,r=n.marks,i=[];for(;s=t.isInSet(r);)i.push(new Ay(e,s)),r=s.removeFromSet(r);for(let e=i.length-1;e>=0;e--)this.step(i[e])}return this}split(e,t=1,n){return function(e,t,n=1,s){let r=e.doc.resolve(t),i=Lu.empty,o=Lu.empty;for(let a=r.depth,l=r.depth-n,c=n-1;a>l;a--,c--){i=Lu.from(r.node(a).copy(i));let e=s&&s[c];o=Lu.from(e?e.type.create(e.attrs,o):r.node(a).copy(o))}e.step(new Iy(t,t,new Hu(i.append(o),n,n),!0))}(this,e,t,n),this}addMark(e,t,n){return function(e,t,n,s){let r,i,o=[],a=[];e.doc.nodesBetween(t,n,(e,l,c)=>{if(!e.isInline)return;let d=e.marks;if(!s.isInSet(d)&&c.type.allowsMarkType(s.type)){let c=Math.max(l,t),u=Math.min(l+e.nodeSize,n),h=s.addToSet(d);for(let e=0;e<d.length;e++)d[e].isInSet(h)||(r&&r.to==c&&r.mark.eq(d[e])?r.to=u:o.push(r=new Ey(c,u,d[e])));i&&i.to==c?i.to=u:a.push(i=new Ty(c,u,s))}}),o.forEach(t=>e.step(t)),a.forEach(t=>e.step(t))}(this,e,t,n),this}removeMark(e,t,n){return function(e,t,n,s){let r=[],i=0;e.doc.nodesBetween(t,n,(e,o)=>{if(!e.isInline)return;i++;let a=null;if(s instanceof wh){let t,n=e.marks;for(;t=s.isInSet(n);)(a||(a=[])).push(t),n=t.removeFromSet(n)}else s?s.isInSet(e.marks)&&(a=[s]):a=e.marks;if(a&&a.length){let s=Math.min(o+e.nodeSize,n);for(let e=0;e<a.length;e++){let n,l=a[e];for(let e=0;e<r.length;e++){let t=r[e];t.step==i-1&&l.eq(r[e].style)&&(n=t)}n?(n.to=s,n.step=i):r.push({style:l,from:Math.max(o,t),to:s,step:i})}}}),r.forEach(t=>e.step(new Ey(t.from,t.to,t.style)))}(this,e,t,n),this}clearIncompatible(e,t,n){return Dy(this,e,t,n),this}}const sx=Math.pow(2,16);function rx(e,t){return e+t*sx}function ix(e){return 65535&e}let ox=class{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}},ax=class e{constructor(t,n=!1){if(this.ranges=t,this.inverted=n,!t.length&&e.empty)return e.empty}recover(e){let t=0,n=ix(e);if(!this.inverted)for(let s=0;s<n;s++)t+=this.ranges[3*s+2]-this.ranges[3*s+1];return this.ranges[3*n]+t+function(e){return(e-(65535&e))/sx}(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let s=0,r=this.inverted?2:1,i=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let a=this.ranges[o]-(this.inverted?s:0);if(a>e)break;let l=this.ranges[o+r],c=this.ranges[o+i],d=a+l;if(e<=d){let r=a+s+((l?e==a?-1:e==d?1:t:t)<0?0:c);if(n)return r;let i=e==(t<0?a:d)?null:rx(o/3,e-a),u=e==a?2:e==d?1:4;return(t<0?e!=a:e!=d)&&(u|=8),new ox(r,u,i)}s+=c-l}return n?e+s:new ox(e+s,0,null)}touches(e,t){let n=0,s=ix(t),r=this.inverted?2:1,i=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let t=this.ranges[o]-(this.inverted?n:0);if(t>e)break;let a=this.ranges[o+r];if(e<=t+a&&o==3*s)return!0;n+=this.ranges[o+i]-a}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let s=0,r=0;s<this.ranges.length;s+=3){let i=this.ranges[s],o=i-(this.inverted?r:0),a=i+(this.inverted?0:r),l=this.ranges[s+t],c=this.ranges[s+n];e(o,o+l,a,a+c),r+=c-l}}invert(){return new e(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return 0==t?e.empty:new e(t<0?[0,-t,0]:[0,0,t])}};ax.empty=new ax([]);const lx=Object.create(null);let cx=class{getMap(){return ax.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=lx[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in lx)throw new RangeError("Duplicate use of step JSON ID "+e);return lx[e]=t,t.prototype.jsonID=e,t}},dx=class e{constructor(e,t){this.doc=e,this.failed=t}static ok(t){return new e(t,null)}static fail(t){return new e(null,t)}static fromReplace(t,n,s,r){try{return e.ok(t.replace(n,s,r))}catch(i){if(i instanceof Vu)return e.fail(i.message);throw i}}};function ux(e,t,n){let s=[];for(let r=0;r<e.childCount;r++){let i=e.child(r);i.content.size&&(i=i.copy(ux(i.content,t,i))),i.isInline&&(i=t(i,n,r)),s.push(i)}return Lu.fromArray(s)}let hx=class e extends cx{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),s=n.node(n.sharedDepth(this.to)),r=new Hu(ux(t.content,(e,t)=>e.isAtom&&t.type.allowsMarkType(this.mark.type)?e.mark(this.mark.addToSet(e.marks)):e,s),t.openStart,t.openEnd);return dx.fromReplace(e,this.from,this.to,r)}invert(){return new px(this.from,this.to,this.mark)}map(t){let n=t.mapResult(this.from,1),s=t.mapResult(this.to,-1);return n.deleted&&s.deleted||n.pos>=s.pos?null:new e(n.pos,s.pos,this.mark)}merge(t){return t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))}};cx.jsonID("addMark",hx);let px=class e extends cx{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new Hu(ux(t.content,e=>e.mark(this.mark.removeFromSet(e.marks)),e),t.openStart,t.openEnd);return dx.fromReplace(e,this.from,this.to,n)}invert(){return new hx(this.from,this.to,this.mark)}map(t){let n=t.mapResult(this.from,1),s=t.mapResult(this.to,-1);return n.deleted&&s.deleted||n.pos>=s.pos?null:new e(n.pos,s.pos,this.mark)}merge(t){return t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))}};cx.jsonID("removeMark",px);let mx=class e extends cx{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return dx.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return dx.fromReplace(e,this.pos,this.pos+1,new Hu(Lu.from(n),0,t.isLeaf?0:1))}invert(t){let n=t.nodeAt(this.pos);if(n){let t=this.mark.addToSet(n.marks);if(t.length==n.marks.length){for(let s=0;s<n.marks.length;s++)if(!n.marks[s].isInSet(t))return new e(this.pos,n.marks[s]);return new e(this.pos,this.mark)}}return new fx(this.pos,this.mark)}map(t){let n=t.mapResult(this.pos,1);return n.deletedAfter?null:new e(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,n){if("number"!=typeof n.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new e(n.pos,t.markFromJSON(n.mark))}};cx.jsonID("addNodeMark",mx);let fx=class e extends cx{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return dx.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return dx.fromReplace(e,this.pos,this.pos+1,new Hu(Lu.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return t&&this.mark.isInSet(t.marks)?new mx(this.pos,this.mark):this}map(t){let n=t.mapResult(this.pos,1);return n.deletedAfter?null:new e(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,n){if("number"!=typeof n.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new e(n.pos,t.markFromJSON(n.mark))}};cx.jsonID("removeNodeMark",fx);let gx=class e extends cx{constructor(e,t,n,s=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=s}apply(e){return this.structure&&xx(e,this.from,this.to)?dx.fail("Structure replace would overwrite content"):dx.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new ax([this.from,this.to-this.from,this.slice.size])}invert(t){return new e(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let n=t.mapResult(this.from,1),s=t.mapResult(this.to,-1);return n.deletedAcross&&s.deletedAcross?null:new e(n.pos,Math.max(n.pos,s.pos),this.slice,this.structure)}merge(t){if(!(t instanceof e)||t.structure||this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;{let n=this.slice.size+t.slice.size==0?Hu.empty:new Hu(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new e(t.from,this.to,n,this.structure)}}{let n=this.slice.size+t.slice.size==0?Hu.empty:new Hu(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new e(this.from,this.to+(t.to-t.from),n,this.structure)}}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(n.from,n.to,Hu.fromJSON(t,n.slice),!!n.structure)}};cx.jsonID("replace",gx);let yx=class e extends cx{constructor(e,t,n,s,r,i,o=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=s,this.slice=r,this.insert=i,this.structure=o}apply(e){if(this.structure&&(xx(e,this.from,this.gapFrom)||xx(e,this.gapTo,this.to)))return dx.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return dx.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?dx.fromReplace(e,this.from,this.to,n):dx.fail("Content does not fit in gap")}getMap(){return new ax([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let n=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let n=t.mapResult(this.from,1),s=t.mapResult(this.to,-1),r=this.from==this.gapFrom?n.pos:t.map(this.gapFrom,-1),i=this.to==this.gapTo?s.pos:t.map(this.gapTo,1);return n.deletedAcross&&s.deletedAcross||r<n.pos||i>s.pos?null:new e(n.pos,s.pos,r,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(t,n){if("number"!=typeof n.from||"number"!=typeof n.to||"number"!=typeof n.gapFrom||"number"!=typeof n.gapTo||"number"!=typeof n.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(n.from,n.to,n.gapFrom,n.gapTo,Hu.fromJSON(t,n.slice),n.insert,!!n.structure)}};function xx(e,t,n){let s=e.resolve(t),r=n-t,i=s.depth;for(;r>0&&i>0&&s.indexAfter(i)==s.node(i).childCount;)i--,r--;if(r>0){let e=s.node(i).maybeChild(s.indexAfter(i));for(;r>0;){if(!e||e.isLeaf)return!0;e=e.firstChild,r--}}return!1}function Cx(e,t,n){return(0==t||e.canReplace(t,e.childCount))&&(n==e.childCount||e.canReplace(0,n))}function bx(e){let t=e.parent.content.cutByIndex(e.startIndex,e.endIndex);for(let n=e.depth;;--n){let s=e.$from.node(n),r=e.$from.index(n),i=e.$to.indexAfter(n);if(n<e.depth&&s.canReplace(r,i,t))return n;if(0==n||s.type.spec.isolating||!Cx(s,r,i))break}return null}function wx(e){return{type:e,attrs:null}}function vx(e,t,n=1,s){let r=e.resolve(t),i=r.depth-n,o=s&&s[s.length-1]||r.parent;if(i<0||r.parent.type.spec.isolating||!r.parent.canReplace(r.index(),r.parent.childCount)||!o.type.validContent(r.parent.content.cutByIndex(r.index(),r.parent.childCount)))return!1;for(let c=r.depth-1,d=n-2;c>i;c--,d--){let e=r.node(c),t=r.index(c);if(e.type.spec.isolating)return!1;let n=e.content.cutByIndex(t,e.childCount),i=s&&s[d+1];i&&(n=n.replaceChild(0,i.type.create(i.attrs)));let o=s&&s[d]||e;if(!e.canReplace(t+1,e.childCount)||!o.type.validContent(n))return!1}let a=r.indexAfter(i),l=s&&s[0];return r.node(i).canReplaceWith(a,a,l?l.type:r.node(i+1).type)}function kx(e,t){let n=e.resolve(t),s=n.index();return Mx(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(s,s+1)}function Mx(e,t){return!(!e||!t||e.isLeaf||!function(e,t){t.content.size||e.type.compatibleContent(t.type);let n=e.contentMatchAt(e.childCount),{linebreakReplacement:s}=e.type.schema;for(let r=0;r<t.childCount;r++){let i=t.child(r),o=i.type==s?e.type.schema.nodes.text:i.type;if(n=n.matchType(o),!n)return!1;if(!e.type.allowsMarks(i.marks))return!1}return n.validEnd}(e,t))}function Sx(e,t,n=-1){let s=e.resolve(t);for(let r=s.depth;;r--){let e,i,o=s.index(r);if(r==s.depth?(e=s.nodeBefore,i=s.nodeAfter):n>0?(e=s.node(r+1),o++,i=s.node(r).maybeChild(o)):(e=s.node(r).maybeChild(o-1),i=s.node(r+1)),e&&!e.isTextblock&&Mx(e,i)&&s.node(r).canReplace(o,o+1))return t;if(0==r)break;t=n<0?s.before(r):s.after(r)}}function Nx(e,t,n=t,s=Hu.empty){if(t==n&&!s.size)return null;let r=e.resolve(t),i=e.resolve(n);return function(e,t,n){return!n.openStart&&!n.openEnd&&e.start()==t.start()&&e.parent.canReplace(e.index(),t.index(),n.content)}(r,i,s)?new gx(t,n,s):new Tx(r,i,s).fit()}cx.jsonID("replaceAround",yx);class Tx{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=Lu.empty;for(let s=0;s<=e.depth;s++){let t=e.node(s);this.frontier.push({type:t.type,match:t.contentMatchAt(e.indexAfter(s))})}for(let s=e.depth;s>0;s--)this.placed=Lu.from(e.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,s=this.close(e<0?this.$to:n.doc.resolve(e));if(!s)return null;let r=this.placed,i=n.depth,o=s.depth;for(;i&&o&&1==r.childCount;)r=r.firstChild.content,i--,o--;let a=new Hu(r,i,o);return e>-1?new yx(n.pos,e,this.$to.pos,this.$to.end(),a,t):a.size||n.pos!=this.$to.pos?new gx(n.pos,s.pos,a):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,s=this.unplaced.openEnd;n<e;n++){let r=t.firstChild;if(t.childCount>1&&(s=0),r.type.spec.isolating&&s<=n){e=n;break}t=r.content}for(let t=1;t<=2;t++)for(let n=1==t?e:this.unplaced.openStart;n>=0;n--){let e,s=null;n?(s=Ax(this.unplaced.content,n-1).firstChild,e=s.content):e=this.unplaced.content;let r=e.firstChild;for(let i=this.depth;i>=0;i--){let e,{type:o,match:a}=this.frontier[i],l=null;if(1==t&&(r?a.matchType(r.type)||(l=a.fillBefore(Lu.from(r),!1)):s&&o.compatibleContent(s.type)))return{sliceDepth:n,frontierDepth:i,parent:s,inject:l};if(2==t&&r&&(e=a.findWrapping(r.type)))return{sliceDepth:n,frontierDepth:i,parent:s,wrap:e};if(s&&a.matchType(s.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,s=Ax(e,t);return!(!s.childCount||s.firstChild.isLeaf)&&(this.unplaced=new Hu(e,t+1,Math.max(n,s.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,s=Ax(e,t);if(s.childCount<=1&&t>0){let r=e.size-t<=t+s.size;this.unplaced=new Hu(Ex(e,t-1,1),t-1,r?t-1:n)}else this.unplaced=new Hu(Ex(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:s,wrap:r}){for(;this.depth>t;)this.closeFrontierNode();if(r)for(let m=0;m<r.length;m++)this.openFrontierNode(r[m]);let i=this.unplaced,o=n?n.content:i.content,a=i.openStart-e,l=0,c=[],{match:d,type:u}=this.frontier[t];if(s){for(let e=0;e<s.childCount;e++)c.push(s.child(e));d=d.matchFragment(s)}let h=o.size+e-(i.content.size-i.openEnd);for(;l<o.childCount;){let e=o.child(l),t=d.matchType(e.type);if(!t)break;l++,(l>1||0==a||e.content.size)&&(d=t,c.push(Ix(e.mark(u.allowedMarks(e.marks)),1==l?a:0,l==o.childCount?h:-1)))}let p=l==o.childCount;p||(h=-1),this.placed=jx(this.placed,t,Lu.from(c)),this.frontier[t].match=d,p&&h<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,f=o;m<h;m++){let e=f.lastChild;this.frontier.push({type:e.type,match:e.contentMatchAt(e.childCount)}),f=e.content}this.unplaced=p?0==e?Hu.empty:new Hu(Ex(i.content,e-1,1),e-1,h<0?i.openEnd:e-1):new Hu(Ex(i.content,e,l),i.openStart,i.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e,t=this.frontier[this.depth];if(!t.type.isTextblock||!Ox(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;let{depth:n}=this.$to,s=this.$to.after(n);for(;n>1&&s==this.$to.end(--n);)++s;return s}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:s}=this.frontier[t],r=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),i=Ox(e,t,s,n,r);if(i){for(let n=t-1;n>=0;n--){let{match:t,type:s}=this.frontier[n],r=Ox(e,n,s,t,!0);if(!r||r.childCount)continue e}return{depth:t,fit:i,move:r?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=jx(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let t=e.node(n),s=t.type.contentMatch.fillBefore(t.content,!0,e.index(n));this.openFrontierNode(t.type,t.attrs,s)}return e}openFrontierNode(e,t=null,n){let s=this.frontier[this.depth];s.match=s.match.matchType(e),this.placed=jx(this.placed,this.depth,Lu.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let e=this.frontier.pop().match.fillBefore(Lu.empty,!0);e.childCount&&(this.placed=jx(this.placed,this.frontier.length,e))}}function Ex(e,t,n){return 0==t?e.cutByIndex(n,e.childCount):e.replaceChild(0,e.firstChild.copy(Ex(e.firstChild.content,t-1,n)))}function jx(e,t,n){return 0==t?e.append(n):e.replaceChild(e.childCount-1,e.lastChild.copy(jx(e.lastChild.content,t-1,n)))}function Ax(e,t){for(let n=0;n<t;n++)e=e.firstChild.content;return e}function Ix(e,t,n){if(t<=0)return e;let s=e.content;return t>1&&(s=s.replaceChild(0,Ix(s.firstChild,t-1,1==s.childCount?n-1:0))),t>0&&(s=e.type.contentMatch.fillBefore(s).append(s),n<=0&&(s=s.append(e.type.contentMatch.matchFragment(s).fillBefore(Lu.empty,!0)))),e.copy(s)}function Ox(e,t,n,s,r){let i=e.node(t),o=r?e.indexAfter(t):e.index(t);if(o==i.childCount&&!n.compatibleContent(i.type))return null;let a=s.fillBefore(i.content,!0,o);return a&&!function(e,t,n){for(let s=n;s<t.childCount;s++)if(!e.allowsMarks(t.child(s).marks))return!0;return!1}(n,i.content,o)?a:null}cx.jsonID("attr",class e extends cx{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return dx.fail("No node at attribute step's position");let n=Object.create(null);for(let r in t.attrs)n[r]=t.attrs[r];n[this.attr]=this.value;let s=t.type.create(n,null,t.marks);return dx.fromReplace(e,this.pos,this.pos+1,new Hu(Lu.from(s),0,t.isLeaf?0:1))}getMap(){return ax.empty}invert(t){return new e(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let n=t.mapResult(this.pos,1);return n.deletedAfter?null:new e(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,n){if("number"!=typeof n.pos||"string"!=typeof n.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new e(n.pos,n.attr,n.value)}});cx.jsonID("docAttr",class e extends cx{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let s in e.attrs)t[s]=e.attrs[s];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return dx.ok(n)}getMap(){return ax.empty}invert(t){return new e(this.attr,t.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(t,n){if("string"!=typeof n.attr)throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new e(n.attr,n.value)}});let Lx=class extends Error{};Lx=function e(t){let n=Error.call(this,t);return n.__proto__=e.prototype,n},(Lx.prototype=Object.create(Error.prototype)).constructor=Lx,Lx.prototype.name="TransformError";const Dx=(e,t)=>!e.selection.empty&&(t&&t(e.tr.deleteSelection().scrollIntoView()),!0);function Rx(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("backward",e):n.parentOffset>0)?null:n}const _x=(e,t,n)=>{let s=Rx(e,n);if(!s)return!1;let r=$x(s);if(!r){let n=s.blockRange(),r=n&&bx(n);return null!=r&&(t&&t(e.tr.lift(n,r).scrollIntoView()),!0)}let i=r.nodeBefore;if(Kx(e,r,t,-1))return!0;if(0==s.parent.content.size&&(Vx(i,"end")||Mp.isSelectable(i)))for(let o=s.depth;;o--){let n=Nx(e.doc,s.before(o),s.after(o),Hu.empty);if(n&&n.slice.size<n.to-n.from){if(t){let s=e.tr.step(n);s.setSelection(Vx(i,"end")?xp.findFrom(s.doc.resolve(s.mapping.map(r.pos,-1)),-1):Mp.create(s.doc,r.pos-i.nodeSize)),t(s.scrollIntoView())}return!0}if(1==o||s.node(o-1).childCount>1)break}return!(!i.isAtom||r.depth!=s.depth-1)&&(t&&t(e.tr.delete(r.pos-i.nodeSize,r.pos).scrollIntoView()),!0)};function Px(e,t,n){let s=t.nodeBefore,r=t.pos-1;for(;!s.isTextblock;r--){if(s.type.spec.isolating)return!1;let e=s.lastChild;if(!e)return!1;s=e}let i=t.nodeAfter,o=t.pos+1;for(;!i.isTextblock;o++){if(i.type.spec.isolating)return!1;let e=i.firstChild;if(!e)return!1;i=e}let a=Nx(e.doc,r,o,Hu.empty);if(!a||a.from!=r||a instanceof gx&&a.slice.size>=o-r)return!1;if(n){let t=e.tr.step(a);t.setSelection(vp.create(t.doc,r)),n(t.scrollIntoView())}return!0}function Vx(e,t,n=!1){for(let s=e;s;s="start"==t?s.firstChild:s.lastChild){if(s.isTextblock)return!0;if(n&&1!=s.childCount)return!1}return!1}const Hx=(e,t,n)=>{let{$head:s,empty:r}=e.selection,i=s;if(!r)return!1;if(s.parent.isTextblock){if(n?!n.endOfTextblock("backward",e):s.parentOffset>0)return!1;i=$x(s)}let o=i&&i.nodeBefore;return!(!o||!Mp.isSelectable(o))&&(t&&t(e.tr.setSelection(Mp.create(e.doc,i.pos-o.nodeSize)).scrollIntoView()),!0)};function $x(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){if(e.index(t)>0)return e.doc.resolve(e.before(t+1));if(e.node(t).type.spec.isolating)break}return null}function zx(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("forward",e):n.parentOffset<n.parent.content.size)?null:n}const Fx=(e,t,n)=>{let s=zx(e,n);if(!s)return!1;let r=Wx(s);if(!r)return!1;let i=r.nodeAfter;if(Kx(e,r,t,1))return!0;if(0==s.parent.content.size&&(Vx(i,"start")||Mp.isSelectable(i))){let n=Nx(e.doc,s.before(),s.after(),Hu.empty);if(n&&n.slice.size<n.to-n.from){if(t){let s=e.tr.step(n);s.setSelection(Vx(i,"start")?xp.findFrom(s.doc.resolve(s.mapping.map(r.pos)),1):Mp.create(s.doc,s.mapping.map(r.pos))),t(s.scrollIntoView())}return!0}}return!(!i.isAtom||r.depth!=s.depth-1)&&(t&&t(e.tr.delete(r.pos,r.pos+i.nodeSize).scrollIntoView()),!0)},Bx=(e,t,n)=>{let{$head:s,empty:r}=e.selection,i=s;if(!r)return!1;if(s.parent.isTextblock){if(n?!n.endOfTextblock("forward",e):s.parentOffset<s.parent.content.size)return!1;i=Wx(s)}let o=i&&i.nodeAfter;return!(!o||!Mp.isSelectable(o))&&(t&&t(e.tr.setSelection(Mp.create(e.doc,i.pos)).scrollIntoView()),!0)};function Wx(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){let n=e.node(t);if(e.index(t)+1<n.childCount)return e.doc.resolve(e.after(t+1));if(n.type.spec.isolating)break}return null}const Zx=(e,t)=>{let{$head:n,$anchor:s}=e.selection;return!(!n.parent.type.spec.code||!n.sameParent(s))&&(t&&t(e.tr.insertText("\n").scrollIntoView()),!0)};function Ux(e){for(let t=0;t<e.edgeCount;t++){let{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const qx=(e,t)=>{let n=e.selection,{$from:s,$to:r}=n;if(n instanceof Np||s.parent.inlineContent||r.parent.inlineContent)return!1;let i=Ux(r.parent.contentMatchAt(r.indexAfter()));if(!i||!i.isTextblock)return!1;if(t){let n=(!s.parentOffset&&r.index()<r.parent.childCount?s:r).pos,o=e.tr.insert(n,i.createAndFill());o.setSelection(vp.create(o.doc,n+1)),t(o.scrollIntoView())}return!0},Jx=(e,t)=>{let{$cursor:n}=e.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let s=n.before();if(vx(e.doc,s))return t&&t(e.tr.split(s).scrollIntoView()),!0}let s=n.blockRange(),r=s&&bx(s);return null!=r&&(t&&t(e.tr.lift(s,r).scrollIntoView()),!0)};const Gx=(e,t)=>{let{$from:n,$to:s}=e.selection;if(e.selection instanceof Mp&&e.selection.node.isBlock)return!(!n.parentOffset||!vx(e.doc,n.pos)||(t&&t(e.tr.split(n.pos).scrollIntoView()),0));if(!n.depth)return!1;let r,i,o=[],a=!1,l=!1;for(let h=n.depth;;h--){if(n.node(h).isBlock){a=n.end(h)==n.pos+(n.depth-h),l=n.start(h)==n.pos-(n.depth-h),i=Ux(n.node(h-1).contentMatchAt(n.indexAfter(h-1))),o.unshift(a&&i?{type:i}:null),r=h;break}if(1==h)return!1;o.unshift(null)}let c=e.tr;(e.selection instanceof vp||e.selection instanceof Np)&&c.deleteSelection();let d=c.mapping.map(n.pos),u=vx(c.doc,d,o.length,o);if(u||(o[0]=i?{type:i}:null,u=vx(c.doc,d,o.length,o)),!u)return!1;if(c.split(d,o.length,o),!a&&l&&n.node(r).type!=i){let e=c.mapping.map(n.before(r)),t=c.doc.resolve(e);i&&n.node(r-1).canReplaceWith(t.index(),t.index()+1,i)&&c.setNodeMarkup(c.mapping.map(n.before(r)),i)}return t&&t(c.scrollIntoView()),!0};function Kx(e,t,n,s){let r,i,o=t.nodeBefore,a=t.nodeAfter,l=o.type.spec.isolating||a.type.spec.isolating;if(!l&&function(e,t,n){let s=t.nodeBefore,r=t.nodeAfter,i=t.index();return!(!(s&&r&&s.type.compatibleContent(r.type))||(!s.content.size&&t.parent.canReplace(i-1,i)?(n&&n(e.tr.delete(t.pos-s.nodeSize,t.pos).scrollIntoView()),0):!t.parent.canReplace(i,i+1)||!r.isTextblock&&!kx(e.doc,t.pos)||(n&&n(e.tr.join(t.pos).scrollIntoView()),0)))}(e,t,n))return!0;let c=!l&&t.parent.canReplace(t.index(),t.index()+1);if(c&&(r=(i=o.contentMatchAt(o.childCount)).findWrapping(a.type))&&i.matchType(r[0]||a.type).validEnd){if(n){let s=t.pos+a.nodeSize,i=Lu.empty;for(let e=r.length-1;e>=0;e--)i=Lu.from(r[e].create(null,i));i=Lu.from(o.copy(i));let l=e.tr.step(new yx(t.pos-1,s,t.pos,s,new Hu(i,1,0),r.length,!0)),c=l.doc.resolve(s+2*r.length);c.nodeAfter&&c.nodeAfter.type==o.type&&kx(l.doc,c.pos)&&l.join(c.pos),n(l.scrollIntoView())}return!0}let d=a.type.spec.isolating||s>0&&l?null:xp.findFrom(t,1),u=d&&d.$from.blockRange(d.$to),h=u&&bx(u);if(null!=h&&h>=t.depth)return n&&n(e.tr.lift(u,h).scrollIntoView()),!0;if(c&&Vx(a,"start",!0)&&Vx(o,"end")){let s=o,r=[];for(;r.push(s),!s.isTextblock;)s=s.lastChild;let i=a,l=1;for(;!i.isTextblock;i=i.firstChild)l++;if(s.canReplace(s.childCount,s.childCount,i.content)){if(n){let s=Lu.empty;for(let e=r.length-1;e>=0;e--)s=Lu.from(r[e].copy(s));n(e.tr.step(new yx(t.pos-r.length,t.pos+a.nodeSize,t.pos+l,t.pos+a.nodeSize-l,new Hu(s,r.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function Yx(e){return function(t,n){let s=t.selection,r=e<0?s.$from:s.$to,i=r.depth;for(;r.node(i).isInline;){if(!i)return!1;i--}return!!r.node(i).isTextblock&&(n&&n(t.tr.setSelection(vp.create(t.doc,e<0?r.start(i):r.end(i)))),!0)}}const Qx=Yx(-1),Xx=Yx(1);function eC(e,t=null){return function(n,s){let{$from:r,$to:i}=n.selection,o=r.blockRange(i),a=o&&function(e,t,n=null,s=e){let r=function(e,t){let{parent:n,startIndex:s,endIndex:r}=e,i=n.contentMatchAt(s).findWrapping(t);if(!i)return null;let o=i.length?i[0]:t;return n.canReplaceWith(s,r,o)?i:null}(e,t),i=r&&function(e,t){let{parent:n,startIndex:s,endIndex:r}=e,i=n.child(s),o=t.contentMatch.findWrapping(i.type);if(!o)return null;let a=(o.length?o[o.length-1]:t).contentMatch;for(let l=s;a&&l<r;l++)a=a.matchType(n.child(l).type);return a&&a.validEnd?o:null}(s,t);return i?r.map(wx).concat({type:t,attrs:n}).concat(i.map(wx)):null}(o,e,t);return!!a&&(s&&s(n.tr.wrap(o,a).scrollIntoView()),!0)}}function tC(e,t=null){return function(n,s){let r=!1;for(let i=0;i<n.selection.ranges.length&&!r;i++){let{$from:{pos:s},$to:{pos:o}}=n.selection.ranges[i];n.doc.nodesBetween(s,o,(s,i)=>{if(r)return!1;if(s.isTextblock&&!s.hasMarkup(e,t))if(s.type==e)r=!0;else{let t=n.doc.resolve(i),s=t.index();r=t.parent.canReplaceWith(s,s+1,e)}})}if(!r)return!1;if(s){let r=n.tr;for(let s=0;s<n.selection.ranges.length;s++){let{$from:{pos:i},$to:{pos:o}}=n.selection.ranges[s];r.setBlockType(i,o,e,t)}s(r.scrollIntoView())}return!0}}function nC(...e){return function(t,n,s){for(let r=0;r<e.length;r++)if(e[r](t,n,s))return!0;return!1}}nC(Dx,_x,Hx),nC(Dx,Fx,Bx),nC(Zx,qx,Jx,Gx),"undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):"undefined"!=typeof os&&os.platform&&os.platform();const sC=Math.pow(2,16);function rC(e,t){return e+t*sC}function iC(e){return 65535&e}class oC{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class aC{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&aC.empty)return aC.empty}recover(e){let t=0,n=iC(e);if(!this.inverted)for(let s=0;s<n;s++)t+=this.ranges[3*s+2]-this.ranges[3*s+1];return this.ranges[3*n]+t+function(e){return(e-(65535&e))/sC}(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let s=0,r=this.inverted?2:1,i=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let a=this.ranges[o]-(this.inverted?s:0);if(a>e)break;let l=this.ranges[o+r],c=this.ranges[o+i],d=a+l;if(e<=d){let r=a+s+((l?e==a?-1:e==d?1:t:t)<0?0:c);if(n)return r;let i=e==(t<0?a:d)?null:rC(o/3,e-a),u=e==a?2:e==d?1:4;return(t<0?e!=a:e!=d)&&(u|=8),new oC(r,u,i)}s+=c-l}return n?e+s:new oC(e+s,0,null)}touches(e,t){let n=0,s=iC(t),r=this.inverted?2:1,i=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let t=this.ranges[o]-(this.inverted?n:0);if(t>e)break;let a=this.ranges[o+r];if(e<=t+a&&o==3*s)return!0;n+=this.ranges[o+i]-a}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let s=0,r=0;s<this.ranges.length;s+=3){let i=this.ranges[s],o=i-(this.inverted?r:0),a=i+(this.inverted?0:r),l=this.ranges[s+t],c=this.ranges[s+n];e(o,o+l,a,a+c),r+=c-l}}invert(){return new aC(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return 0==e?aC.empty:new aC(e<0?[0,-e,0]:[0,0,e])}}aC.empty=new aC([]);const lC=Object.create(null);class cC{getMap(){return aC.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=lC[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in lC)throw new RangeError("Duplicate use of step JSON ID "+e);return lC[e]=t,t.prototype.jsonID=e,t}}class dC{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new dC(e,null)}static fail(e){return new dC(null,e)}static fromReplace(e,t,n,s){try{return dC.ok(e.replace(t,n,s))}catch(r){if(r instanceof Vu)return dC.fail(r.message);throw r}}}function uC(e,t,n){let s=[];for(let r=0;r<e.childCount;r++){let i=e.child(r);i.content.size&&(i=i.copy(uC(i.content,t,i))),i.isInline&&(i=t(i,n,r)),s.push(i)}return Lu.fromArray(s)}class hC extends cC{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),s=n.node(n.sharedDepth(this.to)),r=new Hu(uC(t.content,(e,t)=>e.isAtom&&t.type.allowsMarkType(this.mark.type)?e.mark(this.mark.addToSet(e.marks)):e,s),t.openStart,t.openEnd);return dC.fromReplace(e,this.from,this.to,r)}invert(){return new pC(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new hC(t.pos,n.pos,this.mark)}merge(e){return e instanceof hC&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new hC(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new hC(t.from,t.to,e.markFromJSON(t.mark))}}cC.jsonID("addMark",hC);class pC extends cC{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new Hu(uC(t.content,e=>e.mark(this.mark.removeFromSet(e.marks)),e),t.openStart,t.openEnd);return dC.fromReplace(e,this.from,this.to,n)}invert(){return new hC(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new pC(t.pos,n.pos,this.mark)}merge(e){return e instanceof pC&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new pC(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new pC(t.from,t.to,e.markFromJSON(t.mark))}}cC.jsonID("removeMark",pC);class mC extends cC{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return dC.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return dC.fromReplace(e,this.pos,this.pos+1,new Hu(Lu.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let e=this.mark.addToSet(t.marks);if(e.length==t.marks.length){for(let n=0;n<t.marks.length;n++)if(!t.marks[n].isInSet(e))return new mC(this.pos,t.marks[n]);return new mC(this.pos,this.mark)}}return new fC(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new mC(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new mC(t.pos,e.markFromJSON(t.mark))}}cC.jsonID("addNodeMark",mC);class fC extends cC{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return dC.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return dC.fromReplace(e,this.pos,this.pos+1,new Hu(Lu.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return t&&this.mark.isInSet(t.marks)?new mC(this.pos,this.mark):this}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new fC(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new fC(t.pos,e.markFromJSON(t.mark))}}cC.jsonID("removeNodeMark",fC);class gC extends cC{constructor(e,t,n,s=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=s}apply(e){return this.structure&&xC(e,this.from,this.to)?dC.fail("Structure replace would overwrite content"):dC.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new aC([this.from,this.to-this.from,this.slice.size])}invert(e){return new gC(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new gC(t.pos,Math.max(t.pos,n.pos),this.slice,this.structure)}merge(e){if(!(e instanceof gC)||e.structure||this.structure)return null;if(this.from+this.slice.size!=e.from||this.slice.openEnd||e.slice.openStart){if(e.to!=this.from||this.slice.openStart||e.slice.openEnd)return null;{let t=this.slice.size+e.slice.size==0?Hu.empty:new Hu(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new gC(e.from,this.to,t,this.structure)}}{let t=this.slice.size+e.slice.size==0?Hu.empty:new Hu(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new gC(this.from,this.to+(e.to-e.from),t,this.structure)}}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new gC(t.from,t.to,Hu.fromJSON(e,t.slice),!!t.structure)}}cC.jsonID("replace",gC);class yC extends cC{constructor(e,t,n,s,r,i,o=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=s,this.slice=r,this.insert=i,this.structure=o}apply(e){if(this.structure&&(xC(e,this.from,this.gapFrom)||xC(e,this.gapTo,this.to)))return dC.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return dC.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?dC.fromReplace(e,this.from,this.to,n):dC.fail("Content does not fit in gap")}getMap(){return new aC([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new yC(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),s=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),r=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||s<t.pos||r>n.pos?null:new yC(t.pos,n.pos,s,r,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to||"number"!=typeof t.gapFrom||"number"!=typeof t.gapTo||"number"!=typeof t.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new yC(t.from,t.to,t.gapFrom,t.gapTo,Hu.fromJSON(e,t.slice),t.insert,!!t.structure)}}function xC(e,t,n){let s=e.resolve(t),r=n-t,i=s.depth;for(;r>0&&i>0&&s.indexAfter(i)==s.node(i).childCount;)i--,r--;if(r>0){let e=s.node(i).maybeChild(s.indexAfter(i));for(;r>0;){if(!e||e.isLeaf)return!0;e=e.firstChild,r--}}return!1}function CC(e,t,n){return(0==t||e.canReplace(t,e.childCount))&&(n==e.childCount||e.canReplace(0,n))}function bC(e){return{type:e,attrs:null}}function wC(e,t,n=1,s){let r=e.resolve(t),i=r.depth-n,o=r.parent;if(i<0||r.parent.type.spec.isolating||!r.parent.canReplace(r.index(),r.parent.childCount)||!o.type.validContent(r.parent.content.cutByIndex(r.index(),r.parent.childCount)))return!1;for(let l=r.depth-1,c=n-2;l>i;l--,c--){let e=r.node(l),t=r.index(l);if(e.type.spec.isolating)return!1;let n=e.content.cutByIndex(t,e.childCount),s=e;if(!e.canReplace(t+1,e.childCount)||!s.type.validContent(n))return!1}let a=r.indexAfter(i);return r.node(i).canReplaceWith(a,a,r.node(i+1).type)}function vC(e,t){let n=e.resolve(t),s=n.index();return r=n.nodeBefore,i=n.nodeAfter,!(!r||!i||r.isLeaf||!function(e,t){t.content.size||e.type.compatibleContent(t.type);let n=e.contentMatchAt(e.childCount),{linebreakReplacement:s}=e.type.schema;for(let r=0;r<t.childCount;r++){let i=t.child(r),o=i.type==s?e.type.schema.nodes.text:i.type;if(n=n.matchType(o),!n)return!1;if(!e.type.allowsMarks(i.marks))return!1}return n.validEnd}(r,i))&&n.parent.canReplace(s,s+1);var r,i}cC.jsonID("replaceAround",yC);class kC extends cC{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return dC.fail("No node at attribute step's position");let n=Object.create(null);for(let r in t.attrs)n[r]=t.attrs[r];n[this.attr]=this.value;let s=t.type.create(n,null,t.marks);return dC.fromReplace(e,this.pos,this.pos+1,new Hu(Lu.from(s),0,t.isLeaf?0:1))}getMap(){return aC.empty}invert(e){return new kC(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new kC(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if("number"!=typeof t.pos||"string"!=typeof t.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new kC(t.pos,t.attr,t.value)}}cC.jsonID("attr",kC);class MC extends cC{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let s in e.attrs)t[s]=e.attrs[s];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return dC.ok(n)}getMap(){return aC.empty}invert(e){return new MC(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if("string"!=typeof t.attr)throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new MC(t.attr,t.value)}}cC.jsonID("docAttr",MC);let SC=class extends Error{};function NC(e,t=null){return function(n,s){let{$from:r,$to:i}=n.selection,o=r.blockRange(i);if(!o)return!1;let a=s?n.tr:null;return!!function(e,t,n,s=null){let r=!1,i=t,o=t.$from.doc;if(t.depth>=2&&t.$from.node(t.depth-1).type.compatibleContent(n)&&0==t.startIndex){if(0==t.$from.index(t.depth-1))return!1;let e=o.resolve(t.start-2);i=new th(e,e,t.depth),t.endIndex<t.parent.childCount&&(t=new th(t.$from,o.resolve(t.$to.end(t.depth)),t.depth)),r=!0}let a=function(e,t,n=null,s=e){let r=function(e,t){let{parent:n,startIndex:s,endIndex:r}=e,i=n.contentMatchAt(s).findWrapping(t);if(!i)return null;let o=i.length?i[0]:t;return n.canReplaceWith(s,r,o)?i:null}(e,t),i=r&&function(e,t){let{parent:n,startIndex:s,endIndex:r}=e,i=n.child(s),o=t.contentMatch.findWrapping(i.type);if(!o)return null;let a=(o.length?o[o.length-1]:t).contentMatch;for(let l=s;a&&l<r;l++)a=a.matchType(n.child(l).type);return a&&a.validEnd?o:null}(s,t);return i?r.map(bC).concat({type:t,attrs:n}).concat(i.map(bC)):null}(i,n,s,t);if(!a)return!1;e&&function(e,t,n,s,r){let i=Lu.empty;for(let d=n.length-1;d>=0;d--)i=Lu.from(n[d].type.create(n[d].attrs,i));e.step(new yC(t.start-(s?2:0),t.end,t.start,t.end,new Hu(i,0,0),n.length,!0));let o=0;for(let d=0;d<n.length;d++)n[d].type==r&&(o=d+1);let a=n.length-o,l=t.start+n.length-(s?2:0),c=t.parent;for(let d=t.startIndex,u=t.endIndex,h=!0;d<u;d++,h=!1)!h&&wC(e.doc,l,a)&&(e.split(l,a),l+=2*a),l+=c.child(d).nodeSize}(e,t,a,r,n);return!0}(a,o,e,t)&&(s&&s(a.scrollIntoView()),!0)}}function TC(e){return function(t,n){let{$from:s,$to:r}=t.selection,i=s.blockRange(r,t=>t.childCount>0&&t.firstChild.type==e);return!!i&&(!n||(s.node(i.depth-1).type==e?function(e,t,n,s){let r=e.tr,i=s.end,o=s.$to.end(s.depth);i<o&&(r.step(new yC(i-1,o,i,o,new Hu(Lu.from(n.create(null,s.parent.copy())),1,0),1,!0)),s=new th(r.doc.resolve(s.$from.pos),r.doc.resolve(o),s.depth));const a=function(e){let t=e.parent.content.cutByIndex(e.startIndex,e.endIndex);for(let n=e.depth;;--n){let s=e.$from.node(n),r=e.$from.index(n),i=e.$to.indexAfter(n);if(n<e.depth&&s.canReplace(r,i,t))return n;if(0==n||s.type.spec.isolating||!CC(s,r,i))break}return null}(s);if(null==a)return!1;r.lift(s,a);let l=r.doc.resolve(r.mapping.map(i,-1)-1);vC(r.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&r.join(l.pos);return t(r.scrollIntoView()),!0}(t,n,e,i):function(e,t,n){let s=e.tr,r=n.parent;for(let p=n.end,m=n.endIndex-1,f=n.startIndex;m>f;m--)p-=r.child(m).nodeSize,s.delete(p-1,p+1);let i=s.doc.resolve(n.start),o=i.nodeAfter;if(s.mapping.map(n.end)!=n.start+i.nodeAfter.nodeSize)return!1;let a=0==n.startIndex,l=n.endIndex==r.childCount,c=i.node(-1),d=i.index(-1);if(!c.canReplace(d+(a?0:1),d+1,o.content.append(l?Lu.empty:Lu.from(r))))return!1;let u=i.pos,h=u+o.nodeSize;return s.step(new yC(u-(a?1:0),h+(l?1:0),u+1,h-1,new Hu((a?Lu.empty:Lu.from(r.copy(Lu.empty))).append(l?Lu.empty:Lu.from(r.copy(Lu.empty))),a?0:1,l?0:1),a?0:1)),t(s.scrollIntoView()),!0}(t,n,i)))}}SC=function e(t){let n=Error.call(this,t);return n.__proto__=e.prototype,n},(SC.prototype=Object.create(Error.prototype)).constructor=SC,SC.prototype.name="TransformError";var EC=Object.defineProperty,jC=(e,t)=>{for(var n in t)EC(e,n,{get:t[n],enumerable:!0})};function AC(e){const{state:t,transaction:n}=e;let{selection:s}=n,{doc:r}=n,{storedMarks:i}=n;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return i},get selection(){return s},get doc(){return r},get tr(){return s=n.selection,r=n.doc,i=n.storedMarks,n}}}var IC=class{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:n}=this,{view:s}=t,{tr:r}=n,i=this.buildProps(r);return Object.fromEntries(Object.entries(e).map(([e,t])=>[e,(...e)=>{const n=t(...e)(i);return r.getMeta("preventDispatch")||this.hasCustomState||s.dispatch(r),n}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:n,editor:s,state:r}=this,{view:i}=s,o=[],a=!!e,l=e||r.tr,c={...Object.fromEntries(Object.entries(n).map(([e,n])=>[e,(...e)=>{const s=this.buildProps(l,t),r=n(...e)(s);return o.push(r),c}])),run:()=>(a||!t||l.getMeta("preventDispatch")||this.hasCustomState||i.dispatch(l),o.every(e=>!0===e))};return c}createCan(e){const{rawCommands:t,state:n}=this,s=!1,r=e||n.tr,i=this.buildProps(r,s);return{...Object.fromEntries(Object.entries(t).map(([e,t])=>[e,(...e)=>t(...e)({...i,dispatch:void 0})])),chain:()=>this.createChain(r,s)}}buildProps(e,t=!0){const{rawCommands:n,editor:s,state:r}=this,{view:i}=s,o={tr:e,editor:s,view:i,state:AC({state:r,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e,t),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(n).map(([e,t])=>[e,(...e)=>t(...e)(o)]))}};return o}},OC=class{constructor(){this.callbacks={}}on(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),this}emit(e,...t){const n=this.callbacks[e];return n&&n.forEach(e=>e.apply(this,t)),this}off(e,t){const n=this.callbacks[e];return n&&(t?this.callbacks[e]=n.filter(e=>e!==t):delete this.callbacks[e]),this}once(e,t){const n=(...s)=>{this.off(e,n),t.apply(this,s)};return this.on(e,n)}removeAllListeners(){this.callbacks={}}};function LC(e,t){const n=new nx(e);return t.forEach(e=>{e.steps.forEach(e=>{n.step(e)})}),n}var DC=e=>{const t=e.childNodes;for(let n=t.length-1;n>=0;n-=1){const s=t[n];3===s.nodeType&&s.nodeValue&&/^(\n\s\s|\n)$/.test(s.nodeValue)?e.removeChild(s):1===s.nodeType&&DC(s)}return e};function RC(e){if("undefined"==typeof window)throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const t=`<body>${e}</body>`,n=(new window.DOMParser).parseFromString(t,"text/html").body;return DC(n)}function _C(e,t,n){if(e instanceof sh||e instanceof Lu)return e;n={slice:!0,parseOptions:{},...n};const s="string"==typeof e;if("object"==typeof e&&null!==e)try{if(Array.isArray(e)&&e.length>0)return Lu.fromArray(e.map(e=>t.nodeFromJSON(e)));const s=t.nodeFromJSON(e);return n.errorOnInvalidContent&&s.check(),s}catch(r){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:r});return _C("",t,n)}if(s){if(n.errorOnInvalidContent){let s=!1,r="";const i=new vh({topNode:t.spec.topNode,marks:t.spec.marks,nodes:t.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:e=>(s=!0,r="string"==typeof e?e:e.outerHTML,null)}]}})});if(n.slice?Mh.fromSchema(i).parseSlice(RC(e),n.parseOptions):Mh.fromSchema(i).parse(RC(e),n.parseOptions),n.errorOnInvalidContent&&s)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${r}`)})}const s=Mh.fromSchema(t);return n.slice?s.parseSlice(RC(e),n.parseOptions).content:s.parse(RC(e),n.parseOptions)}return _C("",t,n)}function PC(e,t,n={},s={}){return _C(e,t,{slice:!1,parseOptions:n,errorOnInvalidContent:s.errorOnInvalidContent})}function VC(e){return t=>function(e,t){for(let n=e.depth;n>0;n-=1){const s=e.node(n);if(t(s))return{pos:n>0?e.before(n):0,start:e.start(n),depth:n,node:s}}}(t.$from,e)}function HC(e,t,n){if(void 0===e.config[t]&&e.parent)return HC(e.parent,t,n);if("function"==typeof e.config[t]){return e.config[t].bind({...n,parent:e.parent?HC(e.parent,t,n):null})}return e.config[t]}function $C(e){return e.map(e=>{const t=HC(e,"addExtensions",{name:e.name,options:e.options,storage:e.storage});return t?[e,...$C(t())]:e}).flat(10)}function zC(e,t){const n=Dh.fromSchema(t).serializeFragment(e),s=document.implementation.createHTMLDocument().createElement("div");return s.appendChild(n),s.innerHTML}function FC(e){return"function"==typeof e}function BC(e,t=void 0,...n){return FC(e)?t?e.bind(t)(...n):e(...n):e}function WC(e){return{baseExtensions:e.filter(e=>"extension"===e.type),nodeExtensions:e.filter(e=>"node"===e.type),markExtensions:e.filter(e=>"mark"===e.type)}}function ZC(e){const t=[],{nodeExtensions:n,markExtensions:s}=WC(e),r=[...n,...s],i={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return e.forEach(e=>{const n=HC(e,"addGlobalAttributes",{name:e.name,options:e.options,storage:e.storage,extensions:r});if(!n)return;n().forEach(e=>{e.types.forEach(n=>{Object.entries(e.attributes).forEach(([e,s])=>{t.push({type:n,name:e,attribute:{...i,...s}})})})})}),r.forEach(e=>{const n={name:e.name,options:e.options,storage:e.storage},s=HC(e,"addAttributes",n);if(!s)return;const r=s();Object.entries(r).forEach(([n,s])=>{const r={...i,...s};"function"==typeof(null==r?void 0:r.default)&&(r.default=r.default()),(null==r?void 0:r.isRequired)&&void 0===(null==r?void 0:r.default)&&delete r.default,t.push({type:e.name,name:n,attribute:r})})}),t}function UC(...e){return e.filter(e=>!!e).reduce((e,t)=>{const n={...e};return Object.entries(t).forEach(([e,t])=>{if(n[e])if("class"===e){const s=t?String(t).split(" "):[],r=n[e]?n[e].split(" "):[],i=s.filter(e=>!r.includes(e));n[e]=[...r,...i].join(" ")}else if("style"===e){const s=t?t.split(";").map(e=>e.trim()).filter(Boolean):[],r=n[e]?n[e].split(";").map(e=>e.trim()).filter(Boolean):[],i=new Map;r.forEach(e=>{const[t,n]=e.split(":").map(e=>e.trim());i.set(t,n)}),s.forEach(e=>{const[t,n]=e.split(":").map(e=>e.trim());i.set(t,n)}),n[e]=Array.from(i.entries()).map(([e,t])=>`${e}: ${t}`).join("; ")}else n[e]=t;else n[e]=t}),n},{})}function qC(e,t){return t.filter(t=>t.type===e.type.name).filter(e=>e.attribute.rendered).map(t=>t.attribute.renderHTML?t.attribute.renderHTML(e.attrs)||{}:{[t.name]:e.attrs[t.name]}).reduce((e,t)=>UC(e,t),{})}function JC(e,t){return"style"in e?e:{...e,getAttrs:n=>{const s=e.getAttrs?e.getAttrs(n):e.attrs;if(!1===s)return!1;const r=t.reduce((e,t)=>{const s=t.attribute.parseHTML?t.attribute.parseHTML(n):function(e){return"string"!=typeof e?e:e.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(e):"true"===e||"false"!==e&&e}(n.getAttribute(t.name));return null==s?e:{...e,[t.name]:s}},{});return{...s,...r}}}}function GC(e){return Object.fromEntries(Object.entries(e).filter(([e,t])=>("attrs"!==e||!function(e={}){return 0===Object.keys(e).length&&e.constructor===Object}(t))&&null!=t))}function KC(e){return e.sort((e,t)=>{const n=HC(e,"priority")||100,s=HC(t,"priority")||100;return n>s?-1:n<s?1:0})}function YC(e){const t=KC($C(e));return function(e){const t=e.filter((t,n)=>e.indexOf(t)!==n);return Array.from(new Set(t))}(t.map(e=>e.name)).length,t}function QC(e,t,n){const{from:s,to:r}=t,{blockSeparator:i="\n\n",textSerializers:o={}}=n||{};let a="";return e.nodesBetween(s,r,(e,n,l,c)=>{var d;e.isBlock&&n>s&&(a+=i);const u=null==o?void 0:o[e.type.name];if(u)return l&&(a+=u({node:e,pos:n,parent:l,index:c,range:t})),!1;e.isText&&(a+=null==(d=null==e?void 0:e.text)?void 0:d.slice(Math.max(s,n)-n,r-n))}),a}function XC(e){return Object.fromEntries(Object.entries(e.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}function eb(e,t){if("string"==typeof e){if(!t.marks[e])throw Error(`There is no mark type named '${e}'. Maybe you forgot to add the extension?`);return t.marks[e]}return e}function tb(e,t){const n=eb(t,e.schema),{from:s,to:r,empty:i}=e.selection,o=[];i?(e.storedMarks&&o.push(...e.storedMarks),o.push(...e.selection.$head.marks())):e.doc.nodesBetween(s,r,e=>{o.push(...e.marks)});const a=o.find(e=>e.type.name===n.name);return a?{...a.attrs}:{}}function nb(e,t){if("string"==typeof e){if(!t.nodes[e])throw Error(`There is no node type named '${e}'. Maybe you forgot to add the extension?`);return t.nodes[e]}return e}function sb(e,t){return t.nodes[e]?"node":t.marks[e]?"mark":null}function rb(e,t){const n=sb("string"==typeof t?t:t.name,e.schema);return"node"===n?function(e,t){const n=nb(t,e.schema),{from:s,to:r}=e.selection,i=[];e.doc.nodesBetween(s,r,e=>{i.push(e)});const o=i.reverse().find(e=>e.type.name===n.name);return o?{...o.attrs}:{}}(e,t):"mark"===n?tb(e,t):{}}function ib(e){const t=function(e,t=JSON.stringify){const n={};return e.filter(e=>{const s=t(e);return!Object.prototype.hasOwnProperty.call(n,s)&&(n[s]=!0)})}(e);return 1===t.length?t:t.filter((e,n)=>{const s=t.filter((e,t)=>t!==n);return!s.some(t=>e.oldRange.from>=t.oldRange.from&&e.oldRange.to<=t.oldRange.to&&e.newRange.from>=t.newRange.from&&e.newRange.to<=t.newRange.to)})}function ob(e){const{mapping:t,steps:n}=e,s=[];return t.maps.forEach((e,r)=>{const i=[];if(e.ranges.length)e.forEach((e,t)=>{i.push({from:e,to:t})});else{const{from:e,to:t}=n[r];if(void 0===e||void 0===t)return;i.push({from:e,to:t})}i.forEach(({from:e,to:n})=>{const i=t.slice(r).map(e,-1),o=t.slice(r).map(n),a=t.invert().map(i,-1),l=t.invert().map(o);s.push({oldRange:{from:a,to:l},newRange:{from:i,to:o}})})}),ib(s)}function ab(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function lb(e,t,n={strict:!0}){const s=Object.keys(t);return!s.length||s.every(s=>n.strict?t[s]===e[s]:ab(t[s])?t[s].test(e[s]):t[s]===e[s])}function cb(e,t,n={}){return e.find(e=>e.type===t&&lb(Object.fromEntries(Object.keys(n).map(t=>[t,e.attrs[t]])),n))}function db(e,t,n={}){return!!cb(e,t,n)}function ub(e,t,n){var s;if(!e||!t)return;let r=e.parent.childAfter(e.parentOffset);if(r.node&&r.node.marks.some(e=>e.type===t)||(r=e.parent.childBefore(e.parentOffset)),!r.node||!r.node.marks.some(e=>e.type===t))return;n=n||(null==(s=r.node.marks[0])?void 0:s.attrs);if(!cb([...r.node.marks],t,n))return;let i=r.index,o=e.start()+r.offset,a=i+1,l=o+r.node.nodeSize;for(;i>0&&db([...e.parent.child(i-1).marks],t,n);)i-=1,o-=e.parent.child(i).nodeSize;for(;a<e.parent.childCount&&db([...e.parent.child(a).marks],t,n);)l+=e.parent.child(a).nodeSize,a+=1;return{from:o,to:l}}function hb(e,t,n){const s=[];return e===t?n.resolve(e).marks().forEach(t=>{const r=ub(n.resolve(e),t.type);r&&s.push({mark:t,...r})}):n.nodesBetween(e,t,(e,t)=>{e&&void 0!==(null==e?void 0:e.nodeSize)&&s.push(...e.marks.map(n=>({from:t,to:t+e.nodeSize,mark:n})))}),s}function pb(e,t){return t.nodes[e]||t.marks[e]||null}function mb(e,t,n){return Object.fromEntries(Object.entries(n).filter(([n])=>{const s=e.find(e=>e.type===t&&e.name===n);return!!s&&s.attribute.keepOnSplit}))}function fb(e,t,n={}){const{empty:s,ranges:r}=e.selection,i=t?eb(t,e.schema):null;if(s)return!!(e.storedMarks||e.selection.$from.marks()).filter(e=>!i||i.name===e.type.name).find(e=>lb(e.attrs,n,{strict:!1}));let o=0;const a=[];if(r.forEach(({$from:t,$to:n})=>{const s=t.pos,r=n.pos;e.doc.nodesBetween(s,r,(e,t)=>{if(!e.isText&&!e.marks.length)return;const n=Math.max(s,t),i=Math.min(r,t+e.nodeSize);o+=i-n,a.push(...e.marks.map(e=>({mark:e,from:n,to:i})))})}),0===o)return!1;const l=a.filter(e=>!i||i.name===e.mark.type.name).filter(e=>lb(e.mark.attrs,n,{strict:!1})).reduce((e,t)=>e+t.to-t.from,0),c=a.filter(e=>!i||e.mark.type!==i&&e.mark.type.excludes(i)).reduce((e,t)=>e+t.to-t.from,0);return(l>0?l+c:l)>=o}function gb(e,t,n={}){const{from:s,to:r,empty:i}=e.selection,o=t?nb(t,e.schema):null,a=[];e.doc.nodesBetween(s,r,(e,t)=>{if(e.isText)return;const n=Math.max(s,t),i=Math.min(r,t+e.nodeSize);a.push({node:e,from:n,to:i})});const l=r-s,c=a.filter(e=>!o||o.name===e.node.type.name).filter(e=>lb(e.node.attrs,n,{strict:!1}));if(i)return!!c.length;return c.reduce((e,t)=>e+t.to-t.from,0)>=l}function yb(e,t){return Array.isArray(t)?t.some(t=>("string"==typeof t?t:t.name)===e.name):t}function xb(e,t){const{nodeExtensions:n}=WC(t),s=n.find(t=>t.name===e);if(!s)return!1;const r=BC(HC(s,"group",{name:s.name,options:s.options,storage:s.storage}));return"string"==typeof r&&r.split(" ").includes("list")}function Cb(e,{checkChildren:t=!0,ignoreWhitespace:n=!1}={}){var s;if(n){if("hardBreak"===e.type.name)return!0;if(e.isText)return/^\s*$/m.test(null!=(s=e.text)?s:"")}if(e.isText)return!e.text;if(e.isAtom||e.isLeaf)return!1;if(0===e.content.childCount)return!0;if(t){let s=!0;return e.content.forEach(e=>{!1!==s&&(Cb(e,{ignoreWhitespace:n,checkChildren:t})||(s=!1))}),s}return!1}function bb(e){return e instanceof Mp}function wb(e){return e instanceof vp}function vb(e=0,t=0,n=0){return Math.min(Math.max(e,t),n)}function kb(e,t=null){if(!t)return null;const n=xp.atStart(e),s=xp.atEnd(e);if("start"===t||!0===t)return n;if("end"===t)return s;const r=n.from,i=s.to;return"all"===t?vp.create(e,vb(0,r,i),vb(e.content.size,r,i)):vp.create(e,vb(t,r,i),vb(t,r,i))}var Mb=class{constructor(e){var t;this.find=e.find,this.handler=e.handler,this.undoable=null==(t=e.undoable)||t}};function Sb(e){var t;const{editor:n,from:s,to:r,text:i,rules:o,plugin:a}=e,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(s);if(c.parent.type.spec.code||(null==(t=c.nodeBefore||c.nodeAfter)?void 0:t.marks.find(e=>e.type.spec.code)))return!1;let d=!1;const u=((e,t=500)=>{let n="";const s=e.parentOffset;return e.parent.nodesBetween(Math.max(0,s-t),s,(e,t,r,i)=>{var o,a;const l=(null==(a=(o=e.type.spec).toText)?void 0:a.call(o,{node:e,pos:t,parent:r,index:i}))||e.textContent||"%leaf%";n+=e.isAtom&&!e.isText?l:l.slice(0,Math.max(0,s-t))}),n})(c)+i;return o.forEach(e=>{if(d)return;const t=((e,t)=>{if(ab(t))return t.exec(e);const n=t(e);if(!n)return null;const s=[n.text];return s.index=n.index,s.input=e,s.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith),s.push(n.replaceWith)),s})(u,e.find);if(!t)return;const o=l.state.tr,c=AC({state:l.state,transaction:o}),h={from:s-(t[0].length-i.length),to:r},{commands:p,chain:m,can:f}=new IC({editor:n,state:c});null!==e.handler({state:c,range:h,match:t,commands:p,chain:m,can:f})&&o.steps.length&&(e.undoable&&o.setMeta(a,{transform:o,from:s,to:r,text:i}),l.dispatch(o),d=!0)}),d}function Nb(e){return"Object"===function(e){return Object.prototype.toString.call(e).slice(8,-1)}(e)&&(e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype)}function Tb(e,t){const n={...e};return Nb(e)&&Nb(t)&&Object.keys(t).forEach(s=>{Nb(t[s])&&Nb(e[s])?n[s]=Tb(e[s],t[s]):n[s]=t[s]}),n}var Eb=class{constructor(e={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...e},this.name=this.config.name}get options(){return{...BC(HC(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...BC(HC(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(e={}){const t=this.extend({...this.config,addOptions:()=>Tb(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new this.constructor({...this.config,...e});return t.parent=this,this.child=t,t.name="name"in e?e.name:t.parent.name,t}},jb=class e extends Eb{constructor(){super(...arguments),this.type="mark"}static create(t={}){const n="function"==typeof t?t():t;return new e(n)}static handleExit({editor:e,mark:t}){const{tr:n}=e.state,s=e.state.selection.$from;if(s.pos===s.end()){const r=s.marks();if(!!!r.find(e=>(null==e?void 0:e.type.name)===t.name))return!1;const i=r.find(e=>(null==e?void 0:e.type.name)===t.name);return i&&n.removeStoredMark(i),n.insertText(" ",s.pos),e.view.dispatch(n),!0}return!1}configure(e){return super.configure(e)}extend(e){const t="function"==typeof e?e():e;return super.extend(t)}};var Ab=class{constructor(e){this.find=e.find,this.handler=e.handler}};function Ib(e){const{editor:t,state:n,from:s,to:r,rule:i,pasteEvent:o,dropEvent:a}=e,{commands:l,chain:c,can:d}=new IC({editor:t,state:n}),u=[];n.doc.nodesBetween(s,r,(e,t)=>{var h,p,m,f,g;if((null==(p=null==(h=e.type)?void 0:h.spec)?void 0:p.code)||!(e.isText||e.isTextblock||e.isInline))return;const y=null!=(g=null!=(f=null==(m=e.content)?void 0:m.size)?f:e.nodeSize)?g:0,x=Math.max(s,t),C=Math.min(r,t+y);if(x>=C)return;((e,t,n)=>{if(ab(t))return[...e.matchAll(t)];const s=t(e,n);return s?s.map(t=>{const n=[t.text];return n.index=t.index,n.input=e,n.data=t.data,t.replaceWith&&(t.text.includes(t.replaceWith),n.push(t.replaceWith)),n}):[]})(e.isText?e.text||"":e.textBetween(x-t,C-t,void 0,"￼"),i.find,o).forEach(e=>{if(void 0===e.index)return;const t=x+e.index+1,s=t+e[0].length,r={from:n.tr.mapping.map(t),to:n.tr.mapping.map(s)},h=i.handler({state:n,range:r,match:e,commands:l,chain:c,can:d,pasteEvent:o,dropEvent:a});u.push(h)})});return u.every(e=>null!==e)}var Ob=null;function Lb(e){const{editor:t,rules:n}=e;let s,r=null,i=!1,o=!1,a="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null;try{s="undefined"!=typeof DragEvent?new DragEvent("drop"):null}catch{s=null}const l=({state:e,from:n,to:r,rule:i,pasteEvt:o})=>{const l=e.tr,c=AC({state:e,transaction:l});if(Ib({editor:t,state:c,from:Math.max(n-1,0),to:r.b-1,rule:i,pasteEvent:o,dropEvent:s})&&l.steps.length){try{s="undefined"!=typeof DragEvent?new DragEvent("drop"):null}catch{s=null}return a="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null,l}};return n.map(e=>new Pp({view(e){const n=n=>{var s;r=(null==(s=e.dom.parentElement)?void 0:s.contains(n.target))?e.dom.parentElement:null,r&&(Ob=t)},s=()=>{Ob&&(Ob=null)};return window.addEventListener("dragstart",n),window.addEventListener("dragend",s),{destroy(){window.removeEventListener("dragstart",n),window.removeEventListener("dragend",s)}}},props:{handleDOMEvents:{drop:(e,t)=>{if(o=r===e.dom.parentElement,s=t,!o){const e=Ob;(null==e?void 0:e.isEditable)&&setTimeout(()=>{const t=e.state.selection;t&&e.commands.deleteRange({from:t.from,to:t.to})},10)}return!1},paste:(e,t)=>{var n;const s=null==(n=t.clipboardData)?void 0:n.getData("text/html");return a=t,i=!!(null==s?void 0:s.includes("data-pm-slice")),!1}}},appendTransaction:(t,n,s)=>{const r=t[0],c="paste"===r.getMeta("uiEvent")&&!i,d="drop"===r.getMeta("uiEvent")&&!o,u=r.getMeta("applyPasteRules"),h=!!u;if(!c&&!d&&!h)return;if(h){let{text:t}=u;"string"==typeof t||(t=zC(Lu.from(t),s.schema));const{from:n}=u,r=n+t.length,i=(e=>{var t;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return null==(t=n.clipboardData)||t.setData("text/html",e),n})(t);return l({rule:e,state:s,from:n,to:{b:r},pasteEvt:i})}const p=n.doc.content.findDiffStart(s.doc.content),m=n.doc.content.findDiffEnd(s.doc.content);return"number"==typeof p&&m&&p!==m.b?l({rule:e,state:s,from:p,to:m,pasteEvt:a}):void 0}}))}var Db=class{constructor(e,t){this.splittableMarks=[],this.editor=t,this.extensions=YC(e),this.schema=function(e,t){var n;const s=ZC(e),{nodeExtensions:r,markExtensions:i}=WC(e),o=null==(n=r.find(e=>HC(e,"topNode")))?void 0:n.name,a=Object.fromEntries(r.map(n=>{const r=s.filter(e=>e.type===n.name),i={name:n.name,options:n.options,storage:n.storage,editor:t},o=GC({...e.reduce((e,t)=>{const s=HC(t,"extendNodeSchema",i);return{...e,...s?s(n):{}}},{}),content:BC(HC(n,"content",i)),marks:BC(HC(n,"marks",i)),group:BC(HC(n,"group",i)),inline:BC(HC(n,"inline",i)),atom:BC(HC(n,"atom",i)),selectable:BC(HC(n,"selectable",i)),draggable:BC(HC(n,"draggable",i)),code:BC(HC(n,"code",i)),whitespace:BC(HC(n,"whitespace",i)),linebreakReplacement:BC(HC(n,"linebreakReplacement",i)),defining:BC(HC(n,"defining",i)),isolating:BC(HC(n,"isolating",i)),attrs:Object.fromEntries(r.map(e=>{var t,n;return[e.name,{default:null==(t=null==e?void 0:e.attribute)?void 0:t.default,validate:null==(n=null==e?void 0:e.attribute)?void 0:n.validate}]}))}),a=BC(HC(n,"parseHTML",i));a&&(o.parseDOM=a.map(e=>JC(e,r)));const l=HC(n,"renderHTML",i);l&&(o.toDOM=e=>l({node:e,HTMLAttributes:qC(e,r)}));const c=HC(n,"renderText",i);return c&&(o.toText=c),[n.name,o]})),l=Object.fromEntries(i.map(n=>{const r=s.filter(e=>e.type===n.name),i={name:n.name,options:n.options,storage:n.storage,editor:t},o=GC({...e.reduce((e,t)=>{const s=HC(t,"extendMarkSchema",i);return{...e,...s?s(n):{}}},{}),inclusive:BC(HC(n,"inclusive",i)),excludes:BC(HC(n,"excludes",i)),group:BC(HC(n,"group",i)),spanning:BC(HC(n,"spanning",i)),code:BC(HC(n,"code",i)),attrs:Object.fromEntries(r.map(e=>{var t,n;return[e.name,{default:null==(t=null==e?void 0:e.attribute)?void 0:t.default,validate:null==(n=null==e?void 0:e.attribute)?void 0:n.validate}]}))}),a=BC(HC(n,"parseHTML",i));a&&(o.parseDOM=a.map(e=>JC(e,r)));const l=HC(n,"renderHTML",i);return l&&(o.toDOM=e=>l({mark:e,HTMLAttributes:qC(e,r)})),[n.name,o]}));return new vh({topNode:o,nodes:a,marks:l})}(this.extensions,t),this.setupExtensions()}get commands(){return this.extensions.reduce((e,t)=>{const n=HC(t,"addCommands",{name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:this.editor,type:pb(t.name,this.schema)});return n?{...e,...n()}:e},{})}get plugins(){const{editor:e}=this;return KC([...this.extensions].reverse()).flatMap(t=>{const n={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:e,type:pb(t.name,this.schema)},s=[],r=HC(t,"addKeyboardShortcuts",n);let i={};if("mark"===t.type&&HC(t,"exitable",n)&&(i.ArrowRight=()=>jb.handleExit({editor:e,mark:t})),r){const t=Object.fromEntries(Object.entries(r()).map(([t,n])=>[t,()=>n({editor:e})]));i={...i,...t}}const o=new Pp({props:{handleKeyDown:gy(i)}});s.push(o);const a=HC(t,"addInputRules",n);if(yb(t,e.options.enableInputRules)&&a){const t=a();if(t&&t.length){const n=function(e){const{editor:t,rules:n}=e,s=new Pp({state:{init:()=>null,apply(e,r,i){const o=e.getMeta(s);if(o)return o;const a=e.getMeta("applyInputRules");return!!a&&setTimeout(()=>{let{text:e}=a;"string"==typeof e||(e=zC(Lu.from(e),i.schema));const{from:r}=a,o=r+e.length;Sb({editor:t,from:r,to:o,text:e,rules:n,plugin:s})}),e.selectionSet||e.docChanged?null:r}},props:{handleTextInput:(e,r,i,o)=>Sb({editor:t,from:r,to:i,text:o,rules:n,plugin:s}),handleDOMEvents:{compositionend:e=>(setTimeout(()=>{const{$cursor:r}=e.state.selection;r&&Sb({editor:t,from:r.pos,to:r.pos,text:"",rules:n,plugin:s})}),!1)},handleKeyDown(e,r){if("Enter"!==r.key)return!1;const{$cursor:i}=e.state.selection;return!!i&&Sb({editor:t,from:i.pos,to:i.pos,text:"\n",rules:n,plugin:s})}},isInputRules:!0});return s}({editor:e,rules:t}),r=Array.isArray(n)?n:[n];s.push(...r)}}const l=HC(t,"addPasteRules",n);if(yb(t,e.options.enablePasteRules)&&l){const t=l();if(t&&t.length){const n=Lb({editor:e,rules:t});s.push(...n)}}const c=HC(t,"addProseMirrorPlugins",n);if(c){const e=c();s.push(...e)}return s})}get attributes(){return ZC(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:t}=WC(this.extensions);return Object.fromEntries(t.filter(e=>!!HC(e,"addNodeView")).map(t=>{const n=this.attributes.filter(e=>e.type===t.name),s={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:e,type:nb(t.name,this.schema)},r=HC(t,"addNodeView",s);if(!r)return[];return[t.name,(s,i,o,a,l)=>{const c=qC(s,n);return r()({node:s,view:i,getPos:o,decorations:a,innerDecorations:l,editor:e,extension:t,HTMLAttributes:c})}]}))}get markViews(){const{editor:e}=this,{markExtensions:t}=WC(this.extensions);return Object.fromEntries(t.filter(e=>!!HC(e,"addMarkView")).map(t=>{const n=this.attributes.filter(e=>e.type===t.name),s={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:e,type:eb(t.name,this.schema)},r=HC(t,"addMarkView",s);if(!r)return[];return[t.name,(s,i,o)=>{const a=qC(s,n);return r()({mark:s,view:i,inline:o,editor:e,extension:t,HTMLAttributes:a,updateAttributes:t=>{!function(e,t,n={}){const{state:s}=t,{doc:r,tr:i}=s,o=e;r.descendants((t,s)=>{const r=i.mapping.map(s),a=i.mapping.map(s)+t.nodeSize;let l=null;if(t.marks.forEach(e=>{if(e!==o)return!1;l=e}),!l)return;let c=!1;if(Object.keys(n).forEach(e=>{n[e]!==l.attrs[e]&&(c=!0)}),c){const t=e.type.create({...e.attrs,...n});i.removeMark(r,a,e.type),i.addMark(r,a,t)}}),i.docChanged&&t.view.dispatch(i)}(s,e,t)}})}]}))}setupExtensions(){const e=this.extensions;this.editor.extensionStorage=Object.fromEntries(e.map(e=>[e.name,e.storage])),e.forEach(e=>{var t;const n={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:pb(e.name,this.schema)};if("mark"===e.type){(null==(t=BC(HC(e,"keepOnSplit",n)))||t)&&this.splittableMarks.push(e.name)}const s=HC(e,"onBeforeCreate",n),r=HC(e,"onCreate",n),i=HC(e,"onUpdate",n),o=HC(e,"onSelectionUpdate",n),a=HC(e,"onTransaction",n),l=HC(e,"onFocus",n),c=HC(e,"onBlur",n),d=HC(e,"onDestroy",n);s&&this.editor.on("beforeCreate",s),r&&this.editor.on("create",r),i&&this.editor.on("update",i),o&&this.editor.on("selectionUpdate",o),a&&this.editor.on("transaction",a),l&&this.editor.on("focus",l),c&&this.editor.on("blur",c),d&&this.editor.on("destroy",d)})}};Db.resolve=YC,Db.sort=KC,Db.flatten=$C;jC({},{ClipboardTextSerializer:()=>_b,Commands:()=>Gw,Delete:()=>Kw,Drop:()=>Yw,Editable:()=>Qw,FocusEvents:()=>ev,Keymap:()=>tv,Paste:()=>nv,Tabindex:()=>sv,focusEventsPluginKey:()=>Xw});var Rb=class e extends Eb{constructor(){super(...arguments),this.type="extension"}static create(t={}){const n="function"==typeof t?t():t;return new e(n)}configure(e){return super.configure(e)}extend(e){const t="function"==typeof e?e():e;return super.extend(t)}},_b=Rb.create({name:"clipboardTextSerializer",addOptions:()=>({blockSeparator:void 0}),addProseMirrorPlugins(){return[new Pp({key:new $p("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:e}=this,{state:t,schema:n}=e,{doc:s,selection:r}=t,{ranges:i}=r,o=Math.min(...i.map(e=>e.$from.pos)),a=Math.max(...i.map(e=>e.$to.pos)),l=XC(n);return QC(s,{from:o,to:a},{...void 0!==this.options.blockSeparator?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),Pb={};jC(Pb,{blur:()=>Vb,clearContent:()=>Hb,clearNodes:()=>$b,command:()=>zb,createParagraphNear:()=>Fb,cut:()=>Bb,deleteCurrentNode:()=>Wb,deleteNode:()=>Zb,deleteRange:()=>Ub,deleteSelection:()=>qb,enter:()=>Jb,exitCode:()=>Gb,extendMarkRange:()=>Kb,first:()=>Yb,focus:()=>ew,forEach:()=>tw,insertContent:()=>nw,insertContentAt:()=>sw,joinBackward:()=>ow,joinDown:()=>iw,joinForward:()=>aw,joinItemBackward:()=>lw,joinItemForward:()=>cw,joinTextblockBackward:()=>dw,joinTextblockForward:()=>uw,joinUp:()=>rw,keyboardShortcut:()=>pw,lift:()=>mw,liftEmptyBlock:()=>fw,liftListItem:()=>gw,newlineInCode:()=>yw,resetAttributes:()=>Cw,scrollIntoView:()=>bw,selectAll:()=>ww,selectNodeBackward:()=>vw,selectNodeForward:()=>kw,selectParentNode:()=>Mw,selectTextblockEnd:()=>Sw,selectTextblockStart:()=>Nw,setContent:()=>Tw,setMark:()=>Ew,setMeta:()=>jw,setNode:()=>Aw,setNodeSelection:()=>Iw,setTextSelection:()=>Ow,sinkListItem:()=>Lw,splitBlock:()=>Rw,splitListItem:()=>_w,toggleList:()=>Hw,toggleMark:()=>$w,toggleNode:()=>zw,toggleWrap:()=>Fw,undoInputRule:()=>Bw,unsetAllMarks:()=>Ww,unsetMark:()=>Zw,updateAttributes:()=>Uw,wrapIn:()=>qw,wrapInList:()=>Jw});var Vb=()=>({editor:e,view:t})=>(requestAnimationFrame(()=>{var n;e.isDestroyed||(t.dom.blur(),null==(n=null==window?void 0:window.getSelection())||n.removeAllRanges())}),!0),Hb=(e=!0)=>({commands:t})=>t.setContent("",{emitUpdate:e}),$b=()=>({state:e,tr:t,dispatch:n})=>{const{selection:s}=t,{ranges:r}=s;return!n||(r.forEach(({$from:n,$to:s})=>{e.doc.nodesBetween(n.pos,s.pos,(e,n)=>{if(e.type.isText)return;const{doc:s,mapping:r}=t,i=s.resolve(r.map(n)),o=s.resolve(r.map(n+e.nodeSize)),a=i.blockRange(o);if(!a)return;const l=function(e){let t=e.parent.content.cutByIndex(e.startIndex,e.endIndex);for(let n=e.depth;;--n){let s=e.$from.node(n),r=e.$from.index(n),i=e.$to.indexAfter(n);if(n<e.depth&&s.canReplace(r,i,t))return n;if(0==n||s.type.spec.isolating||!Ry(s,r,i))break}return null}(a);if(e.type.isTextblock){const{defaultType:e}=i.parent.contentMatchAt(i.index());t.setNodeMarkup(a.start,e)}(l||0===l)&&t.lift(a,l)})}),!0)},zb=e=>t=>e(t),Fb=()=>({state:e,dispatch:t})=>qx(e,t),Bb=(e,t)=>({editor:n,tr:s})=>{const{state:r}=n,i=r.doc.slice(e.from,e.to);s.deleteRange(e.from,e.to);const o=s.mapping.map(t);return s.insert(o,i.content),s.setSelection(new vp(s.doc.resolve(Math.max(o-1,0)))),!0},Wb=()=>({tr:e,dispatch:t})=>{const{selection:n}=e,s=n.$anchor.node();if(s.content.size>0)return!1;const r=e.selection.$anchor;for(let i=r.depth;i>0;i-=1){if(r.node(i).type===s.type){if(t){const t=r.before(i),n=r.after(i);e.delete(t,n).scrollIntoView()}return!0}}return!1},Zb=e=>({tr:t,state:n,dispatch:s})=>{const r=nb(e,n.schema),i=t.selection.$anchor;for(let e=i.depth;e>0;e-=1){if(i.node(e).type===r){if(s){const n=i.before(e),s=i.after(e);t.delete(n,s).scrollIntoView()}return!0}}return!1},Ub=e=>({tr:t,dispatch:n})=>{const{from:s,to:r}=e;return n&&t.delete(s,r),!0},qb=()=>({state:e,dispatch:t})=>Dx(e,t),Jb=()=>({commands:e})=>e.keyboardShortcut("Enter"),Gb=()=>({state:e,dispatch:t})=>((e,t)=>{let{$head:n,$anchor:s}=e.selection;if(!n.parent.type.spec.code||!n.sameParent(s))return!1;let r=n.node(-1),i=n.indexAfter(-1),o=Ux(r.contentMatchAt(i));if(!o||!r.canReplaceWith(i,i,o))return!1;if(t){let s=n.after(),r=e.tr.replaceWith(s,s,o.createAndFill());r.setSelection(xp.near(r.doc.resolve(s),1)),t(r.scrollIntoView())}return!0})(e,t),Kb=(e,t={})=>({tr:n,state:s,dispatch:r})=>{const i=eb(e,s.schema),{doc:o,selection:a}=n,{$from:l,from:c,to:d}=a;if(r){const e=ub(l,i,t);if(e&&e.from<=c&&e.to>=d){const t=vp.create(o,e.from,e.to);n.setSelection(t)}}return!0},Yb=e=>t=>{const n="function"==typeof e?e(t):e;for(let e=0;e<n.length;e+=1)if(n[e](t))return!0;return!1};function Qb(){return"Android"===navigator.platform||/android/i.test(navigator.userAgent)}function Xb(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var ew=(e=null,t={})=>({editor:n,view:s,tr:r,dispatch:i})=>{t={scrollIntoView:!0,...t};const o=()=>{(Xb()||Qb())&&s.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(s.focus(),(null==t?void 0:t.scrollIntoView)&&n.commands.scrollIntoView())})};if(s.hasFocus()&&null===e||!1===e)return!0;if(i&&null===e&&!wb(n.state.selection))return o(),!0;const a=kb(r.doc,e)||n.state.selection,l=n.state.selection.eq(a);return i&&(l||r.setSelection(a),l&&r.storedMarks&&r.setStoredMarks(r.storedMarks),o()),!0},tw=(e,t)=>n=>e.every((e,s)=>t(e,{...n,index:s})),nw=(e,t)=>({tr:n,commands:s})=>s.insertContentAt({from:n.selection.from,to:n.selection.to},e,t),sw=(e,t,n)=>({tr:s,dispatch:r,editor:i})=>{var o;if(r){let r;const l=e=>{i.emit("contentError",{editor:i,error:e,disableCollaboration:()=>{"collaboration"in i.storage&&"object"==typeof i.storage.collaboration&&i.storage.collaboration&&(i.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...(n={parseOptions:i.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n}).parseOptions};if(!n.errorOnInvalidContent&&!i.options.enableContentCheck&&i.options.emitContentError)try{_C(t,i.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(a){l(a)}try{r=_C(t,i.schema,{parseOptions:c,errorOnInvalidContent:null!=(o=n.errorOnInvalidContent)?o:i.options.enableContentCheck})}catch(a){return l(a),!1}let{from:d,to:u}="number"==typeof e?{from:e,to:e}:{from:e.from,to:e.to},h=!0,p=!0;if(("type"in r?[r]:r).forEach(e=>{e.check(),h=!!h&&(e.isText&&0===e.marks.length),p=!!p&&e.isBlock}),d===u&&p){const{parent:e}=s.doc.resolve(d);e.isTextblock&&!e.type.spec.code&&!e.childCount&&(d-=1,u+=1)}let m;if(h){if(Array.isArray(t))m=t.map(e=>e.text||"").join("");else if(t instanceof Lu){let e="";t.forEach(t=>{t.text&&(e+=t.text)}),m=e}else m="object"==typeof t&&t&&t.text?t.text:t;s.insertText(m,d,u)}else{m=r;const e=s.doc.resolve(d),t=e.node(),n=0===e.parentOffset,i=t.isText||t.isTextblock,o=t.content.size>0;n&&i&&o&&(d=Math.max(0,d-1)),s.replaceWith(d,u,m)}n.updateSelection&&function(e,t,n){const s=e.steps.length-1;if(s<t)return;const r=e.steps[s];if(!(r instanceof Iy||r instanceof Oy))return;const i=e.mapping.maps[s];let o=0;i.forEach((e,t,n,s)=>{0===o&&(o=s)}),e.setSelection(xp.near(e.doc.resolve(o),n))}(s,s.steps.length-1,-1),n.applyInputRules&&s.setMeta("applyInputRules",{from:d,text:m}),n.applyPasteRules&&s.setMeta("applyPasteRules",{from:d,text:m})}return!0},rw=()=>({state:e,dispatch:t})=>((e,t)=>{let n,s=e.selection,r=s instanceof Mp;if(r){if(s.node.isTextblock||!kx(e.doc,s.from))return!1;n=s.from}else if(n=Sx(e.doc,s.from,-1),null==n)return!1;if(t){let s=e.tr.join(n);r&&s.setSelection(Mp.create(s.doc,n-e.doc.resolve(n).nodeBefore.nodeSize)),t(s.scrollIntoView())}return!0})(e,t),iw=()=>({state:e,dispatch:t})=>((e,t)=>{let n,s=e.selection;if(s instanceof Mp){if(s.node.isTextblock||!kx(e.doc,s.to))return!1;n=s.to}else if(n=Sx(e.doc,s.to,1),null==n)return!1;return t&&t(e.tr.join(n).scrollIntoView()),!0})(e,t),ow=()=>({state:e,dispatch:t})=>_x(e,t),aw=()=>({state:e,dispatch:t})=>Fx(e,t),lw=()=>({state:e,dispatch:t,tr:n})=>{try{const s=Fy(e.doc,e.selection.$from.pos,-1);return null!=s&&(n.join(s,2),t&&t(n),!0)}catch{return!1}},cw=()=>({state:e,dispatch:t,tr:n})=>{try{const s=Fy(e.doc,e.selection.$from.pos,1);return null!=s&&(n.join(s,2),t&&t(n),!0)}catch{return!1}},dw=()=>({state:e,dispatch:t})=>((e,t,n)=>{let s=Rx(e,n);if(!s)return!1;let r=$x(s);return!!r&&Px(e,r,t)})(e,t),uw=()=>({state:e,dispatch:t})=>((e,t,n)=>{let s=zx(e,n);if(!s)return!1;let r=Wx(s);return!!r&&Px(e,r,t)})(e,t);function hw(){return"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)}var pw=e=>({editor:t,view:n,tr:s,dispatch:r})=>{const i=function(e){const t=e.split(/-(?!$)/);let n,s,r,i,o=t[t.length-1];"Space"===o&&(o=" ");for(let a=0;a<t.length-1;a+=1){const e=t[a];if(/^(cmd|meta|m)$/i.test(e))i=!0;else if(/^a(lt)?$/i.test(e))n=!0;else if(/^(c|ctrl|control)$/i.test(e))s=!0;else if(/^s(hift)?$/i.test(e))r=!0;else{if(!/^mod$/i.test(e))throw new Error(`Unrecognized modifier name: ${e}`);Xb()||hw()?i=!0:s=!0}}return n&&(o=`Alt-${o}`),s&&(o=`Ctrl-${o}`),i&&(o=`Meta-${o}`),r&&(o=`Shift-${o}`),o}(e).split(/-(?!$)/),o=i.find(e=>!["Alt","Ctrl","Meta","Shift"].includes(e)),a=new KeyboardEvent("keydown",{key:"Space"===o?" ":o,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),l=t.captureTransaction(()=>{n.someProp("handleKeyDown",e=>e(n,a))});return null==l||l.steps.forEach(e=>{const t=e.map(s.mapping);t&&r&&s.maybeStep(t)}),!0},mw=(e,t={})=>({state:n,dispatch:s})=>!!gb(n,nb(e,n.schema),t)&&((e,t)=>{let{$from:n,$to:s}=e.selection,r=n.blockRange(s),i=r&&bx(r);return null!=i&&(t&&t(e.tr.lift(r,i).scrollIntoView()),!0)})(n,s),fw=()=>({state:e,dispatch:t})=>Jx(e,t),gw=e=>({state:t,dispatch:n})=>TC(nb(e,t.schema))(t,n),yw=()=>({state:e,dispatch:t})=>Zx(e,t);function xw(e,t){const n="string"==typeof t?[t]:t;return Object.keys(e).reduce((t,s)=>(n.includes(s)||(t[s]=e[s]),t),{})}var Cw=(e,t)=>({tr:n,state:s,dispatch:r})=>{let i=null,o=null;const a=sb("string"==typeof e?e:e.name,s.schema);return!!a&&("node"===a&&(i=nb(e,s.schema)),"mark"===a&&(o=eb(e,s.schema)),r&&n.selection.ranges.forEach(e=>{s.doc.nodesBetween(e.$from.pos,e.$to.pos,(e,s)=>{i&&i===e.type&&n.setNodeMarkup(s,void 0,xw(e.attrs,t)),o&&e.marks.length&&e.marks.forEach(r=>{o===r.type&&n.addMark(s,s+e.nodeSize,o.create(xw(r.attrs,t)))})})}),!0)},bw=()=>({tr:e,dispatch:t})=>(t&&e.scrollIntoView(),!0),ww=()=>({tr:e,dispatch:t})=>{if(t){const t=new Np(e.doc);e.setSelection(t)}return!0},vw=()=>({state:e,dispatch:t})=>Hx(e,t),kw=()=>({state:e,dispatch:t})=>Bx(e,t),Mw=()=>({state:e,dispatch:t})=>((e,t)=>{let n,{$from:s,to:r}=e.selection,i=s.sharedDepth(r);return 0!=i&&(n=s.before(i),t&&t(e.tr.setSelection(Mp.create(e.doc,n))),!0)})(e,t),Sw=()=>({state:e,dispatch:t})=>Xx(e,t),Nw=()=>({state:e,dispatch:t})=>Qx(e,t),Tw=(e,{errorOnInvalidContent:t,emitUpdate:n=!0,parseOptions:s={}}={})=>({editor:r,tr:i,dispatch:o,commands:a})=>{const{doc:l}=i;if("full"!==s.preserveWhitespace){const a=PC(e,r.schema,s,{errorOnInvalidContent:null!=t?t:r.options.enableContentCheck});return o&&i.replaceWith(0,l.content.size,a).setMeta("preventUpdate",!n),!0}return o&&i.setMeta("preventUpdate",!n),a.insertContentAt({from:0,to:l.content.size},e,{parseOptions:s,errorOnInvalidContent:null!=t?t:r.options.enableContentCheck})};var Ew=(e,t={})=>({tr:n,state:s,dispatch:r})=>{const{selection:i}=n,{empty:o,ranges:a}=i,l=eb(e,s.schema);if(r)if(o){const e=tb(s,l);n.addStoredMark(l.create({...e,...t}))}else a.forEach(e=>{const r=e.$from.pos,i=e.$to.pos;s.doc.nodesBetween(r,i,(e,s)=>{const o=Math.max(s,r),a=Math.min(s+e.nodeSize,i);e.marks.find(e=>e.type===l)?e.marks.forEach(e=>{l===e.type&&n.addMark(o,a,l.create({...e.attrs,...t}))}):n.addMark(o,a,l.create(t))})});return function(e,t,n){var s;const{selection:r}=t;let i=null;if(wb(r)&&(i=r.$cursor),i){const t=null!=(s=e.storedMarks)?s:i.marks();return i.parent.type.allowsMarkType(n)&&(!!n.isInSet(t)||!t.some(e=>e.type.excludes(n)))}const{ranges:o}=r;return o.some(({$from:t,$to:s})=>{let r=0===t.depth&&e.doc.inlineContent&&e.doc.type.allowsMarkType(n);return e.doc.nodesBetween(t.pos,s.pos,(e,t,s)=>{if(r)return!1;if(e.isInline){const t=!s||s.type.allowsMarkType(n),i=!!n.isInSet(e.marks)||!e.marks.some(e=>e.type.excludes(n));r=t&&i}return!r}),r})}(s,n,l)},jw=(e,t)=>({tr:n})=>(n.setMeta(e,t),!0),Aw=(e,t={})=>({state:n,dispatch:s,chain:r})=>{const i=nb(e,n.schema);let o;return n.selection.$anchor.sameParent(n.selection.$head)&&(o=n.selection.$anchor.parent.attrs),!!i.isTextblock&&r().command(({commands:e})=>!!tC(i,{...o,...t})(n)||e.clearNodes()).command(({state:e})=>tC(i,{...o,...t})(e,s)).run()},Iw=e=>({tr:t,dispatch:n})=>{if(n){const{doc:n}=t,s=vb(e,0,n.content.size),r=Mp.create(n,s);t.setSelection(r)}return!0},Ow=e=>({tr:t,dispatch:n})=>{if(n){const{doc:n}=t,{from:s,to:r}="number"==typeof e?{from:e,to:e}:e,i=vp.atStart(n).from,o=vp.atEnd(n).to,a=vb(s,i,o),l=vb(r,i,o),c=vp.create(n,a,l);t.setSelection(c)}return!0},Lw=e=>({state:t,dispatch:n})=>{const s=nb(e,t.schema);return(r=s,function(e,t){let{$from:n,$to:s}=e.selection,i=n.blockRange(s,e=>e.childCount>0&&e.firstChild.type==r);if(!i)return!1;let o=i.startIndex;if(0==o)return!1;let a=i.parent,l=a.child(o-1);if(l.type!=r)return!1;if(t){let n=l.lastChild&&l.lastChild.type==a.type,s=Lu.from(n?r.create():null),o=new Hu(Lu.from(r.create(null,Lu.from(a.type.create(null,s)))),n?3:1,0),c=i.start,d=i.end;t(e.tr.step(new yC(c-(n?3:1),d,c,d,o,1,!0)).scrollIntoView())}return!0})(t,n);var r};function Dw(e,t){const n=e.storedMarks||e.selection.$to.parentOffset&&e.selection.$from.marks();if(n){const s=n.filter(e=>null==t?void 0:t.includes(e.type.name));e.tr.ensureMarks(s)}}var Rw=({keepMarks:e=!0}={})=>({tr:t,state:n,dispatch:s,editor:r})=>{const{selection:i,doc:o}=t,{$from:a,$to:l}=i,c=mb(r.extensionManager.attributes,a.node().type.name,a.node().attrs);if(i instanceof Mp&&i.node.isBlock)return!(!a.parentOffset||!Hy(o,a.pos))&&(s&&(e&&Dw(n,r.extensionManager.splittableMarks),t.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,u=0===a.depth?void 0:function(e){for(let t=0;t<e.edgeCount;t+=1){const{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}(a.node(-1).contentMatchAt(a.indexAfter(-1)));let h=d&&u?[{type:u,attrs:c}]:void 0,p=Hy(t.doc,t.mapping.map(a.pos),1,h);if(h||p||!Hy(t.doc,t.mapping.map(a.pos),1,u?[{type:u}]:void 0)||(p=!0,h=u?[{type:u,attrs:c}]:void 0),s){if(p&&(i instanceof vp&&t.deleteSelection(),t.split(t.mapping.map(a.pos),1,h),u&&!d&&!a.parentOffset&&a.parent.type!==u)){const e=t.mapping.map(a.before()),n=t.doc.resolve(e);a.node(-1).canReplaceWith(n.index(),n.index()+1,u)&&t.setNodeMarkup(t.mapping.map(a.before()),u)}e&&Dw(n,r.extensionManager.splittableMarks),t.scrollIntoView()}return p},_w=(e,t={})=>({tr:n,state:s,dispatch:r,editor:i})=>{var o;const a=nb(e,s.schema),{$from:l,$to:c}=s.selection,d=s.selection.node;if(d&&d.isBlock||l.depth<2||!l.sameParent(c))return!1;const u=l.node(-1);if(u.type!==a)return!1;const h=i.extensionManager.attributes;if(0===l.parent.content.size&&l.node(-1).childCount===l.indexAfter(-1)){if(2===l.depth||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(r){let e=Lu.empty;const s=l.index(-1)?1:l.index(-2)?2:3;for(let t=l.depth-s;t>=l.depth-3;t-=1)e=Lu.from(l.node(t).copy(e));const r=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,i={...mb(h,l.node().type.name,l.node().attrs),...t},c=(null==(o=a.contentMatch.defaultType)?void 0:o.createAndFill(i))||void 0;e=e.append(Lu.from(a.createAndFill(null,c)||void 0));const d=l.before(l.depth-(s-1));n.replace(d,l.after(-r),new Hu(e,4-s,0));let u=-1;n.doc.nodesBetween(d,n.doc.content.size,(e,t)=>{if(u>-1)return!1;e.isTextblock&&0===e.content.size&&(u=t+1)}),u>-1&&n.setSelection(vp.near(n.doc.resolve(u))),n.scrollIntoView()}return!0}const p=c.pos===l.end()?u.contentMatchAt(0).defaultType:null,m={...mb(h,u.type.name,u.attrs),...t},f={...mb(h,l.node().type.name,l.node().attrs),...t};n.delete(l.pos,c.pos);const g=p?[{type:a,attrs:m},{type:p,attrs:f}]:[{type:a,attrs:m}];if(!Hy(n.doc,l.pos,2))return!1;if(r){const{selection:e,storedMarks:t}=s,{splittableMarks:o}=i.extensionManager,a=t||e.$to.parentOffset&&e.$from.marks();if(n.split(l.pos,2,g).scrollIntoView(),!a||!r)return!0;const c=a.filter(e=>o.includes(e.type.name));n.ensureMarks(c)}return!0},Pw=(e,t)=>{const n=VC(e=>e.type===t)(e.selection);if(!n)return!0;const s=e.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(void 0===s)return!0;const r=e.doc.nodeAt(s);return n.node.type!==(null==r?void 0:r.type)||!$y(e.doc,n.pos)||(e.join(n.pos),!0)},Vw=(e,t)=>{const n=VC(e=>e.type===t)(e.selection);if(!n)return!0;const s=e.doc.resolve(n.start).after(n.depth);if(void 0===s)return!0;const r=e.doc.nodeAt(s);return n.node.type!==(null==r?void 0:r.type)||!$y(e.doc,s)||(e.join(s),!0)},Hw=(e,t,n,s={})=>({editor:r,tr:i,state:o,dispatch:a,chain:l,commands:c,can:d})=>{const{extensions:u,splittableMarks:h}=r.extensionManager,p=nb(e,o.schema),m=nb(t,o.schema),{selection:f,storedMarks:g}=o,{$from:y,$to:x}=f,C=y.blockRange(x),b=g||f.$to.parentOffset&&f.$from.marks();if(!C)return!1;const w=VC(e=>xb(e.type.name,u))(f);if(C.depth>=1&&w&&C.depth-w.depth<=1){if(w.node.type===p)return c.liftListItem(m);if(xb(w.node.type.name,u)&&p.validContent(w.node.content)&&a)return l().command(()=>(i.setNodeMarkup(w.pos,p),!0)).command(()=>Pw(i,p)).command(()=>Vw(i,p)).run()}return n&&b&&a?l().command(()=>{const e=d().wrapInList(p,s),t=b.filter(e=>h.includes(e.type.name));return i.ensureMarks(t),!!e||c.clearNodes()}).wrapInList(p,s).command(()=>Pw(i,p)).command(()=>Vw(i,p)).run():l().command(()=>!!d().wrapInList(p,s)||c.clearNodes()).wrapInList(p,s).command(()=>Pw(i,p)).command(()=>Vw(i,p)).run()},$w=(e,t={},n={})=>({state:s,commands:r})=>{const{extendEmptyMarkRange:i=!1}=n,o=eb(e,s.schema);return fb(s,o,t)?r.unsetMark(o,{extendEmptyMarkRange:i}):r.setMark(o,t)},zw=(e,t,n={})=>({state:s,commands:r})=>{const i=nb(e,s.schema),o=nb(t,s.schema),a=gb(s,i,n);let l;return s.selection.$anchor.sameParent(s.selection.$head)&&(l=s.selection.$anchor.parent.attrs),a?r.setNode(o,l):r.setNode(i,{...l,...n})},Fw=(e,t={})=>({state:n,commands:s})=>{const r=nb(e,n.schema);return gb(n,r,t)?s.lift(r):s.wrapIn(r,t)},Bw=()=>({state:e,dispatch:t})=>{const n=e.plugins;for(let s=0;s<n.length;s+=1){const r=n[s];let i;if(r.spec.isInputRules&&(i=r.getState(e))){if(t){const t=e.tr,n=i.transform;for(let e=n.steps.length-1;e>=0;e-=1)t.step(n.steps[e].invert(n.docs[e]));if(i.text){const n=t.doc.resolve(i.from).marks();t.replaceWith(i.from,i.to,e.schema.text(i.text,n))}else t.delete(i.from,i.to)}return!0}}return!1},Ww=()=>({tr:e,dispatch:t})=>{const{selection:n}=e,{empty:s,ranges:r}=n;return s||t&&r.forEach(t=>{e.removeMark(t.$from.pos,t.$to.pos)}),!0},Zw=(e,t={})=>({tr:n,state:s,dispatch:r})=>{var i;const{extendEmptyMarkRange:o=!1}=t,{selection:a}=n,l=eb(e,s.schema),{$from:c,empty:d,ranges:u}=a;if(!r)return!0;if(d&&o){let{from:e,to:t}=a;const s=null==(i=c.marks().find(e=>e.type===l))?void 0:i.attrs,r=ub(c,l,s);r&&(e=r.from,t=r.to),n.removeMark(e,t,l)}else u.forEach(e=>{n.removeMark(e.$from.pos,e.$to.pos,l)});return n.removeStoredMark(l),!0},Uw=(e,t={})=>({tr:n,state:s,dispatch:r})=>{let i=null,o=null;const a=sb("string"==typeof e?e:e.name,s.schema);return!!a&&("node"===a&&(i=nb(e,s.schema)),"mark"===a&&(o=eb(e,s.schema)),r&&n.selection.ranges.forEach(e=>{const r=e.$from.pos,a=e.$to.pos;let l,c,d,u;n.selection.empty?s.doc.nodesBetween(r,a,(e,t)=>{i&&i===e.type&&(d=Math.max(t,r),u=Math.min(t+e.nodeSize,a),l=t,c=e)}):s.doc.nodesBetween(r,a,(e,s)=>{s<r&&i&&i===e.type&&(d=Math.max(s,r),u=Math.min(s+e.nodeSize,a),l=s,c=e),s>=r&&s<=a&&(i&&i===e.type&&n.setNodeMarkup(s,void 0,{...e.attrs,...t}),o&&e.marks.length&&e.marks.forEach(i=>{if(o===i.type){const l=Math.max(s,r),c=Math.min(s+e.nodeSize,a);n.addMark(l,c,o.create({...i.attrs,...t}))}}))}),c&&(void 0!==l&&n.setNodeMarkup(l,void 0,{...c.attrs,...t}),o&&c.marks.length&&c.marks.forEach(e=>{o===e.type&&n.addMark(d,u,o.create({...e.attrs,...t}))}))}),!0)},qw=(e,t={})=>({state:n,dispatch:s})=>eC(nb(e,n.schema),t)(n,s),Jw=(e,t={})=>({state:n,dispatch:s})=>NC(nb(e,n.schema),t)(n,s),Gw=Rb.create({name:"commands",addCommands:()=>({...Pb})}),Kw=Rb.create({name:"delete",onUpdate({transaction:e,appendedTransactions:t}){var n,s,r;const i=()=>{var n,s,r,i;if(null!=(i=null==(r=null==(s=null==(n=this.editor.options.coreExtensionOptions)?void 0:n.delete)?void 0:s.filterTransaction)?void 0:r.call(s,e))?i:e.getMeta("y-sync$"))return;const o=LC(e.before,[e,...t]);ob(o).forEach(t=>{o.mapping.mapResult(t.oldRange.from).deletedAfter&&o.mapping.mapResult(t.oldRange.to).deletedBefore&&o.before.nodesBetween(t.oldRange.from,t.oldRange.to,(n,s)=>{const r=s+n.nodeSize-2,i=t.oldRange.from<=s&&r<=t.oldRange.to;this.editor.emit("delete",{type:"node",node:n,from:s,to:r,newFrom:o.mapping.map(s),newTo:o.mapping.map(r),deletedRange:t.oldRange,newRange:t.newRange,partial:!i,editor:this.editor,transaction:e,combinedTransform:o})})});const a=o.mapping;o.steps.forEach((t,n)=>{var s,r;if(t instanceof Ey){const i=a.slice(n).map(t.from,-1),l=a.slice(n).map(t.to),c=a.invert().map(i,-1),d=a.invert().map(l),u=null==(s=o.doc.nodeAt(i-1))?void 0:s.marks.some(e=>e.eq(t.mark)),h=null==(r=o.doc.nodeAt(l))?void 0:r.marks.some(e=>e.eq(t.mark));this.editor.emit("delete",{type:"mark",mark:t.mark,from:t.from,to:t.to,deletedRange:{from:c,to:d},newRange:{from:i,to:l},partial:Boolean(h||u),editor:this.editor,transaction:e,combinedTransform:o})}})};null==(r=null==(s=null==(n=this.editor.options.coreExtensionOptions)?void 0:n.delete)?void 0:s.async)||r?setTimeout(i,0):i()}}),Yw=Rb.create({name:"drop",addProseMirrorPlugins(){return[new Pp({key:new $p("tiptapDrop"),props:{handleDrop:(e,t,n,s)=>{this.editor.emit("drop",{editor:this.editor,event:t,slice:n,moved:s})}}})]}}),Qw=Rb.create({name:"editable",addProseMirrorPlugins(){return[new Pp({key:new $p("editable"),props:{editable:()=>this.editor.options.editable}})]}}),Xw=new $p("focusEvents"),ev=Rb.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:e}=this;return[new Pp({key:Xw,props:{handleDOMEvents:{focus:(t,n)=>{e.isFocused=!0;const s=e.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return t.dispatch(s),!1},blur:(t,n)=>{e.isFocused=!1;const s=e.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return t.dispatch(s),!1}}}})]}}),tv=Rb.create({name:"keymap",addKeyboardShortcuts(){const e=()=>this.editor.commands.first(({commands:e})=>[()=>e.undoInputRule(),()=>e.command(({tr:t})=>{const{selection:n,doc:s}=t,{empty:r,$anchor:i}=n,{pos:o,parent:a}=i,l=i.parent.isTextblock&&o>0?t.doc.resolve(o-1):i,c=l.parent.type.spec.isolating,d=i.pos-i.parentOffset,u=c&&1===l.parent.childCount?d===i.pos:xp.atStart(s).from===o;return!(!r||!a.type.isTextblock||a.textContent.length||!u||u&&"paragraph"===i.parent.type.name)&&e.clearNodes()}),()=>e.deleteSelection(),()=>e.joinBackward(),()=>e.selectNodeBackward()]),t=()=>this.editor.commands.first(({commands:e})=>[()=>e.deleteSelection(),()=>e.deleteCurrentNode(),()=>e.joinForward(),()=>e.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:e})=>[()=>e.newlineInCode(),()=>e.createParagraphNear(),()=>e.liftEmptyBlock(),()=>e.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:e,"Mod-Backspace":e,"Shift-Backspace":e,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},s={...n},r={...n,"Ctrl-h":e,"Alt-Backspace":e,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Xb()||hw()?r:s},addProseMirrorPlugins(){return[new Pp({key:new $p("clearDocument"),appendTransaction:(e,t,n)=>{if(e.some(e=>e.getMeta("composition")))return;const s=e.some(e=>e.docChanged)&&!t.doc.eq(n.doc),r=e.some(e=>e.getMeta("preventClearDocument"));if(!s||r)return;const{empty:i,from:o,to:a}=t.selection,l=xp.atStart(t.doc).from,c=xp.atEnd(t.doc).to;if(i||!(o===l&&a===c))return;if(!Cb(n.doc))return;const d=n.tr,u=AC({state:n,transaction:d}),{commands:h}=new IC({editor:this.editor,state:u});return h.clearNodes(),d.steps.length?d:void 0}})]}}),nv=Rb.create({name:"paste",addProseMirrorPlugins(){return[new Pp({key:new $p("tiptapPaste"),props:{handlePaste:(e,t,n)=>{this.editor.emit("paste",{editor:this.editor,event:t,slice:n})}}})]}}),sv=Rb.create({name:"tabindex",addProseMirrorPlugins(){return[new Pp({key:new $p("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),rv=class e{constructor(e,t,n=!1,s=null){this.currentNode=null,this.actualDepth=null,this.isBlock=n,this.resolvedPos=e,this.editor=t,this.currentNode=s}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return null!=(e=this.actualDepth)?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let t=this.from,n=this.to;if(this.isBlock){if(0===this.content.size)return;t=this.from+1,n=this.to-1}this.editor.commands.insertContentAt({from:t,to:n},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(0===this.depth)return null;const t=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(t);return new e(n,this.editor)}get before(){let t=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.from-3)),new e(t,this.editor)}get after(){let t=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.to+3)),new e(t,this.editor)}get children(){const t=[];return this.node.content.forEach((n,s)=>{const r=n.isBlock&&!n.isTextblock,i=n.isAtom&&!n.isText,o=this.pos+s+(i?0:1);if(o<0||o>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(o);if(!r&&a.depth<=this.depth)return;const l=new e(a,this.editor,r,r?n:null);r&&(l.actualDepth=this.depth+1),t.push(new e(a,this.editor,r,r?n:null))}),t}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,t={}){let n=null,s=this.parent;for(;s&&!n;){if(s.node.type.name===e)if(Object.keys(t).length>0){const e=s.node.attrs,n=Object.keys(t);for(let s=0;s<n.length;s+=1){const r=n[s];if(e[r]!==t[r])break}}else n=s;s=s.parent}return n}querySelector(e,t={}){return this.querySelectorAll(e,t,!0)[0]||null}querySelectorAll(e,t={},n=!1){let s=[];if(!this.children||0===this.children.length)return s;const r=Object.keys(t);return this.children.forEach(i=>{if(!(n&&s.length>0)){if(i.node.type.name===e){r.every(e=>t[e]===i.node.attrs[e])&&s.push(i)}n&&s.length>0||(s=s.concat(i.querySelectorAll(e,t,n)))}}),s}setAttribute(e){const{tr:t}=this.editor.state;t.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(t)}};var iv=class extends OC{constructor(e={}){super(),this.css=null,this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:"undefined"!=typeof document?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:e})=>{throw e},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:e,slice:t,moved:n})=>this.options.onDrop(e,t,n)),this.on("paste",({event:e,slice:t})=>this.options.onPaste(e,t)),this.on("delete",this.options.onDelete);const t=this.createDoc(),n=kb(t,this.options.autofocus);this.editorState=Rp.create({doc:t,schema:this.schema,selection:n||void 0}),this.options.element&&this.mount(this.options.element)}mount(e){if("undefined"==typeof document)throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(e),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){const e=this.editorView.dom;(null==e?void 0:e.editor)&&delete e.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css)try{"function"==typeof this.css.remove?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(e){}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&"undefined"!=typeof document&&(this.css=function(e,t){const n=document.querySelector("style[data-tiptap-style]");if(null!==n)return n;const s=document.createElement("style");return t&&s.setAttribute("nonce",t),s.setAttribute("data-tiptap-style",""),s.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(s),s}('.ProseMirror {\n  position: relative;\n}\n\n.ProseMirror {\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  white-space: break-spaces;\n  -webkit-font-variant-ligatures: none;\n  font-variant-ligatures: none;\n  font-feature-settings: "liga" 0; /* the above doesn\'t seem to work in Edge */\n}\n\n.ProseMirror [contenteditable="false"] {\n  white-space: normal;\n}\n\n.ProseMirror [contenteditable="false"] [contenteditable="true"] {\n  white-space: pre-wrap;\n}\n\n.ProseMirror pre {\n  white-space: pre-wrap;\n}\n\nimg.ProseMirror-separator {\n  display: inline !important;\n  border: none !important;\n  margin: 0 !important;\n  width: 0 !important;\n  height: 0 !important;\n}\n\n.ProseMirror-gapcursor {\n  display: none;\n  pointer-events: none;\n  position: absolute;\n  margin: 0;\n}\n\n.ProseMirror-gapcursor:after {\n  content: "";\n  display: block;\n  position: absolute;\n  top: -2px;\n  width: 20px;\n  border-top: 1px solid black;\n  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;\n}\n\n@keyframes ProseMirror-cursor-blink {\n  to {\n    visibility: hidden;\n  }\n}\n\n.ProseMirror-hideselection *::selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection *::-moz-selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection * {\n  caret-color: transparent;\n}\n\n.ProseMirror-focused .ProseMirror-gapcursor {\n  display: block;\n}',this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},this.editorView&&this.state&&!this.isDestroyed&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,t=!0){this.setOptions({editable:e}),t&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:e=>{this.editorState=e},dispatch:e=>{this.dispatchTransaction(e)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(e,t)=>{if(this.editorView)return this.editorView[t];if("state"===t)return this.editorState;if(t in e)return Reflect.get(e,t);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${t}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(e,t){const n=FC(t)?t(e,[...this.state.plugins]):[...this.state.plugins,e],s=this.state.reconfigure({plugins:n});return this.view.updateState(s),s}unregisterPlugin(e){if(this.isDestroyed)return;const t=this.state.plugins;let n=t;if([].concat(e).forEach(e=>{const t="string"==typeof e?`${e}$`:e.key;n=n.filter(e=>!e.key.startsWith(t))}),t.length===n.length)return;const s=this.state.reconfigure({plugins:n});return this.view.updateState(s),s}createExtensionManager(){var e,t;const n=[...this.options.enableCoreExtensions?[Qw,_b.configure({blockSeparator:null==(t=null==(e=this.options.coreExtensionOptions)?void 0:e.clipboardTextSerializer)?void 0:t.blockSeparator}),Gw,ev,tv,sv,Yw,nv,Kw].filter(e=>"object"!=typeof this.options.enableCoreExtensions||!1!==this.options.enableCoreExtensions[e.name]):[],...this.options.extensions].filter(e=>["extension","node","mark"].includes(null==e?void 0:e.type));this.extensionManager=new Db(n,this)}createCommandManager(){this.commandManager=new IC({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let e;try{e=PC(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(t){if(!(t instanceof Error&&["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(t.message)))throw t;this.emit("contentError",{editor:this,error:t,disableCollaboration:()=>{"collaboration"in this.storage&&"object"==typeof this.storage.collaboration&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(e=>"collaboration"!==e.name),this.createExtensionManager()}}),e=PC(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return e}createView(e){var t;this.editorView=new Qg(e,{...this.options.editorProps,attributes:{role:"textbox",...null==(t=this.options.editorProps)?void 0:t.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});const n=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(n),this.prependClass(),this.injectCSS();this.view.dom.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const t=this.capturedTransaction;return this.capturedTransaction=null,t}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction)return this.capturedTransaction?void e.steps.forEach(e=>{var t;return null==(t=this.capturedTransaction)?void 0:t.step(e)}):void(this.capturedTransaction=e);const{state:t,transactions:n}=this.state.applyTransaction(e),s=!this.state.selection.eq(t.selection),r=n.includes(e),i=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:e,nextState:t}),!r)return;this.view.updateState(t),this.emit("transaction",{editor:this,transaction:e,appendedTransactions:n.slice(1)}),s&&this.emit("selectionUpdate",{editor:this,transaction:e});const o=n.findLast(e=>e.getMeta("focus")||e.getMeta("blur")),a=null==o?void 0:o.getMeta("focus"),l=null==o?void 0:o.getMeta("blur");a&&this.emit("focus",{editor:this,event:a.event,transaction:o}),l&&this.emit("blur",{editor:this,event:l.event,transaction:o}),e.getMeta("preventUpdate")||!n.some(e=>e.docChanged)||i.doc.eq(t.doc)||this.emit("update",{editor:this,transaction:e,appendedTransactions:n.slice(1)})}getAttributes(e){return rb(this.state,e)}isActive(e,t){const n="string"==typeof e?e:null,s="string"==typeof e?t:e;return function(e,t,n={}){if(!t)return gb(e,null,n)||fb(e,null,n);const s=sb(t,e.schema);return"node"===s?gb(e,t,n):"mark"===s&&fb(e,t,n)}(this.state,n,s)}getJSON(){return this.state.doc.toJSON()}getHTML(){return zC(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:t="\n\n",textSerializers:n={}}=e||{};return function(e,t){return QC(e,{from:0,to:e.content.size},t)}(this.state.doc,{blockSeparator:t,textSerializers:{...XC(this.schema),...n}})}get isEmpty(){return Cb(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var e,t;return null==(t=null==(e=this.editorView)?void 0:e.isDestroyed)||t}$node(e,t){var n;return(null==(n=this.$doc)?void 0:n.querySelector(e,t))||null}$nodes(e,t){var n;return(null==(n=this.$doc)?void 0:n.querySelectorAll(e,t))||null}$pos(e){const t=this.state.doc.resolve(e);return new rv(t,this)}get $doc(){return this.$pos(0)}};function ov(e){return new Mb({find:e.find,handler:({state:t,range:n,match:s})=>{const r=BC(e.getAttributes,void 0,s);if(!1===r||null===r)return null;const{tr:i}=t,o=s[s.length-1],a=s[0];if(o){const s=a.search(/\S/),l=n.from+a.indexOf(o),c=l+o.length;if(hb(n.from,n.to,t.doc).filter(t=>t.mark.type.excluded.find(n=>n===e.type&&n!==t.mark.type)).filter(e=>e.to>l).length)return null;c<n.to&&i.delete(c,n.to),l>n.from&&i.delete(n.from+s,l);const d=n.from+s+o.length;i.addMark(n.from+s,d,e.type.create(r||{})),i.removeStoredMark(e.type)}},undoable:e.undoable})}function av(e){return new Mb({find:e.find,handler:({state:t,range:n,match:s})=>{const r=t.doc.resolve(n.from),i=BC(e.getAttributes,void 0,s)||{};if(!r.node(-1).canReplaceWith(r.index(-1),r.indexAfter(-1),e.type))return null;t.tr.delete(n.from,n.to).setBlockType(n.from,n.from,e.type,i)},undoable:e.undoable})}function lv(e){return new Mb({find:e.find,handler:({state:t,range:n,match:s,chain:r})=>{const i=BC(e.getAttributes,void 0,s)||{},o=t.tr.delete(n.from,n.to),a=o.doc.resolve(n.from).blockRange(),l=a&&function(e,t,n=null,s=e){let r=function(e,t){let{parent:n,startIndex:s,endIndex:r}=e,i=n.contentMatchAt(s).findWrapping(t);if(!i)return null;let o=i.length?i[0]:t;return n.canReplaceWith(s,r,o)?i:null}(e,t),i=r&&function(e,t){let{parent:n,startIndex:s,endIndex:r}=e,i=n.child(s),o=t.contentMatch.findWrapping(i.type);if(!o)return null;let a=(o.length?o[o.length-1]:t).contentMatch;for(let l=s;a&&l<r;l++)a=a.matchType(n.child(l).type);return a&&a.validEnd?o:null}(s,t);return i?r.map(_y).concat({type:t,attrs:n}).concat(i.map(_y)):null}(a,e.type,i);if(!l)return null;if(o.wrap(a,l),e.keepMarks&&e.editor){const{selection:n,storedMarks:s}=t,{splittableMarks:r}=e.editor.extensionManager,i=s||n.$to.parentOffset&&n.$from.marks();if(i){const e=i.filter(e=>r.includes(e.type.name));o.ensureMarks(e)}}if(e.keepAttributes){const t="bulletList"===e.type.name||"orderedList"===e.type.name?"listItem":"taskList";r().updateAttributes(t,i).run()}const c=o.doc.resolve(n.from-1).nodeBefore;c&&c.type===e.type&&$y(o.doc,n.from-1)&&(!e.joinPredicate||e.joinPredicate(s,c))&&o.join(n.from-1)},undoable:e.undoable})}var cv,dv,uv=class e extends Eb{constructor(){super(...arguments),this.type="node"}static create(t={}){const n="function"==typeof t?t():t;return new e(n)}configure(e){return super.configure(e)}extend(e){const t="function"==typeof e?e():e;return super.extend(t)}},hv=class{constructor(e,t,n){this.isDragging=!1,this.component=e,this.editor=t.editor,this.options={stopEvent:null,ignoreMutation:null,...n},this.extension=t.extension,this.node=t.node,this.decorations=t.decorations,this.innerDecorations=t.innerDecorations,this.view=t.view,this.HTMLAttributes=t.HTMLAttributes,this.getPos=t.getPos,this.mount()}mount(){}get dom(){return this.editor.view.dom}get contentDOM(){return null}onDragStart(e){var t,n,s,r,i,o,a;const{view:l}=this.editor,c=e.target,d=3===c.nodeType?null==(t=c.parentElement)?void 0:t.closest("[data-drag-handle]"):c.closest("[data-drag-handle]");if(!this.dom||(null==(n=this.contentDOM)?void 0:n.contains(c))||!d)return;let u=0,h=0;if(this.dom!==d){const t=this.dom.getBoundingClientRect(),n=d.getBoundingClientRect(),a=null!=(r=e.offsetX)?r:null==(s=e.nativeEvent)?void 0:s.offsetX,l=null!=(o=e.offsetY)?o:null==(i=e.nativeEvent)?void 0:i.offsetY;u=n.x-t.x+a,h=n.y-t.y+l}const p=this.dom.cloneNode(!0);try{const e=this.dom.getBoundingClientRect();p.style.width=`${Math.round(e.width)}px`,p.style.height=`${Math.round(e.height)}px`,p.style.boxSizing="border-box",p.style.pointerEvents="none"}catch{}let m=null;try{m=document.createElement("div"),m.style.position="absolute",m.style.top="-9999px",m.style.left="-9999px",m.style.pointerEvents="none",m.appendChild(p),document.body.appendChild(m),null==(a=e.dataTransfer)||a.setDragImage(p,u,h)}finally{m&&setTimeout(()=>{try{null==m||m.remove()}catch{}},0)}const f=this.getPos();if("number"!=typeof f)return;const g=Mp.create(l.state.doc,f),y=l.state.tr.setSelection(g);l.dispatch(y)}stopEvent(e){var t;if(!this.dom)return!1;if("function"==typeof this.options.stopEvent)return this.options.stopEvent({event:e});const n=e.target;if(!(this.dom.contains(n)&&!(null==(t=this.contentDOM)?void 0:t.contains(n))))return!1;const s=e.type.startsWith("drag"),r="drop"===e.type;if((["INPUT","BUTTON","SELECT","TEXTAREA"].includes(n.tagName)||n.isContentEditable)&&!r&&!s)return!0;const{isEditable:i}=this.editor,{isDragging:o}=this,a=!!this.node.type.spec.draggable,l=Mp.isSelectable(this.node),c="copy"===e.type,d="paste"===e.type,u="cut"===e.type,h="mousedown"===e.type;if(!a&&l&&s&&e.target===this.dom&&e.preventDefault(),a&&s&&!o&&e.target===this.dom)return e.preventDefault(),!1;if(a&&i&&!o&&h){const e=n.closest("[data-drag-handle]");e&&(this.dom===e||this.dom.contains(e))&&(this.isDragging=!0,document.addEventListener("dragend",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("drop",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("mouseup",()=>{this.isDragging=!1},{once:!0}))}return!(o||r||c||d||u||h&&l)}ignoreMutation(e){if(!this.dom||!this.contentDOM)return!0;if("function"==typeof this.options.ignoreMutation)return this.options.ignoreMutation({mutation:e});if(this.node.isLeaf||this.node.isAtom)return!0;if("selection"===e.type)return!1;if(this.dom.contains(e.target)&&"childList"===e.type&&(Xb()||Qb())&&this.editor.isFocused){if([...Array.from(e.addedNodes),...Array.from(e.removedNodes)].every(e=>e.isContentEditable))return!1}return this.contentDOM===e.target&&"attributes"===e.type||!this.contentDOM.contains(e.target)}updateAttributes(e){this.editor.commands.command(({tr:t})=>{const n=this.getPos();return"number"==typeof n&&(t.setNodeMarkup(n,void 0,{...this.node.attrs,...e}),!0)})}deleteNode(){const e=this.getPos();if("number"!=typeof e)return;const t=e+this.node.nodeSize;this.editor.commands.deleteRange({from:e,to:t})}};function pv(e){return new Ab({find:e.find,handler:({state:t,range:n,match:s,pasteEvent:r})=>{const i=BC(e.getAttributes,void 0,s,r);if(!1===i||null===i)return null;const{tr:o}=t,a=s[s.length-1],l=s[0];let c=n.to;if(a){const s=l.search(/\S/),r=n.from+l.indexOf(a),d=r+a.length;if(hb(n.from,n.to,t.doc).filter(t=>t.mark.type.excluded.find(n=>n===e.type&&n!==t.mark.type)).filter(e=>e.to>r).length)return null;d<n.to&&o.delete(d,n.to),r>n.from&&o.delete(n.from+s,r),c=n.from+s+a.length,o.addMark(n.from+s,c,e.type.create(i||{})),o.removeStoredMark(e.type)}}})}var mv=(dv||(dv=1,cv=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var s,r,i;if(Array.isArray(t)){if((s=t.length)!=n.length)return!1;for(r=s;0!==r--;)if(!e(t[r],n[r]))return!1;return!0}if(t instanceof Map&&n instanceof Map){if(t.size!==n.size)return!1;for(r of t.entries())if(!n.has(r[0]))return!1;for(r of t.entries())if(!e(r[1],n.get(r[0])))return!1;return!0}if(t instanceof Set&&n instanceof Set){if(t.size!==n.size)return!1;for(r of t.entries())if(!n.has(r[0]))return!1;return!0}if(ArrayBuffer.isView(t)&&ArrayBuffer.isView(n)){if((s=t.length)!=n.length)return!1;for(r=s;0!==r--;)if(t[r]!==n[r])return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((s=(i=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(r=s;0!==r--;)if(!Object.prototype.hasOwnProperty.call(n,i[r]))return!1;for(r=s;0!==r--;){var o=i[r];if(!("_owner"===o&&t.$$typeof||e(t[o],n[o])))return!1}return!0}return t!=t&&n!=n}),cv);const fv=ee(mv);var gv,yv,xv={exports:{}},Cv={};var bv=(yv||(yv=1,xv.exports=function(){if(gv)return Cv;gv=1;var e=X(),t=Eu(),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},s=t.useSyncExternalStore,r=e.useRef,i=e.useEffect,o=e.useMemo,a=e.useDebugValue;return Cv.useSyncExternalStoreWithSelector=function(e,t,l,c,d){var u=r(null);if(null===u.current){var h={hasValue:!1,value:null};u.current=h}else h=u.current;u=o(function(){function e(e){if(!i){if(i=!0,s=e,e=c(e),void 0!==d&&h.hasValue){var t=h.value;if(d(t,e))return r=t}return r=e}if(t=r,n(s,e))return t;var o=c(e);return void 0!==d&&d(t,o)?(s=e,t):(s=e,r=o)}var s,r,i=!1,o=void 0===l?null:l;return[function(){return e(t())},null===o?void 0:function(){return e(o())}]},[t,l,c,d]);var p=s(e,u[0],u[1]);return i(function(){h.hasValue=!0,h.value=p},[p]),a(p),p},Cv}()),xv.exports),wv=(...e)=>t=>{e.forEach(e=>{"function"==typeof e?e(t):e&&(e.current=t)})},vv=({contentComponent:e})=>{const t=ju.useSyncExternalStore(e.subscribe,e.getSnapshot,e.getServerSnapshot);return q.jsx(q.Fragment,{children:Object.values(t)})};var kv=class extends Y.Component{constructor(e){var t;super(e),this.editorContentRef=Y.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:Boolean(null==(t=e.editor)?void 0:t.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const e=this.props.editor;if(e&&!e.isDestroyed&&e.options.element){if(e.contentComponent)return;const t=this.editorContentRef.current;t.append(e.view.dom),e.setOptions({element:t}),e.contentComponent=function(){const e=new Set;let t={};return{subscribe:t=>(e.add(t),()=>{e.delete(t)}),getSnapshot:()=>t,getServerSnapshot:()=>t,setRenderer(n,s){t={...t,[n]:y.createPortal(s.reactElement,s.element,n)},e.forEach(e=>e())},removeRenderer(n){const s={...t};delete s[n],t=s,e.forEach(e=>e())}}}(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=e.contentComponent.subscribe(()=>{this.setState(e=>e.hasContentComponentInitialized?e:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),e.createNodeViews(),this.initialized=!0}}componentWillUnmount(){var e;const t=this.props.editor;if(t){this.initialized=!1,t.isDestroyed||t.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),t.contentComponent=null;try{if(!(null==(e=t.view.dom)?void 0:e.firstChild))return;const n=document.createElement("div");n.append(t.view.dom),t.setOptions({element:n})}catch{}}}render(){const{editor:e,innerRef:t,...n}=this.props;return q.jsxs(q.Fragment,{children:[q.jsx("div",{ref:wv(t,this.editorContentRef),...n}),(null==e?void 0:e.contentComponent)&&q.jsx(vv,{contentComponent:e.contentComponent})]})}},Mv=U.forwardRef((e,t)=>{const n=Y.useMemo(()=>Math.floor(4294967295*Math.random()).toString(),[e.editor]);return Y.createElement(kv,{key:n,innerRef:t,...e})}),Sv=Y.memo(Mv),Nv="undefined"!=typeof window?U.useLayoutEffect:U.useEffect,Tv=class{constructor(e){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=e,this.lastSnapshot={editor:e,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber||(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber}),this.lastSnapshot}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(e){return this.subscribers.add(e),()=>{this.subscribers.delete(e)}}watch(e){if(this.editor=e,this.editor){const e=()=>{this.transactionNumber+=1,this.subscribers.forEach(e=>e())},t=this.editor;return t.on("transaction",e),()=>{t.off("transaction",e)}}}};var Ev="undefined"==typeof window,jv=Ev||Boolean("undefined"!=typeof window&&window.next),Av=class e{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(e=>e())}getInitialEditor(){return void 0===this.options.current.immediatelyRender?Ev||jv?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}createEditor(){const e={...this.options.current,onBeforeCreate:(...e)=>{var t,n;return null==(n=(t=this.options.current).onBeforeCreate)?void 0:n.call(t,...e)},onBlur:(...e)=>{var t,n;return null==(n=(t=this.options.current).onBlur)?void 0:n.call(t,...e)},onCreate:(...e)=>{var t,n;return null==(n=(t=this.options.current).onCreate)?void 0:n.call(t,...e)},onDestroy:(...e)=>{var t,n;return null==(n=(t=this.options.current).onDestroy)?void 0:n.call(t,...e)},onFocus:(...e)=>{var t,n;return null==(n=(t=this.options.current).onFocus)?void 0:n.call(t,...e)},onSelectionUpdate:(...e)=>{var t,n;return null==(n=(t=this.options.current).onSelectionUpdate)?void 0:n.call(t,...e)},onTransaction:(...e)=>{var t,n;return null==(n=(t=this.options.current).onTransaction)?void 0:n.call(t,...e)},onUpdate:(...e)=>{var t,n;return null==(n=(t=this.options.current).onUpdate)?void 0:n.call(t,...e)},onContentError:(...e)=>{var t,n;return null==(n=(t=this.options.current).onContentError)?void 0:n.call(t,...e)},onDrop:(...e)=>{var t,n;return null==(n=(t=this.options.current).onDrop)?void 0:n.call(t,...e)},onPaste:(...e)=>{var t,n;return null==(n=(t=this.options.current).onPaste)?void 0:n.call(t,...e)},onDelete:(...e)=>{var t,n;return null==(n=(t=this.options.current).onDelete)?void 0:n.call(t,...e)}};return new iv(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}static compareOptions(e,t){return Object.keys(e).every(n=>!!["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(n)||("extensions"===n&&e.extensions&&t.extensions?e.extensions.length===t.extensions.length&&e.extensions.every((e,n)=>{var s;return e===(null==(s=t.extensions)?void 0:s[n])}):e[n]===t[n]))}onRender(t){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&0===t.length?e.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(t),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(null===this.previousDeps)return void(this.previousDeps=e);if(this.previousDeps.length===e.length&&this.previousDeps.every((t,n)=>t===e[n]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,t=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{this.isComponentMounted&&this.instanceId===e?t&&t.setOptions(this.options.current):t&&!t.isDestroyed&&(t.destroy(),this.instanceId===e&&this.setEditor(null))},1)}};function Iv(e={},t=[]){const n=U.useRef(e);n.current=e;const[s]=U.useState(()=>new Av(n)),r=ju.useSyncExternalStore(s.subscribe,s.getEditor,s.getServerSnapshot);return U.useDebugValue(r),U.useEffect(s.onRender(t)),function(e){var t;const[n]=U.useState(()=>new Tv(e.editor)),s=bv.useSyncExternalStoreWithSelector(n.subscribe,n.getSnapshot,n.getServerSnapshot,e.selector,null!=(t=e.equalityFn)?t:fv);Nv(()=>n.watch(e.editor),[e.editor,n]),U.useDebugValue(s)}({editor:r,selector:({transactionNumber:t})=>!1===e.shouldRerenderOnTransaction||void 0===e.shouldRerenderOnTransaction?null:e.immediatelyRender&&0===t?0:t+1}),r}U.createContext({editor:null}).Consumer;var Ov=U.createContext({onDragStart:()=>{},nodeViewContentChildren:void 0,nodeViewContentRef:()=>{}}),Lv=Y.forwardRef((e,t)=>{const{onDragStart:n}=U.useContext(Ov),s=e.as||"div";return q.jsx(s,{...e,ref:t,"data-node-view-wrapper":"",onDragStart:n,style:{whiteSpace:"normal",...e.style}})});function Dv(e){return!("function"!=typeof e||!e.prototype||!e.prototype.isReactComponent)}function Rv(e){return!("object"!=typeof e||!e.$$typeof||"Symbol(react.forward_ref)"!==e.$$typeof.toString()&&"react.forward_ref"!==e.$$typeof.description)}var _v=class{constructor(e,{editor:t,props:n={},as:s="div",className:r=""}){this.ref=null,this.id=Math.floor(4294967295*Math.random()).toString(),this.component=e,this.editor=t,this.props=n,this.element=document.createElement(s),this.element.classList.add("react-renderer"),r&&this.element.classList.add(...r.split(" ")),this.editor.isInitialized?p.flushSync(()=>{this.render()}):queueMicrotask(()=>{this.render()})}render(){var e;const t=this.component,n=this.props,s=this.editor,r=function(){try{if(U.version)return parseInt(U.version.split(".")[0],10)>=19}catch{}return!1}(),i=function(e){if(Dv(e))return!0;if(Rv(e))return!0;if(function(e){return!("object"!=typeof e||!e.$$typeof||"Symbol(react.memo)"!==e.$$typeof.toString()&&"react.memo"!==e.$$typeof.description)}(e)){const t=e.type;if(t)return Dv(t)||Rv(t)}return!1}(t),o={...n};!o.ref||r||i||delete o.ref,o.ref||!r&&!i||(o.ref=e=>{this.ref=e}),this.reactElement=q.jsx(t,{...o}),null==(e=null==s?void 0:s.contentComponent)||e.setRenderer(this.id,this)}updateProps(e={}){this.props={...this.props,...e},this.render()}destroy(){var e;const t=this.editor;null==(e=null==t?void 0:t.contentComponent)||e.removeRenderer(this.id);try{this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}catch{}}updateAttributes(e){Object.keys(e).forEach(t=>{this.element.setAttribute(t,e[t])})}};Y.createContext({markViewContentRef:()=>{}});var Pv=class extends hv{constructor(e,t,n){if(super(e,t,n),!this.node.isLeaf){this.options.contentDOMElementTag?this.contentDOMElement=document.createElement(this.options.contentDOMElementTag):this.contentDOMElement=document.createElement(this.node.isInline?"span":"div"),this.contentDOMElement.dataset.nodeViewContentReact="",this.contentDOMElement.dataset.nodeViewWrapper="",this.contentDOMElement.style.whiteSpace="inherit";const e=this.dom.querySelector("[data-node-view-content]");if(!e)return;e.appendChild(this.contentDOMElement)}}mount(){const e={editor:this.editor,node:this.node,decorations:this.decorations,innerDecorations:this.innerDecorations,view:this.view,selected:!1,extension:this.extension,HTMLAttributes:this.HTMLAttributes,getPos:()=>this.getPos(),updateAttributes:(e={})=>this.updateAttributes(e),deleteNode:()=>this.deleteNode(),ref:U.createRef()};if(!this.component.displayName){const e=e=>e.charAt(0).toUpperCase()+e.substring(1);this.component.displayName=e(this.extension.name)}const t={onDragStart:this.onDragStart.bind(this),nodeViewContentRef:e=>{e&&this.contentDOMElement&&e.firstChild!==this.contentDOMElement&&(e.hasAttribute("data-node-view-wrapper")&&e.removeAttribute("data-node-view-wrapper"),e.appendChild(this.contentDOMElement))}},n=this.component,s=U.memo(e=>q.jsx(Ov.Provider,{value:t,children:U.createElement(n,e)}));s.displayName="ReactNodeView";let r=this.node.isInline?"span":"div";this.options.as&&(r=this.options.as);const{className:i=""}=this.options;this.handleSelectionUpdate=this.handleSelectionUpdate.bind(this),this.renderer=new _v(s,{editor:this.editor,props:e,as:r,className:`node-${this.node.type.name} ${i}`.trim()}),this.editor.on("selectionUpdate",this.handleSelectionUpdate),this.updateElementAttributes()}get dom(){var e;if(this.renderer.element.firstElementChild&&!(null==(e=this.renderer.element.firstElementChild)?void 0:e.hasAttribute("data-node-view-wrapper")))throw Error("Please use the NodeViewWrapper component for your node view.");return this.renderer.element}get contentDOM(){return this.node.isLeaf?null:this.contentDOMElement}handleSelectionUpdate(){const{from:e,to:t}=this.editor.state.selection,n=this.getPos();if("number"==typeof n)if(e<=n&&t>=n+this.node.nodeSize){if(this.renderer.props.selected)return;this.selectNode()}else{if(!this.renderer.props.selected)return;this.deselectNode()}}update(e,t,n){const s=e=>{this.renderer.updateProps(e),"function"==typeof this.options.attrs&&this.updateElementAttributes()};if(e.type!==this.node.type)return!1;if("function"==typeof this.options.update){const r=this.node,i=this.decorations,o=this.innerDecorations;return this.node=e,this.decorations=t,this.innerDecorations=n,this.options.update({oldNode:r,oldDecorations:i,newNode:e,newDecorations:t,oldInnerDecorations:o,innerDecorations:n,updateProps:()=>s({node:e,decorations:t,innerDecorations:n})})}return e===this.node&&this.decorations===t&&this.innerDecorations===n||(this.node=e,this.decorations=t,this.innerDecorations=n,s({node:e,decorations:t,innerDecorations:n})),!0}selectNode(){this.renderer.updateProps({selected:!0}),this.renderer.element.classList.add("ProseMirror-selectednode")}deselectNode(){this.renderer.updateProps({selected:!1}),this.renderer.element.classList.remove("ProseMirror-selectednode")}destroy(){this.renderer.destroy(),this.editor.off("selectionUpdate",this.handleSelectionUpdate),this.contentDOMElement=null}updateElementAttributes(){if(this.options.attrs){let e={};if("function"==typeof this.options.attrs){const t=this.editor.extensionManager.attributes,n=qC(this.node,t);e=this.options.attrs({node:this.node,HTMLAttributes:n})}else e=this.options.attrs;this.renderer.updateAttributes(e)}}};var Vv=(e,t)=>{if("slot"===e)return 0;if(e instanceof Function)return e(t);const{children:n,...s}=null!=t?t:{};if("svg"===e)throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[e,s,n]},Hv=/^\s*>\s$/,$v=uv.create({name:"blockquote",addOptions:()=>({HTMLAttributes:{}}),content:"block+",group:"block",defining:!0,parseHTML:()=>[{tag:"blockquote"}],renderHTML({HTMLAttributes:e}){return Vv("blockquote",{...UC(this.options.HTMLAttributes,e),children:Vv("slot",{})})},addCommands(){return{setBlockquote:()=>({commands:e})=>e.wrapIn(this.name),toggleBlockquote:()=>({commands:e})=>e.toggleWrap(this.name),unsetBlockquote:()=>({commands:e})=>e.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[lv({find:Hv,type:this.type})]}}),zv=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,Fv=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,Bv=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,Wv=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,Zv=jb.create({name:"bold",addOptions:()=>({HTMLAttributes:{}}),parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:e=>"normal"!==e.style.fontWeight&&null},{style:"font-weight=400",clearMark:e=>e.type.name===this.name},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}]},renderHTML({HTMLAttributes:e}){return Vv("strong",{...UC(this.options.HTMLAttributes,e),children:Vv("slot",{})})},addCommands(){return{setBold:()=>({commands:e})=>e.setMark(this.name),toggleBold:()=>({commands:e})=>e.toggleMark(this.name),unsetBold:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[ov({find:zv,type:this.type}),ov({find:Bv,type:this.type})]},addPasteRules(){return[pv({find:Fv,type:this.type}),pv({find:Wv,type:this.type})]}}),Uv=/(^|[^`])`([^`]+)`(?!`)$/,qv=/(^|[^`])`([^`]+)`(?!`)/g,Jv=jb.create({name:"code",addOptions:()=>({HTMLAttributes:{}}),excludes:"_",code:!0,exitable:!0,parseHTML:()=>[{tag:"code"}],renderHTML({HTMLAttributes:e}){return["code",UC(this.options.HTMLAttributes,e),0]},addCommands(){return{setCode:()=>({commands:e})=>e.setMark(this.name),toggleCode:()=>({commands:e})=>e.toggleMark(this.name),unsetCode:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[ov({find:Uv,type:this.type})]},addPasteRules(){return[pv({find:qv,type:this.type})]}}),Gv=/^```([a-z]+)?[\s\n]$/,Kv=/^~~~([a-z]+)?[\s\n]$/,Yv=uv.create({name:"codeBlock",addOptions:()=>({languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:4,HTMLAttributes:{}}),content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:e=>{var t;const{languageClassPrefix:n}=this.options;if(!n)return null;const s=[...(null==(t=e.firstElementChild)?void 0:t.classList)||[]].filter(e=>e.startsWith(n)).map(e=>e.replace(n,""))[0];return s||null},rendered:!1}}},parseHTML:()=>[{tag:"pre",preserveWhitespace:"full"}],renderHTML({node:e,HTMLAttributes:t}){return["pre",UC(this.options.HTMLAttributes,t),["code",{class:e.attrs.language?this.options.languageClassPrefix+e.attrs.language:null},0]]},addCommands(){return{setCodeBlock:e=>({commands:t})=>t.setNode(this.name,e),toggleCodeBlock:e=>({commands:t})=>t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:e,$anchor:t}=this.editor.state.selection,n=1===t.pos;return!(!e||t.parent.type.name!==this.name)&&(!(!n&&t.parent.textContent.length)&&this.editor.commands.clearNodes())},Tab:({editor:e})=>{var t;if(!this.options.enableTabIndentation)return!1;const n=null!=(t=this.options.tabSize)?t:4,{state:s}=e,{selection:r}=s,{$from:i,empty:o}=r;if(i.parent.type!==this.type)return!1;const a=" ".repeat(n);return o?e.commands.insertContent(a):e.commands.command(({tr:e})=>{const{from:t,to:n}=r,i=s.doc.textBetween(t,n,"\n","\n").split("\n").map(e=>a+e).join("\n");return e.replaceWith(t,n,s.schema.text(i)),!0})},"Shift-Tab":({editor:e})=>{var t;if(!this.options.enableTabIndentation)return!1;const n=null!=(t=this.options.tabSize)?t:4,{state:s}=e,{selection:r}=s,{$from:i,empty:o}=r;return i.parent.type===this.type&&(o?e.commands.command(({tr:e})=>{var t;const{pos:r}=i,o=i.start(),a=i.end(),l=s.doc.textBetween(o,a,"\n","\n").split("\n");let c=0,d=0;const u=r-o;for(let n=0;n<l.length;n+=1){if(d+l[n].length>=u){c=n;break}d+=l[n].length+1}const h=(null==(t=l[c].match(/^ */))?void 0:t[0])||"",p=Math.min(h.length,n);if(0===p)return!0;let m=o;for(let n=0;n<c;n+=1)m+=l[n].length+1;e.delete(m,m+p);return r-m<=p&&e.setSelection(vp.create(e.doc,m)),!0}):e.commands.command(({tr:e})=>{const{from:t,to:i}=r,o=s.doc.textBetween(t,i,"\n","\n").split("\n").map(e=>{var t;const s=(null==(t=e.match(/^ */))?void 0:t[0])||"",r=Math.min(s.length,n);return e.slice(r)}).join("\n");return e.replaceWith(t,i,s.schema.text(o)),!0}))},Enter:({editor:e})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:t}=e,{selection:n}=t,{$from:s,empty:r}=n;if(!r||s.parent.type!==this.type)return!1;const i=s.parentOffset===s.parent.nodeSize-2,o=s.parent.textContent.endsWith("\n\n");return!(!i||!o)&&e.chain().command(({tr:e})=>(e.delete(s.pos-2,s.pos),!0)).exitCode().run()},ArrowDown:({editor:e})=>{if(!this.options.exitOnArrowDown)return!1;const{state:t}=e,{selection:n,doc:s}=t,{$from:r,empty:i}=n;if(!i||r.parent.type!==this.type)return!1;if(!(r.parentOffset===r.parent.nodeSize-2))return!1;const o=r.after();if(void 0===o)return!1;return s.nodeAt(o)?e.commands.command(({tr:e})=>(e.setSelection(xp.near(s.resolve(o))),!0)):e.commands.exitCode()}}},addInputRules(){return[av({find:Gv,type:this.type,getAttributes:e=>({language:e[1]})}),av({find:Kv,type:this.type,getAttributes:e=>({language:e[1]})})]},addProseMirrorPlugins(){return[new Pp({key:new $p("codeBlockVSCodeHandler"),props:{handlePaste:(e,t)=>{if(!t.clipboardData)return!1;if(this.editor.isActive(this.type.name))return!1;const n=t.clipboardData.getData("text/plain"),s=t.clipboardData.getData("vscode-editor-data"),r=s?JSON.parse(s):void 0,i=null==r?void 0:r.mode;if(!n||!i)return!1;const{tr:o,schema:a}=e.state,l=a.text(n.replace(/\r\n?/g,"\n"));return o.replaceSelectionWith(this.type.create({language:i},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(vp.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),e.dispatch(o),!0}}})]}}),Qv=uv.create({name:"doc",topNode:!0,content:"block+"}),Xv=uv.create({name:"hardBreak",addOptions:()=>({keepMarks:!0,HTMLAttributes:{}}),inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML:()=>[{tag:"br"}],renderHTML({HTMLAttributes:e}){return["br",UC(this.options.HTMLAttributes,e)]},renderText:()=>"\n",addCommands(){return{setHardBreak:()=>({commands:e,chain:t,state:n,editor:s})=>e.first([()=>e.exitCode(),()=>e.command(()=>{const{selection:e,storedMarks:r}=n;if(e.$from.parent.type.spec.isolating)return!1;const{keepMarks:i}=this.options,{splittableMarks:o}=s.extensionManager,a=r||e.$to.parentOffset&&e.$from.marks();return t().insertContent({type:this.name}).command(({tr:e,dispatch:t})=>{if(t&&a&&i){const t=a.filter(e=>o.includes(e.type.name));e.ensureMarks(t)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),ek=uv.create({name:"heading",addOptions:()=>({levels:[1,2,3,4,5,6],HTMLAttributes:{}}),content:"inline*",group:"block",defining:!0,addAttributes:()=>({level:{default:1,rendered:!1}}),parseHTML(){return this.options.levels.map(e=>({tag:`h${e}`,attrs:{level:e}}))},renderHTML({node:e,HTMLAttributes:t}){return[`h${this.options.levels.includes(e.attrs.level)?e.attrs.level:this.options.levels[0]}`,UC(this.options.HTMLAttributes,t),0]},addCommands(){return{setHeading:e=>({commands:t})=>!!this.options.levels.includes(e.level)&&t.setNode(this.name,e),toggleHeading:e=>({commands:t})=>!!this.options.levels.includes(e.level)&&t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return this.options.levels.reduce((e,t)=>({...e,[`Mod-Alt-${t}`]:()=>this.editor.commands.toggleHeading({level:t})}),{})},addInputRules(){return this.options.levels.map(e=>av({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${e}})\\s$`),type:this.type,getAttributes:{level:e}}))}}),tk=uv.create({name:"horizontalRule",addOptions:()=>({HTMLAttributes:{},nextNodeType:"paragraph"}),group:"block",parseHTML:()=>[{tag:"hr"}],renderHTML({HTMLAttributes:e}){return["hr",UC(this.options.HTMLAttributes,e)]},addCommands(){return{setHorizontalRule:()=>({chain:e,state:t})=>{if(!function(e,t){const{selection:n}=e,{$from:s}=n;if(n instanceof Mp){const e=s.index();return s.parent.canReplaceWith(e,e+1,t)}let r=s.depth;for(;r>=0;){const e=s.index(r);if(s.node(r).contentMatchAt(e).matchType(t))return!0;r-=1}return!1}(t,t.schema.nodes[this.name]))return!1;const{selection:n}=t,{$to:s}=n,r=e();return bb(n)?r.insertContentAt(s.pos,{type:this.name}):r.insertContent({type:this.name}),r.command(({state:e,tr:t,dispatch:n})=>{if(n){const{$to:n}=t.selection,s=n.end();if(n.nodeAfter)n.nodeAfter.isTextblock?t.setSelection(vp.create(t.doc,n.pos+1)):n.nodeAfter.isBlock?t.setSelection(Mp.create(t.doc,n.pos)):t.setSelection(vp.create(t.doc,n.pos));else{const r=e.schema.nodes[this.options.nextNodeType]||n.parent.type.contentMatch.defaultType,i=null==r?void 0:r.create();i&&(t.insert(s,i),t.setSelection(vp.create(t.doc,s+1)))}t.scrollIntoView()}return!0}).run()}}},addInputRules(){return[(e={find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type},new Mb({find:e.find,handler:({state:t,range:n,match:s})=>{const r=BC(e.getAttributes,void 0,s)||{},{tr:i}=t,o=n.from;let a=n.to;const l=e.type.create(r);if(s[1]){let e=o+s[0].lastIndexOf(s[1]);e>a?e=a:a=e+s[1].length;const t=s[0][s[0].length-1];i.insertText(t,o+s[0].length-1),i.replaceWith(e,a,l)}else if(s[0]){const t=e.type.isInline?o:o-1;i.insert(t,e.type.create(r)).delete(i.mapping.map(o),i.mapping.map(a))}i.scrollIntoView()},undoable:e.undoable}))];var e}}),nk=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,sk=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,rk=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,ik=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,ok=jb.create({name:"italic",addOptions:()=>({HTMLAttributes:{}}),parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:e=>"normal"!==e.style.fontStyle&&null},{style:"font-style=normal",clearMark:e=>e.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:e}){return["em",UC(this.options.HTMLAttributes,e),0]},addCommands(){return{setItalic:()=>({commands:e})=>e.setMark(this.name),toggleItalic:()=>({commands:e})=>e.toggleMark(this.name),unsetItalic:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[ov({find:nk,type:this.type}),ov({find:rk,type:this.type})]},addPasteRules(){return[pv({find:sk,type:this.type}),pv({find:ik,type:this.type})]}});const ak="numeric",lk="ascii",ck="alpha",dk="asciinumeric",uk="alphanumeric",hk="domain",pk="emoji",mk="scheme",fk="slashscheme",gk="whitespace";function yk(e,t){return e in t||(t[e]=[]),t[e]}function xk(e,t,n){t[ak]&&(t[dk]=!0,t[uk]=!0),t[lk]&&(t[dk]=!0,t[ck]=!0),t[dk]&&(t[uk]=!0),t[ck]&&(t[uk]=!0),t[uk]&&(t[hk]=!0),t[pk]&&(t[hk]=!0);for(const s in t){const t=yk(s,n);t.indexOf(e)<0&&t.push(e)}}function Ck(e=null){this.j={},this.jr=[],this.jd=null,this.t=e}Ck.groups={},Ck.prototype={accepts(){return!!this.t},go(e){const t=this,n=t.j[e];if(n)return n;for(let s=0;s<t.jr.length;s++){const n=t.jr[s][0],r=t.jr[s][1];if(r&&n.test(e))return r}return t.jd},has(e,t=!1){return t?e in this.j:!!this.go(e)},ta(e,t,n,s){for(let r=0;r<e.length;r++)this.tt(e[r],t,n,s)},tr(e,t,n,s){let r;return s=s||Ck.groups,t&&t.j?r=t:(r=new Ck(t),n&&s&&xk(t,n,s)),this.jr.push([e,r]),r},ts(e,t,n,s){let r=this;const i=e.length;if(!i)return r;for(let o=0;o<i-1;o++)r=r.tt(e[o]);return r.tt(e[i-1],t,n,s)},tt(e,t,n,s){s=s||Ck.groups;const r=this;if(t&&t.j)return r.j[e]=t,t;const i=t;let o,a=r.go(e);if(a?(o=new Ck,Object.assign(o.j,a.j),o.jr.push.apply(o.jr,a.jr),o.jd=a.jd,o.t=a.t):o=new Ck,i){if(s)if(o.t&&"string"==typeof o.t){const e=Object.assign(function(e,t){const n={};for(const s in t)t[s].indexOf(e)>=0&&(n[s]=!0);return n}(o.t,s),n);xk(i,e,s)}else n&&xk(i,n,s);o.t=i}return r.j[e]=o,o}};const bk=(e,t,n,s,r)=>e.ta(t,n,s,r),wk=(e,t,n,s,r)=>e.tr(t,n,s,r),vk=(e,t,n,s,r)=>e.ts(t,n,s,r),kk=(e,t,n,s,r)=>e.tt(t,n,s,r),Mk="WORD",Sk="UWORD",Nk="ASCIINUMERICAL",Tk="ALPHANUMERICAL",Ek="LOCALHOST",jk="TLD",Ak="UTLD",Ik="SCHEME",Ok="SLASH_SCHEME",Lk="NUM",Dk="WS",Rk="NL",_k="OPENBRACE",Pk="CLOSEBRACE",Vk="OPENBRACKET",Hk="CLOSEBRACKET",$k="OPENPAREN",zk="CLOSEPAREN",Fk="OPENANGLEBRACKET",Bk="CLOSEANGLEBRACKET",Wk="FULLWIDTHLEFTPAREN",Zk="FULLWIDTHRIGHTPAREN",Uk="LEFTCORNERBRACKET",qk="RIGHTCORNERBRACKET",Jk="LEFTWHITECORNERBRACKET",Gk="RIGHTWHITECORNERBRACKET",Kk="FULLWIDTHLESSTHAN",Yk="FULLWIDTHGREATERTHAN",Qk="AMPERSAND",Xk="APOSTROPHE",eM="ASTERISK",tM="AT",nM="BACKSLASH",sM="BACKTICK",rM="CARET",iM="COLON",oM="COMMA",aM="DOLLAR",lM="DOT",cM="EQUALS",dM="EXCLAMATION",uM="HYPHEN",hM="PERCENT",pM="PIPE",mM="PLUS",fM="POUND",gM="QUERY",yM="QUOTE",xM="FULLWIDTHMIDDLEDOT",CM="SEMI",bM="SLASH",wM="TILDE",vM="UNDERSCORE",kM="EMOJI",MM="SYM";var SM=Object.freeze({__proto__:null,ALPHANUMERICAL:Tk,AMPERSAND:Qk,APOSTROPHE:Xk,ASCIINUMERICAL:Nk,ASTERISK:eM,AT:tM,BACKSLASH:nM,BACKTICK:sM,CARET:rM,CLOSEANGLEBRACKET:Bk,CLOSEBRACE:Pk,CLOSEBRACKET:Hk,CLOSEPAREN:zk,COLON:iM,COMMA:oM,DOLLAR:aM,DOT:lM,EMOJI:kM,EQUALS:cM,EXCLAMATION:dM,FULLWIDTHGREATERTHAN:Yk,FULLWIDTHLEFTPAREN:Wk,FULLWIDTHLESSTHAN:Kk,FULLWIDTHMIDDLEDOT:xM,FULLWIDTHRIGHTPAREN:Zk,HYPHEN:uM,LEFTCORNERBRACKET:Uk,LEFTWHITECORNERBRACKET:Jk,LOCALHOST:Ek,NL:Rk,NUM:Lk,OPENANGLEBRACKET:Fk,OPENBRACE:_k,OPENBRACKET:Vk,OPENPAREN:$k,PERCENT:hM,PIPE:pM,PLUS:mM,POUND:fM,QUERY:gM,QUOTE:yM,RIGHTCORNERBRACKET:qk,RIGHTWHITECORNERBRACKET:Gk,SCHEME:Ik,SEMI:CM,SLASH:bM,SLASH_SCHEME:Ok,SYM:MM,TILDE:wM,TLD:jk,UNDERSCORE:vM,UTLD:Ak,UWORD:Sk,WORD:Mk,WS:Dk});const NM=/[a-z]/,TM=new RegExp("\\p{L}","u"),EM=new RegExp("\\p{Emoji}","u"),jM=/\d/,AM=/\s/;let IM=null,OM=null;function LM(e,t){const n=function(e){const t=[],n=e.length;let s=0;for(;s<n;){let r,i=e.charCodeAt(s),o=i<55296||i>56319||s+1===n||(r=e.charCodeAt(s+1))<56320||r>57343?e[s]:e.slice(s,s+2);t.push(o),s+=o.length}return t}(t.replace(/[A-Z]/g,e=>e.toLowerCase())),s=n.length,r=[];let i=0,o=0;for(;o<s;){let a=e,l=null,c=0,d=null,u=-1,h=-1;for(;o<s&&(l=a.go(n[o]));)a=l,a.accepts()?(u=0,h=0,d=a):u>=0&&(u+=n[o].length,h++),c+=n[o].length,i+=n[o].length,o++;i-=u,o-=h,c-=u,r.push({t:d.t,v:t.slice(i-c,i),s:i-c,e:i})}return r}function DM(e,t,n,s,r){let i;const o=t.length;for(let a=0;a<o-1;a++){const n=t[a];e.j[n]?i=e.j[n]:(i=new Ck(s),i.jr=r.slice(),e.j[n]=i),e=i}return i=new Ck(n),i.jr=r.slice(),e.j[t[o-1]]=i,i}function RM(e){const t=[],n=[];let s=0;for(;s<e.length;){let r=0;for(;"0123456789".indexOf(e[s+r])>=0;)r++;if(r>0){t.push(n.join(""));for(let t=parseInt(e.substring(s,s+r),10);t>0;t--)n.pop();s+=r}else n.push(e[s]),s++}return t}const _M={defaultProtocol:"http",events:null,format:VM,formatHref:VM,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function PM(e,t=null){let n=Object.assign({},_M);e&&(n=Object.assign(n,e instanceof PM?e.o:e));const s=n.ignoreTags,r=[];for(let i=0;i<s.length;i++)r.push(s[i].toUpperCase());this.o=n,t&&(this.defaultRender=t),this.ignoreTags=r}function VM(e){return e}function HM(e,t){this.t="token",this.v=e,this.tk=t}function $M(e,t){class n extends HM{constructor(t,n){super(t,n),this.t=e}}for(const s in t)n.prototype[s]=t[s];return n.t=e,n}PM.prototype={o:_M,ignoreTags:[],defaultRender:e=>e,check(e){return this.get("validate",e.toString(),e)},get(e,t,n){const s=null!=t;let r=this.o[e];return r?("object"==typeof r?(r=n.t in r?r[n.t]:_M[e],"function"==typeof r&&s&&(r=r(t,n))):"function"==typeof r&&s&&(r=r(t,n.t,n)),r):r},getObj(e,t,n){let s=this.o[e];return"function"==typeof s&&null!=t&&(s=s(t,n.t,n)),s},render(e){const t=e.render(this);return(this.get("render",null,e)||this.defaultRender)(t,e.t,e)}},HM.prototype={isLink:!1,toString(){return this.v},toHref(e){return this.toString()},toFormattedString(e){const t=this.toString(),n=e.get("truncate",t,this),s=e.get("format",t,this);return n&&s.length>n?s.substring(0,n)+"…":s},toFormattedHref(e){return e.get("formatHref",this.toHref(e.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(e=_M.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(e){return{type:this.t,value:this.toFormattedString(e),isLink:this.isLink,href:this.toFormattedHref(e),start:this.startIndex(),end:this.endIndex()}},validate(e){return e.get("validate",this.toString(),this)},render(e){const t=this,n=this.toHref(e.get("defaultProtocol")),s=e.get("formatHref",n,this),r=e.get("tagName",n,t),i=this.toFormattedString(e),o={},a=e.get("className",n,t),l=e.get("target",n,t),c=e.get("rel",n,t),d=e.getObj("attributes",n,t),u=e.getObj("events",n,t);return o.href=s,a&&(o.class=a),l&&(o.target=l),c&&(o.rel=c),d&&Object.assign(o,d),{tagName:r,attributes:o,content:i,eventListeners:u}}};const zM=$M("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),FM=$M("text"),BM=$M("nl"),WM=$M("url",{isLink:!0,toHref(e=_M.defaultProtocol){return this.hasProtocol()?this.v:`${e}://${this.v}`},hasProtocol(){const e=this.tk;return e.length>=2&&e[0].t!==Ek&&e[1].t===iM}}),ZM=e=>new Ck(e);function UM(e,t,n){const s=n[0].s,r=n[n.length-1].e;return new e(t.slice(s,r),n)}const qM="undefined"!=typeof console&&console&&console.warn||(()=>{}),JM={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function GM(e,t=!1){if(JM.initialized&&qM(`linkifyjs: already initialized - will not register custom scheme "${e}" until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(e))throw new Error('linkifyjs: incorrect scheme format.\n1. Must only contain digits, lowercase ASCII letters or "-"\n2. Cannot start or end with "-"\n3. "-" cannot repeat');JM.customSchemes.push([e,t])}function KM(){JM.scanner=function(e=[]){const t={};Ck.groups=t;const n=new Ck;null==IM&&(IM=RM("aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mögensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2")),null==OM&&(OM=RM("ελ1υ2бг1ел3дети4ею2католик6ом3мкд2он1сква6онлайн5рг3рус2ф2сайт3рб3укр3қаз3հայ3ישראל5קום3ابوظبي5رامكو5لاردن4بحرين5جزائر5سعودية6عليان5مغرب5مارات5یران5بارت2زار4يتك3ھارت5تونس4سودان3رية5شبكة4عراق2ب2مان4فلسطين6قطر3كاثوليك6وم3مصر2ليسيا5وريتانيا7قع4همراه5پاکستان7ڀارت4कॉम3नेट3भारत0म्3ोत5संगठन5বাংলা5ভারত2ৰত4ਭਾਰਤ4ભારત4ଭାରତ4இந்தியா6லங்கை6சிங்கப்பூர்11భారత్5ಭಾರತ4ഭാരതം5ලංකා4คอม3ไทย3ລາວ3გე2みんな3アマゾン4クラウド4グーグル4コム2ストア3セール3ファッション6ポイント4世界2中信1国1國1文网3亚马逊3企业2佛山2信息2健康2八卦2公司1益2台湾1灣2商城1店1标2嘉里0大酒店5在线2大拿2天主教3娱乐2家電2广东2微博2慈善2我爱你3手机2招聘2政务1府2新加坡2闻2时尚2書籍2机构2淡马锡3游戏2澳門2点看2移动2组织机构4网址1店1站1络2联通2谷歌2购物2通販2集团2電訊盈科4飞利浦3食品2餐厅2香格里拉3港2닷넷1컴2삼성2한국2")),kk(n,"'",Xk),kk(n,"{",_k),kk(n,"}",Pk),kk(n,"[",Vk),kk(n,"]",Hk),kk(n,"(",$k),kk(n,")",zk),kk(n,"<",Fk),kk(n,">",Bk),kk(n,"（",Wk),kk(n,"）",Zk),kk(n,"「",Uk),kk(n,"」",qk),kk(n,"『",Jk),kk(n,"』",Gk),kk(n,"＜",Kk),kk(n,"＞",Yk),kk(n,"&",Qk),kk(n,"*",eM),kk(n,"@",tM),kk(n,"`",sM),kk(n,"^",rM),kk(n,":",iM),kk(n,",",oM),kk(n,"$",aM),kk(n,".",lM),kk(n,"=",cM),kk(n,"!",dM),kk(n,"-",uM),kk(n,"%",hM),kk(n,"|",pM),kk(n,"+",mM),kk(n,"#",fM),kk(n,"?",gM),kk(n,'"',yM),kk(n,"/",bM),kk(n,";",CM),kk(n,"~",wM),kk(n,"_",vM),kk(n,"\\",nM),kk(n,"・",xM);const s=wk(n,jM,Lk,{[ak]:!0});wk(s,jM,s);const r=wk(s,NM,Nk,{[dk]:!0}),i=wk(s,TM,Tk,{[uk]:!0}),o=wk(n,NM,Mk,{[lk]:!0});wk(o,jM,r),wk(o,NM,o),wk(r,jM,r),wk(r,NM,r);const a=wk(n,TM,Sk,{[ck]:!0});wk(a,NM),wk(a,jM,i),wk(a,TM,a),wk(i,jM,i),wk(i,NM),wk(i,TM,i);const l=kk(n,"\n",Rk,{[gk]:!0}),c=kk(n,"\r",Dk,{[gk]:!0}),d=wk(n,AM,Dk,{[gk]:!0});kk(n,"￼",d),kk(c,"\n",l),kk(c,"￼",d),wk(c,AM,d),kk(d,"\r"),kk(d,"\n"),wk(d,AM,d),kk(d,"￼",d);const u=wk(n,EM,kM,{[pk]:!0});kk(u,"#"),wk(u,EM,u),kk(u,"️",u);const h=kk(u,"‍");kk(h,"#"),wk(h,EM,u);const p=[[NM,o],[jM,r]],m=[[NM,null],[TM,a],[jM,i]];for(let f=0;f<IM.length;f++)DM(n,IM[f],jk,Mk,p);for(let f=0;f<OM.length;f++)DM(n,OM[f],Ak,Sk,m);xk(jk,{tld:!0,ascii:!0},t),xk(Ak,{utld:!0,alpha:!0},t),DM(n,"file",Ik,Mk,p),DM(n,"mailto",Ik,Mk,p),DM(n,"http",Ok,Mk,p),DM(n,"https",Ok,Mk,p),DM(n,"ftp",Ok,Mk,p),DM(n,"ftps",Ok,Mk,p),xk(Ik,{scheme:!0,ascii:!0},t),xk(Ok,{slashscheme:!0,ascii:!0},t),e=e.sort((e,t)=>e[0]>t[0]?1:-1);for(let f=0;f<e.length;f++){const t=e[f][0],s=e[f][1]?{[mk]:!0}:{[fk]:!0};t.indexOf("-")>=0?s[hk]=!0:NM.test(t)?jM.test(t)?s[dk]=!0:s[lk]=!0:s[ak]=!0,vk(n,t,t,s)}return vk(n,"localhost",Ek,{ascii:!0}),n.jd=new Ck(MM),{start:n,tokens:Object.assign({groups:t},SM)}}(JM.customSchemes);for(let e=0;e<JM.tokenQueue.length;e++)JM.tokenQueue[e][1]({scanner:JM.scanner});JM.parser=function({groups:e}){const t=e.domain.concat([Qk,eM,tM,nM,sM,rM,aM,cM,uM,Lk,hM,pM,mM,fM,bM,MM,wM,vM]),n=[Xk,iM,oM,lM,dM,hM,gM,yM,CM,Fk,Bk,_k,Pk,Hk,Vk,$k,zk,Wk,Zk,Uk,qk,Jk,Gk,Kk,Yk],s=[Qk,Xk,eM,nM,sM,rM,aM,cM,uM,_k,Pk,hM,pM,mM,fM,gM,bM,MM,wM,vM],r=ZM(),i=kk(r,wM);bk(i,s,i),bk(i,e.domain,i);const o=ZM(),a=ZM(),l=ZM();bk(r,e.domain,o),bk(r,e.scheme,a),bk(r,e.slashscheme,l),bk(o,s,i),bk(o,e.domain,o);const c=kk(o,tM);kk(i,tM,c),kk(a,tM,c),kk(l,tM,c);const d=kk(i,lM);bk(d,s,i),bk(d,e.domain,i);const u=ZM();bk(c,e.domain,u),bk(u,e.domain,u);const h=kk(u,lM);bk(h,e.domain,u);const p=ZM(zM);bk(h,e.tld,p),bk(h,e.utld,p),kk(c,Ek,p);const m=kk(u,uM);kk(m,uM,m),bk(m,e.domain,u),bk(p,e.domain,u),kk(p,lM,h),kk(p,uM,m);const f=kk(p,iM);bk(f,e.numeric,zM);const g=kk(o,uM),y=kk(o,lM);kk(g,uM,g),bk(g,e.domain,o),bk(y,s,i),bk(y,e.domain,o);const x=ZM(WM);bk(y,e.tld,x),bk(y,e.utld,x),bk(x,e.domain,o),bk(x,s,i),kk(x,lM,y),kk(x,uM,g),kk(x,tM,c);const C=kk(x,iM),b=ZM(WM);bk(C,e.numeric,b);const w=ZM(WM),v=ZM();bk(w,t,w),bk(w,n,v),bk(v,t,w),bk(v,n,v),kk(x,bM,w),kk(b,bM,w);const k=kk(a,iM),M=kk(l,iM),S=kk(M,bM),N=kk(S,bM);bk(a,e.domain,o),kk(a,lM,y),kk(a,uM,g),bk(l,e.domain,o),kk(l,lM,y),kk(l,uM,g),bk(k,e.domain,w),kk(k,bM,w),kk(k,gM,w),bk(N,e.domain,w),bk(N,t,w),kk(N,bM,w);const T=[[_k,Pk],[Vk,Hk],[$k,zk],[Fk,Bk],[Wk,Zk],[Uk,qk],[Jk,Gk],[Kk,Yk]];for(let E=0;E<T.length;E++){const[e,s]=T[E],r=kk(w,e);kk(v,e,r),kk(r,s,w);const i=ZM(WM);bk(r,t,i);const o=ZM();bk(r,n),bk(i,t,i),bk(i,n,o),bk(o,t,i),bk(o,n,o),kk(i,s,w),kk(o,s,w)}return kk(r,Ek,x),kk(r,Rk,BM),{start:r,tokens:SM}}(JM.scanner.tokens);for(let e=0;e<JM.pluginQueue.length;e++)JM.pluginQueue[e][1]({scanner:JM.scanner,parser:JM.parser});return JM.initialized=!0,JM}function YM(e){return JM.initialized||KM(),function(e,t,n){let s=n.length,r=0,i=[],o=[];for(;r<s;){let a=e,l=null,c=null,d=0,u=null,h=-1;for(;r<s&&!(l=a.go(n[r].t));)o.push(n[r++]);for(;r<s&&(c=l||a.go(n[r].t));)l=null,a=c,a.accepts()?(h=0,u=a):h>=0&&h++,r++,d++;if(h<0)r-=d,r<s&&(o.push(n[r]),r++);else{o.length>0&&(i.push(UM(FM,t,o)),o=[]),r-=h,d-=h;const e=u.t,s=n.slice(r-d,r);i.push(UM(e,t,s))}}return o.length>0&&i.push(UM(FM,t,o)),i}(JM.parser.start,e,LM(JM.scanner.start,e))}function QM(e,t=null,n=null){if(t&&"object"==typeof t){if(n)throw Error(`linkifyjs: Invalid link type ${t}; must be a string`);n=t,t=null}const s=new PM(n),r=YM(e),i=[];for(let o=0;o<r.length;o++){const e=r[o];!e.isLink||t&&e.t!==t||!s.check(e)||i.push(e.toFormattedObject(s))}return i}YM.scan=LM;var XM="[\0-   ᠎ -\u2029 　]",eS=new RegExp(XM),tS=new RegExp(`${XM}$`),nS=new RegExp(XM,"g");function sS(e,t){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return t&&t.forEach(e=>{const t="string"==typeof e?e:e.scheme;t&&n.push(t)}),!e||e.replace(nS,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var rS=jb.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate),this.options.protocols.forEach(e=>{"string"!=typeof e?GM(e.scheme,e.optionalSlashes):GM(e)})},onDestroy(){Ck.groups={},JM.scanner=null,JM.parser=null,JM.tokenQueue=[],JM.pluginQueue=[],JM.customSchemes=[],JM.initialized=!1},inclusive(){return this.options.autolink},addOptions:()=>({openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(e,t)=>!!sS(e,t.protocols),validate:e=>!!e,shouldAutoLink:e=>!!e}),addAttributes(){return{href:{default:null,parseHTML:e=>e.getAttribute("href")},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:e=>{const t=e.getAttribute("href");return!(!t||!this.options.isAllowedUri(t,{defaultValidate:e=>!!sS(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol}))&&null}}]},renderHTML({HTMLAttributes:e}){return this.options.isAllowedUri(e.href,{defaultValidate:e=>!!sS(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",UC(this.options.HTMLAttributes,e),0]:["a",UC(this.options.HTMLAttributes,{...e,href:""}),0]},addCommands(){return{setLink:e=>({chain:t})=>{const{href:n}=e;return!!this.options.isAllowedUri(n,{defaultValidate:e=>!!sS(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})&&t().setMark(this.name,e).setMeta("preventAutolink",!0).run()},toggleLink:e=>({chain:t})=>{const{href:n}=e||{};return!(n&&!this.options.isAllowedUri(n,{defaultValidate:e=>!!sS(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol}))&&t().toggleMark(this.name,e,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:e})=>e().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[pv({find:e=>{const t=[];if(e){const{protocols:n,defaultProtocol:s}=this.options,r=QM(e).filter(e=>e.isLink&&this.options.isAllowedUri(e.value,{defaultValidate:e=>!!sS(e,n),protocols:n,defaultProtocol:s}));r.length&&r.forEach(e=>t.push({text:e.value,data:{href:e.href},index:e.start}))}return t},type:this.type,getAttributes:e=>{var t;return{href:null==(t=e.data)?void 0:t.href}}})]},addProseMirrorPlugins(){const e=[],{protocols:t,defaultProtocol:n}=this.options;var s;return this.options.autolink&&e.push((s={type:this.type,defaultProtocol:this.options.defaultProtocol,validate:e=>this.options.isAllowedUri(e,{defaultValidate:e=>!!sS(e,t),protocols:t,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink},new Pp({key:new $p("autolink"),appendTransaction:(e,t,n)=>{const r=e.some(e=>e.docChanged)&&!t.doc.eq(n.doc),i=e.some(e=>e.getMeta("preventAutolink"));if(!r||i)return;const{tr:o}=n;return ob(LC(t.doc,[...e])).forEach(({newRange:e})=>{const t=function(e,t,n){const s=[];return e.nodesBetween(t.from,t.to,(e,t)=>{n(e)&&s.push({node:e,pos:t})}),s}(n.doc,e,e=>e.isTextblock);let r,i;if(t.length>1)r=t[0],i=n.doc.textBetween(r.pos,r.pos+r.node.nodeSize,void 0," ");else if(t.length){const s=n.doc.textBetween(e.from,e.to," "," ");if(!tS.test(s))return;r=t[0],i=n.doc.textBetween(r.pos,e.to,void 0," ")}if(r&&i){const e=i.split(eS).filter(Boolean);if(e.length<=0)return!1;const t=e[e.length-1],l=r.pos+i.lastIndexOf(t);if(!t)return!1;const c=YM(t).map(e=>e.toObject(s.defaultProtocol));if(!(1===(a=c).length?a[0].isLink:3===a.length&&a[1].isLink&&["()","[]"].includes(a[0].value+a[2].value)))return!1;c.filter(e=>e.isLink).map(e=>({...e,from:l+e.start+1,to:l+e.end+1})).filter(e=>!n.schema.marks.code||!n.doc.rangeHasMark(e.from,e.to,n.schema.marks.code)).filter(e=>s.validate(e.value)).filter(e=>s.shouldAutoLink(e.value)).forEach(e=>{hb(e.from,e.to,n.doc).some(e=>e.mark.type===s.type)||o.addMark(e.from,e.to,s.type.create({href:e.href}))})}var a}),o.steps.length?o:void 0}}))),!0===this.options.openOnClick&&e.push(function(e){return new Pp({key:new $p("handleClickLink"),props:{handleClick:(t,n,s)=>{var r,i;if(0!==s.button)return!1;if(!t.editable)return!1;let o=null;if(s.target instanceof HTMLAnchorElement)o=s.target;else{let e=s.target;const t=[];for(;"DIV"!==e.nodeName;)t.push(e),e=e.parentNode;o=t.find(e=>"A"===e.nodeName)}if(!o)return!1;const a=rb(t.state,e.type.name),l=null!=(r=null==o?void 0:o.href)?r:a.href,c=null!=(i=null==o?void 0:o.target)?i:a.target;return e.enableClickSelection&&e.editor.commands.extendMarkRange(e.type.name),!(!o||!l||(window.open(l,c),0))}}})}({type:this.type,editor:this.editor,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&e.push(function(e){return new Pp({key:new $p("handlePasteLink"),props:{handlePaste:(t,n,s)=>{const{state:r}=t,{selection:i}=r,{empty:o}=i;if(o)return!1;let a="";s.content.forEach(e=>{a+=e.textContent});const l=QM(a,{defaultProtocol:e.defaultProtocol}).find(e=>e.isLink&&e.value===a);return!(!a||!l)&&e.editor.commands.setMark(e.type,{href:l.href})}}})}({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),e}}),iS=Object.defineProperty,oS="textStyle",aS=/^\s*([-+*])\s$/,lS=uv.create({name:"bulletList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML:()=>[{tag:"ul"}],renderHTML({HTMLAttributes:e}){return["ul",UC(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleBulletList:()=>({commands:e,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes("listItem",this.editor.getAttributes(oS)).run():e.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let e=lv({find:aS,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(e=lv({find:aS,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(oS),editor:this.editor})),[e]}}),cS=uv.create({name:"listItem",addOptions:()=>({HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}),content:"paragraph block*",defining:!0,parseHTML:()=>[{tag:"li"}],renderHTML({HTMLAttributes:e}){return["li",UC(this.options.HTMLAttributes,e),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}});((e,t)=>{for(var n in t)iS(e,n,{get:t[n],enumerable:!0})})({},{findListItemPos:()=>dS,getNextListDepth:()=>uS,handleBackspace:()=>fS,handleDelete:()=>xS,hasListBefore:()=>hS,hasListItemAfter:()=>CS,hasListItemBefore:()=>pS,listItemHasSubList:()=>mS,nextListIsDeeper:()=>gS,nextListIsHigher:()=>yS});var dS=(e,t)=>{const{$from:n}=t.selection,s=nb(e,t.schema);let r=null,i=n.depth,o=n.pos,a=null;for(;i>0&&null===a;)r=n.node(i),r.type===s?a=i:(i-=1,o-=1);return null===a?null:{$pos:t.doc.resolve(o),depth:a}},uS=(e,t)=>{const n=dS(e,t);if(!n)return!1;const[,s]=((e,t,n,s=20)=>{const r=e.doc.resolve(n);let i=s,o=null;for(;i>0&&null===o;){const e=r.node(i);(null==e?void 0:e.type.name)===t?o=e:i-=1}return[o,i]})(t,e,n.$pos.pos+4);return s},hS=(e,t,n)=>{const{$anchor:s}=e.selection,r=Math.max(0,s.pos-2),i=e.doc.resolve(r).node();return!(!i||!n.includes(i.type.name))},pS=(e,t)=>{var n;const{$anchor:s}=t.selection,r=t.doc.resolve(s.pos-2);return 0!==r.index()&&(null==(n=r.nodeBefore)?void 0:n.type.name)===e},mS=(e,t,n)=>{if(!n)return!1;const s=nb(e,t.schema);let r=!1;return n.descendants(e=>{e.type===s&&(r=!0)}),r},fS=(e,t,n)=>{if(e.commands.undoInputRule())return!0;if(e.state.selection.from!==e.state.selection.to)return!1;if(!gb(e.state,t)&&hS(e.state,t,n)){const{$anchor:n}=e.state.selection,s=e.state.doc.resolve(n.before()-1),r=[];s.node().descendants((e,n)=>{e.type.name===t&&r.push({node:e,pos:n})});const i=r.at(-1);if(!i)return!1;const o=e.state.doc.resolve(s.start()+i.pos+1);return e.chain().cut({from:n.start()-1,to:n.end()+1},o.end()).joinForward().run()}if(!gb(e.state,t))return!1;if(!(e=>{const{$from:t,$to:n}=e.selection;return!(t.parentOffset>0||t.pos!==n.pos)})(e.state))return!1;const s=dS(t,e.state);if(!s)return!1;const r=e.state.doc.resolve(s.$pos.pos-2).node(s.depth),i=mS(t,e.state,r);return pS(t,e.state)&&!i?e.commands.joinItemBackward():e.chain().liftListItem(t).run()},gS=(e,t)=>{const n=uS(e,t),s=dS(e,t);return!(!s||!n)&&n>s.depth},yS=(e,t)=>{const n=uS(e,t),s=dS(e,t);return!(!s||!n)&&n<s.depth},xS=(e,t)=>{if(!gb(e.state,t))return!1;if(!((e,t)=>{const{$from:n,$to:s,$anchor:r}=e.selection;if(t){const n=VC(e=>e.type.name===t)(e.selection);if(!n)return!1;const s=e.doc.resolve(n.pos+1);return r.pos+1===s.end()}return!(s.parentOffset<s.parent.nodeSize-2||n.pos!==s.pos)})(e.state,t))return!1;const{selection:n}=e.state,{$from:s,$to:r}=n;return!(!n.empty&&s.sameParent(r))&&(gS(t,e.state)?e.chain().focus(e.state.selection.from+4).lift(t).joinBackward().run():yS(t,e.state)?e.chain().joinForward().joinBackward().run():e.commands.joinItemForward())},CS=(e,t)=>{var n;const{$anchor:s}=t.selection,r=t.doc.resolve(s.pos-s.parentOffset-2);return r.index()!==r.parent.childCount-1&&(null==(n=r.nodeAfter)?void 0:n.type.name)===e},bS=Rb.create({name:"listKeymap",addOptions:()=>({listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}),addKeyboardShortcuts(){return{Delete:({editor:e})=>{let t=!1;return this.options.listTypes.forEach(({itemName:n})=>{void 0!==e.state.schema.nodes[n]&&xS(e,n)&&(t=!0)}),t},"Mod-Delete":({editor:e})=>{let t=!1;return this.options.listTypes.forEach(({itemName:n})=>{void 0!==e.state.schema.nodes[n]&&xS(e,n)&&(t=!0)}),t},Backspace:({editor:e})=>{let t=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:s})=>{void 0!==e.state.schema.nodes[n]&&fS(e,n,s)&&(t=!0)}),t},"Mod-Backspace":({editor:e})=>{let t=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:s})=>{void 0!==e.state.schema.nodes[n]&&fS(e,n,s)&&(t=!0)}),t}}}}),wS="textStyle",vS=/^(\d+)\.\s$/,kS=uv.create({name:"orderedList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes:()=>({start:{default:1,parseHTML:e=>e.hasAttribute("start")?parseInt(e.getAttribute("start")||"",10):1},type:{default:null,parseHTML:e=>e.getAttribute("type")}}),parseHTML:()=>[{tag:"ol"}],renderHTML({HTMLAttributes:e}){const{start:t,...n}=e;return 1===t?["ol",UC(this.options.HTMLAttributes,n),0]:["ol",UC(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleOrderedList:()=>({commands:e,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes("listItem",this.editor.getAttributes(wS)).run():e.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let e=lv({find:vS,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(e=lv({find:vS,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(wS)}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1],editor:this.editor})),[e]}}),MS=/^\s*(\[([( |x])?\])\s$/,SS=uv.create({name:"taskItem",addOptions:()=>({nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}),content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes:()=>({checked:{default:!1,keepOnSplit:!1,parseHTML:e=>{const t=e.getAttribute("data-checked");return""===t||"true"===t},renderHTML:e=>({"data-checked":e.checked})}}),parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:e,HTMLAttributes:t}){return["li",UC(this.options.HTMLAttributes,t,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:e.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){const e={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...e,Tab:()=>this.editor.commands.sinkListItem(this.name)}:e},addNodeView(){return({node:e,HTMLAttributes:t,getPos:n,editor:s})=>{const r=document.createElement("li"),i=document.createElement("label"),o=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div"),c=e=>{var t,n;a.ariaLabel=(null==(n=null==(t=this.options.a11y)?void 0:t.checkboxLabel)?void 0:n.call(t,e,a.checked))||`Task item checkbox for ${e.textContent||"empty task item"}`};return c(e),i.contentEditable="false",a.type="checkbox",a.addEventListener("mousedown",e=>e.preventDefault()),a.addEventListener("change",t=>{if(!s.isEditable&&!this.options.onReadOnlyChecked)return void(a.checked=!a.checked);const{checked:r}=t.target;s.isEditable&&"function"==typeof n&&s.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:e})=>{const t=n();if("number"!=typeof t)return!1;const s=e.doc.nodeAt(t);return e.setNodeMarkup(t,void 0,{...null==s?void 0:s.attrs,checked:r}),!0}).run(),!s.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(e,r)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([e,t])=>{r.setAttribute(e,t)}),r.dataset.checked=e.attrs.checked,a.checked=e.attrs.checked,i.append(a,o),r.append(i,l),Object.entries(t).forEach(([e,t])=>{r.setAttribute(e,t)}),{dom:r,contentDOM:l,update:e=>e.type===this.type&&(r.dataset.checked=e.attrs.checked,a.checked=e.attrs.checked,c(e),!0)}}},addInputRules(){return[lv({find:MS,type:this.type,getAttributes:e=>({checked:"x"===e[e.length-1]})})]}}),NS=uv.create({name:"taskList",addOptions:()=>({itemTypeName:"taskItem",HTMLAttributes:{}}),group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:e}){return["ul",UC(this.options.HTMLAttributes,e,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:e})=>e.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});Rb.create({name:"listKit",addExtensions(){const e=[];return!1!==this.options.bulletList&&e.push(lS.configure(this.options.bulletList)),!1!==this.options.listItem&&e.push(cS.configure(this.options.listItem)),!1!==this.options.listKeymap&&e.push(bS.configure(this.options.listKeymap)),!1!==this.options.orderedList&&e.push(kS.configure(this.options.orderedList)),!1!==this.options.taskItem&&e.push(SS.configure(this.options.taskItem)),!1!==this.options.taskList&&e.push(NS.configure(this.options.taskList)),e}});var TS=uv.create({name:"paragraph",priority:1e3,addOptions:()=>({HTMLAttributes:{}}),group:"block",content:"inline*",parseHTML:()=>[{tag:"p"}],renderHTML({HTMLAttributes:e}){return["p",UC(this.options.HTMLAttributes,e),0]},addCommands(){return{setParagraph:()=>({commands:e})=>e.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),ES=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,jS=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,AS=jb.create({name:"strike",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:e=>!!e.includes("line-through")&&{}}],renderHTML({HTMLAttributes:e}){return["s",UC(this.options.HTMLAttributes,e),0]},addCommands(){return{setStrike:()=>({commands:e})=>e.setMark(this.name),toggleStrike:()=>({commands:e})=>e.toggleMark(this.name),unsetStrike:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[ov({find:ES,type:this.type})]},addPasteRules(){return[pv({find:jS,type:this.type})]}}),IS=uv.create({name:"text",group:"inline"}),OS=jb.create({name:"underline",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:e=>!!e.includes("underline")&&{}}],renderHTML({HTMLAttributes:e}){return["u",UC(this.options.HTMLAttributes,e),0]},addCommands(){return{setUnderline:()=>({commands:e})=>e.setMark(this.name),toggleUnderline:()=>({commands:e})=>e.toggleMark(this.name),unsetUnderline:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});function LS(e={}){return new Pp({view:t=>new DS(t,e)})}class DS{constructor(e,t){var n;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=null!==(n=t.width)&&void 0!==n?n:1,this.color=!1===t.color?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(t=>{let n=e=>{this[t](e)};return e.dom.addEventListener(t,n),{name:t,handler:n}})}destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){null!=this.cursorPos&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,null==e?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e,t=this.editorView.state.doc.resolve(this.cursorPos),n=!t.parent.inlineContent,s=this.editorView.dom,r=s.getBoundingClientRect(),i=r.width/s.offsetWidth,o=r.height/s.offsetHeight;if(n){let n=t.nodeBefore,s=t.nodeAfter;if(n||s){let t=this.editorView.nodeDOM(this.cursorPos-(n?n.nodeSize:0));if(t){let r=t.getBoundingClientRect(),i=n?r.bottom:r.top;n&&s&&(i=(i+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let a=this.width/2*o;e={left:r.left,right:r.right,top:i-a,bottom:i+a}}}}if(!e){let t=this.editorView.coordsAtPos(this.cursorPos),n=this.width/2*i;e={left:t.left-n,right:t.left+n,top:t.top,bottom:t.bottom}}let a,l,c=this.editorView.dom.offsetParent;if(this.element||(this.element=c.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n),!c||c==document.body&&"static"==getComputedStyle(c).position)a=-pageXOffset,l=-pageYOffset;else{let e=c.getBoundingClientRect(),t=e.width/c.offsetWidth,n=e.height/c.offsetHeight;a=e.left-c.scrollLeft*t,l=e.top-c.scrollTop*n}this.element.style.left=(e.left-a)/i+"px",this.element.style.top=(e.top-l)/o+"px",this.element.style.width=(e.right-e.left)/i+"px",this.element.style.height=(e.bottom-e.top)/o+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),n=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),s=n&&n.type.spec.disableDropCursor,r="function"==typeof s?s(this.editorView,t,e):s;if(t&&!r){let e=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let t=sp(this.editorView.state.doc,e,this.editorView.dragging.slice);null!=t&&(e=t)}this.setCursor(e),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}class RS extends xp{constructor(e){super(e,e)}map(e,t){let n=e.resolve(t.map(this.head));return RS.valid(n)?new RS(n):xp.near(n)}content(){return Hu.empty}eq(e){return e instanceof RS&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for GapCursor.fromJSON");return new RS(e.resolve(t.pos))}getBookmark(){return new _S(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!function(e){for(let t=e.depth;t>=0;t--){let n=e.index(t),s=e.node(t);if(0!=n)for(let e=s.child(n-1);;e=e.lastChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}else if(s.type.spec.isolating)return!0}return!0}(e)||!function(e){for(let t=e.depth;t>=0;t--){let n=e.indexAfter(t),s=e.node(t);if(n!=s.childCount)for(let e=s.child(n);;e=e.firstChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}else if(s.type.spec.isolating)return!0}return!0}(e))return!1;let n=t.type.spec.allowGapCursor;if(null!=n)return n;let s=t.contentMatchAt(e.index()).defaultType;return s&&s.isTextblock}static findGapCursorFrom(e,t,n=!1){e:for(;;){if(!n&&RS.valid(e))return e;let s=e.pos,r=null;for(let n=e.depth;;n--){let i=e.node(n);if(t>0?e.indexAfter(n)<i.childCount:e.index(n)>0){r=i.child(t>0?e.indexAfter(n):e.index(n)-1);break}if(0==n)return null;s+=t;let o=e.doc.resolve(s);if(RS.valid(o))return o}for(;;){let i=t>0?r.firstChild:r.lastChild;if(!i){if(r.isAtom&&!r.isText&&!Mp.isSelectable(r)){e=e.doc.resolve(s+r.nodeSize*t),n=!1;continue e}break}r=i,s+=t;let o=e.doc.resolve(s);if(RS.valid(o))return o}return null}}}RS.prototype.visible=!1,RS.findFrom=RS.findGapCursorFrom,xp.jsonID("gapcursor",RS);class _S{constructor(e){this.pos=e}map(e){return new _S(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return RS.valid(t)?new RS(t):xp.near(t)}}const PS=gy({ArrowLeft:VS("horiz",-1),ArrowRight:VS("horiz",1),ArrowUp:VS("vert",-1),ArrowDown:VS("vert",1)});function VS(e,t){const n="vert"==e?t>0?"down":"up":t>0?"right":"left";return function(e,s,r){let i=e.selection,o=t>0?i.$to:i.$from,a=i.empty;if(i instanceof vp){if(!r.endOfTextblock(n)||0==o.depth)return!1;a=!1,o=e.doc.resolve(t>0?o.after():o.before())}let l=RS.findGapCursorFrom(o,t,a);return!!l&&(s&&s(e.tr.setSelection(new RS(l))),!0)}}function HS(e,t,n){if(!e||!e.editable)return!1;let s=e.state.doc.resolve(t);if(!RS.valid(s))return!1;let r=e.posAtCoords({left:n.clientX,top:n.clientY});return!(r&&r.inside>-1&&Mp.isSelectable(e.state.doc.nodeAt(r.inside)))&&(e.dispatch(e.state.tr.setSelection(new RS(s))),!0)}function $S(e,t){if("insertCompositionText"!=t.inputType||!(e.state.selection instanceof RS))return!1;let{$from:n}=e.state.selection,s=n.parent.contentMatchAt(n.index()).findWrapping(e.state.schema.nodes.text);if(!s)return!1;let r=Lu.empty;for(let o=s.length-1;o>=0;o--)r=Lu.from(s[o].createAndFill(null,r));let i=e.state.tr.replace(n.pos,n.pos,new Hu(r,0,0));return i.setSelection(vp.near(i.doc.resolve(n.pos+1))),e.dispatch(i),!1}function zS(e){if(!(e.selection instanceof RS))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",Tg.create(e.doc,[Mg.widget(e.selection.head,t,{key:"gapcursor"})])}var FS=200,BS=function(){};BS.prototype.append=function(e){return e.length?(e=BS.from(e),!this.length&&e||e.length<FS&&this.leafAppend(e)||this.length<FS&&e.leafPrepend(this)||this.appendInner(e)):this},BS.prototype.prepend=function(e){return e.length?BS.from(e).append(this):this},BS.prototype.appendInner=function(e){return new ZS(this,e)},BS.prototype.slice=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=this.length),e>=t?BS.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))},BS.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)},BS.prototype.forEach=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=this.length),t<=n?this.forEachInner(e,t,n,0):this.forEachInvertedInner(e,t,n,0)},BS.prototype.map=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=this.length);var s=[];return this.forEach(function(t,n){return s.push(e(t,n))},t,n),s},BS.from=function(e){return e instanceof BS?e:e&&e.length?new WS(e):BS.empty};var WS=function(e){function t(t){e.call(this),this.values=t}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(e,n){return 0==e&&n==this.length?this:new t(this.values.slice(e,n))},t.prototype.getInner=function(e){return this.values[e]},t.prototype.forEachInner=function(e,t,n,s){for(var r=t;r<n;r++)if(!1===e(this.values[r],s+r))return!1},t.prototype.forEachInvertedInner=function(e,t,n,s){for(var r=t-1;r>=n;r--)if(!1===e(this.values[r],s+r))return!1},t.prototype.leafAppend=function(e){if(this.length+e.length<=FS)return new t(this.values.concat(e.flatten()))},t.prototype.leafPrepend=function(e){if(this.length+e.length<=FS)return new t(e.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(t.prototype,n),t}(BS);BS.empty=new WS([]);var ZS=function(e){function t(t,n){e.call(this),this.left=t,this.right=n,this.length=t.length+n.length,this.depth=Math.max(t.depth,n.depth)+1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(e){return e<this.left.length?this.left.get(e):this.right.get(e-this.left.length)},t.prototype.forEachInner=function(e,t,n,s){var r=this.left.length;return!(t<r&&!1===this.left.forEachInner(e,t,Math.min(n,r),s))&&(!(n>r&&!1===this.right.forEachInner(e,Math.max(t-r,0),Math.min(this.length,n)-r,s+r))&&void 0)},t.prototype.forEachInvertedInner=function(e,t,n,s){var r=this.left.length;return!(t>r&&!1===this.right.forEachInvertedInner(e,t-r,Math.max(n,r)-r,s+r))&&(!(n<r&&!1===this.left.forEachInvertedInner(e,Math.min(t,r),n,s))&&void 0)},t.prototype.sliceInner=function(e,t){if(0==e&&t==this.length)return this;var n=this.left.length;return t<=n?this.left.slice(e,t):e>=n?this.right.slice(e-n,t-n):this.left.slice(e,n).append(this.right.slice(0,t-n))},t.prototype.leafAppend=function(e){var n=this.right.leafAppend(e);if(n)return new t(this.left,n)},t.prototype.leafPrepend=function(e){var n=this.left.leafPrepend(e);if(n)return new t(n,this.right)},t.prototype.appendInner=function(e){return this.left.depth>=Math.max(this.right.depth,e.depth)+1?new t(this.left,new t(this.right,e)):new t(this,e)},t}(BS),US=BS;class qS{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(0==this.eventCount)return null;let n,s,r=this.items.length;for(;;r--){if(this.items.get(r-1).selection){--r;break}}t&&(n=this.remapping(r,this.items.length),s=n.maps.length);let i,o,a=e.tr,l=[],c=[];return this.items.forEach((e,t)=>{if(!e.step)return n||(n=this.remapping(r,t+1),s=n.maps.length),s--,void c.push(e);if(n){c.push(new JS(e.map));let t,r=e.step.map(n.slice(s));r&&a.maybeStep(r).doc&&(t=a.mapping.maps[a.mapping.maps.length-1],l.push(new JS(t,void 0,void 0,l.length+c.length))),s--,t&&n.appendMap(t,s)}else a.maybeStep(e.step);return e.selection?(i=n?e.selection.map(n.slice(s)):e.selection,o=new qS(this.items.slice(0,r).append(c.reverse().concat(l)),this.eventCount-1),!1):void 0},this.items.length,0),{remaining:o,transform:a,selection:i}}addTransform(e,t,n,s){let r=[],i=this.eventCount,o=this.items,a=!s&&o.length?o.get(o.length-1):null;for(let c=0;c<e.steps.length;c++){let n,l=e.steps[c].invert(e.docs[c]),d=new JS(e.mapping.maps[c],l,t);(n=a&&a.merge(d))&&(d=n,c?r.pop():o=o.slice(0,o.length-1)),r.push(d),t&&(i++,t=void 0),s||(a=d)}let l=i-n.depth;return l>KS&&(o=function(e,t){let n;return e.forEach((e,s)=>{if(e.selection&&0==t--)return n=s,!1}),e.slice(n)}(o,l),i-=l),new qS(o.append(r),i)}remapping(e,t){let n=new Zh;return this.items.forEach((t,s)=>{let r=null!=t.mirrorOffset&&s-t.mirrorOffset>=e?n.maps.length-t.mirrorOffset:void 0;n.appendMap(t.map,r)},e,t),n}addMaps(e){return 0==this.eventCount?this:new qS(this.items.append(e.map(e=>new JS(e))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let n=[],s=Math.max(0,this.items.length-t),r=e.mapping,i=e.steps.length,o=this.eventCount;this.items.forEach(e=>{e.selection&&o--},s);let a=t;this.items.forEach(t=>{let s=r.getMirror(--a);if(null==s)return;i=Math.min(i,s);let l=r.maps[s];if(t.step){let i=e.steps[s].invert(e.docs[s]),c=t.selection&&t.selection.map(r.slice(a+1,s));c&&o++,n.push(new JS(l,i,c))}else n.push(new JS(l))},s);let l=[];for(let u=t;u<i;u++)l.push(new JS(r.maps[u]));let c=this.items.slice(0,s).append(l).append(n),d=new qS(c,o);return d.emptyItemCount()>500&&(d=d.compress(this.items.length-n.length)),d}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),n=t.maps.length,s=[],r=0;return this.items.forEach((i,o)=>{if(o>=e)s.push(i),i.selection&&r++;else if(i.step){let e=i.step.map(t.slice(n)),o=e&&e.getMap();if(n--,o&&t.appendMap(o,n),e){let a=i.selection&&i.selection.map(t.slice(n));a&&r++;let l,c=new JS(o.invert(),e,a),d=s.length-1;(l=s.length&&s[d].merge(c))?s[d]=l:s.push(c)}}else i.map&&n--},this.items.length,0),new qS(US.from(s.reverse()),r)}}qS.empty=new qS(US.empty,0);class JS{constructor(e,t,n,s){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=s}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new JS(t.getMap().invert(),t,this.selection)}}}class GS{constructor(e,t,n,s,r){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=s,this.prevComposition=r}}const KS=20;function YS(e){let t=[];for(let n=e.length-1;n>=0&&0==t.length;n--)e[n].forEach((e,n,s,r)=>t.push(s,r));return t}function QS(e,t){if(!e)return null;let n=[];for(let s=0;s<e.length;s+=2){let r=t.map(e[s],1),i=t.map(e[s+1],-1);r<=i&&n.push(r,i)}return n}let XS=!1,eN=null;function tN(e){let t=e.plugins;if(eN!=t){XS=!1,eN=t;for(let e=0;e<t.length;e++)if(t[e].spec.historyPreserveItems){XS=!0;break}}return XS}const nN=new $p("history"),sN=new $p("closeHistory");function rN(e={}){return e={depth:e.depth||100,newGroupDelay:e.newGroupDelay||500},new Pp({key:nN,state:{init:()=>new GS(qS.empty,qS.empty,null,0,-1),apply:(t,n,s)=>function(e,t,n,s){let r,i=n.getMeta(nN);if(i)return i.historyState;n.getMeta(sN)&&(e=new GS(e.done,e.undone,null,0,-1));let o=n.getMeta("appendedTransaction");if(0==n.steps.length)return e;if(o&&o.getMeta(nN))return o.getMeta(nN).redo?new GS(e.done.addTransform(n,void 0,s,tN(t)),e.undone,YS(n.mapping.maps),e.prevTime,e.prevComposition):new GS(e.done,e.undone.addTransform(n,void 0,s,tN(t)),null,e.prevTime,e.prevComposition);if(!1===n.getMeta("addToHistory")||o&&!1===o.getMeta("addToHistory"))return(r=n.getMeta("rebased"))?new GS(e.done.rebased(n,r),e.undone.rebased(n,r),QS(e.prevRanges,n.mapping),e.prevTime,e.prevComposition):new GS(e.done.addMaps(n.mapping.maps),e.undone.addMaps(n.mapping.maps),QS(e.prevRanges,n.mapping),e.prevTime,e.prevComposition);{let r=n.getMeta("composition"),i=0==e.prevTime||!o&&e.prevComposition!=r&&(e.prevTime<(n.time||0)-s.newGroupDelay||!function(e,t){if(!t)return!1;if(!e.docChanged)return!0;let n=!1;return e.mapping.maps[0].forEach((e,s)=>{for(let r=0;r<t.length;r+=2)e<=t[r+1]&&s>=t[r]&&(n=!0)}),n}(n,e.prevRanges)),a=o?QS(e.prevRanges,n.mapping):YS(n.mapping.maps);return new GS(e.done.addTransform(n,i?t.selection.getBookmark():void 0,s,tN(t)),qS.empty,a,n.time,null==r?e.prevComposition:r)}}(n,s,t,e)},config:e,props:{handleDOMEvents:{beforeinput(e,t){let n=t.inputType,s="historyUndo"==n?oN:"historyRedo"==n?aN:null;return!!s&&(t.preventDefault(),s(e.state,e.dispatch))}}}})}function iN(e,t){return(n,s)=>{let r=nN.getState(n);if(!r||0==(e?r.undone:r.done).eventCount)return!1;if(s){let i=function(e,t,n){let s=tN(t),r=nN.get(t).spec.config,i=(n?e.undone:e.done).popEvent(t,s);if(!i)return null;let o=i.selection.resolve(i.transform.doc),a=(n?e.done:e.undone).addTransform(i.transform,t.selection.getBookmark(),r,s),l=new GS(n?a:i.remaining,n?i.remaining:a,null,0,-1);return i.transform.setSelection(o).setMeta(nN,{redo:n,historyState:l})}(r,n,e);i&&s(t?i.scrollIntoView():i)}return!0}}const oN=iN(!1,!0),aN=iN(!0,!0);Rb.create({name:"characterCount",addOptions:()=>({limit:null,mode:"textSize",textCounter:e=>e.length,wordCounter:e=>e.split(" ").filter(e=>""!==e).length}),addStorage:()=>({characters:()=>0,words:()=>0}),onBeforeCreate(){this.storage.characters=e=>{const t=(null==e?void 0:e.node)||this.editor.state.doc;if("textSize"===((null==e?void 0:e.mode)||this.options.mode)){const e=t.textBetween(0,t.content.size,void 0," ");return this.options.textCounter(e)}return t.nodeSize},this.storage.words=e=>{const t=(null==e?void 0:e.node)||this.editor.state.doc,n=t.textBetween(0,t.content.size," "," ");return this.options.wordCounter(n)}},addProseMirrorPlugins(){let e=!1;return[new Pp({key:new $p("characterCount"),appendTransaction:(t,n,s)=>{if(e)return;const r=this.options.limit;if(null==r||0===r)return void(e=!0);const i=this.storage.characters({node:s.doc});if(i>r){const t=0,n=i-r,o=s.tr.deleteRange(t,n);return e=!0,o}e=!0},filterTransaction:(e,t)=>{const n=this.options.limit;if(!e.docChanged||0===n||null==n)return!0;const s=this.storage.characters({node:t.doc}),r=this.storage.characters({node:e.doc});if(r<=n)return!0;if(s>n&&r>n&&r<=s)return!0;if(s>n&&r>n&&r>s)return!1;if(!e.getMeta("paste"))return!1;const i=e.selection.$head.pos,o=i-(r-n),a=i;e.deleteRange(o,a);return!(this.storage.characters({node:e.doc})>n)}})]}});var lN=Rb.create({name:"dropCursor",addOptions:()=>({color:"currentColor",width:1,class:void 0}),addProseMirrorPlugins(){return[LS(this.options)]}});Rb.create({name:"focus",addOptions:()=>({className:"has-focus",mode:"all"}),addProseMirrorPlugins(){return[new Pp({key:new $p("focus"),props:{decorations:({doc:e,selection:t})=>{const{isEditable:n,isFocused:s}=this.editor,{anchor:r}=t,i=[];if(!n||!s)return Tg.create(e,[]);let o=0;"deepest"===this.options.mode&&e.descendants((e,t)=>{if(e.isText)return;if(!(r>=t&&r<=t+e.nodeSize-1))return!1;o+=1});let a=0;return e.descendants((e,t)=>{if(e.isText)return!1;if(!(r>=t&&r<=t+e.nodeSize-1))return!1;a+=1;if("deepest"===this.options.mode&&o-a>0||"shallowest"===this.options.mode&&a>1)return"deepest"===this.options.mode;i.push(Mg.node(t,t+e.nodeSize,{class:this.options.className}))}),Tg.create(e,i)}}})]}});var cN=Rb.create({name:"gapCursor",addProseMirrorPlugins:()=>[new Pp({props:{decorations:zS,createSelectionBetween:(e,t,n)=>t.pos==n.pos&&RS.valid(n)?new RS(n):null,handleClick:HS,handleKeyDown:PS,handleDOMEvents:{beforeinput:$S}}})],extendNodeSchema(e){var t;return{allowGapCursor:null!=(t=BC(HC(e,"allowGapCursor",{name:e.name,options:e.options,storage:e.storage})))?t:null}}}),dN=Rb.create({name:"placeholder",addOptions:()=>({emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something …",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}),addProseMirrorPlugins(){return[new Pp({key:new $p("placeholder"),props:{decorations:({doc:e,selection:t})=>{const n=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:s}=t,r=[];if(!n)return null;const i=this.editor.isEmpty;return e.descendants((e,t)=>{const n=s>=t&&s<=t+e.nodeSize,o=!e.isLeaf&&Cb(e);if((n||!this.options.showOnlyCurrent)&&o){const s=[this.options.emptyNodeClass];i&&s.push(this.options.emptyEditorClass);const o=Mg.node(t,t+e.nodeSize,{class:s.join(" "),"data-placeholder":"function"==typeof this.options.placeholder?this.options.placeholder({editor:this.editor,node:e,pos:t,hasAnchor:n}):this.options.placeholder});r.push(o)}return this.options.includeChildren}),Tg.create(e,r)}}})]}});function uN({types:e,node:t}){return t&&Array.isArray(e)&&e.includes(t.type)||(null==t?void 0:t.type)===e}Rb.create({name:"selection",addOptions:()=>({className:"selection"}),addProseMirrorPlugins(){const{editor:e,options:t}=this;return[new Pp({key:new $p("selection"),props:{decorations:n=>n.selection.empty||e.isFocused||!e.isEditable||bb(n.selection)||e.view.dragging?null:Tg.create(n.doc,[Mg.inline(n.selection.from,n.selection.to,{class:t.className})])}})]}});var hN=Rb.create({name:"trailingNode",addOptions:()=>({node:"paragraph",notAfter:[]}),addProseMirrorPlugins(){const e=new $p(this.name),t=Object.entries(this.editor.schema.nodes).map(([,e])=>e).filter(e=>(this.options.notAfter||[]).concat(this.options.node).includes(e.name));return[new Pp({key:e,appendTransaction:(t,n,s)=>{const{doc:r,tr:i,schema:o}=s,a=e.getState(s),l=r.content.size,c=o.nodes[this.options.node];if(a)return i.insert(l,c.create())},state:{init:(e,n)=>!uN({node:n.tr.doc.lastChild,types:t}),apply:(e,n)=>{if(!e.docChanged)return n;return!uN({node:e.doc.lastChild,types:t})}}})]}}),pN=Rb.create({name:"undoRedo",addOptions:()=>({depth:100,newGroupDelay:500}),addCommands:()=>({undo:()=>({state:e,dispatch:t})=>oN(e,t),redo:()=>({state:e,dispatch:t})=>aN(e,t)}),addProseMirrorPlugins(){return[rN(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),mN=Rb.create({name:"starterKit",addExtensions(){var e,t,n,s;const r=[];return!1!==this.options.bold&&r.push(Zv.configure(this.options.bold)),!1!==this.options.blockquote&&r.push($v.configure(this.options.blockquote)),!1!==this.options.bulletList&&r.push(lS.configure(this.options.bulletList)),!1!==this.options.code&&r.push(Jv.configure(this.options.code)),!1!==this.options.codeBlock&&r.push(Yv.configure(this.options.codeBlock)),!1!==this.options.document&&r.push(Qv.configure(this.options.document)),!1!==this.options.dropcursor&&r.push(lN.configure(this.options.dropcursor)),!1!==this.options.gapcursor&&r.push(cN.configure(this.options.gapcursor)),!1!==this.options.hardBreak&&r.push(Xv.configure(this.options.hardBreak)),!1!==this.options.heading&&r.push(ek.configure(this.options.heading)),!1!==this.options.undoRedo&&r.push(pN.configure(this.options.undoRedo)),!1!==this.options.horizontalRule&&r.push(tk.configure(this.options.horizontalRule)),!1!==this.options.italic&&r.push(ok.configure(this.options.italic)),!1!==this.options.listItem&&r.push(cS.configure(this.options.listItem)),!1!==this.options.listKeymap&&r.push(bS.configure(null==(e=this.options)?void 0:e.listKeymap)),!1!==this.options.link&&r.push(rS.configure(null==(t=this.options)?void 0:t.link)),!1!==this.options.orderedList&&r.push(kS.configure(this.options.orderedList)),!1!==this.options.paragraph&&r.push(TS.configure(this.options.paragraph)),!1!==this.options.strike&&r.push(AS.configure(this.options.strike)),!1!==this.options.text&&r.push(IS.configure(this.options.text)),!1!==this.options.underline&&r.push(OS.configure(null==(n=this.options)?void 0:n.underline)),!1!==this.options.trailingNode&&r.push(hN.configure(null==(s=this.options)?void 0:s.trailingNode)),r}}),fN=dN;function gN(e,t=10){const n=e.trim().split(/\s+/);if(3!==n.length)throw new Error(`Invalid HSL format: "${e}". Expected format: "H S% L%"`);const s=parseFloat(n[0]),r=parseFloat(n[1]),i=parseFloat(n[2]);if(isNaN(s)||isNaN(r)||isNaN(i))throw new Error(`Invalid HSL values in: "${e}"`);return function(e,t,n){const s=t/100,r=n/100,i=(1-Math.abs(2*r-1))*s,o=i*(1-Math.abs(e/60%2-1)),a=r-i/2;let l=0,c=0,d=0;e>=0&&e<60?(l=i,c=o,d=0):e>=60&&e<120?(l=o,c=i,d=0):e>=120&&e<180?(l=0,c=i,d=o):e>=180&&e<240?(l=0,c=o,d=i):e>=240&&e<300?(l=o,c=0,d=i):e>=300&&e<360&&(l=i,c=0,d=o);const u=Math.round(255*(l+a)),h=Math.round(255*(c+a)),p=Math.round(255*(d+a)),m=e=>{const t=e.toString(16);return 1===t.length?"0"+t:t};return`#${m(u)}${m(h)}${m(p)}`.toUpperCase()}(s,r,Math.min(100,i+t))}const yN={hidden:{opacity:1},visible:{opacity:1,transition:{staggerChildren:.025,delayChildren:0}}};function xN({node:e,extension:t,selected:n,editor:s,getPos:r}){const[i,o]=U.useState(!1),a=e.attrs,{id:l,name:c,promptContent:d}=a,h=t.options,p=h?.onEditShortcut,m=U.useMemo(()=>{let e="",t="";if("undefined"!=typeof window)try{const n=getComputedStyle(document.documentElement).getPropertyValue("--accent-secondary-100").trim();n&&(e=gN(n,40),t=gN(n,0))}catch{}return{hidden:{y:4,opacity:0,scale:.9,color:e},visible:{y:0,opacity:1,scale:1,color:t,transition:{y:{type:"spring",stiffness:450,damping:20,velocity:8},opacity:{duration:.2,ease:"easeOut"},scale:{type:"spring",stiffness:400,damping:10},color:{duration:.3,ease:"linear"}}}}},[]),f=bo(0);U.useEffect(()=>{Bo(f,1,{duration:.35,ease:"easeOut"})},[f]);const g=vo`linear-gradient(
    90deg,
    black ${ko(f,[0,1],[-20,100])}%,
    transparent ${ko(f,[0,1],[0,120])}%
  )`,y=U.useCallback(()=>{if(!s||"function"!=typeof r)return;const t=d;if(!t)return;const n=r();void 0!==n&&s.chain().focus().deleteRange({from:n,to:n+e.nodeSize}).insertContentAt(n,t).run()},[s,r,d,e.nodeSize]),x=U.useCallback(e=>{p&&(e.preventDefault(),e.stopPropagation(),p(l))},[p,l]),C=q.jsxs(q.Fragment,{children:[q.jsx("span",{className:u("absolute -inset-y-0.5 -left-0.5 -right-1 rounded-md pointer-events-none",n&&"bg-accent-secondary-900",i&&!n&&"bg-accent-secondary-900/50")}),q.jsxs(Qt.span,{className:"relative pl-5",style:{maskImage:g},children:[q.jsx(Qt.span,{initial:{opacity:0},animate:{opacity:1},className:u("absolute top-1/2 -translate-y-1/2 left-0","w-4 h-4 flex items-center justify-center","select-none"),children:q.jsx(Ki,{size:16})}),q.jsx(Qt.span,{className:"relative [&::selection]:bg-transparent inline-flex will-change-transform",variants:yN,initial:"hidden",animate:"visible",children:c.split("").map((e,t)=>q.jsx(Qt.span,{variants:m,className:u("inline-block select-none will-change-transform"," "===e&&"whitespace-pre"),children:e},t))})]})]});return q.jsx(Lv,{as:"span",className:u("inline-flex relative cursor-pointer group",n?"text-accent-secondary-000":"text-accent-secondary-100"),contentEditable:!1,"data-drag-handle":!0,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),onClick:p?x:void 0,onDoubleClick:e=>{e.preventDefault(),e.stopPropagation(),y()},children:C})}const CN=uv.create({name:"shortcutChip",addOptions:()=>({onEditShortcut:void 0}),group:"inline",inline:!0,atom:!0,addAttributes:()=>({id:{default:null},name:{default:""},promptContent:{default:null}}),parseHTML:()=>[{tag:"span[data-shortcut-chip]"}],renderHTML:({HTMLAttributes:e})=>["span",UC(e,{"data-shortcut-chip":""}),0],renderText:({node:e})=>`[[shortcut:${e.attrs.id}:${e.attrs.name}]]`,addNodeView(){return e=xN,n=>n.editor.contentComponent?new Pv(e,n,t):{};var e,t},addCommands(){return{insertShortcutChip:e=>({commands:t})=>t.insertContent({type:this.name,attrs:e})}},addKeyboardShortcuts(){return{Backspace:()=>{const{selection:e}=this.editor.state,{$from:t,empty:n}=e;if(!n)return!1;const s=t.nodeBefore;if(s&&s.type.name===this.name){const e=t.pos-s.nodeSize;return this.editor.chain().setNodeSelection(e).run(),!0}return!1},Delete:()=>{const{selection:e}=this.editor.state,{$from:t,empty:n}=e;if(!n)return!1;const s=t.nodeAfter;return!(!s||s.type.name!==this.name)&&(this.editor.chain().setNodeSelection(t.pos).run(),!0)}}}});function bN(e){var t;const{char:n,allowSpaces:s,allowToIncludeChar:r,allowedPrefixes:i,startOfLine:o,$position:a}=e,l=s&&!r,c=n.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&");const d=new RegExp(`\\s${c}$`),u=o?"^":"",h=r?"":c,p=l?new RegExp(`${u}${c}.*?(?=\\s${h}|$)`,"gm"):new RegExp(`${u}(?:^)?${c}[^\\s${h}]*`,"gm"),m=(null==(t=a.nodeBefore)?void 0:t.isText)&&a.nodeBefore.text;if(!m)return null;const f=a.pos-m.length,g=Array.from(m.matchAll(p)).pop();if(!g||void 0===g.input||void 0===g.index)return null;const y=g.input.slice(Math.max(0,g.index-1),g.index),x=new RegExp(`^[${null==i?void 0:i.join("")}\0]?$`).test(y);if(null!==i&&!x)return null;const C=f+g.index;let b=C+g[0].length;return l&&d.test(m.slice(b-1,b+1))&&(g[0]+=" ",b+=1),C<a.pos&&b>=a.pos?{range:{from:C,to:b},query:g[0].slice(n.length),text:g[0]}:null}var wN=new $p("suggestion");var vN=function({pluginKey:e=wN,editor:t,char:n="@",allowSpaces:s=!1,allowToIncludeChar:r=!1,allowedPrefixes:i=[" "],startOfLine:o=!1,decorationTag:a="span",decorationClass:l="suggestion",decorationContent:c="",decorationEmptyClass:d="is-empty",command:u=()=>null,items:h=()=>[],render:p=()=>({}),allow:m=()=>!0,findSuggestionMatch:f=bN}){let g;const y=null==p?void 0:p(),x=()=>{const e=t.state.selection.$anchor.pos,n=t.view.coordsAtPos(e),{top:s,right:r,bottom:i,left:o}=n;try{return new DOMRect(o,s,r-o,i-s)}catch{return null}},C=(n,s)=>s?()=>{const s=e.getState(t.state),r=null==s?void 0:s.decorationId,i=n.dom.querySelector(`[data-decoration-id="${r}"]`);return(null==i?void 0:i.getBoundingClientRect())||null}:x,b=new Pp({key:e,view(){return{update:async(e,n)=>{var s,r,i,o,a,l,c;const d=null==(s=this.key)?void 0:s.getState(n),p=null==(r=this.key)?void 0:r.getState(e.state),m=d.active&&p.active&&d.range.from!==p.range.from,f=!d.active&&p.active,x=d.active&&!p.active,b=!f&&!x&&d.query!==p.query,w=f||m&&b,v=b||m,k=x||m&&b;if(!w&&!v&&!k)return;const M=k&&!w?d:p,S=e.dom.querySelector(`[data-decoration-id="${M.decorationId}"]`);g={editor:t,range:M.range,query:M.query,text:M.text,items:[],command:e=>u({editor:t,range:M.range,props:e}),decorationNode:S,clientRect:C(e,S)},w&&(null==(i=null==y?void 0:y.onBeforeStart)||i.call(y,g)),v&&(null==(o=null==y?void 0:y.onBeforeUpdate)||o.call(y,g)),(v||w)&&(g.items=await h({editor:t,query:M.query})),k&&(null==(a=null==y?void 0:y.onExit)||a.call(y,g)),v&&(null==(l=null==y?void 0:y.onUpdate)||l.call(y,g)),w&&(null==(c=null==y?void 0:y.onStart)||c.call(y,g))},destroy:()=>{var e;g&&(null==(e=null==y?void 0:y.onExit)||e.call(y,g))}}},state:{init:()=>({active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}),apply(a,l,c,d){const{isEditable:u}=t,{composing:h}=t.view,{selection:p}=a,{empty:g,from:y}=p,x={...l},C=a.getMeta(e);if(C&&C.exit)return x.active=!1,x.decorationId=null,x.range={from:0,to:0},x.query=null,x.text=null,x;if(x.composing=h,u&&(g||t.view.composing)){!(y<l.range.from||y>l.range.to)||h||l.composing||(x.active=!1);const e=f({char:n,allowSpaces:s,allowToIncludeChar:r,allowedPrefixes:i,startOfLine:o,$position:p.$from}),a=`id_${Math.floor(4294967295*Math.random())}`;e&&m({editor:t,state:d,range:e.range,isActive:l.active})?(x.active=!0,x.decorationId=l.decorationId?l.decorationId:a,x.range=e.range,x.query=e.query,x.text=e.text):x.active=!1}else x.active=!1;return x.active||(x.decorationId=null,x.range={from:0,to:0},x.query=null,x.text=null),x}},props:{handleKeyDown(n,s){var r,i,o,a;const{active:l,range:c}=b.getState(n.state);if(!l)return!1;if("Escape"===s.key||"Esc"===s.key){const a=b.getState(n.state),l=null!=(r=null==g?void 0:g.decorationNode)?r:null,c=null!=l?l:(null==a?void 0:a.decorationId)?n.dom.querySelector(`[data-decoration-id="${a.decorationId}"]`):null;if((null==(i=null==y?void 0:y.onKeyDown)?void 0:i.call(y,{view:n,event:s,range:a.range}))||!1)return!0;const d={editor:t,range:a.range,query:a.query,text:a.text,items:[],command:e=>u({editor:t,range:a.range,props:e}),decorationNode:c,clientRect:c?()=>c.getBoundingClientRect()||null:null};return null==(o=null==y?void 0:y.onExit)||o.call(y,d),function(n,s){var r;try{const s=e.getState(n.state),i=(null==s?void 0:s.decorationId)?n.dom.querySelector(`[data-decoration-id="${s.decorationId}"]`):null,o={editor:t,range:(null==s?void 0:s.range)||{from:0,to:0},query:(null==s?void 0:s.query)||null,text:(null==s?void 0:s.text)||null,items:[],command:e=>u({editor:t,range:(null==s?void 0:s.range)||{from:0,to:0},props:e}),decorationNode:i,clientRect:C(n,i)};null==(r=null==y?void 0:y.onExit)||r.call(y,o)}catch{}const i=n.state.tr.setMeta(s,{exit:!0});n.dispatch(i)}(n,e),!0}return(null==(a=null==y?void 0:y.onKeyDown)?void 0:a.call(y,{view:n,event:s,range:c}))||!1},decorations(e){const{active:t,range:n,decorationId:s,query:r}=b.getState(e);if(!t)return null;const i=!(null==r?void 0:r.length),o=[l];return i&&o.push(d),Tg.create(e.doc,[Mg.inline(n.from,n.to,{nodeName:a,class:o.join(" "),"data-decoration-id":s,"data-decoration-content":c})])}}});return b};function kN(e){return Array.isArray?Array.isArray(e):"[object Array]"===AN(e)}function MN(e){return"string"==typeof e}function SN(e){return"number"==typeof e}function NN(e){return!0===e||!1===e||function(e){return TN(e)&&null!==e}(e)&&"[object Boolean]"==AN(e)}function TN(e){return"object"==typeof e}function EN(e){return null!=e}function jN(e){return!e.trim().length}function AN(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}const IN=Object.prototype.hasOwnProperty;class ON{constructor(e){this._keys=[],this._keyMap={};let t=0;e.forEach(e=>{let n=LN(e);this._keys.push(n),this._keyMap[n.id]=n,t+=n.weight}),this._keys.forEach(e=>{e.weight/=t})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function LN(e){let t=null,n=null,s=null,r=1,i=null;if(MN(e)||kN(e))s=e,t=DN(e),n=RN(e);else{if(!IN.call(e,"name"))throw new Error((e=>`Missing ${e} property in key`)("name"));const o=e.name;if(s=o,IN.call(e,"weight")&&(r=e.weight,r<=0))throw new Error((e=>`Property 'weight' in key '${e}' must be a positive integer`)(o));t=DN(o),n=RN(o),i=e.getFn}return{path:t,id:n,weight:r,src:s,getFn:i}}function DN(e){return kN(e)?e:e.split(".")}function RN(e){return kN(e)?e.join("."):e}const _N={useExtendedSearch:!1,getFn:function(e,t){let n=[],s=!1;const r=(e,t,i)=>{if(EN(e))if(t[i]){const o=e[t[i]];if(!EN(o))return;if(i===t.length-1&&(MN(o)||SN(o)||NN(o)))n.push(function(e){return null==e?"":function(e){if("string"==typeof e)return e;let t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(e)}(o));else if(kN(o)){s=!0;for(let e=0,n=o.length;e<n;e+=1)r(o[e],t,i+1)}else t.length&&r(o,t,i+1)}else n.push(e)};return r(e,MN(t)?t.split("."):t,0),s?n:n[0]},ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var PN={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(e,t)=>e.score===t.score?e.idx<t.idx?-1:1:e.score<t.score?-1:1,includeMatches:!1,findAllMatches:!1,minMatchCharLength:1,location:0,threshold:.6,distance:100,..._N};const VN=/[^ ]+/g;class HN{constructor({getFn:e=PN.getFn,fieldNormWeight:t=PN.fieldNormWeight}={}){this.norm=function(e=1,t=3){const n=new Map,s=Math.pow(10,t);return{get(t){const r=t.match(VN).length;if(n.has(r))return n.get(r);const i=1/Math.pow(r,.5*e),o=parseFloat(Math.round(i*s)/s);return n.set(r,o),o},clear(){n.clear()}}}(t,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((e,t)=>{this._keysMap[e.id]=t})}create(){!this.isCreated&&this.docs.length&&(this.isCreated=!0,MN(this.docs[0])?this.docs.forEach((e,t)=>{this._addString(e,t)}):this.docs.forEach((e,t)=>{this._addObject(e,t)}),this.norm.clear())}add(e){const t=this.size();MN(e)?this._addString(e,t):this._addObject(e,t)}removeAt(e){this.records.splice(e,1);for(let t=e,n=this.size();t<n;t+=1)this.records[t].i-=1}getValueForItemAtKeyId(e,t){return e[this._keysMap[t]]}size(){return this.records.length}_addString(e,t){if(!EN(e)||jN(e))return;let n={v:e,i:t,n:this.norm.get(e)};this.records.push(n)}_addObject(e,t){let n={i:t,$:{}};this.keys.forEach((t,s)=>{let r=t.getFn?t.getFn(e):this.getFn(e,t.path);if(EN(r))if(kN(r)){let e=[];const t=[{nestedArrIndex:-1,value:r}];for(;t.length;){const{nestedArrIndex:n,value:s}=t.pop();if(EN(s))if(MN(s)&&!jN(s)){let t={v:s,i:n,n:this.norm.get(s)};e.push(t)}else kN(s)&&s.forEach((e,n)=>{t.push({nestedArrIndex:n,value:e})})}n.$[s]=e}else if(MN(r)&&!jN(r)){let e={v:r,n:this.norm.get(r)};n.$[s]=e}}),this.records.push(n)}toJSON(){return{keys:this.keys,records:this.records}}}function $N(e,t,{getFn:n=PN.getFn,fieldNormWeight:s=PN.fieldNormWeight}={}){const r=new HN({getFn:n,fieldNormWeight:s});return r.setKeys(e.map(LN)),r.setSources(t),r.create(),r}function zN(e,{errors:t=0,currentLocation:n=0,expectedLocation:s=0,distance:r=PN.distance,ignoreLocation:i=PN.ignoreLocation}={}){const o=t/e.length;if(i)return o;const a=Math.abs(s-n);return r?o+a/r:a?1:o}const FN=32;function BN(e,t,n,{location:s=PN.location,distance:r=PN.distance,threshold:i=PN.threshold,findAllMatches:o=PN.findAllMatches,minMatchCharLength:a=PN.minMatchCharLength,includeMatches:l=PN.includeMatches,ignoreLocation:c=PN.ignoreLocation}={}){if(t.length>FN)throw new Error(`Pattern length exceeds max of ${FN}.`);const d=t.length,u=e.length,h=Math.max(0,Math.min(s,u));let p=i,m=h;const f=a>1||l,g=f?Array(u):[];let y;for(;(y=e.indexOf(t,m))>-1;){let e=zN(t,{currentLocation:y,expectedLocation:h,distance:r,ignoreLocation:c});if(p=Math.min(e,p),m=y+d,f){let e=0;for(;e<d;)g[y+e]=1,e+=1}}m=-1;let x=[],C=1,b=d+u;const w=1<<d-1;for(let k=0;k<d;k+=1){let s=0,i=b;for(;s<i;){zN(t,{errors:k,currentLocation:h+i,expectedLocation:h,distance:r,ignoreLocation:c})<=p?s=i:b=i,i=Math.floor((b-s)/2+s)}b=i;let a=Math.max(1,h-i+1),l=o?u:Math.min(h+i,u)+d,y=Array(l+2);y[l+1]=(1<<k)-1;for(let o=l;o>=a;o-=1){let s=o-1,i=n[e.charAt(s)];if(f&&(g[s]=+!!i),y[o]=(y[o+1]<<1|1)&i,k&&(y[o]|=(x[o+1]|x[o])<<1|1|x[o+1]),y[o]&w&&(C=zN(t,{errors:k,currentLocation:s,expectedLocation:h,distance:r,ignoreLocation:c}),C<=p)){if(p=C,m=s,m<=h)break;a=Math.max(1,2*h-m)}}if(zN(t,{errors:k+1,currentLocation:h,expectedLocation:h,distance:r,ignoreLocation:c})>p)break;x=y}const v={isMatch:m>=0,score:Math.max(.001,C)};if(f){const e=function(e=[],t=PN.minMatchCharLength){let n=[],s=-1,r=-1,i=0;for(let o=e.length;i<o;i+=1){let o=e[i];o&&-1===s?s=i:o||-1===s||(r=i-1,r-s+1>=t&&n.push([s,r]),s=-1)}return e[i-1]&&i-s>=t&&n.push([s,i-1]),n}(g,a);e.length?l&&(v.indices=e):v.isMatch=!1}return v}function WN(e){let t={};for(let n=0,s=e.length;n<s;n+=1){const r=e.charAt(n);t[r]=(t[r]||0)|1<<s-n-1}return t}class ZN{constructor(e,{location:t=PN.location,threshold:n=PN.threshold,distance:s=PN.distance,includeMatches:r=PN.includeMatches,findAllMatches:i=PN.findAllMatches,minMatchCharLength:o=PN.minMatchCharLength,isCaseSensitive:a=PN.isCaseSensitive,ignoreLocation:l=PN.ignoreLocation}={}){if(this.options={location:t,threshold:n,distance:s,includeMatches:r,findAllMatches:i,minMatchCharLength:o,isCaseSensitive:a,ignoreLocation:l},this.pattern=a?e:e.toLowerCase(),this.chunks=[],!this.pattern.length)return;const c=(e,t)=>{this.chunks.push({pattern:e,alphabet:WN(e),startIndex:t})},d=this.pattern.length;if(d>FN){let e=0;const t=d%FN,n=d-t;for(;e<n;)c(this.pattern.substr(e,FN),e),e+=FN;if(t){const e=d-FN;c(this.pattern.substr(e),e)}}else c(this.pattern,0)}searchIn(e){const{isCaseSensitive:t,includeMatches:n}=this.options;if(t||(e=e.toLowerCase()),this.pattern===e){let t={isMatch:!0,score:0};return n&&(t.indices=[[0,e.length-1]]),t}const{location:s,distance:r,threshold:i,findAllMatches:o,minMatchCharLength:a,ignoreLocation:l}=this.options;let c=[],d=0,u=!1;this.chunks.forEach(({pattern:t,alphabet:h,startIndex:p})=>{const{isMatch:m,score:f,indices:g}=BN(e,t,h,{location:s+p,distance:r,threshold:i,findAllMatches:o,minMatchCharLength:a,includeMatches:n,ignoreLocation:l});m&&(u=!0),d+=f,m&&g&&(c=[...c,...g])});let h={isMatch:u,score:u?d/this.chunks.length:1};return u&&n&&(h.indices=c),h}}class UN{constructor(e){this.pattern=e}static isMultiMatch(e){return qN(e,this.multiRegex)}static isSingleMatch(e){return qN(e,this.singleRegex)}search(){}}function qN(e,t){const n=e.match(t);return n?n[1]:null}class JN extends UN{constructor(e,{location:t=PN.location,threshold:n=PN.threshold,distance:s=PN.distance,includeMatches:r=PN.includeMatches,findAllMatches:i=PN.findAllMatches,minMatchCharLength:o=PN.minMatchCharLength,isCaseSensitive:a=PN.isCaseSensitive,ignoreLocation:l=PN.ignoreLocation}={}){super(e),this._bitapSearch=new ZN(e,{location:t,threshold:n,distance:s,includeMatches:r,findAllMatches:i,minMatchCharLength:o,isCaseSensitive:a,ignoreLocation:l})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class GN extends UN{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let t,n=0;const s=[],r=this.pattern.length;for(;(t=e.indexOf(this.pattern,n))>-1;)n=t+r,s.push([t,n-1]);const i=!!s.length;return{isMatch:i,score:i?0:1,indices:s}}}const KN=[class extends UN{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}},GN,class extends UN{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}},class extends UN{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},class extends UN{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},class extends UN{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}},class extends UN{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const t=-1===e.indexOf(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},JN],YN=KN.length,QN=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/;const XN=new Set([JN.type,GN.type]);class eT{constructor(e,{isCaseSensitive:t=PN.isCaseSensitive,includeMatches:n=PN.includeMatches,minMatchCharLength:s=PN.minMatchCharLength,ignoreLocation:r=PN.ignoreLocation,findAllMatches:i=PN.findAllMatches,location:o=PN.location,threshold:a=PN.threshold,distance:l=PN.distance}={}){this.query=null,this.options={isCaseSensitive:t,includeMatches:n,minMatchCharLength:s,findAllMatches:i,ignoreLocation:r,location:o,threshold:a,distance:l},this.pattern=t?e:e.toLowerCase(),this.query=function(e,t={}){return e.split("|").map(e=>{let n=e.trim().split(QN).filter(e=>e&&!!e.trim()),s=[];for(let r=0,i=n.length;r<i;r+=1){const e=n[r];let i=!1,o=-1;for(;!i&&++o<YN;){const n=KN[o];let r=n.isMultiMatch(e);r&&(s.push(new n(r,t)),i=!0)}if(!i)for(o=-1;++o<YN;){const n=KN[o];let r=n.isSingleMatch(e);if(r){s.push(new n(r,t));break}}}return s})}(this.pattern,this.options)}static condition(e,t){return t.useExtendedSearch}searchIn(e){const t=this.query;if(!t)return{isMatch:!1,score:1};const{includeMatches:n,isCaseSensitive:s}=this.options;e=s?e:e.toLowerCase();let r=0,i=[],o=0;for(let a=0,l=t.length;a<l;a+=1){const s=t[a];i.length=0,r=0;for(let t=0,a=s.length;t<a;t+=1){const a=s[t],{isMatch:l,indices:c,score:d}=a.search(e);if(!l){o=0,r=0,i.length=0;break}if(r+=1,o+=d,n){const e=a.constructor.type;XN.has(e)?i=[...i,...c]:i.push(c)}}if(r){let e={isMatch:!0,score:o/r};return n&&(e.indices=i),e}}return{isMatch:!1,score:1}}}const tT=[];function nT(e,t){for(let n=0,s=tT.length;n<s;n+=1){let s=tT[n];if(s.condition(e,t))return new s(e,t)}return new ZN(e,t)}const sT="$and",rT="$or",iT="$path",oT="$val",aT=e=>!(!e[sT]&&!e[rT]),lT=e=>({[sT]:Object.keys(e).map(t=>({[t]:e[t]}))});function cT(e,t,{auto:n=!0}={}){const s=e=>{let r=Object.keys(e);const i=(e=>!!e[iT])(e);if(!i&&r.length>1&&!aT(e))return s(lT(e));if((e=>!kN(e)&&TN(e)&&!aT(e))(e)){const s=i?e[iT]:r[0],o=i?e[oT]:e[s];if(!MN(o))throw new Error((e=>`Invalid value for key ${e}`)(s));const a={keyId:RN(s),pattern:o};return n&&(a.searcher=nT(o,t)),a}let o={children:[],operator:r[0]};return r.forEach(t=>{const n=e[t];kN(n)&&n.forEach(e=>{o.children.push(s(e))})}),o};return aT(e)||(e=lT(e)),s(e)}function dT(e,t){const n=e.matches;t.matches=[],EN(n)&&n.forEach(e=>{if(!EN(e.indices)||!e.indices.length)return;const{indices:n,value:s}=e;let r={indices:n,value:s};e.key&&(r.key=e.key.src),e.idx>-1&&(r.refIndex=e.idx),t.matches.push(r)})}function uT(e,t){t.score=e.score}class hT{constructor(e,t={},n){this.options={...PN,...t},this.options.useExtendedSearch,this._keyStore=new ON(this.options.keys),this.setCollection(e,n)}setCollection(e,t){if(this._docs=e,t&&!(t instanceof HN))throw new Error("Incorrect 'index' type");this._myIndex=t||$N(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){EN(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const t=[];for(let n=0,s=this._docs.length;n<s;n+=1){const r=this._docs[n];e(r,n)&&(this.removeAt(n),n-=1,s-=1,t.push(r))}return t}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:t=-1}={}){const{includeMatches:n,includeScore:s,shouldSort:r,sortFn:i,ignoreFieldNorm:o}=this.options;let a=MN(e)?MN(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return function(e,{ignoreFieldNorm:t=PN.ignoreFieldNorm}){e.forEach(e=>{let n=1;e.matches.forEach(({key:e,norm:s,score:r})=>{const i=e?e.weight:null;n*=Math.pow(0===r&&i?Number.EPSILON:r,(i||1)*(t?1:s))}),e.score=n})}(a,{ignoreFieldNorm:o}),r&&a.sort(i),SN(t)&&t>-1&&(a=a.slice(0,t)),function(e,t,{includeMatches:n=PN.includeMatches,includeScore:s=PN.includeScore}={}){const r=[];return n&&r.push(dT),s&&r.push(uT),e.map(e=>{const{idx:n}=e,s={item:t[n],refIndex:n};return r.length&&r.forEach(t=>{t(e,s)}),s})}(a,this._docs,{includeMatches:n,includeScore:s})}_searchStringList(e){const t=nT(e,this.options),{records:n}=this._myIndex,s=[];return n.forEach(({v:e,i:n,n:r})=>{if(!EN(e))return;const{isMatch:i,score:o,indices:a}=t.searchIn(e);i&&s.push({item:e,idx:n,matches:[{score:o,value:e,norm:r,indices:a}]})}),s}_searchLogical(e){const t=cT(e,this.options),n=(e,t,s)=>{if(!e.children){const{keyId:n,searcher:r}=e,i=this._findMatches({key:this._keyStore.get(n),value:this._myIndex.getValueForItemAtKeyId(t,n),searcher:r});return i&&i.length?[{idx:s,item:t,matches:i}]:[]}const r=[];for(let i=0,o=e.children.length;i<o;i+=1){const o=e.children[i],a=n(o,t,s);if(a.length)r.push(...a);else if(e.operator===sT)return[]}return r},s=this._myIndex.records,r={},i=[];return s.forEach(({$:e,i:s})=>{if(EN(e)){let o=n(t,e,s);o.length&&(r[s]||(r[s]={idx:s,item:e,matches:[]},i.push(r[s])),o.forEach(({matches:e})=>{r[s].matches.push(...e)}))}}),i}_searchObjectList(e){const t=nT(e,this.options),{keys:n,records:s}=this._myIndex,r=[];return s.forEach(({$:e,i:s})=>{if(!EN(e))return;let i=[];n.forEach((n,s)=>{i.push(...this._findMatches({key:n,value:e[s],searcher:t}))}),i.length&&r.push({idx:s,item:e,matches:i})}),r}_findMatches({key:e,value:t,searcher:n}){if(!EN(t))return[];let s=[];if(kN(t))t.forEach(({v:t,i:r,n:i})=>{if(!EN(t))return;const{isMatch:o,score:a,indices:l}=n.searchIn(t);o&&s.push({score:a,key:e,value:t,idx:r,norm:i,indices:l})});else{const{v:r,n:i}=t,{isMatch:o,score:a,indices:l}=n.searchIn(r);o&&s.push({score:a,key:e,value:r,norm:i,indices:l})}return s}}hT.version="7.0.0",hT.createIndex=$N,hT.parseIndex=function(e,{getFn:t=PN.getFn,fieldNormWeight:n=PN.fieldNormWeight}={}){const{keys:s,records:r}=e,i=new HN({getFn:t,fieldNormWeight:n});return i.setKeys(s),i.setIndexRecords(r),i},hT.config=PN,hT.parseQuery=cT,function(...e){tT.push(...e)}(eT);const pT=U.createContext(void 0);function mT({children:e,items:t,onSelect:n,onClickOutside:s,submenuItems:r,onSubmenuSelect:i,onOpenModal:o,onEditShortcut:a}){const[l,c]=U.useState(0),[d,u]=U.useState(null),[h,p]=U.useState(-1),[m,f]=U.useState("keyboard"),[g,y]=U.useState(!1),x=U.useCallback(e=>{if(!g)return;const n=t.findIndex(t=>t.id===e);n>=0&&c(n),f("mouse")},[t,g]);return U.useEffect(()=>{const e=t.findIndex(e=>!e.isSeparator);c(e>=0?e:0)},[t]),U.useEffect(()=>{const e=()=>{g||(y(!0),f("mouse"))};return document.addEventListener("mousemove",e),()=>document.removeEventListener("mousemove",e)},[g]),U.useEffect(()=>{const e=t[l];if(e&&"submenu"===e.action&&r?.[e.id]){const t=setTimeout(()=>{u(e.id),p(-1)},150);return()=>clearTimeout(t)}u(null)},[l,t,r]),U.useEffect(()=>{const e=e=>{if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter","Tab"].includes(e.key)&&f("keyboard"),"Escape"===e.key)return e.preventDefault(),e.stopImmediatePropagation(),void s();if("ArrowRight"===e.key){e.preventDefault(),e.stopImmediatePropagation();const n=t[l];if("submenu"===n?.action)if(d!==n.id){u(n.id);const e=(r?.[n.id]||[]).findIndex(e=>!e.isSeparator);p(e>=0?e:0)}else if(-1===h){const e=(r?.[n.id]||[]).findIndex(e=>!e.isSeparator);p(e>=0?e:0)}}else if("ArrowLeft"===e.key)e.preventDefault(),e.stopImmediatePropagation(),d&&(u(null),p(-1));else if("ArrowDown"===e.key)if(e.preventDefault(),e.stopImmediatePropagation(),d&&h>=0){const e=r?.[d]||[];p(t=>{let n=t+1;for(;n<e.length&&e[n].isSeparator;)n++;return n<e.length?n:t})}else c(e=>{let n=e+1;for(;n<t.length&&t[n].isSeparator;)n++;return n<t.length?n:e});else if("ArrowUp"===e.key)if(e.preventDefault(),e.stopImmediatePropagation(),d&&h>=0){const e=r?.[d]||[];p(t=>{let n=t-1;for(;n>=0&&e[n].isSeparator;)n--;return n>=0?n:t})}else c(e=>{let n=e-1;for(;n>=0&&t[n].isSeparator;)n--;return n>=0?n:e});else if("Enter"===e.key||"Tab"===e.key)if(e.preventDefault(),e.stopImmediatePropagation(),d&&h>=0){const e=(r?.[d]||[])[h];e&&("open-modal"===e.action?o(e):i(e))}else{const e=t[l];if(e&&!e.isSeparator)if("submenu"===e.action){u(e.id);const t=(r?.[e.id]||[]).findIndex(e=>!e.isSeparator);p(t>=0?t:0)}else"open-modal"===e.action?o(e):n(e)}};return document.addEventListener("keydown",e,!0),()=>document.removeEventListener("keydown",e,!0)},[t,l,n,s,d,h,r,i,o]),q.jsx(pT.Provider,{value:{items:t,onSelect:n,activeIndex:l,setActiveItemById:x,onClickOutside:s,submenuOpen:d,submenuActiveIndex:h,submenuItems:r,setSubmenuOpen:u,setSubmenuActiveIndex:p,onSubmenuSelect:i,onOpenModal:o,onEditShortcut:a,interactionMode:m,hasMouseMoved:g},children:e})}function fT(){const e=U.useContext(pT);if(!e)throw new Error("useShortcutMenu must be used within ShortcutMenuProvider");return e}function gT({item:e,index:t,isSubmenuItem:n=!1}){const r=s(),{activeIndex:i,setActiveItemById:o,onSelect:a,submenuOpen:l,submenuActiveIndex:c,onSubmenuSelect:d,onOpenModal:h,onEditShortcut:p,hasMouseMoved:m}=fT(),f=n?c===t:i===t,g="submenu"===e.action,y=l===e.id,C="string"==typeof e.icon?null:e.icon,b="/"===e.icon,w="chip"===e.action&&p;return q.jsxs("div",{onMouseEnter:()=>{m&&o(e.id)},className:u("group flex items-center gap-1 px-2.5 py-2 rounded-lg transition-colors","hover:bg-bg-200",f&&"bg-bg-200"),children:[q.jsxs("button",{onClick:()=>{"submenu"!==e.action&&("open-modal"!==e.action?n?d(e):a(e):h(e))},className:u("flex-1 min-w-0 text-left flex items-center gap-2","hover:text-text-000",f&&"text-text-000",!f&&"text-text-300"),children:[(b||C)&&q.jsx("div",{className:"w-5 h-5 flex items-center justify-center flex-shrink-0",children:b?q.jsx("span",{className:"text-text-500/50 font-mono text-sm",children:"/"}):C?q.jsx(C,{size:18}):null}),q.jsx("span",{className:"flex-1 truncate text-sm",children:e.name}),e.metadata&&!g&&q.jsx("span",{className:"text-text-400 text-xs ml-auto",children:e.metadata}),g&&q.jsx(ds,{size:14,className:u("text-text-400 ml-auto transition-transform",y&&"text-text-300")})]}),w&&q.jsx("button",{onClick:t=>{t.stopPropagation(),p(e)},className:u("p-1 rounded transition-all","opacity-0 group-hover:opacity-100","hover:bg-bg-300",f&&"opacity-100"),"aria-label":r.formatMessage({defaultMessage:"Edit {name}",id:"s3IOQQ+nJU"},{name:e.name}),children:q.jsx(x,{size:12,className:"text-text-400"})})]})}function yT(){return q.jsx("div",{className:"my-1.5 border-t-[0.5px] border-border-300"})}function xT({clientRect:e}){const t=U.useRef(null),n=U.useRef(null),[s,r]=U.useState({}),{items:i,onClickOutside:o,submenuOpen:a,submenuItems:l}=fT();U.useEffect(()=>{if(!t.current)return;const n=document.querySelector("[data-chat-input-container]");if(!n){const t=e?.();return void(t&&r({position:"fixed",bottom:window.innerHeight-t.top+8,left:t.left}))}const s=n.getBoundingClientRect();r({position:"fixed",bottom:window.innerHeight-s.top+8,left:s.left})},[e,i]),U.useEffect(()=>{if(!n.current||!t.current||!a)return;const e=t.current.getBoundingClientRect(),s=n.current,r=s.getBoundingClientRect();let i=e.right+4,o=e.top;const l=i+r.width>window.innerWidth-8,c=e.left-r.width-4>=8;l&&(c?i=e.left-r.width-4:(i=e.right-r.width,o=e.bottom-r.height)),o+r.height>window.innerHeight-8&&(o=window.innerHeight-r.height-8),o<8&&(o=8),s.style.position="fixed",s.style.top=`${o}px`,s.style.left=`${i}px`},[a,l]),U.useEffect(()=>{const e=e=>{const s=e.target;!t.current||t.current.contains(s)||n.current&&n.current.contains(s)||o()};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[o]);const c=a?l[a]:[];return q.jsxs(q.Fragment,{children:[q.jsx(Qt.div,{ref:t,style:s,initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:5},transition:{duration:.15},className:u("z-dropdown bg-bg-000 border-0.5 border-border-200 rounded-xl","backdrop-blur-xl shadow-[0px_2px_8px_0px_hsl(var(--always-black)/8%)]","dark:shadow-[0px_2px_8px_0px_hsl(var(--always-black)/24%)]","p-1.5 w-[340px] max-h-[300px] overflow-y-auto"),children:i.map((e,t)=>e.isSeparator?q.jsx(yT,{},e.id):q.jsx(gT,{item:e,index:t},e.id))}),q.jsx(Xt,{children:a&&c.length>0&&q.jsx(Qt.div,{ref:n,initial:{opacity:0,x:-5},animate:{opacity:1,x:0},exit:{opacity:0,x:-5},transition:{duration:.15},className:u("z-dropdown bg-bg-000 border-0.5 border-border-200 rounded-xl","backdrop-blur-xl shadow-[0px_2px_8px_0px_hsl(var(--always-black)/8%)]","dark:shadow-[0px_2px_8px_0px_hsl(var(--always-black)/24%)]","p-1.5 w-[300px] max-h-[300px] overflow-y-auto"),children:c.map((e,t)=>e.isSeparator?q.jsx(yT,{},e.id):q.jsx(gT,{item:e,index:t,isSubmenuItem:!0},e.id))})})]})}function CT(e){const t=en(e),n=[];return t.forEach(e=>{n.push({id:e.command,name:e.command,icon:"/",action:"execute",groupId:"system",keywords:e.description,metadata:e.description})}),n.push({id:"separator-1",name:"",isSeparator:!0}),n.push({id:"shortcuts",name:e?e.formatMessage({defaultMessage:"Shortcuts",id:"7FAwwkYilD"}):"Shortcuts",icon:Ki,action:"submenu",groupId:"navigation",keywords:"shortcuts prompts saved"}),n}async function bT(e,t=!0){const n=[],s=(await Q.getAllPrompts()).sort((e,t)=>t.usageCount!==e.usageCount?t.usageCount-e.usageCount:t.createdAt-e.createdAt),r=e?e.formatMessage({defaultMessage:"untitled",id:"zZuYUk2GGf"}):"untitled";return s.forEach(e=>{n.push({id:e.id,name:e.command||r,icon:Ki,action:"chip",groupId:"shortcuts-list",promptContent:e.prompt,keywords:e.command,url:e.url})}),n.length>0&&n.push({id:"shortcuts-separator",name:"",isSeparator:!0}),t&&n.push({id:"record-workflow",name:e?e.formatMessage({defaultMessage:"Record workflow",id:"6pwz+Cv63v"}):"Record workflow",icon:oi,action:"open-modal",groupId:"shortcuts-actions",keywords:"record teach workflow automation"}),n.push({id:"create-shortcut",name:e?e.formatMessage({defaultMessage:"Create shortcut",id:"AzO4h7b149"}):"Create shortcut",icon:tn,action:"open-modal",groupId:"shortcuts-actions",keywords:"create new shortcut prompt"}),n}const wT=["system","navigation","shortcuts-list","shortcuts-actions"];function vT({items:e,command:t,clientRect:n,editor:r,range:i,onClose:o,onRecordWorkflow:a,onCreateShortcut:l,onBrowseShortcuts:c,onEditShortcut:d,recordWorkflowEnabled:u=!0}){const h=s(),[p,m]=U.useState({});U.useEffect(()=>{(async()=>{const e=await async function(e,t,n=!0){return bT(t,n)}(0,h,u);m({shortcuts:e})})()},[h,u]);if(U.useEffect(()=>{r&&r.view.dom.focus()},[r]),!e||0===e.length)return null;return q.jsx(mT,{items:e,onSelect:e=>{t(e)},onClickOutside:()=>{o()},submenuItems:p,onSubmenuSelect:e=>{"chip"===e.action&&setTimeout(()=>{t(e),o()},150)},onOpenModal:e=>{r&&i&&r.chain().focus().deleteRange(i).run(),"record-workflow"===e.id&&a?a():"create-shortcut"===e.id&&l?l():"browse-shortcuts"===e.id&&c&&c(),o()},onEditShortcut:e=>{r&&i&&r.chain().focus().deleteRange(i).run(),d?.(e),o()},children:q.jsx(xT,{clientRect:n})})}const kT={keys:[{name:"name",weight:2},{name:"keywords",weight:1}],threshold:.3,ignoreLocation:!0,includeScore:!0,minMatchCharLength:1,isCaseSensitive:!1,findAllMatches:!0,shouldSort:!0};let MT=null,ST=null;async function NT(){if(!MT){const e=CT().filter(e=>!e.isSeparator&&!1!==e.showInFilteredList),t=(await bT()).filter(e=>!e.isSeparator&&!1!==e.showInFilteredList);MT=[...e,...t]}return MT}function TT(e){const t=e.getRecordWorkflowEnabled??(()=>!0);return{items:async({query:t})=>{if(!t)return CT(e.intl);if(t.startsWith(" "))return[];const n=t.trim();if(!n)return[];const s=await async function(){if(!ST){const e=await NT();ST=new hT(e,kT)}return ST}(),r=await NT(),i=s.search(n),o=[],a=[];i.forEach(e=>{const t=e.item,s=e.score||0;t.name.toLowerCase()===n.toLowerCase()||t.keywords?.toLowerCase()?.includes(n.toLowerCase())?o.push(t):s<=.4&&a.push(t)});let l=[...o,...a];if(0===l.length&&n.length<=3){l=r.filter(e=>e.name.toLowerCase().startsWith(n.toLowerCase())||e.keywords?.toLowerCase()?.startsWith(n.toLowerCase()))}const c=Array.from(new Map(l.map(e=>[e.id,e])).values());if(c.length<=1)return c;const d=new Map;if(c.forEach(e=>{const t=e.groupId||"default";d.has(t)||d.set(t,[]),d.get(t).push(e)}),d.size<=1)return c;const u=[];let h=0,p=!1;return wT.forEach(e=>{if(d.has(e)){const t=d.get(e);p&&u.push({id:"dynamic-separator-"+h++,name:"",isSeparator:!0}),u.push(...t),p=!0}}),u},command:({editor:t,range:n,props:s})=>{if("execute"===s.action)return t.chain().focus().deleteRange(n).run(),void e.onExecuteSystemCommand?.(`/${s.id}`);if("submenu"!==s.action&&"open-modal"!==s.action&&"chip"===s.action){if(s.url&&"undefined"!=typeof window)try{const e=new URLSearchParams(window.location.search).get("tabId");e&&chrome.tabs.update(parseInt(e),{url:s.url})}catch(r){}t.chain().focus().deleteRange(n).insertContent({type:"shortcutChip",attrs:{id:s.id,name:s.name,promptContent:s.promptContent}}).insertContent(" ").run()}},render:()=>{let n=null,s=null,r=!1;const i=()=>{r||(r=!0,s&&(s.destroy(),s=null),n&&n.parentNode&&(n.parentNode.removeChild(n),n=null))};return{onStart:o=>{r=!1,s=new _v(vT,{props:{...o,range:o.range,query:o.query,onClose:i,onRecordWorkflow:e.onRecordWorkflow,onCreateShortcut:e.onCreateShortcut,onBrowseShortcuts:e.onBrowseShortcuts,onEditShortcut:e.onEditShortcut,recordWorkflowEnabled:t()},editor:o.editor}),n=s.element,document.body.appendChild(n)},onUpdate:n=>{s&&s.updateProps({...n,range:n.range,query:n.query,onClose:i,onRecordWorkflow:e.onRecordWorkflow,onEditShortcut:e.onEditShortcut,onCreateShortcut:e.onCreateShortcut,onBrowseShortcuts:e.onBrowseShortcuts,recordWorkflowEnabled:t()})},onKeyDown:({event:e})=>"Escape"===e.key?(i(),!0):"Enter"===e.key||"Tab"===e.key||("ArrowUp"===e.key||"ArrowDown"===e.key||("ArrowLeft"===e.key||"ArrowRight"===e.key)),onExit:()=>{i()}}}}}const ET=Rb.create({name:"shortcut-suggestion",addOptions:()=>({onRecordWorkflow:void 0,onCreateShortcut:void 0,onBrowseShortcuts:void 0,onEditShortcut:void 0,onExecuteSystemCommand:void 0,intl:void 0,getRecordWorkflowEnabled:()=>!0}),addProseMirrorPlugins(){return[vN({editor:this.editor,char:"/",allowSpaces:!0,...TT({onRecordWorkflow:this.options.onRecordWorkflow,onCreateShortcut:this.options.onCreateShortcut,onBrowseShortcuts:this.options.onBrowseShortcuts,onEditShortcut:this.options.onEditShortcut,onExecuteSystemCommand:this.options.onExecuteSystemCommand,intl:this.options.intl,getRecordWorkflowEnabled:this.options.getRecordWorkflowEnabled})})]}}),jT=U.forwardRef(({value:e,onChange:t,onEmptyChange:n,onKeyDown:r,onPaste:i,placeholder:o,className:a,onRecordWorkflow:l,onCreateShortcut:c,onBrowseShortcuts:d,onEditShortcut:u,onExecuteSystemCommand:h,recordWorkflowEnabled:p=!0},m)=>{const f=s(),g=U.useRef(!1),y=U.useRef(e),x=U.useRef(!0),C=U.useRef(o);C.current=o;const b=U.useRef(h);b.current=h;const w=U.useRef(l);w.current=l;const v=U.useRef(c);v.current=c;const k=U.useRef(d);k.current=d;const M=U.useRef(u);M.current=u;const S=U.useRef(p);S.current=p;const N=Iv({extensions:[mN.configure({blockquote:!1,codeBlock:!1,heading:!1,horizontalRule:!1,bulletList:!1,orderedList:!1,listItem:!1}),fN.configure({placeholder:()=>C.current||"",emptyEditorClass:"is-editor-empty"}),CN.configure({onEditShortcut:e=>M.current?.(e)}),ET.configure({onRecordWorkflow:()=>w.current?.(),onCreateShortcut:()=>v.current?.(),onBrowseShortcuts:()=>k.current?.(),onEditShortcut:e=>M.current?.(e.id),onExecuteSystemCommand:e=>b.current?.(e),intl:f,getRecordWorkflowEnabled:()=>S.current})],content:e,editorProps:{attributes:{class:"w-full resize-none focus:outline-none focus:ring-0 focus:border-transparent text-text-100 overflow-y-auto text-sm prose prose-sm max-w-none",style:"min-height: 24px; max-height: 50vh; outline: none;","data-test-id":"message-input"},handleKeyDown:(e,t)=>{if("Enter"===t.key&&!t.shiftKey){if(!("true"===e.dom.dataset.shortcutMenuOpen)){const e=new KeyboardEvent("keydown",{key:"Enter",bubbles:!0});if(r?.(e),!t.shiftKey)return!0}}return!1},handlePaste:(e,t)=>(i?.(t),!1)},onUpdate:({editor:e})=>{g.current=!0;const s=e.getText();t(s);const r=e.isEmpty;if(r!==x.current&&(x.current=r,n?.(r)),s.startsWith("/")&&s.includes(" ")){const t=s.match(/^\/(\w+)\s/);if(t){const n=t[1];"compact"!==n&&"share"!==n||(b.current?.(`/${n}`),e.commands.clearContent())}}}});U.useEffect(()=>{if(N){if(""===e)return N.isEmpty||N.commands.clearContent(),y.current="",g.current=!1,void(!0!==x.current&&(x.current=!0,n?.(!0)));if(g.current)g.current=!1;else if(e!==y.current){y.current=e;N.getText()!==e&&N.commands.setContent(e||"")}}},[e,N,n]),U.useEffect(()=>{N&&N.isEmpty&&n?.(!0)},[N,n]),U.useEffect(()=>{N&&N.view.dispatch(N.state.tr)},[N,o]),U.useEffect(()=>{const e=()=>{MT=null,ST=null};return window.addEventListener("prompts-changed",e),()=>window.removeEventListener("prompts-changed",e)},[]),U.useImperativeHandle(m,()=>({focus:()=>{N?.commands.focus()},getText:()=>N?.getText()||"",getTextWithChips:()=>{if(!N)return{text:"",chips:[]};let e="";const t=[];return N.state.doc.descendants(n=>{if(n.isText)e+=n.text;else if("shortcutChip"===n.type.name){const s=n.attrs;s.promptContent&&(e+=s.promptContent),t.push({id:s.id,name:s.name,promptContent:s.promptContent})}}),{text:e,chips:t}},clear:()=>{N?.commands.clearContent()},setContent:e=>{N?.commands.setContent(e)},isEmpty:()=>N?.isEmpty??!0}),[N]);const T=U.useCallback(e=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Tab"].includes(e.key)||r?.(e)},[r]);return q.jsx("div",{className:a,onKeyDown:T,children:q.jsx(Sv,{editor:N})})});function AT({inputText:e,setInputText:t,attachments:n,isUploading:o,uploadingCount:a,hasBlockingWarning:l,permissionMode:c,setPermissionMode:d,supportedPermissionModes:u,canSkipPermissions:p,shouldDisableSkipPermissions:m,messages:f,isAgentRunning:g,recordingState:y,isSpeechRecording:x,isSpeechSupported:b,hasSpeechPermission:w,isGeneratingSummary:v,setIsGeneratingSummary:k,handleDrop:M,handlePaste:S,handleFiles:N,removeAttachment:T,handleSend:E,cancel:j,captureSelection:A,sendMessage:I,stopRecording:O,togglePause:L,setShowWorkflowModeSelectionModal:D,setPromptToSave:R,setPromptToEdit:_,activeBanner:P,chromeExtEligibility:V,messageStopWarning:H,error:$,onRetryError:z,onClearError:F,messageLimit:B,lastStopReason:W,selectedModel:Z,modelConfig:J,setSkipPermissionsWarningDismissed:G,setIsMessageLimitDismissed:K,announcementConfig:Y,handleEnableNotifications:X,handleDismissNotificationBanner:ee,handleDismissAnnouncement:ne,handleRetryWithFallback:se,handleSendFeedbackForRefusal:re,recordWorkflowEnabled:ie,isCapturing:oe,currentUrl:ae,useSessionsAPI:le=!1,autoScrollRef:ce,sentinelRef:de,fileInputRef:ue,chatInputContainerRef:he,isStreaming:pe=!1,analytics:me,createAnthropicMessage:fe}){const ge=s(),ye=U.useRef(null),[xe,Ce]=U.useState(!0),be=U.useCallback(t=>{if("Enter"===t.key&&!t.shiftKey&&!t.nativeEvent?.isComposing){t.preventDefault();const s=n.some(e=>!e.error),r=n.some(e=>e.error);(e.trim()||s)&&!g&&!r&&!l&&E()}},[n,e,g,l,E]),we=U.useCallback(e=>{t(""),I(e)},[I,t]),ve=U.useCallback(()=>{D(!0)},[D]),ke=U.useCallback(()=>{const t=e||"";if(t.startsWith("/")){const e=t.slice(1).split(" ")[0];R({prompt:"",command:e})}else R({prompt:t})},[e,R]),Me=U.useCallback(async e=>{const t=(await Q.getAllPrompts()).find(t=>t.id===e);t&&_(t)},[_]);return q.jsxs("div",{className:"mx-3 md:mx-0",children:[!y.isRecording&&q.jsx(fo,{autoscrollRef:ce,sentinelElement:de.current,isStreaming:pe,scrollThreshold:50}),q.jsxs("div",{className:"bg-bg-100",children:[q.jsx("div",{className:"px-3 md:px-2",children:q.jsx(Xt,{mode:"wait",children:(()=>{if("eligibility"===P)return q.jsx(wu,{isEligible:V,onBlockingStateChange:()=>{}},"eligibility");if("error"===P){const e=$?.toLowerCase().includes("connection error")||$?.toLowerCase().includes("network error")||$?.toLowerCase().includes("failed to fetch");return q.jsxs(Zo,{type:"error",onDismiss:F,dismissWithGradient:!0,children:[$,z&&e&&q.jsxs(q.Fragment,{children:[" ",q.jsx("button",{onClick:z,className:"underline hover:opacity-80 transition-opacity",children:q.jsx(r,{defaultMessage:"Retry",id:"62nsdyMyIO"})})]})]},"error")}if("refusal"===P)return H;if("messageLimit"===P)return q.jsx(bu,{messageLimit:B,currentModel:Z,onBlockingStateChange:()=>{},onDismiss:()=>K(!0)},"messageLimit");if("highRisk"===P)return q.jsx(Zo,{type:"high-risk",onDismiss:()=>G(!0),dismissWithGradient:!0,children:q.jsx(r,{defaultMessage:"<bold>HIGH RISK:</bold> Claude can take most actions on the internet now. This setting could put your data at risk. <link>See safe use tips</link>",id:"sbllSdx3rS",values:{bold:e=>q.jsx("span",{className:"font-bold",children:e}),link:e=>q.jsx("button",{onClick:()=>chrome.tabs.create({url:ku}),className:"underline hover:opacity-80 transition-colors",children:e})}})},"highRisk");if("notification"===P)return q.jsx(Zo,{type:"notification",onAction:X,onDismiss:ee,actionText:ge.formatMessage({defaultMessage:"Notify me",id:"ipGe+BIJx7"}),actionIcon:q.jsx(xs,{size:16}),children:q.jsx(r,{defaultMessage:"Get notified when tasks complete or need input",id:"wJ41IHBkzE"})},"notification");if("announcement"===P){const e=Y.get("text","");return q.jsx(Zo,{type:"announcement",onDismiss:ne,children:q.jsxs("div",{className:"flex items-start gap-2",children:[q.jsx(Ei,{vectorSizeOverride:16}),e]})},"announcement")}return null})()})}),(()=>{const e="refusal"===W?.reason?J.modelFallbacks?.[Z]:null;return e?q.jsx(Uo,{currentModelName:e.currentModelName,fallbackModelName:e.fallbackModelName,fallbackDisplayName:e.fallbackDisplayName,learnMoreUrl:e.learnMoreUrl,onRetry:se,onSendFeedback:re}):null})(),!("refusal"===W?.reason&&J.modelFallbacks?.[Z])&&q.jsxs(q.Fragment,{children:[q.jsx("div",{ref:he,"data-chat-input-container":"true",className:"bg-bg-000 rounded-2xl relative z-30 transition-all focus-within:outline-none cursor-text shadow-[0_0.25rem_1.25rem_hsl(var(--always-black)/3.5%),0_0_0_0.5px_hsla(var(--border-300)/0.15)] hover:shadow-[0_0.25rem_1.25rem_hsl(var(--always-black)/3.5%),0_0_0_0.5px_hsla(var(--border-200)/0.3)] focus-within:shadow-[0_0.25rem_1.25rem_hsl(var(--always-black)/7.5%),0_0_0_0.5px_hsla(var(--border-200)/0.3)]",onClick:()=>ye.current?.focus(),children:q.jsxs(nn,{onDrop:M,children:[q.jsx(sn,{attachments:n,onRemove:T,isUploading:o,uploadingCount:a}),q.jsx(Xt,{initial:!1,children:!y.isRecording&&q.jsx(Qt.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2,ease:"easeOut"},className:"overflow-hidden",children:q.jsx("div",{className:"px-4 pt-4 pb-2",children:q.jsxs("div",{className:"relative",children:[q.jsx(jT,{ref:ye,value:e,onChange:t,onEmptyChange:Ce,onKeyDown:be,onPaste:S,placeholder:0===f.length?"":ge.formatMessage({defaultMessage:"Reply to Claude",id:"l+dE/S7JbF"}),onRecordWorkflow:ve,onCreateShortcut:ke,onEditShortcut:Me,onExecuteSystemCommand:we,recordWorkflowEnabled:ie}),q.jsx(vu,{isVisible:0===f.length&&xe})]})})})}),q.jsx("input",{ref:ue,type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:e=>{e.target.files&&N(e.target.files),e.target.value=""}}),q.jsxs("div",{className:`flex items-center ${y.isRecording?"justify-center":"justify-between"} px-3 ${y.isRecording?"py-3":"pb-3"} relative`,children:[!y.isRecording&&p?q.jsx(rn,{permissionMode:c,permissionModeOptions:u,onChange:e=>{d(e),me?.track("claude_chrome.permission_mode.changed",{from:c,to:e,method:"menu"})},disabled:m}):y.isRecording?null:q.jsx("div",{}),q.jsxs("div",{className:"flex items-center "+(y.isRecording?"gap-4 justify-between w-full":"gap-2"),children:[y.isRecording?q.jsxs(q.Fragment,{children:[q.jsx(h,{tooltipContent:ge.formatMessage({defaultMessage:"Discard",id:"nmpevlUATU"}),side:"top",children:q.jsx(i,{variant:"ghost",size:"icon_sm",onClick:()=>{O()},"aria-label":ge.formatMessage({defaultMessage:"Discard",id:"nmpevlUATU"}),className:"text-danger-000 hover:bg-danger-900",children:q.jsx(C,{size:12})})}),q.jsxs("div",{className:"flex items-center gap-2",children:[q.jsx(h,{tooltipContent:y.isPaused?ge.formatMessage({defaultMessage:"Resume",id:"3y9DGgura7"}):ge.formatMessage({defaultMessage:"Pause",id:"tFFMkFDBMO"}),side:"top",children:q.jsx(i,{variant:"secondary",size:"icon_sm",onClick:L,"aria-label":y.isPaused?ge.formatMessage({defaultMessage:"Resume",id:"3y9DGgura7"}):ge.formatMessage({defaultMessage:"Pause",id:"tFFMkFDBMO"}),children:y.isPaused?q.jsx(Cs,{size:12}):q.jsx($r,{size:12,weight:"light"})})}),b&&q.jsx(h,{tooltipContent:x?ge.formatMessage({defaultMessage:"Voice narration active",id:"yq8mEk+Hev"}):w?ge.formatMessage({defaultMessage:"Voice narration paused",id:"i5E6OW65QG"}):ge.formatMessage({defaultMessage:"Microphone permission needed",id:"FPK1O1X8S1"}),side:"top",children:q.jsx("div",{className:"flex items-center justify-center h-7 w-7 rounded-lg "+(x?"text-accent-main-100 animate-pulse":w?"text-text-400":"text-danger-000"),children:q.jsx(Ss,{size:12})})}),q.jsx(i,{variant:"primary",size:"sm",onClick:async()=>{k(!0);let e="";if(y.steps.length>0)try{const{generateWorkflowSummary:t}=await te(async()=>{const{generateWorkflowSummary:e}=await import("./ModelSelector-B-fXYzGj.js").then(e=>e.aQ);return{generateWorkflowSummary:e}},__vite__mapDeps([0,1,2,3,4,5]));e=await t(y.steps,fe)}catch(t){}k(!1),R({prompt:e}),O()},disabled:v,"aria-label":ge.formatMessage({defaultMessage:"Save as shortcut",id:"z9VjDwhyoe"}),children:v?q.jsx(r,{defaultMessage:"Generating...",id:"A/lLjOnjl0"}):q.jsx(r,{defaultMessage:"Save as shortcut",id:"z9VjDwhyoe"})})]})]}):q.jsxs(q.Fragment,{children:[ie&&q.jsx(h,{tooltipContent:ge.formatMessage({defaultMessage:"Teach Claude",id:"cXTNE0Hbj4"}),side:"top",children:q.jsx("button",{onClick:()=>{D(!0)},className:"inline-flex items-center justify-center relative shrink-0 select-none font-medium h-7 w-7 rounded-lg active:scale-95 transition-all duration-200 text-text-300 hover:text-text-200 hover:bg-bg-200",type:"button","aria-label":ge.formatMessage({defaultMessage:"Teach Claude",id:"cXTNE0Hbj4"}),children:q.jsx(oi,{size:12})})}),q.jsx(h,{tooltipContent:ge.formatMessage({defaultMessage:"Actions",id:"wL7VAE/fRX"}),side:"top",children:q.jsx(on,{onScreenshot:()=>A(),onUpload:()=>ue.current?.click(),disabled:o||oe,currentUrl:ae,showConnectors:le,isAgentRunning:g})})]}),!y.isRecording&&q.jsx(q.Fragment,{children:g?q.jsx("button",{"data-test-id":"stop-button",onClick:j,className:"inline-flex items-center justify-center relative shrink-0 select-none font-medium h-7 w-7 rounded-lg active:scale-95 text-text-300 hover:text-text-200 hover:bg-bg-200 transition-colors",type:"button","aria-label":ge.formatMessage({defaultMessage:"Stop message",id:"0YIsn/UOa0"}),children:q.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 256 256",children:q.jsx("path",{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Zm40-112v56a12,12,0,0,1-12,12H100a12,12,0,0,1-12-12V100a12,12,0,0,1,12-12h56A12,12,0,0,1,168,100Z"})})}):q.jsx("button",{"data-test-id":"send-button",onClick:E,disabled:!e.trim()&&0===n.length||n.some(e=>e.error)||l,className:"inline-flex items-center justify-center relative shrink-0 select-none disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none disabled:drop-shadow-none font-medium transition-colors h-7 w-7 rounded-lg active:scale-95 "+("skip_all_permission_checks"===c?"bg-[#BF8534] hover:bg-[#A06F2C] text-white":"bg-accent-main-000 hover:bg-accent-main-200 text-oncolor-100"),type:"button","aria-label":ge.formatMessage({defaultMessage:"Send message",id:"Xx0WZVz8QS"}),children:q.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 256 256",className:"transition-colors",children:q.jsx("path",{d:"M208.49,120.49a12,12,0,0,1-17,0L140,69V216a12,12,0,0,1-24,0V69L64.49,120.49a12,12,0,0,1-17-17l72-72a12,12,0,0,1,17,0l72,72A12,12,0,0,1,208.49,120.49Z"})})})})]})]})]})}),q.jsx("div",{className:"flex justify-center py-1.5 text-text-500 bg-bg-100",children:q.jsx("a",{href:"https://support.anthropic.com/en/articles/8525154-claude-is-providing-incorrect-or-misleading-responses-what-s-going-on",target:"_blank",rel:"noopener noreferrer",className:"text-[11px] hover:text-text-300 transition-colors text-center",children:q.jsx(r,{defaultMessage:"Claude is AI and can make mistakes. Please double-check responses.",id:"Hz3uf5n9Ga"})})})]})]})]})}jT.displayName="TipTapEditor";class IT{static async startTaskRun(e,t,n,s){const r={id:`${e}_${Date.now()}`,taskId:e,taskName:t,timestamp:Date.now(),status:"started",prompt:n,url:s,messages:[{role:"system",content:`Task "${t}" started`,timestamp:Date.now()}]};return await this.saveLog(r),r}static async addLogMessage(e,t){const n=await this.getAllLogs(),s=n.find(t=>t.id===e);s&&(s.messages.push(t),await this.saveLogs(n))}static async updateTaskRunStatus(e,t,n){const s=await this.getAllLogs(),r=s.find(t=>t.id===e);r&&(r.status=t,n&&(r.error=n),"completed"!==t&&"failed"!==t||(r.duration=Date.now()-r.timestamp),await this.saveLogs(s),await this.updateStats(r.taskId,"completed"===t))}static async getTaskLogs(e){return(await this.getAllLogs()).filter(t=>t.taskId===e).sort((e,t)=>t.timestamp-e.timestamp)}static async getAllLogs(){return await J(G.SCHEDULED_TASK_LOGS)||[]}static async saveLog(e){const t=await this.getAllLogs();t.push(e),await this.saveLogs(t)}static async saveLogs(e){const t=Date.now()-2592e6;let n=e.filter(e=>e.timestamp>t);const s=new Map;n.forEach(e=>{const t=s.get(e.taskId)||[];t.push(e),s.set(e.taskId,t)}),n=[],s.forEach(e=>{const t=e.sort((e,t)=>t.timestamp-e.timestamp);n.push(...t.slice(0,50))}),n=n.sort((e,t)=>t.timestamp-e.timestamp).slice(0,500),await K(G.SCHEDULED_TASK_LOGS,n)}static async updateStats(e,t){const n=await J(G.SCHEDULED_TASK_STATS)||{},s=n[e]||{totalRuns:0,successfulRuns:0,failedRuns:0,averageDuration:0};s.totalRuns++,t?s.successfulRuns++:s.failedRuns++,s.lastRunDate=Date.now();const r=(await this.getTaskLogs(e)).filter(e=>e.duration).map(e=>e.duration);r.length>0&&(s.averageDuration=r.reduce((e,t)=>e+t,0)/r.length),n[e]=s,await K(G.SCHEDULED_TASK_STATS,n)}static async getTaskStats(e){return(await J(G.SCHEDULED_TASK_STATS)||{})[e]||null}static async exportLogs(e){const t=e?await this.getTaskLogs(e):await this.getAllLogs();return JSON.stringify({exportDate:(new Date).toISOString(),taskId:e||"all",logs:t},null,2)}static async clearTaskLogs(e){const t=(await this.getAllLogs()).filter(t=>t.taskId!==e);await K(G.SCHEDULED_TASK_LOGS,t);const n=await J(G.SCHEDULED_TASK_STATS)||{};delete n[e],await K(G.SCHEDULED_TASK_STATS,n)}static async clearAllLogs(){await chrome.storage.local.remove([G.SCHEDULED_TASK_LOGS,G.SCHEDULED_TASK_STATS])}}const OT=Ln(e=>({sessionId:crypto.randomUUID(),deviceId:void 0,existingSessionIdToLoad:void 0,existingConversationUuidToLoad:void 0,currentScheduledTaskRunId:null,currentScheduledTaskName:null,inputText:"",pendingPrompt:null,promptToSave:null,promptToEdit:null,setSessionId:t=>e({sessionId:t}),setDeviceId:t=>e({deviceId:t}),setExistingSessionIdToLoad:t=>e({existingSessionIdToLoad:t}),setExistingConversationUuidToLoad:t=>e({existingConversationUuidToLoad:t}),setCurrentScheduledTask:(t,n)=>e({currentScheduledTaskRunId:t,currentScheduledTaskName:n}),clearCurrentScheduledTask:()=>e({currentScheduledTaskRunId:null,currentScheduledTaskName:null}),setInputText:t=>e({inputText:t}),setPendingPrompt:t=>e({pendingPrompt:t}),setPromptToSave:t=>e({promptToSave:t}),setPromptToEdit:t=>e({promptToEdit:t}),generateNewSessionId:()=>{const t=crypto.randomUUID();return e({sessionId:t}),t}}));ne().then(e=>{OT.getState().setDeviceId(e)});const LT=()=>{if("undefined"!=typeof window){if("true"===new URLSearchParams(window.location.search).get("skipPermissions"))return"skip_all_permission_checks"}return"ask"},DT=Ln(e=>({permissionPrompt:null,permissionMode:LT(),setPermissionPrompt:t=>e({permissionPrompt:t}),setPermissionMode:t=>e({permissionMode:t}),resetOnSessionClear:()=>e({permissionPrompt:null})}));const RT=new class{calculateMetricsFromMessages(e,t){for(let n=e.length-1;n>=0;n--){const s=e[n];if(s&&"role"in s&&"assistant"===s.role&&"usage"in s&&s.usage)return this.calculateMetricsFromUsage(s.usage,t)}return null}calculateMetricsFromUsage(e,t){const n=e.input_tokens||0,s=e.output_tokens||0,r=e.cache_creation_input_tokens||0,i=e.cache_read_input_tokens||0,o=r+i,a=n+r+i,l=a+s,c=2e5-t,d=Math.round(l/c*100);return{inputTokens:a,outputTokens:s,totalTokens:l,cacheTokens:o,contextWindow:c,percentUsed:d,percentRemaining:Math.max(0,100-d),isWarning:l>=c-2e4,isError:l>=c-1e4}}getColorForPercentage(e){return e>30?"text-green-500":e>10?"text-yellow-500":"text-red-500"}formatTokenDisplay(e){return`Context: ${e.percentRemaining}% remaining`}getDetailedBreakdown(e){return`${e.totalTokens.toLocaleString()} / ${e.contextWindow.toLocaleString()} tokens${e.cacheTokens>0?` (${e.cacheTokens.toLocaleString()} cached)`:""}`}};class _T{createMessage;constructor(e){this.createMessage=e}async compactConversation(e,t,n=!1){if(0===e.length)throw new Error("Not enough messages to compact");const s=RT.calculateMetricsFromMessages(e,t),r=s?.totalTokens||0,i=await async function(){try{const e=se("zepher_prompt");if(e){const t=e.get("prompt","");if(t&&"string"==typeof t&&t.trim())return t}}catch(e){}return'Your task is to create a detailed summary of the conversation so far, with EXTREME EMPHASIS on preserving ALL user instructions, requirements, and feedback. User instructions are the most critical element and must be preserved verbatim when possible.\n\nBefore providing your final summary, wrap your analysis in <analysis> tags to organize your thoughts and ensure you\'ve covered all necessary points. In your analysis process:\n\n1. CRITICAL - Extract ALL user instructions:\n   - The initial task definition (preserve as close to verbatim as possible)\n   - Any modifications or clarifications to the task\n   - Specific requirements, criteria, or rules they provided\n   - Warnings, constraints, or "DO NOT" instructions\n   - Any feedback that changed your approach\n   - Instructions about how to continue or when to stop\n\n2. Identify if this is a REPEATABLE TASK WORKFLOW:\n   - Is there a pattern being repeated (e.g., reviewing multiple candidates, processing multiple items)?\n   - What is the atomic unit of work being repeated?\n   - What are the specific steps in each iteration?\n   - What decision criteria or rules are being applied consistently?\n\n3. Chronologically analyze each message and section of the conversation. For each section thoroughly identify:\n   - The user\'s explicit requests and intents\n   - Your approach to addressing the user\'s requests\n   - Key browser interactions and automation steps\n   - Specific details like:\n     - URLs visited\n     - Elements clicked or interacted with\n     - Form data entered\n     - Screenshots taken\n     - Navigation patterns\n   - Errors that you ran into and how you fixed them\n   - Pay special attention to specific user feedback that you received, especially if the user told you to do something differently.\n\n4. Double-check that you have captured EVERY user instruction, especially:\n   - Initial requirements\n   - Process modifications\n   - Corrections to your behavior\n   - Explicit "IMPORTANT" or emphasized instructions\n\nYour summary should include the following sections:\n\n1. USER INSTRUCTIONS (MOST CRITICAL): Preserve verbatim or as close as possible:\n   - Complete initial task definition\n   - ALL specific requirements and criteria\n   - Every "IMPORTANT", "DO NOT", "ALWAYS", "MUST" instruction\n   - Process modifications and corrections\n   - Feedback that changed behavior\n   - Instructions about when/how to continue\n\n2. Task Template (if applicable): If this is a repeatable workflow, describe:\n   - The pattern/template of the repeated task\n   - Complete decision criteria and evaluation rules\n   - Standard workflow steps for each iteration\n   - Example of a completed iteration\n\n3. Constraints and Rules: Organize all user-specified rules:\n   - Critical constraints that must never be violated\n   - Specific acceptance/rejection criteria\n   - Process requirements and warnings\n   - Edge cases and exceptions\n\n4. Key Browser Context: Current page URL, domain, and any important page state\n\n5. Pages and Interactions: List all pages visited, elements interacted with, and actions taken\n\n6. Automation Steps: Document the sequence of browser automation steps performed\n\n7. Errors and fixes: List all errors that you ran into, and how you fixed them\n\n8. User Feedback History: Chronological list of:\n   - Initial instructions\n   - Corrections received\n   - Process refinements\n   - Confirmations or approvals\n\n9. Progress Tracking: For repeatable tasks:\n   - How many items have been processed\n   - Where we are in the current iteration\n   - Any items that need revisiting\n\n10. Current Work: Describe in detail precisely what was being worked on immediately before this summary request\n\n11. Next Step: For repeatable tasks, specify exactly where to resume (e.g., "Continue reviewing candidates starting with the next one in the queue")\n\nHere\'s an example of how your output should be structured:\n\n<example>\n<analysis>\n[Your thought process, identifying if this is a repeatable task, what the pattern is, and ensuring all points are covered thoroughly and accurately]\n</analysis>\n\n<summary>\n1. USER INSTRUCTIONS (MOST CRITICAL):\n   Initial Task: "[Verbatim or near-verbatim initial request from user]"\n\n   Key Requirements:\n   - [Specific requirement 1 as stated by user]\n   - [Specific requirement 2 as stated by user]\n\n   Critical Constraints:\n   - [Any DO NOT instruction from user]\n   - [Any MUST/ALWAYS instruction from user]\n\n   User Corrections/Feedback:\n   - [Any modification to original instructions]\n   - [Any correction to behavior]\n\n2. Task Template (if applicable):\n   - Pattern: Processing multiple items from a list/queue\n   - Decision Criteria:\n     * [Specific criteria for evaluation]\n     * [Required qualifications or attributes]\n     * [Disqualifying factors]\n   - Workflow Steps:\n     1. Navigate to item page\n     2. Review item details\n     3. Evaluate against criteria\n     4. Take appropriate action (approve/reject/modify)\n     5. Move to next item\n   - Example Iteration: [Brief description of one completed cycle]\n\n3. Constraints and Rules:\n   - IMPORTANT: [Key instructions that must always be followed]\n   - DO NOT: [Actions to avoid]\n   - ALWAYS: [Required behaviors]\n   - Edge cases: [Special handling instructions]\n\n4. Key Browser Context:\n   - Current URL: [Current page URL]\n   - Current Domain: [Domain]\n   - Page State: [Important state information]\n\n5. Pages and Interactions:\n   - [Page/Section]: [Actions taken]\n   - [Buttons/Forms]: [Interactions performed]\n\n6. Automation Steps:\n   - [Step-by-step workflow description]\n\n7. Errors and fixes:\n   - [Error description]: [How it was resolved]\n   - [User feedback on errors if any]\n\n8. User Feedback History:\n   - Initial: [Complete task definition]\n   - Corrections: [Any process refinements]\n   - Feedback: [Important guidance received]\n\n9. Progress Tracking:\n   - Processed: [Number and summary of items completed]\n   - Current: [What\'s being worked on now]\n   - Remaining: [What\'s left to do]\n\n10. Current Work:\n   [Precise description of the immediate task being performed]\n\n11. Next Step:\n   [Exactly what should be done next to continue the workflow]\n\n</summary>\n</example>\n\nPlease provide your summary based on the conversation so far, following this structure and ensuring precision and thoroughness in your response.'}(),o=this.prepareMessagesForAPI(e);o.push({role:"user",content:i});try{const t=await this.createMessage({maxTokens:1e4,messages:o,system:[{type:"text",text:"You are a helpful AI assistant tasked with summarizing browser automation conversations."}]}),s=function(e,t){const n=function(e){let t=e;const n=t.match(/<analysis>([\s\S]*?)<\/analysis>/);if(n){const e=n[1]||"";t=t.replace(/<analysis>[\s\S]*?<\/analysis>/,`Analysis:\n${e.trim()}`)}const s=t.match(/<summary>([\s\S]*?)<\/summary>/);if(s){const e=s[1]||"";t=t.replace(/<summary>[\s\S]*?<\/summary>/,`Summary:\n${e.trim()}`)}return t=t.replace(/\n\n+/g,"\n\n"),t.trim()}(e),s=`The conversation history was compressed to save context space. Here's a summary of what we discussed:\n\n${n}`;return t?`${s}\n\nI'll continue from where we left off without asking additional questions.`:`${s}\n\nHow would you like to proceed?`}(this.extractTextFromResponse(t),n),i={role:"user",content:s,isCompactSummary:!0},a=this.preserveRecentContext(e),l=[{role:"assistant",content:"This conversation has been summarized so we can keep going.",isCompactionMessage:!0},i,...a],c=1600,d=Math.round(s.length/4+a.reduce((e,t)=>{let n=0;if("string"==typeof t.content)n=t.content.length/4;else if(Array.isArray(t.content)){n=t.content.filter(e=>"type"in e&&"image"===e.type).length*c;n+=JSON.stringify(t.content.filter(e=>"type"in e&&"image"!==e.type)).length/4}else n=JSON.stringify(t.content).length/4;return e+n},0));return{summaryMessage:i,messagesAfterCompacting:l,preCompactTokenCount:r,postCompactTokenCount:d,tokensSaved:Math.max(0,r-d)}}catch(a){throw new Error(`Failed to compact conversation: ${a}`)}}prepareMessagesForAPI(e){const t=[];for(const n of e)!n.content||"string"==typeof n.content&&""===n.content.trim()||Array.isArray(n.content)&&0===n.content.length||!("role"in n)||"user"!==n.role&&"assistant"!==n.role||t.push({role:n.role,content:n.content});return t.length>0&&"assistant"===t[0].role&&t.unshift({role:"user",content:"Continue the conversation."}),t}extractTextFromResponse(e){if(!e.content||0===e.content.length)throw new Error("No content in API response");const t=e.content.filter(e=>"text"===e.type);if(0===t.length)throw new Error("No text content in API response");return t.map(e=>e.text).join("\n")}preserveRecentContext(e){const t=[];let n=0;for(let s=e.length-1;s>=0&&n<3;s--){const r=e[s];if(r&&"role"in r&&("user"===r.role&&Array.isArray(r.content))){if(r.content.some(e=>"type"in e&&"image"===e.type&&"source"in e&&e.source)){const e=r.content.filter(e=>"type"in e&&"image"===e.type&&"source"in e&&e.source);e.length>0&&(t.unshift({...r,content:e}),n++)}}}return t}}function PT(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var VT,HT={exports:{}};VT||(VT=1,HT.exports=function e(t,n,s){function r(o,a){if(!n[o]){if(!t[o]){if(!a&&PT)return PT(o);if(i)return i(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return r(n||e)},c,c.exports,e,t,n,s)}return n[o].exports}for(var i=PT,o=0;o<s.length;o++)r(s[o]);return r}({1:[function(e,t,n){function s(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0,s.defaultMaxListeners=10,s.prototype.setMaxListeners=function(e){if(!i(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},s.prototype.emit=function(e){var t,n,s,i,l,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var d=new Error('Uncaught, unspecified "error" event. ('+t+")");throw d.context=t,d}if(a(n=this._events[e]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),n.apply(this,i)}else if(o(n))for(i=Array.prototype.slice.call(arguments,1),s=(c=n.slice()).length,l=0;l<s;l++)c[l].apply(this,i);return!0},s.prototype.addListener=function(e,t){var n;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(n=a(this._maxListeners)?s.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,"function"==typeof console.trace&&console.trace()),this},s.prototype.on=s.prototype.addListener,s.prototype.once=function(e,t){if(!r(t))throw TypeError("listener must be a function");var n=!1;function s(){this.removeListener(e,s),n||(n=!0,t.apply(this,arguments))}return s.listener=t,this.on(e,s),this},s.prototype.removeListener=function(e,t){var n,s,i,a;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=(n=this._events[e]).length,s=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(a=i;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){s=a;break}if(s<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(s,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},s.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},s.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},s.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},s.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(e,t,n){var s,r,i,o,a;a=navigator.userAgent.toLowerCase(),o=navigator.platform.toLowerCase(),i="ie"===(s=a.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0])[1]&&document.documentMode,(r={name:"version"===s[1]?s[3]:s[1],version:i||parseFloat("opera"===s[1]&&s[4]?s[4]:s[2]),platform:{name:a.match(/ip(?:ad|od|hone)/)?"ios":(a.match(/(?:webos|android)/)||o.match(/mac|win|linux/)||["other"])[0]}})[r.name]=!0,r[r.name+parseInt(r.version,10)]=!0,r.platform[r.platform.name]=!0,t.exports=r},{}],3:[function(e,t,n){var s,r,i,o=function(e,t){for(var n in t)a.call(t,n)&&(e[n]=t[n]);function s(){this.constructor=e}return s.prototype=t.prototype,e.prototype=new s,e.__super__=t.prototype,e},a={}.hasOwnProperty,l=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},c=[].slice;s=e("events").EventEmitter,i=e("./browser.coffee"),r=function(e){var t,n;function s(e){var n,s,r;for(s in this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(e),t)r=t[s],null==(n=this.options)[s]&&(n[s]=r)}return o(s,e),t={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},n={delay:500,copy:!1},s.prototype.setOption=function(e,t){if(this.options[e]=t,null!=this._canvas&&("width"===e||"height"===e))return this._canvas[e]=t},s.prototype.setOptions=function(e){var t,n,s;for(t in n=[],e)a.call(e,t)&&(s=e[t],n.push(this.setOption(t,s)));return n},s.prototype.addFrame=function(e,t){var s,r;for(r in null==t&&(t={}),(s={}).transparent=this.options.transparent,n)s[r]=t[r]||n[r];if(null==this.options.width&&this.setOption("width",e.width),null==this.options.height&&this.setOption("height",e.height),"undefined"!=typeof ImageData&&null!==ImageData&&e instanceof ImageData)s.data=e.data;else if("undefined"!=typeof CanvasRenderingContext2D&&null!==CanvasRenderingContext2D&&e instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&null!==WebGLRenderingContext&&e instanceof WebGLRenderingContext)t.copy?s.data=this.getContextData(e):s.context=e;else{if(null==e.childNodes)throw new Error("Invalid image");t.copy?s.data=this.getImageData(e):s.image=e}return this.frames.push(s)},s.prototype.render=function(){var e,t,n;if(this.running)throw new Error("Already running");if(null==this.options.width||null==this.options.height)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(){var e,t,n;for(n=[],e=0,t=this.frames.length;0<=t?e<t:e>t;0<=t?++e:--e)n.push(null);return n}.call(this),t=this.spawnWorkers(),!0===this.options.globalPalette)this.renderNextFrame();else for(e=0,n=t;0<=n?e<n:e>n;0<=n?++e:--e)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},s.prototype.abort=function(){for(var e;null!=(e=this.activeWorkers.shift());)this.log("killing active worker"),e.terminate();return this.running=!1,this.emit("abort")},s.prototype.spawnWorkers=function(){var e,t,n;return e=Math.min(this.options.workers,this.frames.length),function(){n=[];for(var s=t=this.freeWorkers.length;t<=e?s<e:s>e;t<=e?s++:s--)n.push(s);return n}.apply(this).forEach(function(e){return function(t){var n;return e.log("spawning worker "+t),(n=new Worker(e.options.workerScript)).onmessage=function(t){return e.activeWorkers.splice(e.activeWorkers.indexOf(n),1),e.freeWorkers.push(n),e.frameFinished(t.data)},e.freeWorkers.push(n)}}(this)),e},s.prototype.frameFinished=function(e){var t,n;if(this.log("frame "+e.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[e.index]=e,!0===this.options.globalPalette&&(this.options.globalPalette=e.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(t=1,n=this.freeWorkers.length;1<=n?t<n:t>n;1<=n?++t:--t)this.renderNextFrame();return l.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},s.prototype.finishRendering=function(){var e,t,n,s,r,i,o,a,l,c,d,u,h,p,m,f;for(a=0,r=0,l=(p=this.imageParts).length;r<l;r++)a+=((t=p[r]).data.length-1)*t.pageSize+t.cursor;for(a+=t.pageSize-t.cursor,this.log("rendering finished - filesize "+Math.round(a/1e3)+"kb"),e=new Uint8Array(a),u=0,i=0,c=(m=this.imageParts).length;i<c;i++)for(n=o=0,d=(f=(t=m[i]).data).length;o<d;n=++o)h=f[n],e.set(h,u),n===t.data.length-1?u+=t.cursor:u+=t.pageSize;return s=new Blob([e],{type:"image/gif"}),this.emit("finished",s,e)},s.prototype.renderNextFrame=function(){var e,t,n;if(0===this.freeWorkers.length)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return e=this.frames[this.nextFrame++],n=this.freeWorkers.shift(),t=this.getTask(e),this.log("starting frame "+(t.index+1)+" of "+this.frames.length),this.activeWorkers.push(n),n.postMessage(t)},s.prototype.getContextData=function(e){return e.getImageData(0,0,this.options.width,this.options.height).data},s.prototype.getImageData=function(e){var t;return null==this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),(t=this._canvas.getContext("2d")).setFill=this.options.background,t.fillRect(0,0,this.options.width,this.options.height),t.drawImage(e,0,0),this.getContextData(t)},s.prototype.getTask=function(e){var t,n;if(n={index:t=this.frames.indexOf(e),last:t===this.frames.length-1,delay:e.delay,transparent:e.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:"chrome"===i.name},null!=e.data)n.data=e.data;else if(null!=e.context)n.data=this.getContextData(e.context);else{if(null==e.image)throw new Error("Invalid frame");n.data=this.getImageData(e.image)}return n},s.prototype.log=function(){1<=arguments.length&&c.call(arguments,0),this.options.debug},s}(s),t.exports=r},{"./browser.coffee":2,events:1}]},{},[3])(3));var $T=(e=>(e.Share="share",e.Compact="compact",e))($T||{});async function zT(e){const{messages:t,systemPrompt:n,messageHistory:s,onShareRequested:r}=e;if(r){if(!(await r()))return!1}try{let e=null;n&&(e="string"==typeof n?[{type:"text",text:n}]:n);await async function(e,t,n){const s=(new Date).toISOString();let r={};try{const e=await ge.getAllGroups(),t=e.map(e=>({mainTabId:e.mainTabId,chromeGroupId:e.chromeGroupId,memberCount:e.memberTabs.length,memberTabs:e.memberTabs.map(e=>({id:e.tabId,url:e.url})),indicatorStates:Array.from(e.memberStates.entries()).map(([e,t])=>({tabId:e,state:t.indicatorState}))}));let n;try{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});e&&e.id&&(n={id:e.id,indicatorState:ge.getTabIndicatorState(e.id)})}catch{}r={groups:t,currentTab:n,totalGroups:e.length}}catch(u){r={error:`Failed to get tab orchestration debug info: ${u}`}}const i={version:chrome.runtime.getManifest().version,timestamp:s,systemPrompt:n,messages:e,preCompactionMessages:t,extensionId:chrome.runtime.id,userAgent:navigator.userAgent,debug:{tabs:r},environment:"production",buildType:"external"},o=JSON.stringify(i,null,2),a=new Blob([o],{type:"application/json"}),l=URL.createObjectURL(a),c=`claude-browser-conversation-${s.replace(/[:.]/g,"-")}.json`,d=document.createElement("a");return d.href=l,d.download=c,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(l),c}(t,s,e);return!0}catch(i){return!1}}function FT(e){const t=e["anthropic-ratelimit-unified-status"];if(!t||"allowed"===t)return{type:"within_limit"};const n={},s=e["anthropic-ratelimit-unified-5h-status"],r=e["anthropic-ratelimit-unified-5h-reset"];s&&(n["5h"]={status:"rejected"===s?"exceeded_limit":"allowed_warning"===s?"approaching_limit":"within_limit",resets_at:r?parseInt(r,10):Date.now()/1e3});const i=e["anthropic-ratelimit-unified-7d-status"],o=e["anthropic-ratelimit-unified-7d-reset"];i&&(n["7d"]={status:"rejected"===i?"exceeded_limit":"allowed_warning"===i?"approaching_limit":"within_limit",resets_at:o?parseInt(o,10):Date.now()/1e3});const a=e["anthropic-ratelimit-unified-7d_opus-status"],l=e["anthropic-ratelimit-unified-7d_opus-reset"];a&&(n["7d_opus"]={status:"rejected"===a?"exceeded_limit":"allowed_warning"===a?"approaching_limit":"within_limit",resets_at:l?parseInt(l,10):Date.now()/1e3});const c=e["anthropic-ratelimit-unified-overage-status"],d=e["anthropic-ratelimit-unified-overage-reset"];c&&(n.overage={status:"rejected"===c?"exceeded_limit":"allowed_warning"===c?"approaching_limit":"within_limit",resets_at:d?parseInt(d,10):Date.now()/1e3});const u=e["anthropic-ratelimit-unified-reset"],h=u?parseInt(u,10):Date.now()/1e3+3600,p="rejected"===t?"exceeded_limit":"allowed_warning"===t?"approaching_limit":"within_limit";let m;m="within_limit"===p?{type:"within_limit",windows:n}:"approaching_limit"===p?{type:"approaching_limit",resetsAt:h,windows:n,remaining:5}:{type:"exceeded_limit",resetsAt:h,windows:n};const f=e["anthropic-ratelimit-unified-overage-disabled-reason"];return f&&"within_limit"!==m.type&&(m.overageDisabledReason=f),m}function BT(e){if(e instanceof Dn&&429===e.status)try{const t=e.message,n=t.indexOf("{");if(-1!==n){const e=t.substring(n),s=JSON.parse(e);if("error"===s.type&&s.error){const e=s.error;if("rate_limit_error"===e.type&&e.message)try{const t=JSON.parse(e.message);if("exceeded_limit"===t.type||"approaching_limit"===t.type)return t}catch{}}if("rate_limit_error"===s.type&&s.message)try{const e=JSON.parse(s.message);if("exceeded_limit"===e.type||"approaching_limit"===e.type)return e}catch{}if("exceeded_limit"===s.type||"approaching_limit"===s.type)return s}}catch{}if(e&&"object"==typeof e&&"status"in e){const t=e;if(429===t.status){let e=Math.floor(Date.now()/1e3)+18e3;if(t.headers&&"get"in t.headers){const n=t.headers,s=n.get("x-ratelimit-reset"),r=n.get("retry-after");if(s)e=parseInt(s);else if(r){const t=parseInt(r);isNaN(t)||(e=Math.floor(Date.now()/1e3)+t)}}return{type:"exceeded_limit",resetsAt:e}}}return null}function WT(e,t){if(e.type!==t.type)return!0;if("within_limit"!==t.type&&"within_limit"!==e.type){if(e.resetsAt!==t.resetsAt)return!0;if(e.overageDisabledReason!==t.overageDisabledReason)return!0;const n=e.windows?.overage?.status,s=t.windows?.overage?.status;if(n!==s)return!0;if("approaching_limit"===e.type&&"approaching_limit"===t.type){if(e.remaining!==t.remaining)return!0}}return!1}const ZT=()=>{const{value:e}=n.useDynamicConfig("chrome_ext_system_prompt"),{value:t}=n.useDynamicConfig("chrome_ext_skip_perms_system_prompt"),{value:s}=n.useDynamicConfig("chrome_ext_multiple_tabs_system_prompt"),{value:r}=n.useDynamicConfig("chrome_ext_explicit_permissions_prompt"),{value:i}=n.useDynamicConfig("chrome_ext_tool_usage_prompt");return U.useMemo(()=>{const n=s.multipleTabsSystemPrompt??"";return{systemPrompt:e.systemPrompt,skipPermissionsSystemPrompt:t.skipPermissionsSystemPrompt,multipleTabsSystemPrompt:n||void 0,explicitPermissionsPrompt:r.prompt,toolUsagePrompt:i.prompt}},[e.systemPrompt,t.skipPermissionsSystemPrompt,s.multipleTabsSystemPrompt,r.prompt,i.prompt])};function UT(e,t,n,s){if("system"===t||"non-script"===t){const n=["navigate","update_plan","TodoWrite","turn_answer_start"];if(!n.includes(e))return{allowed:!1,errorMessage:`Tool ${e} is not available on ${t} pages.`,suggestedGuidance:`Available tools: ${n.join(", ")}. Use navigate to go to a regular webpage first.`}}return"update_plan"===e&&"follow_a_plan"!==n?{allowed:!0}:Me(n,s)&&"update_plan"!==e&&"turn_answer_start"!==e?{allowed:!1,errorMessage:"You must use update_plan to create and get approval for a plan first.",suggestedGuidance:"Use update_plan to present your approach and get user approval before using other tools."}:{allowed:!0}}re.NAVIGATE,re.READ_PAGE_CONTENT,re.TYPE,re.UPLOAD_IMAGE,re.CLICK,re.READ_PAGE_CONTENT;const qT=ln({skill:cn()}),JT=dn(cn());function GT(e){try{const t=new URL(e);return t.hostname.toLowerCase().replace(/^www\./,"")}catch{return""}}function KT(e){return"string"==typeof e?e.length:Array.isArray(e)?e.reduce((e,t)=>{const n=t.type;if("text"===n)return e+(t.text?.length||0);if("image"===n){const n=t.source?.data;return e+(n?.length||0)}return e+JSON.stringify(t).length},0):JSON.stringify(e).length}function YT(e,t,n=26214400){const s=function(e,t=26214400){const n=[];let s=0,r=!1;for(let i=0;i<e.length;i++){const o=e[i];if(s+=KT(o.content),!r&&s>=t&&(r=!0),Array.isArray(o.content))for(let e=0;e<o.content.length;e++){const t=o.content[e];if("image"===t.type){const s=t;if(s.source&&"data"in s.source&&"base64"===s.source.type){const t=s.source.data,r=s.source.media_type||"image/png",o=`img_${i}_${e}_${t.substring(0,16).replace(/[^a-zA-Z0-9]/g,"")}`;n.push({id:o,base64Data:t,mediaType:r,messageIndex:i,contentIndex:e})}}else if("tool_result"===t.type&&Array.isArray(t.content)){const s=t.content;for(let t=0;t<s.length;t++){const r=s[t];if("image"===r.type){const s=r;if(s.source&&"data"in s.source&&"base64"===s.source.type){const r=s.source.data,o=s.source.media_type||"image/png",a=`img_${i}_${e}_${t}_${r.substring(0,16).replace(/[^a-zA-Z0-9]/g,"")}`;n.push({id:a,base64Data:r,mediaType:o,messageIndex:i,contentIndex:e,nestedIndex:t})}}}}}}return{exceedsThreshold:r,currentSize:s,extractedImages:n,imagesToUpload:r?n:[]}}(e,n);if(!s.exceedsThreshold)return;const{imagesToUpload:r,messagesWithImagesRemoved:i,changedMessageIndices:o}=function(e,t,n){const s=[];let r=t;const i=new Set;for(let a=0;a<e.length&&!(r<n);a++){const t=e[a];if(Array.isArray(t.content))for(let e=0;e<t.content.length&&!(r<n);e++){const o=t.content[e];if("image"===o.type){const t=o;if(t.source&&"data"in t.source&&"base64"===t.source.type){const n=t.source.data,o=t.source.media_type||"image/png",l=Math.ceil(n.length/4*3),c=`img_${a}_${e}_${n.substring(0,16).replace(/[^a-zA-Z0-9]/g,"")}`;s.push({id:c,base64Data:n,mediaType:o,messageIndex:a,contentIndex:e}),r-=l,i.add(a)}}else if("tool_result"===o.type&&Array.isArray(o.content)){const t=o.content;for(let o=0;o<t.length&&!(r<n);o++){const n=t[o];if("image"===n.type){const t=n;if(t.source&&"data"in t.source&&"base64"===t.source.type){const n=t.source.data,l=t.source.media_type||"image/png",c=Math.ceil(n.length/4*3),d=`img_${a}_${e}_${o}_${n.substring(0,16).replace(/[^a-zA-Z0-9]/g,"")}`;s.push({id:d,base64Data:n,mediaType:l,messageIndex:a,contentIndex:e,nestedIndex:o}),r-=c,i.add(a)}}}}}}const o=e.map((e,t)=>{if(!i.has(t)||!Array.isArray(e.content))return e;const n=new Set(s.map(e=>e.id)),r=e.content.map((e,s)=>{if("image"===e.type){const r=e;if(r.source&&"data"in r.source){const e=r.source.data,i=`img_${t}_${s}_${e.substring(0,16).replace(/[^a-zA-Z0-9]/g,"")}`;if(n.has(i))return null}}else if("tool_result"===e.type&&Array.isArray(e.content)){const r=e.content.filter((e,r)=>{if("image"===e.type){const i=e;if(i.source&&"data"in i.source){const e=i.source.data,o=`img_${t}_${s}_${r}_${e.substring(0,16).replace(/[^a-zA-Z0-9]/g,"")}`;return!n.has(o)}}return!0});return{...e,content:r}}return e}).filter(e=>null!==e);return 0===r.length?{...e,content:""}:{...e,content:r}});return{imagesToUpload:s,messagesWithImagesRemoved:o,changedMessageIndices:i}}(e,s.currentSize,n);if(0===r.length)return;const a={};o.forEach(e=>{a[e]=i[e]});r.reduce((e,t)=>e+Math.ceil(t.base64Data.length/4*3),0);t(a)}async function QT(e,t){try{if(!e||""===e.trim())return"";const n=[{role:"user",content:function(e){return`<message>\n${e}\n</message>\n\nBased on this message, generate a 7-word-or-less status describing the high-level task or goal Claude is working on. Put it between <status> tags.`}(e.slice(0,500))},{role:"assistant",content:"Here is the status:\n\n<status>"}];return function(e){if(!e.content||0===e.content.length)return"";const t=e.content.filter(e=>"text"===e.type).map(e=>"text"in e?e.text:"").join("\n"),n=t.match(/<status>(.*?)<\/status>/s);if(n&&n[1])return n[1].trim();const s=t.match(/^(.*?)<\/status>/s);return s&&s[1]?s[1].trim():""}(await t({maxTokens:128,messages:n,system:"Generate ultra-concise status updates describing the current high-level task or goal.\nYour status should describe WHAT Claude is trying to accomplish, not the specific action.\n\nREQUIREMENTS:\n- Maximum 7 words\n- Describe the goal/task, not the action\n- Be high-level and task-oriented\n- No punctuation at the end\n\nExamples of GOOD statuses (goal-oriented):\n- Researching company information\n- Looking up flight options\n- Completing checkout process\n- Finding product details\n- Setting up account\n- Analyzing search results\n- Gathering page content\n\nExamples of BAD statuses (too action-specific):\n- Clicking submit button\n- Reading page content\n- Taking screenshot\n- Typing into form field",modelClass:"small_fast"}))}catch(n){return""}}const XT=[".pdf",".png",".jpg",".jpeg",".gif",".webp",".svg"];let eE=null;function tE(e){eE={tabId:e,timestamp:Date.now()}}function nE(){const{value:e}=n.useFeatureGate("chrome_ext_downloads");U.useEffect(()=>{if(!e)return;const t=async e=>{if("complete"!==e.state?.current)return;const t=eE;if(t&&!(Date.now()-t.timestamp>1e4))try{const[n]=await chrome.downloads.search({id:e.id});if(!n?.filename)return;if(!function(e){const t=e.toLowerCase();return XT.some(e=>t.endsWith(e))}(n.filename))return;await ge.initialize();const s=await ge.findGroupByTab(t.tabId);if(!s)return;const r=`file://${n.filename}`,i=await chrome.tabs.create({url:r,active:!1});i.id&&await ge.addTabToGroup(s.mainTabId,i.id),eE=null}catch(n){}};return chrome.downloads.onChanged.addListener(t),()=>{chrome.downloads.onChanged.removeListener(t)}},[e])}const sE=1e4,rE=(e,t)=>{};function iE({apiKey:e,authToken:t,refreshTokenIfNeeded:s,sessionId:r,deviceId:i,model:o,modelRef:a,onPermissionRequired:l,tabId:c,currentDomain:d,onShowNotificationBanner:u,onSendNotification:h,onShareRequested:p,permissionManager:m,permissionMode:f}){const[y,x]=U.useState([]),C=U.useRef(new Set),v=U.useRef([]);U.useEffect(()=>{v.current=y},[y]),U.useEffect(()=>{po.getState().setMessages(y)},[y]);const k=U.useRef(!1);U.useEffect(()=>{const e=setTimeout(()=>{J(G.TEST_DATA_MESSAGES).then(e=>{e&&e.length>0&&x(e)})},100);return()=>clearTimeout(e)},[]);const[M,S]=U.useState([]),[N,T]=U.useState(!1),[E,j]=U.useState(!1),[A,I]=U.useState(!1),[O,L]=U.useState(null),[D,R]=U.useState({type:"within_limit"}),[_,P]=U.useState(null),[V,H]=U.useState(null),[$,z]=U.useState(""),{analytics:F}=b(),[B,W]=U.useState([]),Z=ZT(),q=(()=>{const e=n.useStatsigClient(),{value:t}=n.useDynamicConfig("crochet_domain_skills"),[s,r]=U.useState({});return U.useEffect(()=>{if(!t||!e)return;const n=JT.safeParse(t);if(!n.success)return;const s=n.data,i={},o=[...new Set(Object.values(s))];for(const t of o)try{const n=e.getDynamicConfig(t).value,r=qT.safeParse(n);if(r.success){const e=r.data.skill;for(const[n,r]of Object.entries(s))r===t&&(i[n]=e)}}catch(O){}r(i)},[t,e]),s})(),K=n.useDynamicConfig("chrome_ext_custom_tool_prompts"),Y=U.useRef(null),Q=U.useRef(null),X=U.useRef(!1),ee=U.useRef(null),te=U.useRef(!1),ne=U.useRef(null),se=U.useRef(!1),re=U.useRef(null),oe=U.useRef(new Set),ae=U.useRef([Se,Ne,Te,Ee,je,Ae,Ie,Oe,Le,De,Re,_e,Pe,Ve,He,$e]),{userProfile:le}=g(),ce=(()=>{const{value:e}=n.useFeatureGate("chrome_ext_trace_headers");return e||!1})(),de=ie(),ue=n.useDynamicConfig("chrome_ext_models").value,he=U.useCallback(e=>e?e.startsWith("chrome://")||e.startsWith("chrome-extension://")||"about:blank"===e?"system":e.startsWith("https://chromewebstore.google.com/")?"non-script":"regular":"regular",[]);U.useEffect(()=>{e||t?(L(null),e?Y.current=new Rn({baseURL:de.apiBaseUrl,apiKey:e,dangerouslyAllowBrowser:!0}):t&&(Y.current=new Rn({baseURL:de.apiBaseUrl,authToken:t,dangerouslyAllowBrowser:!0}))):L("No API key or Auth Token provided.")},[e,t,de.apiBaseUrl]),U.useEffect(()=>{o&&r&&f&&F?.track("claude_chrome.chat.session_started",{model:a.current,sessionId:r,permissions:f})},[F,o,a,r,f]),U.useEffect(()=>{K.value&&ae.current.forEach(e=>{"update_plan"===e.name&&K.value.update_plan&&e.setPromptsConfig?.(K.value.update_plan)})},[K.value]);const pe=U.useCallback(async()=>{if(!c)return;const e="skip_all_permission_checks"!==f&&"follow_a_plan"!==f||!Z.skipPermissionsSystemPrompt?Z.systemPrompt:Z.skipPermissionsSystemPrompt;if(!e)throw W(null),new Error("Unable to initialize the chat session. Please check your connection and try again.");const t=navigator.platform.toUpperCase().indexOf("MAC")>=0||navigator.userAgent.toUpperCase().indexOf("MAC")>=0,n=t?"Mac":"Windows/Linux",s=t?"cmd":"ctrl",r=(new Date).toLocaleString(),i=w(o,ue),a=[{type:"text",text:e.replace(/{{currentDateTime}}/g,r).replace(/{{modelName}}/g,i)}],l=await J(G.SYSTEM_PROMPT);l&&a.push({type:"text",text:l}),a.push({type:"text",text:`Platform-specific information:\n- You are on a ${n} system\n- Use "${s}" as the modifier key for keyboard shortcuts (e.g., "${s}+a" for select all, "${s}+c" for copy, "${s}+v" for paste)`}),Z.multipleTabsSystemPrompt&&a.push({type:"text",text:Z.multipleTabsSystemPrompt}),a.push({type:"text",text:"<turn_answer_start_instructions>\nBefore outputting any text response to the user this turn, call turn_answer_start first.\n\nWITH TOOL CALLS: After completing all tool calls, call turn_answer_start, then write your response.\nWITHOUT TOOL CALLS: Call turn_answer_start immediately, then write your response.\n\nRULES:\n- Call exactly once per turn\n- Call immediately before your text response\n- NEVER call during intermediate thoughts, reasoning, or while planning to use more tools\n- No more tools after calling this\n</turn_answer_start_instructions>"}),a[a.length-1].cache_control={type:"ephemeral"},W(a)},[c,Z,f,ue,o]),me=U.useCallback(async()=>{x([]),S([]),L(null),P(null),z(""),R({type:"within_limit"}),H(null),re.current=null,oe.current.clear(),k.current=!1,c&&ge.removePrefix(c).catch(()=>{}),await m.clearOncePermissions(),m.clearTurnApprovedDomains();try{await pe()}catch(e){L(oE(e))}},[pe,m,c]);U.useEffect(()=>{if(se.current)pe().catch(e=>{L(oE(e))});else{se.current=!0;(async()=>{await me();try{await pe()}catch(e){L(oE(e))}})()}},[f,me,pe]),U.useEffect(()=>()=>{ne.current&&(clearTimeout(ne.current),ne.current=null)},[]);const fe=U.useCallback(()=>{X.current=!0,Q.current&&(Q.current.abort(),Q.current=null),T(!1),j(!1),I(!1),z("")},[]),ye=U.useCallback((e,t=!1)=>{const n=e.role;if("string"==typeof e.content)return t?{role:n,content:[{type:"text",text:e.content,cache_control:{type:"ephemeral"}}]}:{role:n,content:e.content};if(Array.isArray(e.content)){const s=JSON.parse(JSON.stringify(e.content));return t&&s.length>0&&(s[s.length-1].cache_control={type:"ephemeral"}),{role:n,content:s}}return{role:n,content:""}},[]),xe=U.useCallback(e=>{const t=e.filter(e=>!("type"in e&&"result"===e.type));let n=-1;for(let r=t.length-1;r>=0;r--)if("assistant"===t[r].role){n=r;break}const s=t.map((e,t)=>ye(e,t===n));if(n>=0){const e=n+1;s.length}return s},[ye]),Ce=U.useCallback(async(e,t,n)=>{if(!Y.current)throw new Error("Client not initialized");return await s(),async function({params:e,client:t,currentModel:n,modelConfig:s,userAccountUuid:r,sessionId:i,deviceId:o,permissionMode:a,traceHeadersEnabled:l,loggedConfigsRef:c,evalLog:d,abortSignal:u,parentSpan:h,spanName:p}){const{modelClass:m,maxTokens:f,model:g,...y}=e;let x=n;g?x=g:"small_fast"===m&&(x=s.small_fast_model||"claude-haiku-4-5-20251001");const C=await Gr(y.messages),b={...y,messages:C,max_tokens:f,model:x,betas:["oauth-2025-04-20"]},w=p||"anthropic_message_create",v=await _n(w,async e=>{if(r){const t=`user_${o??"unknown"}_account_${r}_session_${i??"unknown"}`;b.metadata={user_id:t},e.setAttribute("account_uuid",r)}e.setAttribute("session_id",i||""),e.setAttribute("permissions",a),e.setAttribute("model",n);const{traceId:s,headers:h}=Pn(l);e.setAttribute("sampling_trace_id",s),c.has(w)||(c.add(w),d("sampling_config",{configId:w,toolset:b.tools||[],systemPrompt:b.system,maxTokens:b.max_tokens,headers:h,model:b.model,metadata:b.metadata,betas:b.betas})),b.messages?.length>0&&b.messages.forEach(e=>{d("message",{...e,sampling_config_id:w})});const p={headers:h};return u&&(p.signal=u),await t.beta.messages.create(b,p)},h);return d("message",{...v,sampling_config_id:w}),v}({params:e,client:Y.current,currentModel:a.current,modelConfig:ue,userAccountUuid:le?.account.uuid,sessionId:r,deviceId:i,permissionMode:f,traceHeadersEnabled:ce,loggedConfigsRef:C.current,evalLog:rE,abortSignal:Q.current?.signal,parentSpan:t,spanName:n})},[a,ue,le?.account.uuid,ce,s,r,i,f]),be=U.useCallback(async(e,t,n,s)=>{const i=t.action;return await _n(`tool_execution_${e}${i?"_"+i:""}`,async s=>{s.setAttribute("session_id",r||""),s.setAttribute("permissions",f),s.setAttribute("tool_name",e),i&&s.setAttribute("action",i);const o={toolUseId:n,tabId:c,sessionId:r,createAnthropicMessage:(e,t)=>Ce(e,s,t),permissionManager:m,messages:v.current},a=ae.current.find(t=>t.name===e);if(!a)throw new Error(`Unknown tool: ${e}`);const l={name:e,sessionId:r,permissions:f};"computer"===e&&i&&(l.action=i),d&&(l.domain=d);try{const n=ze(e,t,ae.current),r=await a.execute(n,o);return"type"in r?(l.success=!1,s.setAttribute("success",!1),s.setAttribute("failure_reason","needs_permission")):(l.success=!r.error,s.setAttribute("success",!r.error)),F?.track("claude_chrome.chat.tool_called",l),r}catch(u){throw F?.track("claude_chrome.chat.tool_called",{...l,success:!1,failureReason:"exception"}),u}},s)},[c,r,Ce,m,f,F,d]),we=U.useCallback(e=>{const t=[];if(!q)return t;for(const n of e)if(n.url){const e=GT(n.url);e&&q[e]&&!oe.current.has(e)&&(t.push({domain:e,skill:q[e]}),oe.current.add(e))}return t},[q]),ve=U.useCallback((e,t,n)=>{if(!e)return!1;const s=JSON.stringify(e.availableTabs.map(e=>({id:e.id,title:e.title,url:e.url})));if(re.current!==s){const r={};r.availableTabs=e.availableTabs,null===re.current&&(r.initialTabId=n);const i=we(e.availableTabs);i.length>0&&(r.domainSkills=i);const o=`<system-reminder>${Fe(r)}</system-reminder>`;return t.push({type:"text",text:o}),re.current=s,!0}return!1},[we]),ke=U.useCallback(async(e,t,n)=>{const s=[];let r;const i=e=>{if(e.error)return e.error;const t=[];if(e.output&&t.push({type:"text",text:e.output}),e.base64Image){const n=e.imageFormat?`image/${e.imageFormat}`:"image/png";t.push({type:"image",source:{type:"base64",media_type:n,data:e.base64Image}})}return t.length>0?t:""},o=(e,t)=>{const n=!!t.error;return{type:"tool_result",tool_use_id:e,content:i(t),...n&&{is_error:!0}}};for(const d of e){d.input;try{const e=UT(d.name,t,f,k.current);if(!e.allowed){s.push(o(d.id,{error:`${e.errorMessage}\n\n${e.suggestedGuidance}`}));continue}const i=await be(d.name,d.input,d.id,n),a=i;if("tabContext"in a&&a.tabContext&&(r={availableTabs:a.tabContext.availableTabs}),"type"in i&&"permission_required"===i.type){const e={...i};if(!l){s.push(o(d.id,{error:"Permission required but no handler available"}));continue}let t=!1;if("update_plan"===d.name&&"follow_a_plan"!==f?t=!0:(d.name,t=await l(e)),!t){s.push(o(d.id,{error:"update_plan"===d.name?"Plan rejected by user. Ask the user how they would like to change the plan.":"Permission denied by user"}));continue}if("update_plan"===d.name){const{approach:e,domains:t}=d.input;let n="User has approved your plan. You can now start executing the plan.";e&&e.length>0?n+="\n\nPlan steps:\n"+e.map((e,t)=>`${t+1}. ${e}`).join("\n")+"\n\nStart by using the TodoWrite tool to track your progress through these steps.":n+=" Start with updating your todo list if applicable.",k.current=!0,await Be(t,m),s.push(o(d.id,{output:n}));continue}const a=await be(d.name,d.input,d.id,n);if("type"in a&&"permission_required"===a.type)throw new Error("Permission still required after granting");const u=a;"tabContext"in u&&u.tabContext&&(r={availableTabs:u.tabContext.availableTabs}),s.push(o(d.id,a)),"computer"!==d.name||!d.input?.action?.toLowerCase().includes("click")||"error"in a&&a.error||!c||tE(c)}else s.push(o(d.id,i)),"computer"!==d.name||!d.input?.action?.toLowerCase().includes("click")||"error"in i&&i.error||!c||tE(c)}catch(a){const e=oE(a);s.push(o(d.id,{error:e}))}}return{toolResults:s,lastTabContext:r}},[be,l,c,f,m]),qe=n.useFeatureGate("cascade_nebula").value,Je=U.useCallback(async(e,t,n,o,l,d=!1)=>{if(!Y.current)throw new Error("Client not initialized");if(!c)throw new Error("No active tab");if(!B)throw new Error("Unable to initialize the chat session. Please check your connection and try again.");"follow_a_plan"!==f||o||(k.current=!1,m.clearTurnApprovedDomains());const g=RT.calculateMetricsFromMessages(y,sE);g&&(g.percentRemaining<20&&g.percentRemaining>=10||g.percentRemaining);let b=y;const w=await async function(e){const t=function(e){const t=e.trim();return"/share"===t?"share":"/compact"===t?"compact":null}(e.message);return t?e.supportedCommands&&!e.supportedCommands.includes(t)?null:"share"===t?(await zT({messages:e.messages,systemPrompt:e.systemPrompt??null,messageHistory:e.messageHistory,onShareRequested:e.onShareRequested}),"share"):"compact"===t?"compact":null:null}({message:e,messages:y,systemPrompt:B,messageHistory:M,onShareRequested:p});if(w===$T.Share)return void T(!1);const v=w===$T.Compact,N=RT.calculateMetricsFromMessages(y,sE);let E;for(let s=y.length-1;s>=0;s--){const e=y[s];if(e&&"role"in e&&"assistant"===e.role){E=e;break}}const A=!v&&N&&N.isError;if(v||A){const e=v?"manual":"auto";I(!0),L(null),Q.current=new AbortController;try{if(!Y.current)throw new Error("Client not initialized");const t=new _T(e=>Ce(e,l,"sampling_compaction")),n=await t.compactConversation(y,sE,!v);if(x(n.messagesAfterCompacting),S(y),P(n.tokensSaved),re.current=null,oe.current.clear(),b=n.messagesAfterCompacting,F?.track(`claude_chrome.chat.${e}_compact`,{preTokens:n.preCompactTokenCount,postTokens:n.postCompactTokenCount,savedTokens:n.tokensSaved,sessionId:r,permissions:f}),v)return void I(!1)}catch(Z){return"Request was aborted."===oE(Z)||Z instanceof Error&&"AbortError"===Z.name||X.current||L(Z instanceof Error?Z.message:`Failed to ${e}-compact conversation`),void I(!1)}finally{I(!1),Q.current&&(Q.current=null)}}T(!0),L(null),z(""),ee.current=Date.now(),te.current=!1;let O;if(0===y.length&&u&&(ne.current=setTimeout(()=>{u(),ne.current=null},3e4)),F?.track("claude_chrome.chat.user_message_sent",{model:a.current,sessionId:r,permissions:f}),d)O=[...b];else{const s={role:"user",content:e?[{type:"text",text:e}]:[],...o&&{isDomainTransitionMessage:!0}};if(t&&t.length>0&&Array.isArray(s.content)){n&&s.content.push({type:"text",text:"<system-reminder>\nCONTEXT ABOUT ANNOTATIONS IN USER SCREENSHOTS:\n\nThe GLOWING BLUE OUTLINES you see are USER-SELECTED REGIONS on the user's screenshot. These markings:\n- Are regions selected by the user to point out specific areas\n- Are NOT part of the website/interface/UI\n- Will NOT appear in screenshots you take yourself\n- Have white outlines for visibility on all backgrounds\n\nUser screenshots may show a different viewport/responsive layout than what you see. Page elements may be in different positions due to:\n- Different screen sizes or browser window dimensions\n- Responsive design breakpoints\n- Mobile vs desktop views\n- Zoom levels or scaling\n\nINSTRUCTIONS FOR HANDLING ANNOTATED USER SCREENSHOTS:\n1. FIRST, take your own screenshot to see the current page state and layout\n2. Compare the user's annotated screenshot with your view to identify layout differences\n3. The blue outlines indicate regions the user selected - focus on what's inside or near these areas\n4. Look for what UI element the annotation is highlighting based on visual context\n5. Account for responsive changes - an element marked on the right might be below on your screen\n6. Use the user's description combined with the annotation to determine intent\n7. Find and interact with the actual UI element being indicated\n\nFor example: If a blue outline highlights a menu item that appears horizontally in the user's screenshot but is in a hamburger menu on your view, open the hamburger menu first to find the item.\n</system-reminder>"});for(const e of t)e.id&&s.content.push({type:"text",text:`<system-reminder>[Image ID: ${e.id}]</system-reminder>`}),s.content.push({type:"image",source:{type:"base64",media_type:e.mediaType,data:e.base64}})}O=[...b,s];try{const e={availableTabs:await ge.getValidTabsWithMetadata(c)};Array.isArray(s.content)&&ve(e,s.content,c)}catch(Z){}Array.isArray(s.content)&&Me(f,k.current)&&s.content.push({type:"text",text:We()})}if(x(O),!c)return L("No active tab"),void T(!1);if(!d){(0===b.length||b.every(e=>e.isCompactSummary||e.isCompactionMessage))&&!v&&(async()=>{try{const e=O[O.length-1],t=await un(e,e=>Ce(e,l,"sampling_title_generation"));t&&(await ge.initialize(),await ge.updateGroupTitle(c,t,!0))}catch(Z){}})()}let _="regular";try{const e=await chrome.tabs.get(c);_=he(e.url)}catch(Z){}let V=null;try{V=await Ze(ae.current,{tabId:c})}catch(Z){const e=oE(Z);return L(e),void T(!1)}V.length>0&&(V[V.length-1].cache_control={type:"ephemeral"}),X.current=!1,H(null);let $=!0,W=0;for(;$&&!X.current;){if(W++,$=!1,T(!0),Q.current=new AbortController,W>1)try{const e=await chrome.tabs.get(c),t=he(e.url);t!==_&&(_=t)}catch(Z){}let e;const t=new Promise(t=>{e=t});let n;if(c){const e=await ge.findGroupByMainTab(c);if(e)try{const t=await chrome.tabGroups.get(e.chromeGroupId);t.title&&"Claude"!==t.title&&await ge.addLoadingPrefix(c)}catch(Z){}}const o=10;let u,p=0;do{u=!1,await _n("message_streaming",async m=>{m.setAttribute("session_id",r||""),m.setAttribute("permissions",f),m.setAttribute("model",a.current);try{let o=xe(O);o=await Gr(o),YT(o,e=>{x(t=>t.map((t,n)=>e[n]||t)),o=o.map((t,n)=>e[n]||t),O=O.map((t,n)=>e[n]||t)});const{traceId:u,headers:h}=Pn(ce);m.setAttribute("sampling_trace_id",u);const p={signal:Q.current?.signal,headers:h},g={role:"assistant",content:[],...u&&{traceId:u}};O.push(g),x([...O]);let y="";const b={messages:o,model:a.current,max_tokens:sE,tools:V||[],system:B,betas:["oauth-2025-04-20"]};if(le?.account.uuid){const e=`user_${i??"unknown"}_account_${le.account.uuid}_session_${r??"unknown"}`;b.metadata={user_id:e},m.setAttribute("account_uuid",le.account.uuid),l?.setAttribute("account_uuid",le.account.uuid)}await s();const w=JSON.stringify({toolset:V||[],systemPrompt:B,maxTokens:b.max_tokens,model:b.model,betas:b.betas}),v=`send_user_message_${Array.from((new TextEncoder).encode(w)).reduce((e,t)=>e+t.toString(16).padStart(2,"0"),"").slice(0,16)}`;if(C.current.has(v)||(C.current.add(v),b.max_tokens,b.model,b.metadata,b.betas),1===W&&!d){O[O.length-2]}const k=Y.current.beta.messages.stream(b,p).on("connect",()=>{if(k.response){const e={};if(k.response.headers.forEach((t,n)=>{n.startsWith("anthropic-ratelimit-")&&(e[n]=t)}),Object.keys(e).length>0){const t=FT(e);t&&WT(D,t)&&R(t)}}}).on("text",e=>{y+=e;const t=O[O.length-1];t&&"assistant"===t.role&&(t.content=[{type:"text",text:y}]),x([...O])}).on("message",async t=>{try{"stop_reason"in t&&t.stop_reason&&(n=t.stop_reason,H({reason:t.stop_reason,messageId:t.id}));const s=O.pop(),r={...t,...s&&"traceId"in s&&{traceId:s.traceId},..."usage"in t&&t.usage&&{usage:t.usage}};if(O.push(r),x([...O]),Array.isArray(t.content)){t.content.forEach((e,t)=>{});const n=t.content.filter(e=>"tool_use"===e.type);if(n.length>0){y&&!y.toLowerCase().includes("<answer>")?QT(y,Ce).then(e=>{e&&z(e)}).catch(e=>{}):y&&y.toLowerCase().includes("<answer>")&&z("");const t=["read_page","get_page_text","find","turn_answer_start"];n.some(e=>!t.includes(e.name))&&j(!0);let s,r=[];if(X.current)r=n.map(e=>({type:"tool_result",tool_use_id:e.id,content:"Tool execution cancelled by user",is_error:!0}));else{const e=await ke(n,_,m);r=e.toolResults,s=e.lastTabContext,X.current}if(s&&r.length>0){const e=r[r.length-1];if("string"==typeof e.content&&(e.content=[{type:"text",text:e.content}]),Array.isArray(e.content)){const t=JSON.stringify(s.availableTabs.map(e=>({id:e.id,title:e.title,url:e.url})));if(re.current!==t){const n={};n.availableTabs=s.availableTabs,null===re.current&&(n.initialTabId=c);const r=we(s.availableTabs);r.length>0&&(n.domainSkills=r);const i=`<system-reminder>${Fe(n)}</system-reminder>`;e.content.push({type:"text",text:i}),re.current=t}}}const i={role:"user",content:r};return O.push(i),x([...O]),$=!0,void e()}}y&&!y.toLowerCase().includes("<answer>")?QT(y,Ce).then(e=>{e&&z(e)}).catch(e=>{}):y&&y.toLowerCase().includes("<answer>")&&z(""),O.length,O[O.length-1],e()}catch(Z){throw e(),Z}}).on("finalMessage",e=>{if(e?.message_limit&&WT(D,e.message_limit)&&R(e.message_limit),e&&"usage"in e){const t=e.usage;F?.track("claude_chrome.chat.usage",{usage:t,sessionId:r,permissions:f})}});await k.done(),await t}catch(Z){const t=oE(Z);if("Request was aborted."===t)return;m.setStatus({code:Vn.ERROR,message:t});const n=t.toLowerCase(),s=BT(Z);if(s)R(s),L(null);else if((n.startsWith("overloaded")||n.startsWith("internal server error")||n.startsWith("network error")||n.startsWith("connection error")||n.startsWith("failed to fetch")||n.startsWith("499")||n.startsWith("this request would exceed the rate limit"))&&p+1<o){p++;let e=Math.pow(2,p);e+=Math.random()*e,await new Promise(t=>setTimeout(t,1e3*e)),u=!0,O.pop(),x([...O])}else Z instanceof Error&&Z.stack,Z instanceof Error&&Z.constructor.name,L(t),R({type:"within_limit"});return}finally{if(Q.current=null,!$){T(!1),j(!1);try{await Ue.detachDebugger(c)}catch(Z){}F?.track("claude_chrome.chat.assistant_response_stopped",{model:a.current,cancelled:X.current,sessionId:r,permissions:f,stopReason:n}),X.current}const e=O[O.length-1];if(e&&"assistant"===e.role){const t=e.content;Array.isArray(t)&&(0===t.length||1===t.length&&"text"===t[0].type&&""===t[0].text)&&(O.pop(),x([...O]))}const t=ee.current?Date.now()-ee.current:0;!$&&ee.current&&t>6e4&&!te.current&&h&&(h(),te.current=!0),!$&&c&&ge.addCompletionPrefix(c).catch(()=>{}),$||(ee.current=null,te.current=!1)}},l)}while(u&&p<o)}},[c,B,a,y,M,D,F,he,xe,ce,qe,le?.account.uuid,s,u,p,ke,h,Ce,f,r,i,ve,we,m]),Ge=U.useCallback(async(e,t,n,s)=>{await _n("send_user_message",async i=>(i.setAttribute("session_id",r||""),i.setAttribute("permissions",f),i.setAttribute("model",a.current),await Je(e,t,n,s,i,!1)))},[Je,r,f,a]),Ke=U.useCallback(async()=>{const e=[...y];for(let t=e.length-1;t>=0;t--)if("assistant"===e[t].role){e.splice(t,1);break}x(e),H(null),await _n("retry_last_message",async e=>(e.setAttribute("session_id",r||""),e.setAttribute("permissions",f),e.setAttribute("model",a.current),await Je("",void 0,void 0,void 0,e,!0)))},[y,Je,r,f,a]),Ye=U.useCallback(()=>{L(null)},[]);return{messages:y,messageHistory:M,sendMessage:Ge,retryLastMessage:Ke,cancel:fe,clearMessages:me,clearError:Ye,isLoading:N,isInitializing:!1,hasInteractiveTools:E,isCompacting:A,error:O,messageLimit:D,setMessages:x,tokensSaved:_,createAnthropicMessage:Ce,lastStopReason:V,currentStatus:$,conversationUuid:null}}function oE(e){if("string"==typeof e){const t=e.match(/^(\d{3})\s+(\{.+\})$/s);let n=e;t&&(n=t[2]);try{const t=JSON.parse(n);return t?.error?.message?t.error.message:t?.message?t.message:e}catch{return e}}if(e instanceof Error){const t=e.message,n=t.match(/^(\d{3})\s+(\{.+\})$/s);let s=t;n&&(s=n[2]);try{const e=JSON.parse(s);if(e?.error?.message)return e.error.message;if(e?.message)return e.message}catch{}return e.message}if(e&&"object"==typeof e){if("error"in e&&"object"==typeof e.error&&e.error&&"message"in e.error)return String(e.error.message);if("message"in e)return String(e.message)}return String(e)}function aE(){const[e,t]=U.useState(""),[s,r]=U.useState(!1),[i,o]=U.useState({isBlocked:!1,hasUpdate:!1,currentVersion:"",minSupportedVersion:null}),{value:a}=n.useDynamicConfig("chrome_ext_version_info");return U.useEffect(()=>{const e=chrome.runtime.getManifest().version;t(e);(async()=>{const e=await J(G.UPDATE_AVAILABLE);r(!!e)})();const n=e=>{e[G.UPDATE_AVAILABLE]&&r(!0===e[G.UPDATE_AVAILABLE].newValue)};return chrome.storage.onChanged.addListener(n),()=>{chrome.storage.onChanged.removeListener(n)}},[]),U.useEffect(()=>{if(!e)return;const t=a?.min_supported_version,n=!!t&&function(e,t){const n=e.split(".").map(Number),s=t.split(".").map(Number);for(let r=0;r<Math.max(n.length,s.length);r++){const e=n[r]||0,t=s[r]||0;if(e<t)return-1;if(e>t)return 1}return 0}(e,t)<0;o({isBlocked:n,hasUpdate:s,currentVersion:e,minSupportedVersion:t||null})},[e,a,s]),i}function lE(){return q.jsx("div",{className:"flex flex-col h-screen bg-bg-100 items-center justify-center p-4",children:q.jsx(Fn,{})})}const cE=e=>{if("user"!==e.role)return!1;if("string"==typeof e.content)return e.content.trim().length>0;return(Array.isArray(e.content)?e.content:[]).some(e=>"text"===e.type&&e.text?.trim().length>0)},dE=e=>{const t=Array.isArray(e.content)?e.content:[];if("assistant"===e.role){return t.some(e=>"tool_use"===e.type)}if("user"===e.role){const e=t.filter(e=>"text"===e.type&&"text"in e&&e.text?.trim().length>0);return t.filter(e=>"tool_result"===e.type).length>0&&0===e.length}return!1},uE=(e,t)=>((e,t=!1)=>{const n=[];let s=0;for(;s<e.length;){const r=e[s],i=e.slice(s+1).some(cE);if(dE(r)||t&&"assistant"===r.role&&!i){const i={type:"tool_group",messages:[r],startIndex:s,endIndex:s};let o=s+1;for(;o<e.length;){const n=e[o],s=e.slice(o+1).some(cE);if(!(dE(n)||t&&"assistant"===n.role&&!s))break;i.messages.push(n),i.endIndex=o,o++}n.push(i),s=o}else n.push({type:"single",messages:[r],startIndex:s,endIndex:s}),s++}return n})(e,t),hE=({className:e=""})=>q.jsx("svg",{width:"21",height:"10",viewBox:"0 0 21 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:q.jsx("path",{d:"M1.748 1.776V4.266H4.748V5.322H1.748V7.944H5.402V9H0.356V0.719999H5.336L5.18 1.776H1.748ZM12.7773 6.66C12.7773 7.148 12.6513 7.582 12.3993 7.962C12.1513 8.338 11.7913 8.632 11.3193 8.844C10.8513 9.056 10.2853 9.162 9.62131 9.162C8.94931 9.162 8.35931 9.062 7.85131 8.862C7.34731 8.658 6.92131 8.388 6.57331 8.052L7.33531 7.2C7.63131 7.468 7.96531 7.68 8.33731 7.836C8.70931 7.988 9.13531 8.064 9.61531 8.064C9.92731 8.064 10.2133 8.016 10.4733 7.92C10.7333 7.82 10.9413 7.672 11.0973 7.476C11.2533 7.276 11.3313 7.026 11.3313 6.726C11.3313 6.482 11.2813 6.276 11.1813 6.108C11.0813 5.94 10.9073 5.788 10.6593 5.652C10.4153 5.516 10.0733 5.384 9.63331 5.256C9.04931 5.08 8.55931 4.884 8.16331 4.668C7.76731 4.452 7.46731 4.194 7.26331 3.894C7.06331 3.59 6.96331 3.222 6.96331 2.79C6.96331 2.342 7.08531 1.95 7.32931 1.614C7.57731 1.278 7.91531 1.018 8.34331 0.834C8.77531 0.645999 9.26331 0.551999 9.80731 0.551999C10.4073 0.551999 10.9313 0.638 11.3793 0.81C11.8273 0.982 12.2273 1.228 12.5793 1.548L11.8473 2.376C11.5553 2.12 11.2413 1.934 10.9053 1.818C10.5733 1.702 10.2353 1.644 9.89131 1.644C9.61131 1.644 9.35731 1.684 9.12931 1.764C8.90131 1.844 8.72131 1.962 8.58931 2.118C8.45731 2.274 8.39131 2.472 8.39131 2.712C8.39131 2.924 8.44931 3.106 8.56531 3.258C8.68531 3.41 8.88531 3.552 9.16531 3.684C9.44931 3.812 9.83731 3.95 10.3293 4.098C10.7933 4.234 11.2093 4.402 11.5773 4.602C11.9493 4.802 12.2413 5.064 12.4533 5.388C12.6693 5.712 12.7773 6.136 12.7773 6.66ZM17.6866 0.551999C18.2466 0.551999 18.7186 0.625999 19.1026 0.774C19.4906 0.918 19.8506 1.126 20.1826 1.398L19.4566 2.262C19.2086 2.054 18.9426 1.9 18.6586 1.8C18.3746 1.7 18.0726 1.65 17.7526 1.65C17.3406 1.65 16.9606 1.754 16.6126 1.962C16.2646 2.17 15.9846 2.508 15.7726 2.976C15.5646 3.444 15.4606 4.068 15.4606 4.848C15.4606 5.612 15.5606 6.228 15.7606 6.696C15.9606 7.164 16.2346 7.504 16.5826 7.716C16.9306 7.928 17.3206 8.034 17.7526 8.034C18.1966 8.034 18.5646 7.962 18.8566 7.818C19.1486 7.67 19.4066 7.504 19.6306 7.32L20.3026 8.178C20.0266 8.446 19.6766 8.678 19.2526 8.874C18.8286 9.066 18.3126 9.162 17.7046 9.162C17.0046 9.162 16.3746 8.998 15.8146 8.67C15.2586 8.338 14.8186 7.852 14.4946 7.212C14.1746 6.572 14.0146 5.784 14.0146 4.848C14.0146 3.92 14.1806 3.138 14.5126 2.502C14.8446 1.862 15.2886 1.378 15.8446 1.05C16.4006 0.717999 17.0146 0.551999 17.6866 0.551999Z",fill:"currentColor"})}),pE=({tool:e,url:t,screenshot:n,coordinate:s,typeText:i,uploadImageData:o,onAllow:a,onDeny:l,disableAlwaysAllow:c=!1})=>{const[d,u]=U.useState(null);let h="";try{const e=new URL(t);h=e.host}catch{h=t}const p=U.useMemo(()=>({type:"netloc",netloc:h}),[h]),m=U.useCallback(()=>{a(oe.ONCE,p)},[a,p]),f=U.useCallback(()=>{c||a(oe.ALWAYS,p)},[a,p,c]);return U.useEffect(()=>{const e=e=>{(e.metaKey||e.ctrlKey)&&"Enter"===e.key?(e.preventDefault(),c||(u("always"),setTimeout(()=>{f()},150))):"Enter"===e.key?(e.preventDefault(),u("once"),setTimeout(()=>{m()},150)):"Escape"===e.key&&(e.preventDefault(),u("deny"),setTimeout(()=>{l()},150))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[f,m,l,c]),q.jsxs("div",{className:"bg-bg-000 rounded-[14px]",children:[q.jsxs("div",{className:"flex items-center gap-2 py-[10px] px-4",children:[q.jsx(hn,{size:20,className:"text-text-100"}),q.jsx("h3",{className:"font-base text-text-100",children:q.jsx(r,{defaultMessage:"New permissions required",id:"/CBk9UV8iS"})})]}),q.jsx("div",{className:"border-t border-border-300 mb-4"}),q.jsxs("div",{className:"space-y-4 px-4",children:[q.jsxs("div",{children:[q.jsx("p",{className:"font-base-bold text-text-100",children:q.jsx(r,{defaultMessage:"Claude wants to {toolAction}:",id:"cELBBLzSZE",values:{toolAction:ae(e)}})}),q.jsx("p",{className:"font-claude-response-code text-text-200",children:h})]}),e===re.CLICK&&n&&s&&q.jsx("div",{children:q.jsx(ei,{screenshot:n,coordinates:s,className:"mx-auto"})}),e===re.TYPE&&i&&q.jsxs("div",{children:[q.jsx("p",{className:"font-base-bold text-text-100 mb-2",children:q.jsx(r,{defaultMessage:"Text to be typed:",id:"8laklrhkfX"})}),q.jsx("div",{className:"p-3 bg-bg-100 border border-border-200 rounded-lg max-h-[300px] overflow-y-auto",children:q.jsx("code",{className:"font-claude-response-code text-text-200 whitespace-pre-wrap break-words overflow-wrap-anywhere",children:i})})]}),e===re.UPLOAD_IMAGE&&o&&q.jsx("div",{children:q.jsx(Xr,{dataUrl:o,className:"mx-auto"})})]}),q.jsxs("div",{className:"px-3 py-[10px] space-y-[5px] mt-[10px] mb-0.5",children:[q.jsxs(zi,{onClick:m,isActive:"once"===d,children:[q.jsx("span",{children:q.jsx(r,{defaultMessage:"Allow this action",id:"6Ss5IpaxlL"})}),q.jsx($i,{className:"text-text-500"})]}),q.jsxs(zi,{onClick:l,isActive:"deny"===d,children:[q.jsx("span",{children:q.jsx(r,{defaultMessage:"Decline",id:"pvtgR26QWY"})}),q.jsx(hE,{className:"text-text-500"})]}),q.jsx("div",{className:"border-t-[0.5px] border-border-300 my-3 -mx-3"}),c?q.jsx("p",{className:"font-small text-text-500 px-1 mt-2",children:q.jsx(r,{defaultMessage:"Site-level permissions are disabled for this site.",id:"xsy6u5jY4z"})}):q.jsxs(zi,{onClick:f,isActive:"always"===d,height:"55px",children:[q.jsxs("div",{className:"flex flex-col items-start",children:[q.jsx("span",{children:q.jsx(r,{defaultMessage:"Always allow actions on this site",id:"IjBl43b/I/"})}),q.jsx("span",{className:"font-small text-text-500",children:q.jsx(r,{defaultMessage:"Browse, click, and type",id:"6baLmoYEwS"})})]}),q.jsxs("span",{className:"flex items-center gap-0.5",children:[q.jsx(Si,{className:"text-text-500"}),q.jsx($i,{className:"text-text-500"})]})]}),q.jsx("p",{className:"font-small text-text-500 px-1 mt-2",children:q.jsx(r,{defaultMessage:"Claude will not purchase items, create accounts, or bypass captchas without input. Revoke site permissions in <settingsButton>settings</settingsButton>.",id:"zPbO6HcY5Z",values:{settingsButton:e=>q.jsx("button",{onClick:()=>chrome.runtime.openOptionsPage(),className:"inline-link hover:text-text-400",children:e})}})})]})]})},mE=({fromDomain:e,toDomain:t,onAllow:n,onDeny:s})=>{const[i,o]=U.useState(null),a=U.useMemo(()=>({type:"domain_transition",fromDomain:e,toDomain:t}),[e,t]),l=U.useCallback(()=>{n(oe.ONCE,a)},[n,a]),c=U.useCallback(()=>{n(oe.ALWAYS,a)},[n,a]);return U.useEffect(()=>{const e=e=>{(e.metaKey||e.ctrlKey)&&"Enter"===e.key?(e.preventDefault(),o("always"),setTimeout(()=>{c()},150)):"Enter"===e.key?(e.preventDefault(),o("once"),setTimeout(()=>{l()},150)):"Escape"===e.key&&(e.preventDefault(),o("deny"),setTimeout(()=>{s()},150))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[c,l,s]),q.jsxs("div",{className:"bg-bg-000 rounded-[14px]",children:[q.jsxs("div",{className:"flex items-center gap-2 py-[10px] px-4",children:[q.jsx(hn,{size:20,className:"text-text-100"}),q.jsx("h3",{className:"font-base text-text-100",children:q.jsx(r,{defaultMessage:"New permissions required",id:"/CBk9UV8iS"})})]}),q.jsx("div",{className:"border-t border-border-300 mb-4"}),q.jsx("div",{className:"space-y-4 px-4",children:q.jsx("div",{children:q.jsx("p",{className:"font-base-bold text-text-100",children:q.jsx(r,{defaultMessage:"Claude paused due to a navigation from <strong>{fromDomain}</strong> to <strong>{toDomain}</strong>",id:"xgz5co4oqe",values:{fromDomain:e,toDomain:t,strong:e=>q.jsx("strong",{children:e})}})})})}),q.jsxs("div",{className:"px-3 py-[10px] space-y-[5px] mt-[10px] mb-0.5",children:[q.jsxs(zi,{onClick:l,isActive:"once"===i,children:[q.jsx("span",{children:q.jsx(r,{defaultMessage:"Continue",id:"acrOozm08x"})}),q.jsx($i,{className:"text-text-500"})]}),q.jsxs(zi,{onClick:s,isActive:"deny"===i,children:[q.jsx("span",{children:q.jsx(r,{defaultMessage:"Stop",id:"q/uwLTb3Zf"})}),q.jsx(hE,{className:"text-text-500"})]}),q.jsx("div",{className:"border-t-[0.5px] border-border-300 my-3 -mx-3"}),q.jsxs(zi,{onClick:c,isActive:"always"===i,height:"55px",children:[q.jsxs("div",{className:"flex flex-col items-start",children:[q.jsx("span",{children:q.jsx(r,{defaultMessage:"Always continue",id:"T40fliCDxK"})}),q.jsx("span",{className:"font-small text-text-500",children:q.jsx(r,{defaultMessage:"When navigating between these sites",id:"/5FoUj4Va+"})})]}),q.jsxs("span",{className:"flex items-center gap-0.5",children:[q.jsx(Si,{className:"text-text-500"}),q.jsx($i,{className:"text-text-500"})]})]}),q.jsx("p",{className:"font-small text-text-500 px-1 mt-2",children:q.jsx(r,{defaultMessage:"Claude will not purchase items, create accounts, or bypass captchas without input. Revoke site permissions in <settingsButton>settings</settingsButton>.",id:"zPbO6HcY5Z",values:{settingsButton:e=>q.jsx("button",{onClick:()=>chrome.runtime.openOptionsPage(),className:"inline-link hover:text-text-400",children:e})}})})]})]})},fE=({serverName:e,serverIconUrl:t,toolDisplayName:n,onAllow:s,onDeny:i})=>{const[o,a]=U.useState(null),l=U.useMemo(()=>({type:"netloc",netloc:""}),[]),c=U.useCallback(()=>{s(oe.ONCE,l)},[s,l]),d=U.useCallback(()=>{s(oe.ALWAYS,l)},[s,l]);return U.useEffect(()=>{const e=e=>{(e.metaKey||e.ctrlKey)&&"Enter"===e.key?(e.preventDefault(),a("always"),setTimeout(()=>{d()},150)):"Enter"===e.key?(e.preventDefault(),a("once"),setTimeout(()=>{c()},150)):"Escape"===e.key&&(e.preventDefault(),a("deny"),setTimeout(()=>{i()},150))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[d,c,i]),q.jsxs("div",{className:"bg-bg-000 rounded-[14px]",children:[q.jsxs("div",{className:"flex items-center gap-2 py-[10px] px-4",children:[q.jsx(hn,{size:20,className:"text-text-100"}),q.jsx("h3",{className:"font-base text-text-100",children:q.jsx(r,{defaultMessage:"New permissions required",id:"/CBk9UV8iS"})})]}),q.jsx("div",{className:"border-t border-border-300 mb-4"}),q.jsx("div",{className:"space-y-4 px-4",children:q.jsxs("div",{children:[q.jsx("p",{className:"font-base-bold text-text-100 mb-2",children:q.jsx(r,{defaultMessage:"Claude wants to use:",id:"tX+S0cc3I4"})}),q.jsxs("div",{className:"flex items-center gap-2",children:[q.jsx(lt,{name:e,iconUrl:t,size:16}),q.jsx("p",{className:"font-claude-response-code text-text-200",children:n})]})]})}),q.jsxs("div",{className:"px-3 py-[10px] space-y-[5px] mt-[10px] mb-0.5",children:[q.jsxs(zi,{onClick:c,isActive:"once"===o,children:[q.jsx("span",{children:q.jsx(r,{defaultMessage:"Allow once",id:"O2tb5KUxpc"})}),q.jsx($i,{className:"text-text-500"})]}),q.jsxs(zi,{onClick:i,isActive:"deny"===o,children:[q.jsx("span",{children:q.jsx(r,{defaultMessage:"Decline",id:"pvtgR26QWY"})}),q.jsx(hE,{className:"text-text-500"})]}),q.jsx("div",{className:"border-t-[0.5px] border-border-300 my-3 -mx-3"}),q.jsxs(zi,{onClick:d,isActive:"always"===o,height:"55px",children:[q.jsxs("div",{className:"flex flex-col items-start",children:[q.jsx("span",{children:q.jsx(r,{defaultMessage:"Allow for all chats",id:"7wuY3W3ryd"})}),q.jsx("span",{className:"font-small text-text-500",children:q.jsx(r,{defaultMessage:"{serverName}: {toolDisplayName}",id:"7DuHI9a2sT",values:{serverName:e,toolDisplayName:n}})})]}),q.jsxs("span",{className:"flex items-center gap-0.5",children:[q.jsx(Si,{className:"text-text-500"}),q.jsx($i,{className:"text-text-500"})]})]}),q.jsx("p",{className:"font-small text-text-500 px-1 mt-2",children:q.jsx(r,{defaultMessage:"You can manage permissions on the Claude <settingsLink>settings</settingsLink> page.",id:"EsGNUZDLMi",values:{settingsLink:e=>q.jsx("a",{href:"https://claude.ai/settings/connectors",target:"_blank",rel:"noopener noreferrer",className:"inline-link hover:text-text-400",children:e})}})})]})]})},gE=({tool:e,url:t,screenshot:n,coordinate:s,typeText:r,uploadImageData:i,plan:o,fromDomain:a,toDomain:l,actionData:c,onAllow:d,onDeny:u,disableAlwaysAllow:h=!1})=>e===re.PLAN_APPROVAL&&o?q.jsx(Fi,{planStructure:o,onApprove:()=>{d(oe.ONCE,{type:"netloc",netloc:""})},onReject:u}):e===re.REMOTE_MCP&&c?.remoteMcp?q.jsx(fE,{serverName:c.remoteMcp.serverName,serverIconUrl:c.remoteMcp.serverIconUrl,toolDisplayName:c.remoteMcp.toolDisplayName,toolDescription:c.remoteMcp.toolDescription,onAllow:d,onDeny:u}):e===re.DOMAIN_TRANSITION?q.jsx(mE,{fromDomain:a,toDomain:l,onAllow:(e,t)=>d(e,t),onDeny:u}):q.jsx(pE,{tool:e,url:t,screenshot:n,coordinate:s,typeText:r,uploadImageData:i,onAllow:d,onDeny:u,disableAlwaysAllow:h}),yE=e=>q.jsx(l,{...e,children:q.jsx("path",{d:"M13.4996 3.5C13.7758 3.5 13.9996 3.72386 13.9996 4C13.9996 4.27614 13.7758 4.5 13.4996 4.5H12.9996V8.84375L16.7965 14.3672C17.7085 15.6942 16.7583 17.5 15.1481 17.5H4.8511C3.24107 17.4998 2.2909 15.6941 3.20265 14.3672L6.99956 8.84375V4.5H6.49956C6.22353 4.49986 5.99955 4.27606 5.99955 4C5.99955 3.72394 6.22353 3.50014 6.49956 3.5H13.4996ZM4.02688 14.9336C3.57109 15.597 4.04619 16.4998 4.8511 16.5H15.1481C15.9532 16.5 16.4283 15.5971 15.9723 14.9336L14.9869 13.5H5.01224L4.02688 14.9336ZM7.99957 9C7.99957 9.10111 7.96894 9.19987 7.91168 9.2832L5.69974 12.5H14.2994L12.0875 9.2832C12.0303 9.1999 11.9996 9.10107 11.9996 9V4.5H7.99957V9Z"})}),xE=({onAccept:e})=>q.jsx("div",{className:"w-full h-screen bg-bg-100 flex items-center justify-center p-5",children:q.jsxs("div",{className:"max-w-[520px] w-full",children:[q.jsx("h1",{className:"text-center text-text-300 mb-[22px]",style:{fontFamily:"Anthropic Sans, var(--font-ui-serif)",fontSize:"26px",fontWeight:500,lineHeight:"130%"},children:q.jsx(r,{defaultMessage:"Claude can now{br}control your browser",id:"jz5L9A3Vjy",values:{br:q.jsx("br",{})}})}),q.jsxs("div",{className:"border border-border-300 rounded-[24px] mb-[22px]",children:[q.jsxs("div",{className:"flex gap-3 pt-5 pb-4 px-4",children:[q.jsx("div",{className:"mt-0.5",children:q.jsx(fs,{size:20,className:"text-text-100"})}),q.jsx("p",{className:"text-[12px] text-text-300 flex-1 leading-[140%]",children:q.jsx(r,{defaultMessage:"Claude can view the URL of tabs where the panel is open and take screenshots when responding. For privacy, avoid using Claude on sensitive sites like health and dating platforms.",id:"hItngLUKCl"})})]}),q.jsx("div",{className:"border-t-[0.5px] border-border-300 px-4"}),q.jsxs("div",{className:"flex gap-3 py-4 px-4",children:[q.jsx("div",{className:"mt-0.5",children:q.jsx(yE,{size:20,className:"text-text-100"})}),q.jsx("p",{className:"text-[12px] text-text-300 flex-1 leading-[140%]",children:q.jsx(r,{defaultMessage:"This is a beta feature with unique risks distinct from other Claude products. You are fully responsible for all risks associated with use of this product.",id:"9anUl9Q74Z"})})]}),q.jsx("div",{className:"border-t-[0.5px] border-border-300 px-4"}),q.jsxs("div",{className:"flex gap-3 pt-4 pb-5 px-4",children:[q.jsx("div",{className:"mt-0.5",children:q.jsx(v,{size:20,className:"text-danger-000"})}),q.jsx("div",{className:"flex-1",children:q.jsx("p",{className:"text-[12px] text-danger-000 leading-[140%]",children:q.jsx(r,{defaultMessage:"Malicious code buried in sites may override your instructions in order to steal your data, inject malware into your systems, or take over your system to attack other users. {learnMoreLink}",id:"bmDayxG7DJ",values:{learnMoreLink:q.jsx("button",{onClick:()=>{chrome.tabs.create({url:ku})},className:"text-danger-000 inline-link hover:no-underline focus:outline-none",children:q.jsx(r,{defaultMessage:"Learn more",id:"TdTXXf940t"})})}})})})]})]}),q.jsx("div",{className:"flex justify-end",children:q.jsx("button",{onClick:e,className:"px-4 py-2.5 rounded-[14px] bg-text-100 hover:bg-text-200 active:bg-text-000 text-bg-100 font-button transition-all hover:shadow-md",children:q.jsx(r,{defaultMessage:"I understand",id:"p5wxjR3WJg"})})})]})});function CE({permissionPrompt:e,onAllow:t,onDeny:n,disableAlwaysAllow:s}){const[i,o]=U.useState(!1),[a,l]=U.useState(e);if(U.useEffect(()=>{J(G.BROWSER_CONTROL_PERMISSION_ACCEPTED).then(e=>{o(!0===e)})},[]),U.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("requestId");if(e){const t=`mcp_prompt_${e}`;chrome.storage.local.get(t).then(e=>{const n=e[t];n&&l(n.prompt)})}},[]),!i)return q.jsx("div",{className:"flex items-center justify-center h-screen bg-bg-100 p-3",children:q.jsx("div",{className:"w-full max-w-md",children:q.jsx(xE,{onAccept:()=>{K(G.BROWSER_CONTROL_PERMISSION_ACCEPTED,!0).then(()=>{o(!0)})}})})});const c=a||e;return c?q.jsx("div",{className:"flex items-center justify-center h-screen bg-bg-100 p-3",children:q.jsx("div",{className:"w-full max-w-sm border border-border-300 rounded-[14px]",children:q.jsx(gE,{tool:c.tool,url:c.url,screenshot:c.actionData?.screenshot,coordinate:c.actionData?.coordinate,typeText:c.actionData?.text,fromDomain:c.actionData?.fromDomain,toDomain:c.actionData?.toDomain,onAllow:t,onDeny:n,disableAlwaysAllow:s})})}):q.jsx("div",{className:"flex items-center justify-center h-screen bg-bg-100",children:q.jsx("div",{className:"text-text-200 text-sm",children:q.jsx(r,{defaultMessage:"Waiting for permission request...",id:"6x5YwESShd"})})})}const bE=({onNext:e})=>{const t=()=>{chrome.tabs.create({url:ku})};return q.jsx("div",{className:"w-full h-screen bg-bg-100 flex items-center justify-center p-5",children:q.jsxs("div",{className:"max-w-[520px] w-full",children:[q.jsx("h1",{className:"font-claude-response-heading text-center text-text-100 mb-5",children:q.jsx(r,{defaultMessage:"This is a beta feature",id:"/06n65wN4J"})}),q.jsxs("div",{className:"border border-border-300 rounded-xl mb-5",children:[q.jsxs("div",{className:"flex gap-3 pt-5 pb-4 px-4",children:[q.jsx("div",{className:"mt-0.5",children:q.jsx(yE,{size:20,className:"text-text-100"})}),q.jsx("p",{className:"font-base text-text-300 flex-1",children:q.jsx(r,{defaultMessage:"This beta feature has unique risks distinct from other Claude products. You are fully responsible for all risks associated with use of this product.",id:"RWrtnxjH8o"})})]}),q.jsx("div",{className:"border-t-[0.5px] border-border-300 px-4"}),q.jsxs("div",{className:"flex gap-3 py-4 px-4",children:[q.jsx("div",{className:"mt-0.5",children:q.jsx(fs,{size:20,className:"text-text-100"})}),q.jsx("p",{className:"font-base text-text-300 flex-1",children:q.jsx(r,{defaultMessage:"Claude can take screenshots when responding. For privacy, avoid using Claude on sensitive sites like health and dating platforms.",id:"Ddc1eapnSI"})})]}),q.jsx("div",{className:"border-t-[0.5px] border-border-300 px-4"}),q.jsxs("div",{className:"flex gap-3 pt-4 pb-5 px-4",children:[q.jsx("div",{className:"mt-0.5",children:q.jsx(v,{size:20,className:"text-danger-000"})}),q.jsx("div",{className:"flex-1",children:q.jsx("p",{className:"font-base text-danger-000",children:q.jsx(r,{defaultMessage:"Malicious actors can hide instructions in websites, emails, and documents that trick AI into taking harmful actions without your knowledge. <link>Learn more</link>",id:"DvXQDnOGPc",values:{link:e=>q.jsx("button",{onClick:t,className:"text-danger-000 inline-link hover:no-underline focus:outline-none",children:e})}})})})]})]}),q.jsx("div",{className:"flex justify-center",children:q.jsx(i,{onClick:e,variant:"primary","data-test-id":"onboarding-continue",children:q.jsx(r,{defaultMessage:"I understand",id:"p5wxjR3WJg"})})})]})})},wE=({onNext:e})=>{const t=s(),n=Je();return q.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen h-full px-10",children:q.jsxs("div",{className:"flex flex-col items-center",children:[q.jsx("img",{src:n?"/assets/usecase_dark-B8e6CElR.svg":"/assets/usecase-DTXLdUtN.svg",alt:t.formatMessage({defaultMessage:"Onboarding illustration",id:"IvNiHZimcV"}),className:"w-[168px] h-[122px]"}),q.jsx("div",{className:"text-text-100 text-base font-semibold mt-7 text-center font-claude-response",children:q.jsx(r,{defaultMessage:"Automate your repetitive tasks",id:"5U/pkz4osv"})}),q.jsx("div",{className:"text-text-300 text-sm font-normal mt-2 text-center max-w-[320px] font-base",children:q.jsx(r,{defaultMessage:"Claude can take on your multi-step work like QA testing, researching sales leads, and data entry across multiple sites. You can focus elsewhere knowing Claude is working in background.",id:"yLeYIHrySb"})}),q.jsx(i,{onClick:e,variant:"primary",className:"mt-7","data-test-id":"onboarding-continue",children:q.jsx(r,{defaultMessage:"Next",id:"9+DdtuCqLw"})})]})})},vE=({onNext:e})=>{const t=s(),n=Je();return q.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen h-full px-10",children:q.jsxs("div",{className:"flex flex-col items-center",children:[q.jsx("img",{src:n?pn:mn,alt:t.formatMessage({defaultMessage:"Onboarding illustration",id:"IvNiHZimcV"}),className:"w-[212px] h-[120px]"}),q.jsx("div",{className:"text-text-100 text-base font-semibold mt-7 text-center font-claude-response",children:q.jsx(r,{defaultMessage:"Claude has tab group access",id:"RuX+iObJu9"})}),q.jsx("div",{className:"text-text-300 text-sm font-normal mt-2 text-center max-w-[320px] font-base",children:q.jsx(r,{defaultMessage:"If Claude is open in a tab group, it can access the URL, context and information of all the tabs in that group.",id:"jN7b0qJSmv"})}),q.jsx(i,{onClick:e,variant:"primary",className:"mt-7","data-test-id":"onboarding-continue",children:q.jsx(r,{defaultMessage:"Next",id:"9+DdtuCqLw"})})]})})},kE=({onNext:e})=>{const t=s(),n=Je();return q.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen h-full px-10",children:q.jsxs("div",{className:"flex flex-col items-center",children:[q.jsx("img",{src:n?"/assets/shortcuts_dark-DelMLMgh.svg":"/assets/shortcuts-D9M-y4eQ.svg",alt:t.formatMessage({defaultMessage:"Onboarding illustration",id:"IvNiHZimcV"}),className:"w-[212px] h-[120px]"}),q.jsx("div",{className:"text-text-100 text-base font-semibold mt-7 text-center font-claude-response",children:q.jsx(r,{defaultMessage:"Use shortcuts to save time",id:"sDX6Oo6Pj4"})}),q.jsx("div",{className:"text-text-300 text-sm font-normal mt-2 text-center max-w-[320px] font-base",children:q.jsx(r,{defaultMessage:"Shortcuts make it easy to send instructions to Claude. Great for tasks you repeat often! Type / in the chat to find and create shortcuts.",id:"oCBOPo+ZDe"})}),q.jsx(i,{onClick:e,variant:"primary",className:"mt-7","data-test-id":"onboarding-continue",children:q.jsx(r,{defaultMessage:"Let's go",id:"wVu1FLTwAn"})})]})})},ME=({onAccept:e})=>{const[t,n]=U.useState(1),s=()=>{n(t+1)};switch(t){case 1:return q.jsx(bE,{onNext:s});case 2:return q.jsx(wE,{onNext:s});case 3:return q.jsx(vE,{onNext:s});case 4:return q.jsx(kE,{onNext:e})}},SE=({currentVersion:e,minSupportedVersion:t})=>q.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-bg-100 p-4",children:q.jsx("div",{className:"max-w-md w-full",children:q.jsx("div",{className:"bg-bg-000 rounded-xl shadow-sm border border-border-200 p-6",children:q.jsxs("div",{className:"flex flex-col items-center text-center",children:[q.jsx("div",{className:"w-12 h-12 bg-danger-900 rounded-full flex items-center justify-center mb-3",children:q.jsx(ni,{className:"w-6 h-6 text-danger-200"})}),q.jsx("h2",{className:"font-xl-bold text-text-100 mb-2",children:q.jsx(r,{defaultMessage:"Extension Update Required",id:"bWSwU/3iyK"})}),q.jsx("p",{className:"font-base-sm text-text-300 mb-4",children:q.jsx(r,{defaultMessage:"Your extension version ({currentVersion}) is no longer supported. Please update to version {minSupportedVersion} or later to continue using Claude.",id:"kWxPgoo7qQ",values:{currentVersion:e,minSupportedVersion:t}})}),q.jsx("button",{onClick:()=>{chrome.runtime.reload()},className:"w-full px-4 py-2 bg-accent-main-200 text-oncolor-100 font-button-lg rounded-lg hover:bg-accent-main-100 transition-colors",children:q.jsx(r,{defaultMessage:"Update Extension",id:"TDyP36qHxV"})}),q.jsx("p",{className:"font-caption text-text-400 mt-3",children:q.jsx(r,{defaultMessage:"Clicking the button will reload the extension to apply any pending updates.",id:"j111DEvZ03"})})]})})})}),NE=({className:e=""})=>q.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"44",height:"54",viewBox:"0 0 44 54",fill:"none",className:e,children:[q.jsx("path",{d:"M21.7123 19.6053C21.6411 19.4884 18.9303 14.7128 19.6611 10.6981C20.3919 6.6834 24.1296 1.49002 29.3189 1.1021C34.5083 0.714185 39.3603 1.8108 41.5565 8.03863C43.7527 14.2665 40.9756 20.59 36.2422 22.2772C31.5089 23.9644 27.0316 23.0655 27.0316 23.0655C27.0316 23.0655 26.6706 17.9629 26.5919 16.9844C26.5132 16.0059 24.5244 15.2487 23.8947 15.6888C23.2651 16.129 22.8191 16.4373 22.6043 17.5265C22.3894 18.6156 21.7123 19.6028 21.7123 19.6028V19.6053Z",fill:"hsl(var(--bg-500))"}),q.jsx("path",{d:"M0.721235 51.5865C0.717916 50.4591 0.714597 49.3317 0.711278 48.2043C0.711278 46.512 0.591797 46.512 0.591797 44.8209C0.591797 43.1298 0.761062 43.1298 0.761062 41.4375C0.758573 40.3101 0.755669 39.1823 0.75235 38.0541C0.756084 37.1849 0.769775 36.741 0.792177 36.2971C0.804623 36.0746 0.822048 35.8507 0.858141 35.571C0.897968 35.2912 0.953975 34.9542 1.07968 34.5078C1.20663 34.0614 1.34478 33.7319 1.47795 33.4646C1.61112 33.196 1.73932 32.9883 1.88245 32.7894C2.02309 32.5892 2.18364 32.3989 2.39771 32.1726C2.61925 31.9538 2.90302 31.6976 3.33863 31.4427C3.77673 31.1903 4.13766 31.0809 4.43388 31.0038C4.58198 30.9615 4.7164 30.9379 4.84459 30.9155C4.96905 30.8882 5.09725 30.8807 5.22046 30.867C5.46938 30.8421 5.73075 30.8434 6.06306 30.8869C6.22983 30.9192 6.41528 30.9541 6.62064 31.0349C6.826 31.1082 7.05003 31.2276 7.27903 31.3967C7.32882 31.4378 7.37611 31.4775 7.42341 31.5161L7.45825 31.5447L7.47568 31.5596L7.50306 31.587C7.51675 31.6006 7.53044 31.6143 7.54289 31.6268L7.55658 31.6417C7.57276 31.6591 7.5852 31.674 7.59516 31.6852C7.61383 31.7076 7.62379 31.715 7.62876 31.7138C7.6325 31.7126 7.62876 31.7138 7.63872 31.7039C7.64868 31.6952 7.64992 31.669 7.64743 31.6516C7.64619 31.6143 7.64494 31.587 7.64619 31.5671C7.64619 31.5621 7.64619 31.5546 7.64868 31.5472C7.67481 31.4688 7.69846 31.4005 7.71962 31.3395C7.77936 31.1704 7.83661 31.0237 7.89386 30.8894C8.00712 30.6233 8.10794 30.4119 8.22244 30.2055C8.33694 29.9991 8.45767 29.7939 8.63191 29.5452C8.8074 29.299 9.03267 29.0031 9.41228 28.6624C9.79561 28.3229 10.1516 28.1314 10.454 28.0059C10.7602 27.8828 11.0178 27.8169 11.2754 27.782L11.3725 27.7671L11.4621 27.7597C11.5219 27.7547 11.5841 27.7497 11.6463 27.7435C11.7098 27.7385 11.7745 27.7335 11.8417 27.7273C11.9114 27.7273 11.9849 27.7248 12.0608 27.7236C12.1379 27.7236 12.2164 27.7186 12.3047 27.7236C12.3931 27.7298 12.4852 27.736 12.5848 27.7435C12.6818 27.746 12.7926 27.7721 12.9059 27.7895C12.9631 27.8007 13.0216 27.8082 13.0826 27.8243C13.1448 27.843 13.2083 27.8616 13.273 27.8803C13.8007 28.0419 14.1679 28.318 14.4181 28.5642C14.4492 28.5965 14.479 28.6276 14.5077 28.6574L14.5512 28.7034L14.5624 28.7146C14.5624 28.7146 14.5599 28.7109 14.5599 28.7096C14.5562 28.7047 14.5512 28.6997 14.5462 28.6947C14.5512 28.6985 14.5587 28.7022 14.5637 28.7047C14.5749 28.7096 14.5836 28.7146 14.5911 28.7159C14.6197 28.7246 14.6222 28.6848 14.6247 28.7072C14.6334 28.6935 14.6383 28.7096 14.657 28.7022C14.6657 28.6985 14.6769 28.6885 14.6906 28.6649L14.6981 28.6512L14.7018 28.6437L14.7043 28.64L14.7155 28.6139C14.7479 28.5381 14.7777 28.4585 14.8163 28.3739C14.8898 28.2048 14.9819 28.0158 15.0976 27.8032C15.3366 27.3792 15.5793 27.0795 15.8108 26.8544C16.0435 26.6294 16.2576 26.4702 16.4903 26.3396C16.7231 26.2103 16.9695 26.0997 17.2893 26.0139C17.4487 25.9716 17.6266 25.9343 17.8283 25.9144C18.0262 25.8883 18.2651 25.8833 18.5352 25.9107C18.8065 25.9393 19.0455 26.0039 19.2471 26.0823C19.4512 26.1581 19.6192 26.2476 19.7649 26.3372C20.0548 26.5175 20.259 26.6915 20.4444 26.8743C20.4892 26.9203 20.5378 26.9663 20.5788 27.0161C20.6 27.0409 20.6224 27.0646 20.6448 27.0894L20.6771 27.1255H20.6821C20.6958 27.1317 20.7045 27.1317 20.712 27.1305C20.7269 27.1305 20.7319 27.123 20.7356 27.1342C20.7394 27.1454 20.7431 27.1653 20.7481 27.1976C20.7556 27.2275 20.7531 27.2784 20.7717 27.3195C20.7941 27.3667 20.8041 27.3692 20.8128 27.271C20.8165 27.2225 20.824 27.1951 20.8327 27.1665C20.8389 27.1516 20.8439 27.1379 20.8489 27.1243L20.8576 27.1019L20.8601 27.0957L20.8651 27.0584L20.875 26.98C20.9273 26.5597 20.9808 26.1382 21.0518 25.2964C21.2011 23.6078 21.0754 23.5966 21.2484 21.9043C21.3368 21.0575 21.4115 20.6347 21.4824 20.2132C21.521 20.0006 21.5583 19.788 21.6056 19.5231C21.6305 19.3876 21.6579 19.2396 21.6878 19.0705C21.7164 18.9014 21.7624 18.7111 21.8048 18.4935C21.9977 17.6231 22.1508 17.1817 22.3262 16.7378C22.376 16.6271 22.4134 16.5165 22.4793 16.3983C22.5428 16.2814 22.6001 16.1559 22.6946 16.0203C22.7419 15.9519 22.783 15.8798 22.8428 15.8065C22.9037 15.7318 22.9672 15.6548 23.0382 15.5727C23.1215 15.4931 23.2024 15.4086 23.3082 15.3252C23.4178 15.2432 23.5323 15.1574 23.6841 15.0853C23.9778 14.936 24.2927 14.8726 24.569 14.8826C24.7034 14.8913 24.8478 14.9099 24.9187 14.9286C25.0059 14.946 25.0855 14.9684 25.1627 14.9895C25.4701 15.079 25.7078 15.1897 25.9356 15.319C26.1633 15.4483 26.3799 15.61 26.6226 15.84C26.8603 16.0713 27.1292 16.3934 27.3358 16.8758C27.5436 17.3595 27.5847 17.7325 27.6332 18.0359C27.6469 18.1876 27.6594 18.3232 27.6706 18.4513C27.6768 18.5632 27.6818 18.6689 27.6867 18.7745C27.7091 19.1973 27.7315 19.6201 27.7166 20.4669C27.6855 22.1592 27.571 22.1592 27.5399 23.8503C27.515 24.9785 27.4905 26.1071 27.4664 27.2362C27.4353 28.9285 27.4565 28.9285 27.4241 30.6208C27.3967 31.749 27.3694 32.8777 27.342 34.0067C27.3345 34.4295 27.3333 34.7478 27.3358 35.0114C27.3358 35.0413 27.3358 35.0711 27.3358 35.0997L27.3382 35.1196C27.3407 35.132 27.342 35.1432 27.3445 35.1556C27.3482 35.178 27.3532 35.1967 27.3582 35.2128C27.3768 35.2812 27.3955 35.3074 27.3943 35.423C27.3943 35.4528 27.3918 35.4827 27.3893 35.5138C27.3868 35.5473 27.4191 35.5685 27.4303 35.5635C27.444 35.5535 27.4515 35.5498 27.4652 35.5424C27.4913 35.5274 27.5312 35.474 27.6257 35.2924C27.637 35.27 27.6482 35.2489 27.6581 35.229C27.6706 35.2029 27.6631 35.2166 27.7179 35.1146C27.8 34.9642 27.8709 34.8311 27.9369 34.7117C28.0688 34.4705 28.1759 34.2778 28.2879 34.0838C28.3999 33.8911 28.5169 33.6996 28.6774 33.4671C28.7583 33.3527 28.8542 33.2221 28.96 33.0878C29.067 32.956 29.1827 32.8068 29.3271 32.6414C29.8984 31.9787 30.2033 31.6479 30.5219 31.3221C30.6812 31.1592 30.8493 31.0001 31.0745 30.8123C31.3023 30.627 31.5886 30.4094 32.0229 30.1757C32.4585 29.9431 32.8244 29.8225 33.1294 29.7479C33.2825 29.7069 33.4219 29.6845 33.5538 29.6634C33.6857 29.6385 33.8102 29.6335 33.9334 29.6211C34.1848 29.6024 34.4636 29.6037 34.8096 29.6534C34.8979 29.6733 34.99 29.6932 35.0871 29.7156C35.1842 29.7355 35.2875 29.7815 35.3958 29.8188C35.6123 29.9021 35.8488 30.0364 36.089 30.2291C36.1998 30.3336 36.3081 30.4331 36.3915 30.5375C36.4699 30.6444 36.5533 30.7427 36.6068 30.8434C36.6615 30.9441 36.7163 31.0386 36.7574 31.1294C36.7922 31.2214 36.8258 31.3084 36.8582 31.3918C36.8918 31.4751 36.9042 31.5534 36.9254 31.6292C36.9428 31.7051 36.9652 31.7785 36.9752 31.8481C36.9939 31.9861 37.0163 32.1192 37.0237 32.2472C37.0275 32.3741 37.0362 32.5034 37.0337 32.6377C37.0262 32.7695 37.0237 32.9112 37.0075 33.0629C36.9976 33.1375 36.9876 33.2171 36.9764 33.3004C36.9665 33.385 36.954 33.472 36.9341 33.5628C36.9154 33.6536 36.8955 33.7506 36.8756 33.8538C36.8681 33.901 36.8457 33.9706 36.8296 34.0303C36.8109 34.0925 36.7947 34.1584 36.7698 34.2206C36.5819 34.7291 36.3666 35.0313 36.1923 35.27C36.0131 35.5075 35.86 35.6767 35.7057 35.8395C35.3983 36.1653 35.0809 36.4675 34.5146 37.0855C33.9533 37.7022 33.7031 38.0181 33.4604 38.3401C33.3397 38.5018 33.224 38.6646 33.0871 38.8698C32.9526 39.0775 32.7896 39.3262 32.6116 39.6718C32.4336 40.0187 32.3303 40.2898 32.2606 40.5199C32.1909 40.7499 32.1524 40.9377 32.1212 41.1254C32.1026 41.2187 32.0926 41.3132 32.0802 41.4139C32.0739 41.4636 32.0665 41.5146 32.059 41.5681C32.054 41.6215 32.0491 41.6775 32.0441 41.7372C32.0379 41.7969 32.0316 41.859 32.0242 41.9249C32.0179 41.9971 32.0105 42.0742 32.003 42.155C31.9856 42.3179 31.9657 42.5007 31.9433 42.7083C31.7553 44.382 31.6545 44.3733 31.4803 46.0532C31.3098 47.7355 31.3421 47.7393 31.1778 49.4217C31.0957 50.2635 31.0372 50.6813 30.9787 51.1003C30.9501 51.3092 30.9202 51.5193 30.8878 51.7817C30.8804 51.8476 30.8717 51.916 30.863 51.9894C30.853 52.0851 30.8418 52.1871 30.8306 52.2952C30.8169 52.4432 30.7933 52.5962 30.731 52.7392C30.67 52.8846 30.573 53.0264 30.4373 53.1445C30.2817 53.2801 30.1013 53.3584 29.9594 53.3907C29.8175 53.4255 29.7067 53.423 29.6769 53.4268C29.4814 53.4305 29.306 53.433 29.1454 53.4367C29.0185 53.4405 28.9015 53.4429 28.7932 53.4467C28.5766 53.4541 28.3887 53.4604 28.1933 53.4678C27.805 53.4815 27.3893 53.4939 26.6637 53.5001C24.9698 53.5126 24.9685 53.4355 23.2746 53.4479C21.5807 53.4591 21.5807 53.5263 19.8868 53.5362C18.1917 53.5461 18.1917 53.5225 16.4965 53.5312C15.3673 53.5412 14.238 53.5507 13.1087 53.5598C11.4136 53.5648 11.4136 53.6394 9.7172 53.6406C8.01957 53.6406 8.01957 53.5325 6.32193 53.5263C4.62306 53.5163 4.62554 53.4977 2.92044 53.4703C2.26205 53.4579 1.87125 53.3895 1.63602 53.2713C1.57752 53.2415 1.53023 53.2092 1.49413 53.1756C1.48044 53.1594 1.44933 53.1383 1.42817 53.1172C1.40701 53.096 1.39083 53.0749 1.37838 53.0537C1.32984 52.9679 1.34851 52.8846 1.38461 52.7951C1.4207 52.7056 1.47048 52.6248 1.50907 52.5477C1.51902 52.529 1.52774 52.5104 1.5352 52.493C1.54267 52.4755 1.54392 52.4594 1.56756 52.4432C1.6049 52.4109 1.64971 52.3835 1.70322 52.3587C1.91481 52.2592 2.2969 52.2082 2.94658 52.2206C4.62928 52.248 4.63177 52.2766 6.32193 52.2865C7.45037 52.2915 8.57839 52.2961 9.706 52.3002C11.3987 52.299 11.3974 52.197 13.0901 52.192C14.7827 52.1858 14.7827 52.2841 16.4754 52.2766C18.168 52.2679 18.1668 52.1025 19.8594 52.0926C21.5521 52.0826 21.5521 52.11 23.2448 52.0975C24.9374 52.0851 24.9374 52.1634 26.6301 52.151C27.3607 52.1485 27.7763 52.1473 28.1672 52.146C28.5256 52.146 28.8616 52.146 29.4429 52.146C29.4478 52.1448 29.4902 52.1547 29.5263 52.1274C29.5599 52.1025 29.5636 52.0627 29.5648 52.0329C29.5773 51.9036 29.5897 51.7904 29.5997 51.686C29.6271 51.4223 29.6482 51.2122 29.6706 51.0021C29.7129 50.5805 29.7553 50.1603 29.8411 49.3172C30.0067 47.6323 30.049 47.6373 30.2195 45.9525C30.3937 44.2676 30.3639 44.2651 30.553 42.5778C30.5779 42.3664 30.5991 42.1811 30.6178 42.0157C30.6364 41.8503 30.6526 41.7061 30.6763 41.5606C30.6962 41.4176 30.7148 41.2895 30.741 41.1702C30.7659 41.0508 30.7845 40.9364 30.8144 40.8257C30.8679 40.6019 30.9314 40.3793 31.0248 40.107C31.1218 39.836 31.2488 39.5152 31.4566 39.1073C31.886 38.3028 32.1449 37.936 32.3913 37.563C32.6427 37.1961 32.9091 36.8318 33.4878 36.1952C34.0666 35.5635 34.3354 35.2576 34.5818 34.9455C34.7063 34.7901 34.822 34.6346 34.954 34.4444C35.0834 34.2542 35.229 34.0241 35.3348 33.7406C35.3659 33.6685 35.3746 33.6063 35.3958 33.5454C35.412 33.4658 35.4269 33.3912 35.4418 33.3203C35.4767 33.1786 35.4829 33.058 35.5016 32.9473C35.5265 32.7272 35.5327 32.5556 35.5265 32.3915C35.5277 32.3492 35.524 32.3094 35.5178 32.2696C35.5128 32.2298 35.509 32.1888 35.5041 32.1478C35.5016 32.1042 35.4904 32.0657 35.4804 32.0247C35.4705 31.9836 35.4618 31.9389 35.4505 31.8953C35.3945 31.7262 35.3099 31.5422 35.1394 31.3843C35.1182 31.3632 35.0921 31.3507 35.0709 31.3333C35.0473 31.3184 35.0311 31.2972 35.0062 31.2861C34.9564 31.2649 34.9179 31.2338 34.8706 31.2177C34.822 31.2027 34.781 31.1841 34.7361 31.1692C34.6889 31.1605 34.6453 31.1505 34.603 31.1406C34.5631 31.1269 34.5146 31.1306 34.4748 31.1244C34.4325 31.1219 34.3939 31.112 34.3516 31.1132C34.2657 31.117 34.1935 31.1107 34.1064 31.1194C33.9296 31.1344 33.7554 31.1543 33.5438 31.2077C33.331 31.2562 33.0821 31.3408 32.7622 31.5061C32.4448 31.6765 32.2121 31.8344 32.0229 31.9774C31.8325 32.1192 31.6807 32.241 31.5325 32.3703C31.2363 32.629 30.9414 32.8988 30.4062 33.518C30.2718 33.671 30.1585 33.814 30.0565 33.9371C29.9519 34.0627 29.8772 34.1671 29.8013 34.2653C29.6569 34.4655 29.5462 34.6309 29.4379 34.8C29.3321 34.9704 29.2276 35.142 29.0994 35.3596C29.0371 35.4702 28.9662 35.5896 28.8903 35.7289C28.8703 35.7649 28.8504 35.801 28.8293 35.8383C28.7882 35.9129 28.7471 35.9863 28.7073 36.0658C28.6252 36.2225 28.5393 36.3904 28.4472 36.5682C28.3576 36.7535 28.2742 36.9276 28.1945 37.0904C28.1161 37.2558 28.0427 37.4237 27.9742 37.5741C27.9058 37.7296 27.8398 37.8651 27.7776 37.9932C27.7465 38.0578 27.7166 38.12 27.6867 38.1809C27.6718 38.2108 27.6581 38.2406 27.6432 38.2705C27.6357 38.2841 27.6282 38.3016 27.622 38.3127L27.6021 38.3314C27.5498 38.3811 27.5013 38.4284 27.454 38.4744C27.4303 38.4968 27.4079 38.5192 27.3843 38.5415C27.3656 38.5515 27.3482 38.5627 27.3308 38.5726C27.2611 38.6124 27.1914 38.6559 27.1441 38.6709C27.118 38.682 27.0918 38.6932 27.0657 38.7044C27.0445 38.7119 27.0234 38.7206 27.001 38.7293C26.9611 38.7455 26.9201 38.7616 26.8728 38.7803C26.8454 38.789 26.7682 38.7927 26.6799 38.7766C26.594 38.7604 26.4957 38.7181 26.4558 38.6845C26.4023 38.6323 26.3525 38.5614 26.2841 38.4732C26.2654 38.4458 26.248 38.4197 26.2306 38.3936C26.2131 38.3662 26.1969 38.3476 26.1783 38.3115C26.1434 38.2431 26.1098 38.1971 26.0824 38.1113C26.0688 38.0703 26.0526 38.0417 26.0414 37.9957C26.0314 37.9484 26.0202 37.9024 26.0115 37.8576C26.0053 37.8054 26.004 37.7445 25.9991 37.6898C25.9991 37.6264 26.0003 37.5654 26.0015 37.5058C26.009 37.0233 26.0152 36.6366 26.0215 36.2499C26.0302 35.6941 26.0401 35.137 26.0588 34.0254C26.0899 32.3355 26.0352 32.3355 26.0663 30.6457C26.0974 28.9558 26.1994 28.9571 26.2306 27.2673C26.2617 25.5762 26.0899 25.5749 26.121 23.8851C26.1434 22.7585 26.1658 21.6324 26.1882 20.5067C26.2044 19.6611 26.2119 19.2396 26.2206 18.8168C26.2231 18.7111 26.2243 18.6054 26.2268 18.4935C26.2293 18.4326 26.2243 18.3953 26.2218 18.3431C26.2194 18.2946 26.2181 18.2436 26.2156 18.1901C26.2156 18.1354 26.2057 18.0832 26.1982 18.026C26.1907 17.97 26.182 17.9104 26.1721 17.8469C26.1571 17.7873 26.1409 17.7251 26.1248 17.6579C26.1098 17.5896 26.0775 17.5299 26.0551 17.4577C25.9431 17.1854 25.8074 17.03 25.6804 16.9094C25.5522 16.79 25.4328 16.7079 25.2971 16.6408C25.1639 16.5724 25.0196 16.5102 24.8229 16.4593C24.7731 16.4493 24.7221 16.4344 24.6648 16.4232C24.6362 16.4182 24.6076 16.412 24.5777 16.407C24.5653 16.407 24.5553 16.407 24.5441 16.4045C24.4993 16.4045 24.4533 16.4083 24.3811 16.4406C24.233 16.5115 24.0687 16.6756 23.9504 16.8298C23.9206 16.8696 23.8882 16.9032 23.8608 16.943C23.8335 16.984 23.8073 17.0225 23.7812 17.0598C23.7264 17.132 23.6816 17.2115 23.6356 17.2911C23.4563 17.6094 23.2746 17.9576 23.0991 18.7397C23.0606 18.9374 23.022 19.109 22.9958 19.2645C22.9722 19.4211 22.951 19.5592 22.9311 19.6847C22.8925 19.9359 22.8739 20.1473 22.849 20.3525C22.8054 20.769 22.7606 21.1856 22.6735 22.0199C22.5017 23.6936 22.5727 23.7011 22.4246 25.381C22.3536 26.2215 22.3287 26.643 22.3051 27.0646C22.2503 27.8678 22.1943 28.6723 22.0835 30.2801C22.0835 30.2963 22.0811 30.3137 22.0798 30.3236L22.0711 30.392C22.0674 30.4132 22.0661 30.443 22.0587 30.448C22.0462 30.4691 22.035 30.489 22.0238 30.5089C22.0002 30.5487 21.9778 30.5872 21.9566 30.6245C21.913 30.6967 21.8707 30.7651 21.8321 30.8297C21.7911 30.9105 21.76 30.9081 21.7276 30.9279C21.6965 30.9441 21.6666 30.959 21.638 30.9727C21.6106 30.9851 21.5807 31.005 21.5596 31.0075C21.5397 31.0113 21.5197 31.015 21.5011 31.0187C21.4824 31.0224 21.465 31.0274 21.4476 31.0324C21.4276 31.0374 21.4264 31.0423 21.3579 31.0523C21.2982 31.061 21.2185 31.0548 21.2123 31.0399C21.2049 31.0249 21.1999 31.01 21.1924 30.9926C21.1775 30.959 21.1601 30.9205 21.1314 30.877C21.104 30.8322 21.0692 30.7837 21.0119 30.7265C20.9559 30.6681 20.8813 30.6071 20.7419 30.4853C20.712 30.4629 20.6684 30.4132 20.6323 30.3746C20.6137 30.3535 20.595 30.3361 20.5763 30.3137C20.5552 30.2789 20.5353 30.2441 20.5154 30.2105C20.4954 30.1769 20.4755 30.1433 20.4569 30.111C20.4469 30.0936 20.4369 30.0799 20.4282 30.06C20.4208 30.0277 20.4121 29.9941 20.4046 29.9618C20.3735 29.8325 20.3424 29.7069 20.3125 29.585C20.1942 29.1536 20.0897 28.8502 19.9802 28.6201C19.9528 28.5617 19.9267 28.5032 19.9005 28.4473C19.8719 28.3963 19.8445 28.3478 19.8171 28.2993C19.7897 28.2521 19.7649 28.2023 19.7362 28.1588C19.7076 28.1165 19.679 28.0742 19.6504 28.0332L19.608 27.9723L19.5869 27.9424C19.5794 27.9313 19.5719 27.9213 19.5707 27.9201L19.5271 27.8691C19.4985 27.8355 19.4699 27.8032 19.44 27.7733C19.323 27.6515 19.1998 27.5445 19.0405 27.4438C18.8799 27.3443 18.6895 27.2486 18.4008 27.2113C18.2552 27.1939 18.1232 27.1964 17.9975 27.2138C17.9664 27.2175 17.9353 27.2212 17.9067 27.225C17.878 27.2312 17.8507 27.2374 17.8233 27.2424C17.7685 27.2523 17.7187 27.266 17.6727 27.2809C17.486 27.3381 17.3503 27.4102 17.2197 27.4923C17.0915 27.5794 16.9707 27.6788 16.8301 27.8256C16.6907 27.9735 16.5301 28.17 16.3534 28.4809C16.2663 28.6375 16.1953 28.7805 16.1381 28.9148C16.1082 28.9807 16.0833 29.0454 16.0584 29.1051C16.0522 29.12 16.046 29.1349 16.0398 29.1498C16.0286 29.1809 16.0186 29.212 16.0074 29.2431C15.9863 29.304 15.9651 29.3637 15.9452 29.4221C15.7908 29.9009 15.7 30.3199 15.6278 30.8061L15.5905 31.0921C15.5855 31.1219 15.5842 31.1617 15.5743 31.1791C15.5432 31.2687 15.5133 31.3594 15.4809 31.4539C15.4735 31.4825 15.4635 31.49 15.4536 31.5037L15.4249 31.5422C15.405 31.5683 15.3851 31.5957 15.3652 31.623C15.344 31.6554 15.3266 31.6653 15.3067 31.6852C15.288 31.7026 15.2681 31.7213 15.2482 31.7399C15.2096 31.7735 15.176 31.7946 15.1387 31.8245C15.1088 31.8444 15.0764 31.8643 15.0428 31.8866C15.0167 31.9028 14.9881 31.9215 14.9582 31.9401C14.947 31.9476 14.9346 31.955 14.9221 31.9637C14.9184 31.9675 14.9047 31.9737 14.8711 31.9774C14.84 31.9811 14.8026 31.9811 14.784 31.9787C14.7192 31.9264 14.6496 31.8929 14.4952 31.8332L14.4716 31.8245C14.4616 31.8195 14.4467 31.8083 14.4342 31.8008C14.4093 31.7847 14.3845 31.7685 14.3596 31.7523C14.311 31.7213 14.2637 31.6914 14.2189 31.6628C14.1679 31.5447 14.1181 31.4291 14.0683 31.3159C14.0434 31.2587 14.0185 31.2015 13.9949 31.1455C13.97 31.0884 13.9439 31.0374 13.9277 30.9565C13.8903 30.8073 13.853 30.6569 13.8157 30.5052C13.797 30.4281 13.7783 30.351 13.7584 30.2727C13.751 30.2266 13.7335 30.213 13.7211 30.1831L13.68 30.1048C13.6252 29.9979 13.5692 29.8884 13.5107 29.7728L13.4883 29.7293C13.4796 29.7143 13.4622 29.692 13.4485 29.6746L13.4274 29.646C13.4211 29.6373 13.4224 29.641 13.4199 29.6373L13.4087 29.6273C13.395 29.6136 13.3801 29.5987 13.3664 29.585C13.2469 29.4719 13.1087 29.3587 12.8474 29.2742C12.5823 29.1909 12.3296 29.1685 12.1118 29.1635C12.0023 29.1598 11.904 29.1536 11.8044 29.1598C11.7098 29.1635 11.6077 29.1598 11.5269 29.1672C11.3626 29.1747 11.2008 29.202 11.0041 29.2667C10.81 29.3339 10.5822 29.4458 10.3196 29.6733C10.0595 29.9058 9.89269 30.1247 9.76699 30.3174C9.64128 30.5114 9.55665 30.6793 9.47451 30.8496C9.39361 31.0212 9.32142 31.199 9.23554 31.4241C9.19323 31.5372 9.14718 31.6616 9.09864 31.8071C9.08619 31.8431 9.07374 31.8804 9.0613 31.919C9.04387 31.9737 9.02645 32.0296 9.00778 32.0868C8.95924 32.2572 8.90448 32.435 8.85594 32.6352C8.83727 32.7148 8.8186 32.7919 8.79993 32.8652C8.78251 32.9398 8.76882 33.0157 8.75513 33.0841C8.7265 33.2196 8.70534 33.3365 8.69165 33.421C8.67049 33.4932 8.65058 33.5703 8.62942 33.6337C8.60204 33.6809 8.5759 33.7282 8.55101 33.7729C8.53857 33.7953 8.52612 33.8177 8.51367 33.8401C8.50123 33.86 8.48878 33.8699 8.47634 33.8848C8.45145 33.9134 8.4278 33.9408 8.40415 33.9682C8.3581 34.0167 8.32076 34.044 8.28093 34.0801C8.24733 34.1037 8.21373 34.1298 8.1851 34.1485C8.15648 34.1659 8.13532 34.182 8.10296 34.197C8.06437 34.2144 7.98596 34.2343 7.92125 34.2405C7.88889 34.2442 7.85902 34.2442 7.84035 34.2442C7.82043 34.2442 7.81421 34.2442 7.80674 34.243L7.76318 34.2405C7.72086 34.2355 7.68228 34.2355 7.60387 34.2144C7.5852 34.2094 7.56902 34.2069 7.54911 34.2019C7.52297 34.1907 7.49684 34.1783 7.46946 34.1659C7.44207 34.1534 7.41469 34.141 7.38731 34.1286L7.36615 34.1186L7.33877 34.0938C7.3201 34.0763 7.30143 34.0602 7.28277 34.0428C7.24543 34.008 7.20685 33.9719 7.16702 33.9358L7.13715 33.9085C7.13715 33.9085 7.12719 33.901 7.12221 33.8923L7.10977 33.86C7.09234 33.8165 7.07492 33.7729 7.05749 33.7282C6.98655 33.5529 6.91188 33.3477 6.83222 33.196C6.79239 33.1127 6.75132 33.0281 6.71025 32.9398C6.70527 32.9299 6.70029 32.9162 6.69407 32.9088L6.64553 32.8491C6.62313 32.8217 6.60073 32.7944 6.57832 32.767C6.55592 32.7396 6.53227 32.711 6.50987 32.6824L6.47502 32.6389C6.46631 32.629 6.46382 32.629 6.4576 32.624C6.43644 32.6078 6.41528 32.5892 6.39288 32.5705C6.19623 32.4163 6.00456 32.3666 5.83281 32.3305C5.65358 32.3082 5.5005 32.302 5.33621 32.3169C5.17566 32.3306 4.99893 32.3529 4.79357 32.4064C4.58696 32.4561 4.348 32.532 4.06423 32.6899C3.78544 32.8528 3.60248 33.0157 3.45935 33.1637C3.31996 33.3166 3.21292 33.4459 3.12082 33.5926C3.02499 33.7344 2.93787 33.8886 2.84203 34.09C2.7462 34.2927 2.64041 34.5464 2.53711 34.9094C2.33673 35.6406 2.26578 36.036 2.18364 36.4264C2.10896 36.8194 2.04051 37.2198 2.03553 38.0417C2.03553 39.7315 2.00442 39.7328 2.00442 41.4251C2.00442 43.1186 2.05545 43.1186 2.05545 44.8122C2.05545 46.5058 2.09527 46.507 2.09527 48.2018C2.09527 49.8966 2.01935 49.8966 2.01935 51.5915C2.01935 52.8983 1.75799 52.7939 1.37092 52.7939C0.983846 52.7939 0.713768 52.8983 0.713768 51.5915L0.721235 51.5865Z",fill:"hsl(var(--text-100))"}),q.jsx("path",{d:"M27.8162 22.5869C28.1398 22.6678 28.309 22.6901 28.4733 22.72C28.6401 22.7436 28.8069 22.7722 29.1429 22.8095C29.4802 22.8443 29.652 22.8282 29.8225 22.8058C29.993 22.7871 30.1622 22.7623 30.4995 22.766C30.6688 22.7635 30.7957 22.7735 30.9015 22.7871C31.0073 22.7983 31.0932 22.8157 31.1791 22.8331C31.3508 22.8692 31.5251 22.8978 31.8673 22.868C32.2084 22.8331 32.3776 22.8058 32.5469 22.7797C32.6315 22.7672 32.7162 22.7523 32.8207 22.7324C32.9253 22.7113 33.0535 22.6939 33.2202 22.6578C33.5563 22.5907 33.7168 22.526 33.8774 22.4651C33.957 22.434 34.0379 22.4042 34.1375 22.3656C34.2371 22.3271 34.3603 22.2935 34.5208 22.24C34.8444 22.1393 35.0087 22.097 35.1755 22.056C35.2589 22.0373 35.341 22.015 35.4418 21.9801C35.5414 21.9453 35.6646 21.9068 35.8189 21.8359C36.1301 21.6991 36.2782 21.6158 36.4263 21.535C36.501 21.4952 36.5744 21.4542 36.6653 21.3995C36.7549 21.3447 36.8681 21.2875 37.0113 21.1993C37.1544 21.111 37.2602 21.0426 37.3436 20.9779C37.4257 20.912 37.488 20.8561 37.5514 20.7989C37.6149 20.7429 37.6771 20.687 37.7543 20.6161C37.8315 20.5452 37.931 20.4718 38.0592 20.3674C38.1887 20.2642 38.2845 20.1859 38.3654 20.1212C38.4451 20.0553 38.5073 20.0018 38.5708 19.9496C38.7002 19.8464 38.8209 19.7332 39.0512 19.497C39.1607 19.3739 39.2466 19.2856 39.32 19.2122C39.3885 19.1351 39.4457 19.0755 39.5042 19.017C39.6225 18.9001 39.7282 18.7733 39.9212 18.5022C40.1029 18.2138 40.1738 18.0558 40.2423 17.8992C40.3132 17.7425 40.3642 17.5784 40.5298 17.2849C40.6144 17.1394 40.6692 17.0263 40.7202 16.933C40.7712 16.841 40.8135 16.7689 40.8571 16.6955C40.8994 16.6222 40.9467 16.5513 40.9927 16.4568C41.0376 16.361 41.0873 16.2454 41.1496 16.09C41.2803 15.7791 41.3363 15.6224 41.4097 15.4682C41.4445 15.3911 41.4794 15.3141 41.5192 15.2158C41.5528 15.1163 41.5877 14.9945 41.63 14.8316C41.7196 14.5058 41.7022 14.3305 41.7009 14.1601C41.6984 14.0743 41.6972 13.9898 41.7009 13.8853C41.7009 13.7796 41.7059 13.6553 41.7258 13.4912C41.737 13.4091 41.7457 13.337 41.7544 13.2723C41.7594 13.2077 41.7656 13.1517 41.7719 13.0995C41.7843 12.9963 41.7968 12.9142 41.8105 12.8309C41.8428 12.6655 41.8503 12.4989 41.849 12.1657C41.8378 11.8324 41.8366 11.6645 41.8478 11.4954C41.8478 11.3276 41.8478 11.1572 41.798 10.824C41.732 10.4932 41.681 10.3316 41.6051 10.1762C41.5703 10.0978 41.5354 10.0207 41.4993 9.92249C41.4806 9.87275 41.4632 9.81804 41.4433 9.75587C41.4209 9.69494 41.3973 9.62531 41.3724 9.54448C41.3226 9.38532 41.2939 9.26222 41.2653 9.1615C41.2367 9.06078 41.2168 8.97872 41.1969 8.89665C41.177 8.81458 41.1595 8.73127 41.1272 8.63055C41.0923 8.53108 41.0475 8.41171 40.9828 8.25628C40.7015 7.64077 40.6505 7.66564 40.3219 7.07625C40.2348 6.93077 40.1763 6.81886 40.1315 6.72187C40.0854 6.62613 40.0493 6.54779 40.0157 6.46821C39.9821 6.38863 39.9473 6.30905 39.8975 6.2133C39.8465 6.1188 39.7755 6.01187 39.676 5.8726C39.2628 5.32797 39.1682 5.40382 38.7189 4.90023C38.4911 4.6503 38.389 4.51476 38.2882 4.3755C38.2385 4.30462 38.1874 4.23623 38.1152 4.15789C38.043 4.07956 37.9572 3.98506 37.8277 3.87563C37.6983 3.76621 37.6012 3.68539 37.5203 3.617C37.4382 3.55234 37.371 3.50011 37.305 3.44789C37.239 3.39442 37.1731 3.34344 37.0872 3.28375C37.0013 3.22531 36.9017 3.14573 36.7599 3.06118C36.4798 2.88088 36.3317 2.81622 36.1849 2.74037C36.0293 2.67447 35.8787 2.59738 35.5688 2.46433C35.4132 2.39842 35.2962 2.34869 35.1991 2.30765C35.1021 2.26662 35.0212 2.23926 34.9428 2.20818C34.8631 2.17834 34.7847 2.14849 34.6851 2.10995C34.5856 2.07264 34.4623 2.04031 34.3005 1.99182C33.6459 1.81525 33.6272 1.89732 32.9663 1.77795C32.2992 1.69464 32.3054 1.61381 31.6271 1.5877C31.2874 1.57651 31.1181 1.61257 30.9513 1.6449C30.8679 1.66231 30.7833 1.67474 30.68 1.69215C30.5755 1.7108 30.451 1.72821 30.283 1.74313C29.9482 1.7767 29.7864 1.83017 29.6233 1.86996C29.4628 1.92219 29.3022 1.96944 28.9761 2.04156C28.6525 2.12238 28.487 2.14725 28.3252 2.18828C28.1634 2.22807 27.9954 2.25419 27.683 2.3748C27.3669 2.48422 27.215 2.55759 27.0595 2.61727C26.9026 2.67571 26.752 2.75032 26.4508 2.89829C26.1546 3.05372 25.9978 3.11838 25.836 3.17433C25.6804 3.24148 25.5199 3.30489 25.2386 3.4939C24.966 3.69409 24.8254 3.78984 24.6997 3.90423C24.635 3.95894 24.5703 4.01365 24.4906 4.08204C24.4495 4.11562 24.4047 4.15292 24.3537 4.1952C24.3052 4.23996 24.2504 4.2897 24.1882 4.3469C24.0625 4.46005 23.9741 4.55082 23.9044 4.63165C23.8384 4.7162 23.7911 4.78708 23.7438 4.8592C23.6493 5.00219 23.5522 5.14021 23.3344 5.39512C23.1091 5.64256 22.9933 5.76442 22.8664 5.88006C22.8042 5.9385 22.7407 5.9957 22.6698 6.07404C22.6013 6.15486 22.5229 6.25558 22.4258 6.3936C22.3773 6.46323 22.335 6.52416 22.2976 6.57887C22.264 6.63607 22.2341 6.68581 22.2068 6.73182C22.1545 6.82383 22.1122 6.89844 22.0711 6.9718C22.0313 7.04641 21.9852 7.11853 21.9379 7.21303C21.8894 7.30753 21.8309 7.42068 21.7488 7.56865C21.7077 7.64202 21.6703 7.70668 21.638 7.76512C21.6081 7.82356 21.5795 7.87578 21.5546 7.92179C21.5023 8.01505 21.4575 8.08717 21.4127 8.16053C21.3679 8.2339 21.3206 8.30602 21.2721 8.40052C21.2248 8.49626 21.1713 8.61314 21.1065 8.77106C20.9709 9.08565 20.936 9.256 20.8887 9.42014C20.8427 9.58427 20.7966 9.74841 20.7045 10.0767C20.6572 10.2396 20.6162 10.3614 20.5801 10.4609C20.5465 10.5616 20.5191 10.6424 20.4917 10.7233C20.4631 10.8041 20.4357 10.8849 20.4046 10.9869C20.3735 11.0888 20.3386 11.2119 20.315 11.381C20.2042 12.0525 20.2801 12.0612 20.2291 12.7314C20.2092 13.4029 20.1893 13.4041 20.2316 14.0731C20.2714 14.4063 20.2826 14.573 20.3224 14.7359C20.3386 14.8179 20.3548 14.9 20.376 15.0019C20.3946 15.1052 20.4158 15.2283 20.4606 15.3887C20.5017 15.5503 20.5365 15.6709 20.5676 15.7704C20.6025 15.8686 20.6398 15.9445 20.6734 16.0216C20.7444 16.1733 20.8016 16.3287 20.931 16.6346C21.048 16.9454 21.1028 17.1021 21.1489 17.265C21.1737 17.3458 21.1949 17.4291 21.2335 17.5261C21.2758 17.6219 21.3318 17.735 21.414 17.8818C21.7612 18.4575 21.745 18.4687 22.147 19.012C22.4781 19.4112 22.3822 19.6263 22.0923 19.8849C21.8035 20.1423 21.5359 20.2381 21.1601 19.783C20.707 19.1712 20.7319 19.1538 20.3399 18.5047C20.2478 18.3381 20.1781 18.2138 20.1208 18.1106C20.0661 18.0049 20.0287 17.9178 19.9876 17.832C19.9092 17.6592 19.8209 17.4901 19.6852 17.1344C19.5383 16.7838 19.4662 16.6072 19.3815 16.4344C19.3404 16.3474 19.2969 16.2603 19.2546 16.1484C19.216 16.0352 19.1749 15.8972 19.1289 15.7107C19.1065 15.6174 19.0853 15.5366 19.0729 15.462C19.0617 15.3874 19.0542 15.3228 19.048 15.2631C19.0355 15.1437 19.0305 15.048 19.0268 14.951C19.0119 14.7595 19.0231 14.5667 18.9808 14.19C18.9322 13.4352 18.7617 13.4377 18.7841 12.6693C18.7841 12.4765 18.8115 12.3348 18.8215 12.2166C18.8364 12.0985 18.8476 12.0028 18.86 11.9083C18.8787 11.718 18.926 11.5327 18.9832 11.156C19.0094 10.967 19.0467 10.8302 19.0816 10.7158C19.1152 10.6014 19.145 10.5119 19.1749 10.4211C19.206 10.3316 19.2347 10.2408 19.2695 10.1289C19.3093 10.0182 19.3529 9.88394 19.4064 9.70364C19.4599 9.52334 19.4973 9.38781 19.5371 9.27714C19.5782 9.16772 19.6118 9.08068 19.6441 8.99239C19.7138 8.81831 19.7686 8.6405 19.9167 8.29607C19.9889 8.12323 20.0436 7.99391 20.0885 7.88573C20.1357 7.7788 20.1806 7.69673 20.2216 7.61217C20.2639 7.52886 20.305 7.44431 20.3573 7.33986C20.3834 7.28764 20.412 7.22919 20.4432 7.16329C20.478 7.09863 20.5178 7.02651 20.5626 6.94445C20.7419 6.61493 20.8402 6.45453 20.9522 6.30283C21.0057 6.22574 21.0592 6.14864 21.1252 6.05166C21.1576 6.00316 21.1924 5.94845 21.2335 5.88752C21.2758 5.82784 21.3231 5.76069 21.3779 5.6836C21.4837 5.52941 21.5633 5.41253 21.6305 5.31678C21.699 5.22228 21.755 5.14643 21.8097 5.06934C21.923 4.91888 22.0238 4.75972 22.2777 4.47995C22.4034 4.33944 22.493 4.23001 22.5739 4.14422C22.6548 4.05842 22.7195 3.99003 22.7843 3.92164C22.849 3.85325 22.9137 3.78486 22.9946 3.69906C23.0792 3.617 23.1838 3.52125 23.3244 3.39442C23.3941 3.33101 23.4551 3.27505 23.5086 3.22283C23.5634 3.17433 23.6119 3.13081 23.6555 3.08978C23.7414 3.00895 23.8086 2.93932 23.8745 2.87093C24.004 2.72918 24.1496 2.60484 24.4582 2.38102C24.7731 2.16714 24.9324 2.06145 25.088 1.9483C25.2498 1.84758 25.4079 1.73691 25.7464 1.5591C26.0899 1.38999 26.2629 1.30917 26.4434 1.24451C26.6238 1.17985 26.7968 1.10027 27.1578 0.974684C27.515 0.839149 27.7017 0.796872 27.8859 0.744647C28.0688 0.689936 28.2555 0.651389 28.6252 0.560618C28.9961 0.477307 29.1877 0.461143 29.3757 0.43503C29.5661 0.423839 29.754 0.400214 30.1311 0.361667C30.3203 0.345503 30.4609 0.330581 30.5792 0.318147C30.6974 0.304469 30.792 0.301982 30.8866 0.292035C31.0758 0.277113 31.2662 0.255975 31.6458 0.268409C31.7404 0.270896 31.8238 0.273383 31.8985 0.27587C31.9731 0.280844 32.0379 0.288304 32.0964 0.294521C32.2146 0.308199 32.3092 0.31939 32.4038 0.330581C32.5929 0.350476 32.7784 0.393997 33.1555 0.437517C33.9023 0.569322 33.906 0.556888 34.6403 0.753351C35.0062 0.856557 35.1892 0.907538 35.3734 0.958519C35.4655 0.984631 35.5588 1.00701 35.6721 1.04556C35.7841 1.08659 35.9173 1.13757 36.094 1.21094C36.272 1.28057 36.3952 1.35518 36.4997 1.41362C36.6031 1.4733 36.6839 1.52677 36.7636 1.579C36.8433 1.63246 36.9242 1.69464 37.0262 1.76054C37.1283 1.82644 37.2502 1.90478 37.412 2.01047C37.5776 2.10995 37.6971 2.18828 37.8053 2.24175C37.9136 2.29646 38.0045 2.33501 38.0916 2.37729C38.18 2.41832 38.2696 2.45935 38.3754 2.52028C38.4799 2.58245 38.5957 2.66825 38.7425 2.79135C38.8894 2.91445 38.9914 3.01517 39.0798 3.09475C39.1682 3.17558 39.2379 3.24023 39.3038 3.30862C39.4382 3.44416 39.5764 3.57472 39.8328 3.85574C40.1705 4.23374 40.492 4.6246 40.7973 5.0283C40.9081 5.18249 40.9915 5.29689 41.0612 5.39388C41.1272 5.49211 41.1794 5.57169 41.2317 5.65002C41.284 5.7296 41.3363 5.80794 41.401 5.90742C41.462 6.00938 41.5354 6.13124 41.6337 6.29413C41.8254 6.6224 41.8752 6.81264 41.9337 6.99418C41.981 7.18319 42.0357 7.36473 42.1876 7.70916C42.261 7.88324 42.3183 8.01256 42.3668 8.1195C42.4153 8.22768 42.4477 8.31596 42.485 8.403C42.5572 8.57833 42.6356 8.75117 42.7427 9.1155C42.7713 9.20627 42.7962 9.2846 42.8186 9.35548C42.8397 9.42635 42.8584 9.48977 42.8758 9.54573C42.9107 9.65888 42.9418 9.74965 42.9729 9.84042C43.0401 10.0207 43.0849 10.2072 43.1571 10.5828C43.2144 10.9608 43.2442 11.151 43.2778 11.34C43.2978 11.5303 43.3289 11.7217 43.3438 12.106C43.3438 12.4914 43.3077 12.6842 43.2442 12.8719C43.2156 12.9664 43.187 13.0597 43.1621 13.1778C43.1496 13.2363 43.1384 13.3009 43.1297 13.3743C43.1185 13.4476 43.1036 13.5297 43.0936 13.623C43.0712 13.8107 43.0588 13.9525 43.0513 14.0706C43.0401 14.1887 43.0314 14.2832 43.0227 14.3777C43.0028 14.5667 43.0015 14.762 42.902 15.1288C42.8547 15.3128 42.8223 15.4521 42.7974 15.569C42.7651 15.6834 42.7427 15.7754 42.719 15.8674C42.668 16.0502 42.6369 16.2429 42.49 16.5936C42.4178 16.7701 42.3643 16.9019 42.3195 17.0113C42.2722 17.1208 42.2249 17.2028 42.1838 17.2874C42.1415 17.3719 42.098 17.4565 42.0444 17.5622C41.9909 17.6679 41.9324 17.7972 41.8378 17.9613C41.6536 18.2909 41.5852 18.4687 41.5005 18.6378C41.4159 18.8069 41.3313 18.9772 41.1284 19.2956C40.9056 19.6126 40.7625 19.7519 40.6107 19.8775C40.536 19.9409 40.4613 20.0056 40.3754 20.0901C40.2858 20.1722 40.1825 20.2717 40.0543 20.4146C39.9249 20.5564 39.8241 20.6571 39.7457 20.7479C39.6673 20.8387 39.6038 20.9108 39.5378 20.9817C39.4731 21.0525 39.4084 21.1247 39.3237 21.2104C39.2379 21.295 39.1283 21.3883 38.9802 21.5101C38.8321 21.632 38.7164 21.7165 38.6255 21.7961C38.5347 21.8744 38.4625 21.9379 38.3878 22C38.3144 22.0622 38.2397 22.1244 38.1451 22.1977C38.0493 22.2711 37.9273 22.347 37.7643 22.4477C37.6012 22.5484 37.4718 22.6131 37.3685 22.6727C37.2639 22.7324 37.1805 22.7784 37.0947 22.8207C36.9242 22.909 36.7561 22.9985 36.4064 23.1515C36.2334 23.2323 36.0977 23.2795 35.9882 23.3255C35.8774 23.3703 35.7891 23.4064 35.6995 23.4375C35.5202 23.5021 35.3423 23.5705 34.9801 23.6824C34.7996 23.7433 34.659 23.767 34.542 23.7881C34.425 23.808 34.3292 23.8167 34.2321 23.8204C34.0404 23.8304 33.85 23.8441 33.4828 23.9174C33.2999 23.9585 33.1592 23.9746 33.0447 23.9933C32.929 24.0107 32.8356 24.0231 32.7423 24.0306C32.5556 24.0492 32.3702 24.0691 31.998 24.1077C31.6259 24.1412 31.4392 24.1686 31.2525 24.1885C31.1592 24.1984 31.0658 24.2096 30.9488 24.2196C30.8318 24.2258 30.69 24.2308 30.502 24.2333C30.1249 24.232 29.9357 24.2308 29.7478 24.2308C29.5586 24.2308 29.3682 24.2283 28.9911 24.1885C28.6127 24.1462 28.4273 24.0927 28.2431 24.0443C28.0589 23.9883 27.8747 23.9423 27.5038 23.8503C26.93 23.6998 27.0557 23.4561 27.1677 23.088C27.281 22.715 27.3208 22.4539 27.8162 22.5845V22.5869Z",fill:"hsl(var(--text-100))"}),q.jsx("path",{d:"M35.5078 17.1108C34.9813 16.6607 35.0448 16.5873 34.5183 16.136C33.9919 15.6846 34.0143 15.6597 33.4878 15.2084C32.9614 14.757 32.8966 14.8328 32.3702 14.3815C31.8437 13.9301 31.8163 13.9612 31.2899 13.5111C30.7634 13.0597 30.8617 12.9453 30.3352 12.4939C29.8088 12.0426 29.7777 12.0799 29.2512 11.6285C28.7247 11.1771 28.7135 11.1896 28.1871 10.7382C27.6594 10.2868 27.6992 10.2408 27.1715 9.78944C26.6438 9.33807 26.6039 9.38532 26.0762 8.93395C25.6867 8.60071 25.8173 8.34207 26.0538 8.06727C26.2903 7.79247 26.4932 7.66067 26.8827 7.99515C27.4092 8.44528 27.4901 8.35202 28.0166 8.80215C28.543 9.25352 28.4522 9.35921 28.9786 9.80934C29.5051 10.2607 29.4889 10.2794 30.0154 10.7295C30.5418 11.1809 30.6414 11.0652 31.1679 11.5166C31.6943 11.968 31.6197 12.0537 32.1474 12.5051C32.6738 12.9565 32.6664 12.9652 33.1928 13.4153C33.7193 13.8667 33.7305 13.8543 34.257 14.3056C34.7847 14.757 34.8531 14.6774 35.3796 15.1288C35.9073 15.5801 35.9272 15.5578 36.4537 16.0091C36.8433 16.3424 36.5794 16.6023 36.3429 16.8771C36.1065 17.1519 35.8986 17.4428 35.5103 17.1096L35.5078 17.1108Z",fill:"hsl(var(--text-100))"}),q.jsx("path",{d:"M26.5044 16.7216C26.9624 16.2019 27.0346 16.2653 27.4913 15.7443C27.9493 15.2233 27.9742 15.2457 28.4323 14.7259C28.8903 14.2049 28.8156 14.1402 29.2724 13.6192C29.7304 13.0982 29.6993 13.0721 30.1573 12.5511C30.6153 12.0301 30.7285 12.1296 31.1866 11.6086C31.6446 11.0876 31.6085 11.0565 32.0652 10.5367C32.5233 10.0157 32.5108 10.0046 32.9688 9.48355C33.4268 8.96255 33.4729 9.00234 33.9309 8.48134C34.3889 7.96034 34.3416 7.91806 34.7996 7.39706C35.1382 7.01159 35.3945 7.14588 35.6671 7.38462C35.9397 7.62337 36.0679 7.82853 35.7293 8.21276C35.2713 8.73252 35.3647 8.81458 34.9079 9.33558C34.4499 9.85659 34.3453 9.76457 33.8873 10.2843C33.4293 10.8053 33.4107 10.7892 32.9539 11.3089C32.4959 11.8299 32.6104 11.9294 32.1524 12.4504C31.6943 12.9714 31.6085 12.8956 31.1505 13.4166C30.6924 13.9376 30.6837 13.9289 30.227 14.4499C29.769 14.9709 29.7814 14.9821 29.3234 15.5018C28.8654 16.0228 28.9438 16.0924 28.4858 16.6134C28.0278 17.1345 28.0502 17.1543 27.5921 17.6766C27.2536 18.0621 26.9972 17.7947 26.7247 17.556C26.4521 17.3172 26.1646 17.1059 26.5031 16.7204L26.5044 16.7216Z",fill:"hsl(var(--text-100))"})]}),TE=({isMainTabBlocked:e=!0,category:t})=>{const n=Je(),i=s();return q.jsx("div",{className:"flex flex-col items-center justify-center h-screen bg-bg-100 p-8",children:q.jsxs("div",{className:"max-w-md text-center",children:[q.jsx("div",{className:"flex items-center justify-center mx-auto",children:e?q.jsx("img",{src:n?"/assets/darkshield-C5QZAT-q.svg":"/assets/lightshield-Dx3kyqnQ.svg",alt:i.formatMessage({defaultMessage:"Shield",id:"ivOuJVNgF2"}),className:"w-12 h-12"}):q.jsx(NE,{})}),q.jsx("h2",{className:"font-large-bold text-text-100 mt-[22px]",children:e?i.formatMessage({defaultMessage:"Can't access this page",id:"5mDrlUu7+N"}):i.formatMessage({defaultMessage:"Workflow stopped",id:"j1niUi0cRv"})}),q.jsx("p",{className:"font-base text-text-300 mt-[7px]",children:"category_org_blocked"===t?i.formatMessage({defaultMessage:"This site is blocked by your organization's policy.",id:"Rc2RmGjQRw"}):e?i.formatMessage({defaultMessage:"Claude cannot assist with the content on this page.",id:"WDCnAlgy2l"}):i.formatMessage({defaultMessage:"Claude landed on a blocked site and can't complete your request.",id:"hGdb967wOL"})}),!e&&q.jsx("button",{onClick:async()=>{try{const t=new URLSearchParams(window.location.search).get("tabId");if(!t)return;const n=parseInt(t);await ge.initialize();const s=await ge.getBlockedTabsInfo(n);for(const r of s.blockedTabs)if(r.tabId!==n)try{await chrome.tabs.remove(r.tabId)}catch(e){}}catch(e){}},className:"mt-[14px] px-[14px] py-2 border border-border-300 text-text-200 rounded-[6px] hover:bg-bg-200 transition-colors font-ui font-medium text-[14px]",children:q.jsx(r,{defaultMessage:"Close blocked site",id:"OarD7TkDBO"})})]})})},EE=({isOpen:e,onClose:t,onConfirm:n})=>{if(!e)return null;return q.jsx("div",{className:"w-full h-screen bg-bg-100 flex items-center justify-center p-5 absolute inset-0 z-50",children:q.jsxs("div",{className:"max-w-[520px] w-full",children:[q.jsx("div",{className:"flex justify-start mb-4",children:q.jsx(NE,{})}),q.jsx("h2",{className:"text-text-100 font-ui font-medium text-[20px] leading-[140%] mb-4",children:q.jsx(r,{defaultMessage:"Skip all permissions across the internet?",id:"DcOPulvEDu"})}),q.jsxs("div",{className:"bg-danger-900 border-[0.5px] border-danger-200 rounded-lg p-4 mb-4",children:[q.jsxs("h3",{className:"text-[14px] font-ui font-medium text-danger-000 leading-[140%] mb-2.5 flex items-center gap-1",children:[q.jsx(v,{size:16,className:"text-danger-000"}),q.jsx(r,{defaultMessage:"WARNING",id:"RIrR6dJyeb"})]}),q.jsxs("ul",{className:"text-[14px] font-ui font-normal text-danger-000 leading-[140%] ml-4 list-disc space-y-2",children:[q.jsx("li",{children:q.jsx(r,{defaultMessage:"This allows Claude to take any action on the internet.",id:"2yTW8KQyIr"})}),q.jsx("li",{children:q.jsx(r,{defaultMessage:"This mode puts your data and the data of others at risk from malicious code.",id:"xeH1mSU1MS"})}),q.jsx("li",{children:q.jsx(r,{defaultMessage:"You should oversee Claude when it is in this mode. You are fully responsible for all risks associated with permission-less Claude.",id:"1cBbdp1n7Q"})}),q.jsx("li",{children:q.jsx(r,{defaultMessage:"Review {risksLink} before you begin.",id:"fOUfZ3Wftl",values:{risksLink:q.jsx("button",{onClick:()=>chrome.tabs.create({url:ku}),className:"text-danger-000 inline-link hover:no-underline focus:outline-none",children:q.jsx(r,{defaultMessage:"risks",id:"BfcxKxig7S"})})}})})]})]}),q.jsxs("div",{className:"flex justify-end gap-3",children:[q.jsx("button",{onClick:t,className:"px-[14px] py-2 border border-border-300 text-text-200 rounded-[14px] hover:bg-bg-200 transition-colors font-ui font-medium text-[14px]",children:q.jsx(r,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),q.jsx("button",{onClick:async()=>{await n(),t()},className:"px-[14px] py-2 bg-text-100 text-bg-100 rounded-[14px] hover:bg-text-200 transition-colors font-ui font-medium text-[14px]",children:q.jsx(r,{defaultMessage:"Skip permissions",id:"c0/oTKLaf+"})})]})]})})},jE=({isOpen:e,onClose:t})=>{if(!e)return null;return q.jsx("div",{className:"w-full h-screen bg-bg-100 flex items-center justify-center p-5 absolute inset-0 z-50",children:q.jsxs("div",{className:"max-w-[520px] w-full",children:[q.jsx("h1",{className:"text-center text-text-000 mb-3",style:{fontFamily:"Anthropic Sans, var(--font-ui-serif)",fontSize:"26px",fontWeight:500,lineHeight:"140%"},children:q.jsx(r,{defaultMessage:"Test the newest{br}Claude experience",id:"kDcz4TuVQh",values:{br:q.jsx("br",{})}})}),q.jsx("p",{className:"text-center text-text-300 mb-[22px] px-4",style:{fontSize:"14px",lineHeight:"140%"},children:q.jsx(r,{defaultMessage:"Please help us Antfood the latest version of Claude. Your testing accelerates our development.",id:"wLZuGWqTtQ"})}),q.jsxs("div",{className:"border border-border-300 rounded-[24px] mb-[22px]",children:[q.jsxs("div",{className:"flex gap-3 pt-5 pb-4 px-4",children:[q.jsx("div",{className:"mt-0.5",children:q.jsx(ms,{size:20,className:"text-text-100"})}),q.jsxs("div",{className:"flex-1",children:[q.jsx("h3",{className:"text-[14px] text-text-100 font-medium mb-1",children:q.jsx(r,{defaultMessage:"Step 1: Download the Ant-only version",id:"MMLgwunXx4"})}),q.jsx("p",{className:"text-[12px] text-text-300 leading-[140%]",children:q.jsx(r,{defaultMessage:"Click below to get the latest internal build from the Chrome Web Store.",id:"s5uJOAoEr4"})})]})]}),q.jsx("div",{className:"border-t-[0.5px] border-border-300 px-4"}),q.jsxs("div",{className:"flex gap-3 pt-4 pb-5 px-4",children:[q.jsx("div",{className:"mt-0.5",children:q.jsx(fn,{size:20,className:"text-text-100"})}),q.jsxs("div",{className:"flex-1",children:[q.jsx("h3",{className:"text-[14px] text-text-100 font-medium mb-1",children:q.jsx(r,{defaultMessage:"Step 2: Remove this extension",id:"xFdRKGza1P"})}),q.jsx("p",{className:"text-[12px] text-text-300 leading-[140%]",children:q.jsx(r,{defaultMessage:"Uninstall this version after installing the new one to avoid conflicts.",id:"Iu0/PCYXfB"})})]})]})]}),q.jsxs("div",{className:"flex flex-col gap-3",children:[q.jsx("button",{onClick:()=>{window.open("https://chromewebstore.google.com/detail/claude/dngcpimnedloihjnnfngkgjoidhnaolf","_blank")},className:"w-full px-4 py-2.5 rounded-[14px] bg-text-100 hover:bg-text-200 active:bg-text-000 text-bg-100 font-button transition-all hover:shadow-md",children:q.jsx(r,{defaultMessage:"Get the Ant-only extension",id:"O+2FnUTQ6S"})}),q.jsx("button",{onClick:t,className:"w-full px-4 py-2.5 rounded-[14px] bg-transparent hover:bg-bg-200 text-text-300 hover:text-text-100 font-button transition-colors",children:q.jsx(r,{defaultMessage:"Later",id:"uQDRsYlg+S"})})]})]})})},AE=[{value:"ui_bug",label:"UI bug"},{value:"incorrect_assumptions",label:"Made incorrect assumptions"},{value:"incomplete_request",label:"Incomplete request"},{value:"too_much_input",label:"Asked for too much input"},{value:"ui_misunderstanding",label:"Didn't understand the UI"},{value:"unauthorized_action",label:"Did something it shouldn't have done"},{value:"navigation_error",label:"Navigation, clicking, typing, scrolling error"},{value:"report_content",label:"Report content"},{value:"other",label:"Other"}],IE=({onClose:e,onSubmit:t,feedbackType:n,message:i,hardcodedType:o=null,messageId:a=null})=>{const l=s(),[c,u]=U.useState(""),[h,p]=U.useState(""),[m,f]=U.useState(!1);return q.jsxs("div",{className:"bg-bg-000 rounded-[14px]",children:[q.jsxs("div",{className:"flex items-center justify-between py-[10px] px-4",children:[q.jsxs("div",{className:"flex items-center gap-2",children:["positive"===n?q.jsx(vs,{size:20,className:"text-text-100"}):q.jsx(ws,{size:20,className:"text-text-100"}),q.jsx("h3",{className:"font-ui text-[14px] font-normal leading-[140%] text-text-100",children:q.jsx(r,{defaultMessage:"Share {feedbackType} feedback",id:"xUedNbOuGK",values:{feedbackType:n}})})]}),q.jsx("button",{onClick:e,className:"p-1 text-text-300 hover:bg-bg-100 rounded transition-colors","aria-label":l.formatMessage({defaultMessage:"Close",id:"rbrahOGMC3"}),children:q.jsx(ri,{size:16})})]}),q.jsx("div",{className:"border-t border-border-300 mb-4"}),q.jsxs("div",{className:"space-y-4 px-4",children:["negative"===n&&q.jsxs(q.Fragment,{children:[!o&&q.jsxs("div",{children:[q.jsx("p",{className:"font-base-bold text-text-100 mb-2",children:q.jsx(r,{defaultMessage:"What type of issue do you wish to report? (optional)",id:"IFWIi9rs1t"})}),q.jsxs("div",{className:"relative",children:[q.jsxs("select",{value:c,onChange:e=>u(e.target.value),className:"w-full h-10 px-3 bg-bg-100 border border-border-200 rounded-lg text-text-100 text-sm font-normal font-ui leading-tight focus:outline-none focus:ring-2 focus:ring-accent-main-200 focus:border-transparent appearance-none",children:[q.jsx("option",{value:"",children:l.formatMessage({defaultMessage:"Select",id:"kQAf2d9u+x"})}),AE.map(e=>q.jsx("option",{value:e.value,children:e.label},e.value))]}),q.jsx(d,{className:"absolute right-3 top-3 w-4 h-4 text-text-300 pointer-events-none"})]})]}),"report_content"===c?q.jsx("div",{className:"p-4 bg-bg-100 border border-border-200 rounded-lg",children:q.jsx("p",{className:"text-sm font-normal font-ui text-text-100",children:q.jsx(r,{defaultMessage:"Please use this <link>form</link> to report violative content.",id:"QSjqvNNsUq",values:{link:e=>q.jsx("a",{href:"https://docs.google.com/forms/d/e/1FAIpQLSeO9Hzkyf_hQ2fYkfP_cqAcJG5kdlkg1wF4drQEFK9Z6db7jg/viewform",target:"_blank",rel:"noopener noreferrer",className:"inline-link cursor-pointer hover:text-text-200",children:e})}})})}):q.jsxs("div",{children:[q.jsx("p",{className:"font-base-bold text-text-100 mb-2",children:q.jsx(r,{defaultMessage:"Please provide details: (optional)",id:"og1W/bIZdx"})}),q.jsx("textarea",{value:h,onChange:e=>p(e.target.value),placeholder:l.formatMessage({defaultMessage:"What was unsatisfying about this response?",id:"+DB/t6WTki"}),className:"w-full h-28 p-3 bg-bg-100 border border-border-200 rounded-lg text-text-100 placeholder-text-400 text-sm font-normal font-ui leading-tight resize-none focus:outline-none focus:ring-2 focus:ring-accent-main-200 focus:border-transparent"})]})]}),"positive"===n&&q.jsx(q.Fragment,{children:q.jsxs("div",{children:[q.jsx("p",{className:"font-base-bold text-text-100 mb-2",children:q.jsx(r,{defaultMessage:"Please provide details: (optional)",id:"og1W/bIZdx"})}),q.jsx("textarea",{value:h,onChange:e=>p(e.target.value),placeholder:l.formatMessage({defaultMessage:"What was satisfying about this response?",id:"yJFWG3mK1I"}),className:"w-full h-28 p-3 bg-bg-100 border border-border-200 rounded-lg text-text-100 placeholder-text-400 text-sm font-normal font-ui leading-tight resize-none focus:outline-none focus:ring-2 focus:ring-accent-main-200 focus:border-transparent"})]})}),"report_content"!==c&&q.jsx("div",{className:"text-text-300",children:q.jsx("p",{className:"text-xs font-small font-ui",children:q.jsx(r,{defaultMessage:"Submitting this report will send the entire current conversation to Anthropic for future improvements to our models. <link>Learn more</link>",id:"04w/1piSXb",values:{link:e=>q.jsx("a",{href:"https://support.claude.com/en/articles/10023548-how-long-do-you-store-my-data",target:"_blank",rel:"noopener noreferrer",className:"inline-link cursor-pointer hover:text-text-200",children:e})}})})})]}),q.jsx("div",{className:"px-3 py-[10px] space-y-[5px] mt-[10px] mb-0.5",children:q.jsxs("div",{className:"flex justify-end gap-2",children:[q.jsx("button",{onClick:e,className:"h-8 min-w-20 px-3.5 py-[3px] rounded-lg outline outline-[0.50px] outline-offset-[-0.50px] outline-border-200/30 flex justify-center items-center gap-2 overflow-hidden hover:bg-bg-100 transition-colors",children:q.jsx("div",{className:"flex-1 text-center justify-start text-text-100 text-sm font-medium font-ui leading-tight",children:q.jsx(r,{defaultMessage:"Cancel",id:"47FYwba+bI"})})}),"report_content"!==c&&q.jsx("button",{onClick:()=>{f(!0);try{t({thumbs:n,type:o||c,message:h,messageId:a||i?.id||"unknown"})}finally{f(!1),e()}},className:"h-8 min-w-20 px-3.5 py-[3px] bg-text-100 rounded-lg flex justify-center items-center gap-2 overflow-hidden hover:bg-text-200 transition-colors",children:q.jsx("div",{className:"flex-1 text-center justify-start text-bg-100 text-sm font-medium font-ui leading-tight",children:m?q.jsx(r,{defaultMessage:"Submitting...",id:"txkW56MpkQ"}):q.jsx(r,{defaultMessage:"Submit",id:"wSZR47Y5kj"})})})]})})]})},OE=({strokeColor:e,strokeWidth:t=2,dashLength:n=10,gapLength:s=10,borderRadius:r=16})=>{const i=U.useRef(null),[o,a]=U.useState({width:0,height:0});U.useEffect(()=>{const e=()=>{if(i.current){const e=i.current.getBoundingClientRect();a({width:e.width,height:e.height})}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const{width:l,height:c}=o,d=Math.min(r,Math.min(l,c)/2),u=2*(l+c-4*d)+2*Math.PI*d,h=n+s,p=u/Math.round(u/h),m=n/h*p,f=p-m;return q.jsx("div",{ref:i,className:"absolute inset-0 pointer-events-none overflow-hidden",style:{zIndex:41},children:o.width>0&&o.height>0&&q.jsx("svg",{width:o.width,height:o.height,style:{position:"absolute",top:0,left:0,overflow:"hidden"},children:q.jsx("rect",{x:t/2,y:t/2,width:o.width-t,height:o.height-t,rx:d,ry:d,fill:"none",stroke:e,strokeWidth:t,strokeDasharray:`${m} ${f}`,strokeDashoffset:m/2,pathLength:u})})})},LE=({isActive:e})=>q.jsx(Xt,{children:e&&q.jsxs(Qt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeOut"},className:"absolute inset-0 pointer-events-none z-[60]",children:[q.jsx("div",{className:"absolute inset-0",style:{border:"2px solid #F7CE46",borderRadius:"16px",boxSizing:"border-box"}}),q.jsx(OE,{strokeColor:"#31290E",strokeWidth:2,dashLength:9,gapLength:9,borderRadius:16})]})});function DE({messages:e,isAgentRunning:t,currentUrl:n,createAnthropicMessage:s}){const[r,i]=U.useState(!1),[o,a]=U.useState(null),[l,c]=U.useState(!1);return{isConvertingToTask:r,conversionError:o,showConversionError:l,handleConvertToScheduledTask:async()=>{if(!r){if(t)return c(!0),void a("Please wait for Claude to finish before creating a scheduled task.");if(0===e.length)return c(!0),void a("Start a conversation first to create a scheduled task from it. The scheduled task feature converts your chat history into an automated task that can run on a schedule.");i(!0),a(null),c(!1);try{const t="Convert our conversation into a scheduled task that could recreate the actions we performed.\n\nIMPORTANT: Even if the original conversation wasn't about scheduling, your job is to create a scheduled task that would REPRODUCE the same actions that were performed.\n\nFor example:\n- If the user asked \"What do you see?\" and you took a screenshot, create a task that takes screenshots\n- If the user asked to fill out a form, create a task that fills out that same form\n- If the user asked to check something on a page, create a task that checks the same thing\n\nExtract and infer from our conversation:\n- A concise title describing what the task does (max 50 characters)\n- A detailed prompt that would recreate the same actions (be specific about what was done)\n- The most sensible frequency (once/daily/weekly/monthly/annually) - default to 'once' if unclear\n- The starting URL from the conversation (or the current page URL if actions were performed)\n- A reasonable time (use current time + 1 hour for 'once', or 09:00 for recurring)\n\nCRITICAL: If the conversation involved corrections, refinements, or multiple attempts to get something right, incorporate those lessons into the task prompt so it will succeed correctly on the first try. Don't replicate the mistakes - preserve the final working approach.\n\nThe scheduled task should be written as if instructing someone to repeat exactly what was done in this conversation.\n\nFormat your response ONLY as XML with no other text or explanation:\n<scheduled_task>\n  <title>...</title>\n  <prompt>...</prompt>\n  <frequency>once|daily|weekly|monthly|annually</frequency>\n  <url>...</url>\n  <datetime>...</datetime>\n</scheduled_task>",r=function(e){const t=[];for(const n of e)!n.content||"string"==typeof n.content&&""===n.content.trim()||Array.isArray(n.content)&&0===n.content.length||!("role"in n)||"user"!==n.role&&"assistant"!==n.role||t.push({role:n.role,content:n.content});t.length>0&&"assistant"===t[0].role&&t.unshift({role:"user",content:"Continue the conversation."});return t}(e);r.push({role:"user",content:t});const i=function(e){if(!e.content||0===e.content.length)throw new Error("No content in API response");const t=e.content.filter(e=>"text"===e.type);if(0===t.length)throw new Error("No text content in API response");return t.map(e=>"text"===e.type?e.text:"").join("\n")}(await s({maxTokens:2e3,messages:r,system:[{type:"text",text:"You are a helpful AI assistant tasked with converting browser automation conversations into scheduled tasks."}],modelClass:"small_fast"},void 0,"convert_conversation_to_scheduled_task")),o=i.match(/<scheduled_task>([\s\S]*?)<\/scheduled_task>/);if(!o)throw new Error("Could not parse the task configuration");const l=o[1],d=e=>{const t=l.match(new RegExp(`<${e}>([\\s\\S]*?)<\\/${e}>`));return t?t[1].trim():""},u=d("title"),h=d("prompt"),p=d("frequency"),m=d("url")||n||"",f=d("datetime"),g={command:(e=>e.toLowerCase().trim().replace(/\s+/g,"-").replace(/[^a-z0-9-_]/g,"").replace(/-+/g,"-").replace(/^-|-$/g,""))(u||"converted-task"),prompt:h||"Task converted from chat",url:m,createdAt:Date.now(),usageCount:0,repeatType:p||"once"},y=(new Date).toISOString().split("T")[0];if("once"===p&&f){const e=f.match(/^(\d{4}-\d{2}-\d{2})/);if(e){const t=e[1];g.specificDate=t>=y?t:""}const t=f.match(/(\d{1,2}):(\d{2})/);t&&(g.specificTime=`${t[1].padStart(2,"0")}:${t[2]}`)}else if("daily"===p&&f){const e=f.match(/(\d{1,2}):(\d{2})/);e&&(g.specificTime=`${e[1].padStart(2,"0")}:${e[2]}`)}else if("weekly"===p&&f){g.dayOfWeek=1;const e=f.match(/(\d{1,2}):(\d{2})/);e&&(g.specificTime=`${e[1].padStart(2,"0")}:${e[2]}`)}else if("monthly"===p&&f){g.dayOfMonth=1;const e=f.match(/(\d{1,2}):(\d{2})/);e&&(g.specificTime=`${e[1].padStart(2,"0")}:${e[2]}`)}else if("annually"===p&&f){g.monthAndDay="1-1";const e=f.match(/(\d{1,2}):(\d{2})/);e&&(g.specificTime=`${e[1].padStart(2,"0")}:${e[2]}`)}await K(G.PENDING_SCHEDULED_TASK,g),await new Promise((e,t)=>{chrome.runtime.sendMessage({type:"OPEN_OPTIONS_WITH_TASK",task:g},n=>{chrome.runtime.lastError?t(new Error(`Failed to open options page: ${chrome.runtime.lastError.message}`)):n?.success?e():t(new Error(n?.error||"Failed to open options page"))})}),c(!1),a(null)}catch(o){c(!0),a("Failed to create scheduled task. Please try again.")}finally{i(!1)}}}}}function RE({prompt:e,onClose:t,onSave:o,onDelete:a,sessionId:l,generateName:c,currentModel:d}){const u=s(),{analytics:h}=b(),p=Je(),m=!(!e||!("id"in e)),g=m?e:null,y=g?.prompt||(e&&!("id"in e)?e.prompt:"")||"",x=g?.command||(e&&!("id"in e)?e.command:"")||"",[w,v]=U.useState(x),[E,j]=U.useState(y),[A,I]=U.useState(""),[O,L]=U.useState(!1),[D,R]=U.useState(!1),[_,P]=U.useState(!1),[V,H]=U.useState(!1),[$,z]=U.useState(!1),[F,B]=U.useState(!1),[W,Z]=U.useState(!1),J=U.useRef(null),G=U.useRef(null),K=U.useRef(!1),Y=U.useRef(!1),[X,ee]=U.useState(Boolean(g?.repeatType&&"none"!==g.repeatType)),[te,ne]=U.useState(g?.repeatType&&"none"!==g.repeatType?g.repeatType:"once"),[se,re]=U.useState(g?.specificTime||"09:00"),[ie,oe]=U.useState(g?.dayOfWeek??0),[ae,le]=U.useState(g?.dayOfMonth||1),[ce,de]=U.useState(g?.monthAndDay&&parseInt(g.monthAndDay.split("-")[0])||1),[ue,he]=U.useState(g?.monthAndDay&&parseInt(g.monthAndDay.split("-")[1])||1),[pe,me]=U.useState(()=>{const e=g?.specificDate;if(!e)return"";return e>=(new Date).toISOString().split("T")[0]?e:""}),[fe,ge]=U.useState(g?.url||""),ye=n.useDynamicConfig("chrome_ext_models"),xe=ye.value,[Ce,be]=U.useState(g?.model||d||ye.get("default")||"claude-sonnet-4-5-20250929"),we=[u.formatMessage({defaultMessage:"Sunday",id:"mJR06Pgp0X"}),u.formatMessage({defaultMessage:"Monday",id:"azMsfMtNvt"}),u.formatMessage({defaultMessage:"Tuesday",id:"YAgYL60fLm"}),u.formatMessage({defaultMessage:"Wednesday",id:"lxblglMBAV"}),u.formatMessage({defaultMessage:"Thursday",id:"qAhUUOIWbF"}),u.formatMessage({defaultMessage:"Friday",id:"QrihTZnk0x"}),u.formatMessage({defaultMessage:"Saturday",id:"WMNHPhDie+"})],ve=[u.formatMessage({defaultMessage:"January",id:"t8QlFE5KKF"}),u.formatMessage({defaultMessage:"February",id:"0TR0PDvKax"}),u.formatMessage({defaultMessage:"March",id:"T5W0CVKXi6"}),u.formatMessage({defaultMessage:"April",id:"h7xti1PjS7"}),u.formatMessage({defaultMessage:"May",id:"zUpHdfwzIp"}),u.formatMessage({defaultMessage:"June",id:"xBaHKeE0uO"}),u.formatMessage({defaultMessage:"July",id:"NGWumBAsap"}),u.formatMessage({defaultMessage:"August",id:"lINtN6vYsg"}),u.formatMessage({defaultMessage:"September",id:"TFf5u+qBgM"}),u.formatMessage({defaultMessage:"October",id:"EuK7yRq90M"}),u.formatMessage({defaultMessage:"November",id:"pn+jQDsOvh"}),u.formatMessage({defaultMessage:"December",id:"SsiZK7n81x"})],ke=U.useCallback(()=>{H(!0),P(!1),setTimeout(()=>{t()},200)},[t]),Me=U.useCallback(async()=>{if(E&&c&&!m&&!Y.current){Z(!0),Y.current=!0;try{const e=await c(E);e&&!w&&v(e)}catch(e){}finally{Z(!1),K.current||setTimeout(()=>{J.current?.focus(),J.current?.select(),K.current=!0},100)}}},[E,c,w,m]);U.useEffect(()=>{setTimeout(()=>{P(!0)},10),!m&&!x&&y&&c?Me():K.current||setTimeout(()=>{J.current?.focus(),K.current=!0},50),m||chrome.tabs.query({active:!0,currentWindow:!0},e=>{if(e[0]?.url)try{const t=e[0].url;t&&t.startsWith("http")&&ge(t)}catch{}})},[m,x,y,c,Me]),U.useEffect(()=>{const e=e=>{G.current&&!G.current.contains(e.target)&&B(!1)};if(F)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[F]);const Se=U.useCallback(async()=>{if(z(!0),w.trim()&&E.trim()){L(!0),I("");try{if(m&&g){const e={prompt:E.trim(),command:w.trim(),url:fe.trim()||void 0};X?(e.repeatType=te,e.specificTime=se,e.model=Ce,"once"===te?e.specificDate=pe:"weekly"===te?e.dayOfWeek=ie:"monthly"===te?e.dayOfMonth=ae:"annually"===te&&(e.monthAndDay=`${ce}-${ue}`)):(e.repeatType="none",e.specificTime=void 0,e.dayOfWeek=void 0,e.dayOfMonth=void 0,e.monthAndDay=void 0,e.specificDate=void 0,e.model=void 0),await Q.updatePrompt(g.id,e),h?.track("claude_chrome.chat.shortcut_updated",{sessionId:l||"",commandName:w.trim(),oldCommandName:g.command||""}),window.dispatchEvent(new Event("prompts-changed"))}else{const e={prompt:E.trim(),command:w.trim(),url:fe.trim()||void 0,createdAt:Date.now(),usageCount:0};X&&(e.repeatType=te,e.specificTime=se,e.model=Ce,"once"===te?e.specificDate=pe:"weekly"===te?e.dayOfWeek=ie:"monthly"===te?e.dayOfMonth=ae:"annually"===te&&(e.monthAndDay=`${ce}-${ue}`)),await Q.savePrompt(e),h?.track("claude_chrome.chat.shortcut_created",{sessionId:l||"",commandName:w.trim()}),window.dispatchEvent(new Event("prompts-changed"))}o(w.trim()),ke()}catch(e){I(e instanceof Error?e.message:"Failed to save"),L(!1)}}},[w,E,h,l,o,ke,m,g,X,te,se,pe,ie,ae,ce,ue,fe,Ce]);U.useEffect(()=>{const e=e=>{if("Escape"===e.key)ke();else if("Enter"===e.key){const t=document.activeElement;"INPUT"===t?.tagName||"TEXTAREA"===t?.tagName||O||D||(e.preventDefault(),Se())}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[ke,Se,O,D]);return q.jsxs(q.Fragment,{children:[q.jsx("div",{className:"fixed inset-0 z-40 transition-opacity duration-200 "+(_&&!V?"bg-black/20":"bg-black/0"),onClick:()=>ke()}),q.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-bg-000 border-t-[0.5px] border-border-300 rounded-t-2xl shadow-xl transition-transform duration-200 ease-out "+(_&&!V?"translate-y-0":"translate-y-full"),children:q.jsxs("div",{className:"px-4 pb-4 pt-4",children:[q.jsxs("div",{className:"flex items-center justify-between mb-4",children:[q.jsx("h3",{className:"font-large-bold text-text-000",children:m?q.jsx(r,{defaultMessage:"Edit shortcut",id:"R592aOW18A"}):q.jsx(r,{defaultMessage:"Create shortcut",id:"AzO4h7b149"})}),q.jsxs("div",{className:"flex items-center gap-2",children:[m&&q.jsxs("div",{className:"relative",ref:G,children:[q.jsx("button",{onClick:()=>B(!F),className:"p-1 hover:bg-bg-200 rounded transition-colors","aria-label":u.formatMessage({defaultMessage:"More options",id:"IzCVhGdYVc"}),children:q.jsx(k,{size:16,className:"text-text-300"})}),F&&q.jsx("div",{className:"absolute right-0 top-full mt-2 bg-bg-000 border-0.5 border-border-200 rounded-xl backdrop-blur-xl shadow-[0px_2px_8px_0px_hsl(var(--always-black)/8%)] dark:shadow-[0px_2px_8px_0px_hsl(var(--always-black)/24%)] p-1.5 min-w-[120px] z-dropdown",children:q.jsxs("button",{onClick:()=>{B(!1),(async()=>{if(m&&g){R(!0);try{await Q.deletePrompt(g.id),h?.track("claude_chrome.chat.shortcut_deleted",{sessionId:l||"",commandName:g.command||""}),window.dispatchEvent(new Event("prompts-changed")),a?.(),ke()}catch(e){I(e instanceof Error?e.message:"Failed to delete prompt"),R(!1)}}})()},disabled:D,className:"w-full px-2 py-2 text-left rounded-lg hover:bg-bg-200 flex items-center gap-2 text-danger-100 hover:text-danger-000 transition-colors",children:[D?q.jsx("div",{className:"w-4 h-4 border-2 border-danger-100 border-t-transparent rounded-full animate-spin"}):q.jsx(C,{size:16}),q.jsx("span",{className:"text-sm",children:q.jsx(r,{defaultMessage:"Delete",id:"K3r6DQW7h+"})})]})})]}),q.jsx("button",{onClick:()=>ke(),className:"p-1 hover:bg-bg-200 rounded transition-colors","aria-label":u.formatMessage({defaultMessage:"Close",id:"rbrahOGMC3"}),children:q.jsx(f,{size:16,className:"text-text-300"})})]})]}),q.jsxs("div",{className:"space-y-4",children:[q.jsxs("div",{className:"relative",children:[q.jsx(M,{ref:J,label:u.formatMessage({defaultMessage:"Name",id:"HAlOn1ZsuY"}),type:"text",value:w,onChange:e=>{const t=e.target.value.replace(/\s/g,"-").replace(/[^a-zA-Z0-9-_]/g,"");v(t),A&&I("")},prepend:q.jsx("span",{className:"text-text-300",children:"/"}),placeholder:W?"":u.formatMessage({defaultMessage:"e.g., summarize",id:"3jVWWj+aj4"}),disabled:W,className:"w-full text-sm",error:$&&!w.trim()||A?.includes("already in use")}),($&&!w.trim()||A?.includes("already in use"))&&q.jsx(S,{className:"mt-1",children:$&&!w.trim()?q.jsx(r,{defaultMessage:"Name is required",id:"Gvxoji2HqE"}):A}),W&&!w&&q.jsxs("div",{className:"absolute left-[24px] top-[31px] pointer-events-none",children:[q.jsx("span",{className:"text-[14px] relative inline-block",style:{color:"transparent",background:p?"linear-gradient(90deg, #808080 0%, #808080 35%, #c0c0c0 50%, #808080 65%, #808080 100%)":"linear-gradient(90deg, #9ca3af 0%, #9ca3af 35%, #6b7280 50%, #9ca3af 65%, #9ca3af 100%)",backgroundSize:"200% 100%",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",animation:"shimmerSweep 2s ease-in-out infinite"},children:q.jsx(r,{defaultMessage:"Generating...",id:"A/lLjOnjl0"})}),q.jsx("style",{children:"\n                    @keyframes shimmerSweep {\n                      0% { background-position: 200% 0; }\n                      100% { background-position: -200% 0; }\n                    }\n                  "})]})]}),q.jsx(N,{label:u.formatMessage({defaultMessage:"Prompt",id:"iWKE8shLIt"}),required:!0,value:E,onChange:e=>j(e.target.value),className:"min-h-32 max-h-64 overflow-y-auto font-large text-sm",placeholder:u.formatMessage({defaultMessage:"Enter your prompt text...",id:"xvBEtpDq86"}),error:$&&!E.trim()?u.formatMessage({defaultMessage:"Prompt is required",id:"E8uSl+czLg"}):void 0}),q.jsx(T,{scheduleEnabled:X,setScheduleEnabled:ee,repeatType:te,setRepeatType:ne,specificDate:pe,setSpecificDate:me,dayOfWeek:ie,setDayOfWeek:oe,dayOfMonth:ae,setDayOfMonth:le,month:ce,setMonth:de,day:ue,setDay:he,specificTime:se,setSpecificTime:re,monthLabels:ve,daysOfWeekLabels:we,url:fe,setUrl:ge,compact:!0,model:Ce,setModel:be,modelConfig:xe})]}),q.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[q.jsx(i,{onClick:()=>ke(),variant:"secondary",children:q.jsx(r,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),q.jsx(i,{onClick:Se,loading:O,children:m?q.jsx(r,{defaultMessage:"Save changes",id:"X0ha1a+WYV"}):q.jsx(r,{defaultMessage:"Create shortcut",id:"AzO4h7b149"})})]})]})})]})}var _E=(e=>(e.HORIZON_SPARK_CONNECT="horizon_spark_connect",e))(_E||{}),PE=(e=>(e.INTERACTED="interacted",e.DISMISSED="dismissed",e.NOT_TARGETED="not_targeted",e))(PE||{});async function VE(e,t,n){return E.fetch(`/api/oauth/organizations/${e}/spotlight/action`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({spotlight:t,action:n})})}const HE=({spotlight:e,organizationUuid:t,isOpen:n,onClose:r,children:i,className:o})=>{const{analytics:a}=b(),l=s();U.useEffect(()=>{n&&a?.track("spotlight.shown",{spotlight:e})},[n,e,a]);const c=async()=>{a?.track("spotlight.dismissed",{spotlight:e});try{await VE(t,e,PE.DISMISSED)}catch(n){}r()};return n?q.jsx(Xt,{children:n&&q.jsxs(q.Fragment,{children:[q.jsx(Qt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-always-black/50 z-50",onClick:c}),q.jsx("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center pointer-events-none p-0 sm:p-[11.5px]",children:q.jsxs(Qt.div,{initial:{y:"100%",opacity:0,scale:.95},animate:{y:0,opacity:1,scale:1},exit:{y:"100%",opacity:0,scale:.95},transition:{type:"spring",damping:30,stiffness:300},className:u("relative w-full sm:max-w-[500px] pointer-events-auto","bg-bg-000 border-[0.5px] border-border-300","rounded-t-[14px] sm:rounded-[14px]","overflow-hidden",o),children:[q.jsx("button",{onClick:c,className:"absolute top-4 right-4 z-10 p-1.5 bg-bg-000/80 backdrop-blur-sm rounded-full hover:bg-bg-200 transition-colors","aria-label":l.formatMessage({defaultMessage:"Close",id:"rbrahOGMC3"}),children:q.jsx(f,{size:16,className:"text-text-300"})}),"function"==typeof i?i({handleDismiss:c,handleAction:async n=>{a?.track("spotlight.action_clicked",{spotlight:e,action_name:n});try{await VE(t,e,PE.INTERACTED)}catch(s){}r()}}):i]})})]})}):null},$E=({variant:e})=>q.jsx("div",{className:"inline-flex",children:q.jsx("span",{className:"px-2 py-1 text-xs font-base-bold bg-accent-secondary-100/10 text-accent-secondary-100 rounded-md",children:"NEW"===e?q.jsx(r,{defaultMessage:"New",id:"bW7B87wFFp"}):q.jsx(r,{defaultMessage:"Beta",id:"riw/yc06Nq"})})}),zE=({children:e})=>q.jsx("h1",{className:"font-title text-text-100",children:e}),FE=({organizationUuid:e,onClose:t})=>{const n=s();return q.jsx(HE,{spotlight:_E.HORIZON_SPARK_CONNECT,organizationUuid:e,isOpen:!0,onClose:t,className:"overflow-hidden",children:({handleAction:e})=>q.jsxs("div",{className:"flex flex-col",children:[q.jsx("div",{className:"relative w-full flex-1",children:q.jsx("img",{src:"/assets/horizon-spark-connect-C83O8AQN.png",alt:n.formatMessage({defaultMessage:"Chrome extension with connected apps",id:"4aIpD3RYB/"}),className:"w-full h-full object-cover"})}),q.jsxs("div",{className:"flex flex-col gap-6 p-6 flex-[2] overflow-y-auto",children:[q.jsx($E,{variant:"NEW"}),q.jsx(zE,{children:q.jsx(r,{defaultMessage:"Extend what you can do in Chrome",id:"MM/ULko3j1"})}),q.jsxs("div",{className:"flex flex-col gap-3",children:[q.jsxs("div",{className:"flex gap-3",children:[q.jsx("div",{className:"shrink-0 mt-0.5",children:q.jsx(us,{size:20,className:"text-text-300"})}),q.jsx("span",{className:"text-text-200 font-base",children:q.jsx(r,{defaultMessage:"Chats are now saved—refer back or restart",id:"dPfJcsF2EP"})})]}),q.jsxs("div",{className:"flex gap-3",children:[q.jsx("div",{className:"shrink-0 mt-0.5",children:q.jsx(gn,{size:20,className:"text-text-300"})}),q.jsx("span",{className:"text-text-200 font-base",children:q.jsx(r,{defaultMessage:"Access and work with your connected apps while chatting in the extension",id:"gHpDMF2yPM"})})]}),q.jsxs("div",{className:"flex gap-3",children:[q.jsx("div",{className:"shrink-0 mt-0.5",children:q.jsx(j,{size:20,className:"text-text-300"})}),q.jsx("span",{className:"text-text-200 font-base",children:q.jsx(r,{defaultMessage:"Move beyond chat by creating downloadable docs, spreadsheets, and code",id:"oTdWIw/nMo"})})]})]}),q.jsx("p",{className:"text-xs text-text-400 font-base",children:q.jsx(r,{defaultMessage:"Ant-only: All future chats will use the new experience (Sessions API). Use the overflow (⋮) toggle between experiences.",id:"VOW1L8jo1E"})}),q.jsx(i,{variant:"primary",size:"lg",className:"w-full",onClick:async()=>{await K(G.USE_SESSIONS_API,!0),await e("try_whats_new")},children:q.jsx(r,{defaultMessage:"Try what's new",id:"eH5gdeveIM"})})]})]})})},BE=({organizationUuid:e})=>{const[t,n]=U.useState(null),[s,r]=U.useState(!0);U.useEffect(()=>{if(!e)return void r(!1);(async()=>{try{const t=await async function(e){return E.fetch(`/api/oauth/organizations/${e}/spotlight`,{method:"GET",headers:{"Content-Type":"application/json"}})}(e);n(t.spotlight)}catch(t){n(null)}finally{r(!1)}})()},[e]);const i=()=>{n(null)};return!s&&t&&e&&t===_E.HORIZON_SPARK_CONNECT?q.jsx(FE,{organizationUuid:e,onClose:i}):null};const WE=({mainTabId:e,onSwitchToMainTab:t})=>{const n=s(),i=Je(),[o,a]=U.useState(!0);U.useEffect(()=>{let t,n=!0;return(async()=>{try{const[s]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!s?.id)return;const r=s.id;t=setTimeout(async()=>{if(n)try{await ge.promoteToMainTab(e,r),window.location.reload()}catch(t){a(!1)}},3e3),chrome.runtime.sendMessage({type:"SECONDARY_TAB_CHECK_MAIN",secondaryTabId:r,mainTabId:e,timestamp:Date.now()},s=>{n&&(clearTimeout(t),s?.success?a(!1):ge.promoteToMainTab(e,r).then(()=>{window.location.reload()}).catch(e=>{a(!1)}))})}catch(s){n&&a(!1)}})(),()=>{n=!1,t&&clearTimeout(t)}},[e]);return o?q.jsx(A,{}):q.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen h-full",children:q.jsxs("div",{className:"flex flex-col items-center",children:[q.jsx("img",{src:i?pn:mn,alt:n.formatMessage({defaultMessage:"Tab group illustration",id:"XLN5nvmwda"}),className:"w-[212px] h-[120px]"}),q.jsx("div",{className:"text-text-200 text-base font-semibold mt-7 text-center font-claude-response",children:q.jsx(r,{defaultMessage:"Claude is active in this tab group",id:"DflDZ51Hia"})}),q.jsx("div",{className:"text-text-300 text-sm font-normal mt-2 text-center max-w-[320px] font-base",children:q.jsx(r,{defaultMessage:"Claude can research across sites, compare information, or handle multi-tab tasks.",id:"F3l7yioCLQ"})}),q.jsx("button",{onClick:async()=>{try{await chrome.tabs.update(e,{active:!0});const n=await chrome.tabs.get(e);n.windowId&&await chrome.windows.update(n.windowId,{focused:!0}),await chrome.runtime.sendMessage({type:"open_side_panel",tabId:e}),t()}catch(n){}},className:"mt-7 px-5 py-[10px] border border-border-300 text-text-200 rounded-[14px] hover:bg-bg-200 transition-colors font-ui font-medium text-[14px]",children:q.jsx(r,{defaultMessage:"Open chat",id:"un14bsOIsH"})})]})})};async function ZE(e,t){const n=["ANTHROPIC_MAGIC_STRING_TRIGGER_BROWESER_USE_N7D2H29PTWHFAYEH7THV49E7F99HN8ETMNHWDPSCQVR7NGUZB8TDAWJ7MMHVY3HB"],s=navigator.platform.toUpperCase().indexOf("MAC")>=0||navigator.userAgent.toUpperCase().indexOf("MAC")>=0,r=s?"Mac":"Windows/Linux",i=s?"cmd":"ctrl",o=await J(G.SYSTEM_PROMPT);return o&&n.push(o),n.push(`<platform-instructions>Platform-specific information:\n- You are on a ${r} system\n- Use "${i}" as the modifier key for keyboard shortcuts (e.g., "${i}+a" for select all, "${i}+c" for copy, "${i}+v" for paste)</platform-instructions>`),e.multipleTabsSystemPrompt&&n.push(e.multipleTabsSystemPrompt),e.toolUsagePrompt&&n.push(e.toolUsagePrompt),n.push("<turn_answer_start_instructions>\nBefore outputting any text response to the user this turn, call turn_answer_start first.\n\nWITH TOOL CALLS: After completing all tool calls, call turn_answer_start, then write your response.\nWITHOUT TOOL CALLS: Call turn_answer_start immediately, then write your response.\n\nRULES:\n- Call exactly once per turn\n- Call immediately before your text response\n- NEVER call during intermediate thoughts, reasoning, or while planning to use more tools\n- No more tools after calling this\n</turn_answer_start_instructions>"),n.join("\n\n")}const UE=async()=>null;function qE(e,t,n){const[s,r]=U.useState([]),[i,o]=U.useState(!1),[a,l]=U.useState(null),[c,d]=U.useState(null),[u,h]=U.useState(0),[p,m]=U.useState(!0),f=U.useRef(!1),g=U.useRef(t),y=U.useRef(n);g.current=t,y.current=n;const x=U.useCallback(async e=>{try{const t=await async function(e){return E.fetch(`/v1/sessions/${e}`,{method:"GET",headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29"}})}(e);return t.session_context.model||null}catch(t){return null}},[]),C=U.useCallback(async()=>{if(e){o(!0),l(null),h(0);try{const n=await yn({platforms:["CLAUDE_BROWSER_EXTENSION"],limit:30}),s=n.filter(e=>e.name.startsWith(xn)),i=n.filter(e=>!e.name.startsWith(xn)),o=await UE(),a=new Map,l=[];for(const e of s)if(e.session_id)try{const t=await x(e.session_id);if(!t){l.push(e);continue}a.has(t)||a.set(t,[]),a.get(t).push(e)}catch(t){l.push(e)}else l.push(e);if(o)for(const[e,t]of a.entries())if(t.length>0){const n=t[0];o.addExistingPooledSession({sessionId:n.session_id,conversationUuid:n.uuid},e),t.length>1&&l.push(...t.slice(1))}l.length>0&&Promise.all(l.map(t=>Cn({organizationUuid:e,conversationUuid:t.uuid}).catch(e=>{})));const c=g.current,d=y.current;if(o&&c&&d&&!f.current&&(f.current=!0,!o.hasSessionForModel(c))){const t=await ZE(d);o.warm(e,c,t).catch(e=>{})}r(i),m(30===n.length),h(30)}catch(t){l(t instanceof Error?t.message:"Failed to fetch conversations")}finally{o(!1)}}},[e,x]),b=U.useCallback(async()=>{if(e&&!i&&p){o(!0);try{const e=await yn({platforms:["CLAUDE_BROWSER_EXTENSION"],limit:20,offset:u}),t=e.filter(e=>!e.name.startsWith(xn));r(e=>[...e,...t]),m(20===e.length),h(e=>e+20)}catch(t){l(t instanceof Error?t.message:"Failed to load more conversations")}finally{o(!1)}}},[e,u,i,p]);U.useEffect(()=>{C()},[C]),U.useEffect(()=>{if(!(f.current&&e&&t&&n))return;(async()=>{const s=await UE();if(s&&!s.hasSessionForModel(t)){const r=await ZE(n);s.warm(e,t,r).catch(e=>{})}})()},[t,e,n]);const w=U.useCallback(async e=>{try{const t=await async function(e){const t=new URLSearchParams,n=`/v1/sessions/${e}/events${t.toString()?`?${t.toString()}`:""}`;return E.fetch(n,{method:"GET",headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29"}})}(e);return t.data}catch(t){throw t}},[]),v=U.useCallback(async t=>{if(e)try{await Cn({organizationUuid:e,conversationUuid:t}),r(e=>e.filter(e=>e.uuid!==t));const n=s.find(e=>e.uuid===t);n?.session_id===c&&d(null),await C()}catch(n){l(n instanceof Error?n.message:"Failed to delete conversation")}},[e,c,s,C]),k=U.useCallback(()=>{const e=s.find(e=>e.session_id===c);return e?.settings?.enabled_mcp_tools||{}},[s,c]);return{sessions:s,isLoading:i,error:a,activeSessionId:c,setActiveSessionId:d,refreshSessions:C,loadSessionEvents:w,deleteConversationById:v,getCurrentConversationMcpTools:k,getSessionModel:x,loadMore:b,hasMore:p}}const JE=({sessions:e,activeSessionId:t,onSelectSession:n,onConversationDelete:s,onConversationRename:i,isLoading:o=!1,onLoadMore:a,hasMore:l=!1,open:c,onOpenChange:d,trigger:u})=>q.jsx(I,{align:"end",side:"bottom",sideOffset:8,unstyledTrigger:!0,open:c,onOpenChange:d,className:"w-64 max-w-[280px]",trigger:u,children:o&&0===e.length?q.jsx("div",{className:"px-2 py-2 text-sm text-text-400",children:q.jsx(r,{defaultMessage:"Loading conversations...",id:"vWBKqpDTBm"})}):0===e.length?q.jsx("div",{className:"px-2 py-2 text-sm text-text-400",children:q.jsx(r,{defaultMessage:"Chat sessions will appear here",id:"zYPk/n3qmG"})}):q.jsxs(q.Fragment,{children:[e.map(e=>q.jsx(GE,{session:e,isActive:e.session_id===t,onSelect:()=>{e.session_id&&n(e.session_id),d?.(!1)},onDelete:s?()=>{s(e.uuid),d?.(!1)}:void 0,onRename:i?()=>{i(e.uuid,e.name||""),d?.(!1)}:void 0},e.uuid)),o&&q.jsx("div",{className:"px-2 py-2 text-center text-sm text-text-400",children:q.jsx(r,{defaultMessage:"Loading more...",id:"tL4WC1FPW1"})})]})}),GE=({session:e,isActive:t,onSelect:n,onDelete:o,onRename:a})=>{const l=s(),[c,d]=U.useState(!1),[p,m]=U.useState(!1),f=U.useRef(null),g=e.name||q.jsx("span",{className:"opacity-60",children:q.jsx(r,{defaultMessage:"Untitled",id:"3kbIhS7KZS"})});return U.useEffect(()=>{if(f.current&&e.name){const e=f.current.scrollWidth>f.current.clientWidth;m(e)}},[e.name]),q.jsxs("div",{className:u("px-2 py-1.5 cursor-pointer transition-colors flex items-center justify-between gap-2 group relative rounded-lg","hover:bg-bg-200"),onClick:n,onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:[e.name&&p?q.jsx(h,{tooltipContent:e.name,children:q.jsx("div",{ref:f,className:"flex-1 min-w-0 text-sm text-text-200 truncate",children:g})}):q.jsx("div",{ref:f,className:"flex-1 min-w-0 text-sm text-text-200 truncate",children:g}),q.jsx("div",{className:"flex items-center shrink-0 w-6 h-6 justify-center",onClick:e=>e.stopPropagation(),children:t&&!c?q.jsx(vi,{size:16,className:"text-accent-secondary-100"}):(o||a)&&q.jsxs(I,{align:"start",side:"left",sideOffset:4,unstyledTrigger:!0,modal:!1,trigger:q.jsx(i,{variant:"ghost",onClick:e=>{e.stopPropagation()},className:"!p-1 opacity-0 group-hover:opacity-100 !min-w-0 !h-auto","aria-label":l.formatMessage({defaultMessage:"More actions",id:"S8/4ZI1Fhf"}),children:q.jsx(Ni,{size:12})}),children:[a&&q.jsx(O,{onSelect:e=>{e.preventDefault(),a()},icon:q.jsx(Ti,{size:16}),children:q.jsx("span",{className:"text-sm",children:q.jsx(r,{defaultMessage:"Rename",id:"iXNbPfQDIZ"})})}),o&&q.jsx(O,{onSelect:e=>{e.preventDefault(),o()},danger:!0,icon:q.jsx(_i,{size:16}),children:q.jsx("span",{className:"text-sm",children:q.jsx(r,{defaultMessage:"Delete",id:"K3r6DQW7h+"})})})]})})]})};function KE({conversationUuid:e,onClose:t,onDelete:n}){const[o,a]=U.useState(!1),l=s();return q.jsxs(L,{isOpen:null!==e,onClose:t,title:l.formatMessage({defaultMessage:"Delete chat",id:"ngIzbjIFxF"}),modalSize:"sm",className:"bg-bg-100",hasCloseButton:!0,autoCloseOnFocusOut:!0,overlayClassName:"[background-color:hsl(var(--always-black)/0.5)!important]",children:[q.jsx("p",{className:"text-text-200 font-base mt-4",children:q.jsx(r,{defaultMessage:"Are you sure you want to delete this chat?",id:"eoF+zSJr4t"})}),q.jsxs(D,{layout:"right",className:"!flex-row !mt-6",children:[q.jsx(i,{variant:"secondary",onClick:t,disabled:o,children:q.jsx(r,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),q.jsx(i,{variant:"danger",onClick:async()=>{if(e){a(!0);try{await n(e),t()}catch(s){}finally{a(!1)}}},loading:o,children:q.jsx(r,{defaultMessage:"Delete",id:"K3r6DQW7h+"})})]})]})}function YE({conversationUuid:e,currentName:t,onClose:n,onRename:o}){const a=s(),[l,c]=U.useState(t),[d,u]=U.useState(!1),[h,p]=U.useState(""),m=U.useRef(null);U.useEffect(()=>{e&&(c(t),p(""))},[e,t]);const f=async()=>{if(e&&l.trim()){u(!0);try{await o(e,l.trim()),n()}catch(t){p(a.formatMessage({defaultMessage:"Failed to rename conversation",id:"rbG4gZ94o6"}))}finally{u(!1)}}else p(a.formatMessage({defaultMessage:"Name is required",id:"Gvxoji2HqE"}))};return q.jsxs(L,{isOpen:null!==e,onClose:n,title:a.formatMessage({defaultMessage:"Rename chat",id:"Oi9LAY6C5H"}),modalSize:"sm",className:"bg-bg-100",hasCloseButton:!0,autoCloseOnFocusOut:!0,overlayClassName:"[background-color:hsl(var(--always-black)/0.5)!important]",children:[q.jsx(M,{className:"mt-4 text-sm",ref:m,type:"text",value:l,onChange:e=>{c(e.target.value),h&&p("")},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),f())},disabled:d,error:!!h}),h&&q.jsx(S,{className:"mt-1",children:h}),q.jsxs(D,{layout:"right",className:"!flex-row !mt-6",children:[q.jsx(i,{variant:"secondary",onClick:n,disabled:d,children:q.jsx(r,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),q.jsx(i,{variant:"primary",onClick:f,loading:d,children:q.jsx(r,{defaultMessage:"Save",id:"jvo0vs3nF0"})})]})]})}function QE({pendingLocale:e,onClose:t,onConfirm:n}){const o=s();return q.jsxs(L,{isOpen:null!==e,onClose:t,title:o.formatMessage({defaultMessage:"Change language",id:"jOuyTp+O9P"}),modalSize:"sm",className:"bg-bg-100",hasCloseButton:!0,autoCloseOnFocusOut:!0,overlayClassName:"[background-color:hsl(var(--always-black)/0.5)!important]",children:[q.jsx("p",{className:"text-text-200 font-base mt-4",children:q.jsx(r,{defaultMessage:"Changing the language will start a new chat.",id:"yPUC8ZWYmE"})}),q.jsxs(D,{layout:"right",className:"!flex-row !mt-6",children:[q.jsx(i,{variant:"secondary",onClick:t,children:q.jsx(r,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),q.jsx(i,{variant:"primary",onClick:()=>{e&&(n(e),t())},children:q.jsx(r,{defaultMessage:"Continue",id:"acrOozm08x"})})]})]})}const XE=({onConvertToScheduledTask:e,isConvertingToTask:t,isAgentRunning:n,onOpenSettings:i,useSessionsAPI:o,onSessionsToggle:a,hasMessages:l})=>{const c=s(),[d,u]=U.useState(!1),{locale:h,setLocale:p}=R(),[f,g]=U.useState(null),y=U.useCallback(e=>{e&&requestAnimationFrame(()=>{const t=e.closest("[data-radix-popper-content-wrapper]");if(!t)return;const n=document.querySelector("[data-radix-popper-content-wrapper]:not(:has(.language-submenu))");if(!n)return;const s=n.getBoundingClientRect();t.style.left=`${s.left}px`,t.style.top=`${s.top+96}px`,t.style.transform="none"})},[]);return q.jsxs(q.Fragment,{children:[q.jsx(QE,{pendingLocale:f,onClose:()=>g(null),onConfirm:e=>{p(e)}}),q.jsxs(I,{align:"end",side:"bottom",sideOffset:8,unstyledTrigger:!0,className:"w-[240px]",open:d,onOpenChange:u,trigger:q.jsx("button",{className:"hide-focus-ring p-1.5 rounded-md transition-colors text-text-300 hover:bg-bg-300 hover:text-text-100","aria-label":c.formatMessage({defaultMessage:"Menu",id:"tKMlOcHz9T"}),children:q.jsx(k,{size:12})}),children:[q.jsx(O,{onSelect:()=>e(),disabled:t||n,icon:t?q.jsx("div",{className:"animate-spin",children:q.jsx(_,{size:16})}):q.jsx(_,{size:16}),children:q.jsx("span",{className:"text-sm",children:q.jsx(r,{defaultMessage:"Convert to task",id:"Z7sL1cCQpI"})})}),q.jsx(O,{onSelect:()=>i(),icon:q.jsx(bn,{size:16}),children:q.jsx("span",{className:"text-sm",children:q.jsx(r,{defaultMessage:"Settings",id:"D3idYvSLF9"})})}),q.jsxs(P,{children:[q.jsx(V,{children:q.jsxs("div",{className:"flex items-center gap-2 w-full",children:[q.jsx(st,{size:16,className:"text-text-300"}),q.jsx("span",{className:"flex-1 text-sm",children:q.jsx(r,{defaultMessage:"Language",id:"y1Z3orIe9Z"})}),q.jsx(wn,{size:16,className:"text-text-300"})]})}),q.jsx(H,{children:q.jsx($,{ref:y,sideOffset:0,className:"font-base !min-w-44 language-submenu",children:z.map(e=>q.jsx(O,{onSelect:()=>{var t;(t=e)!==h&&(l?g(t):p(t))},trailing:h===e?q.jsx(m,{size:14,className:"text-accent-secondary-200"}):void 0,children:q.jsx("span",{className:"text-sm",children:F[e]})},e))})})]}),!1]})]})},ej=({showModelSelector:e,selectedModel:t,onModelChange:n,modelConfig:i,availableModelOptions:o,handleStickyModelChange:a,useSessionsAPI:l,onNewConversation:c,onClearChat:d,onSessionsToggle:u,sessions:p,activeSessionId:m,onSelectSession:f,onConversationDelete:g,onConversationRename:y,isLoadingSessions:x,onLoadMoreSessions:C,hasMoreSessions:b,onConvertToScheduledTask:w,isConvertingToTask:v,isAgentRunning:k,onOpenOptions:M,hasMessages:S})=>{const N=s(),[T,E]=U.useState(!1),[j,A]=U.useState(null),[I,O]=U.useState(null),L=U.useCallback(e=>{A(e)},[]);return q.jsxs("div",{className:"flex justify-between items-center px-4 pt-3 pb-3",children:[q.jsx("div",{className:"flex items-center gap-3",children:e?q.jsx(vn,{currentModel:t,onChange:n,modelConfig:{...i,options:o},onModelChange:a,disabled:l&&null!==m}):q.jsx("span",{className:"text-[12px] text-text-300 font-ui font-normal leading-[140%] tracking-[-0.3px]",children:q.jsx(r,{defaultMessage:"Beta",id:"riw/yc06Nq"})})}),q.jsxs("div",{className:"flex items-center gap-2.5",children:[l?q.jsxs(q.Fragment,{children:[q.jsx(h,{tooltipContent:N.formatMessage({defaultMessage:"New conversation",id:"PQ8A3IzhiS"}),children:q.jsx("button",{onClick:c,className:"p-1.5 rounded-md transition-colors text-text-300 hover:bg-bg-300 hover:text-text-100","aria-label":N.formatMessage({defaultMessage:"New conversation",id:"PQ8A3IzhiS"}),children:q.jsx(pi,{size:12})})}),q.jsx(JE,{sessions:p,activeSessionId:m,onSelectSession:f,onConversationDelete:L,onConversationRename:(e,t)=>{O({uuid:e,currentName:t})},isLoading:x,onLoadMore:C,hasMore:b,open:T,onOpenChange:E,trigger:q.jsx("button",{className:"p-1.5 rounded-md transition-colors text-text-300 hover:bg-bg-300 hover:text-text-100","aria-label":N.formatMessage({defaultMessage:"Chat history",id:"Z17cukDtG+"}),title:N.formatMessage({defaultMessage:"Chat history",id:"Z17cukDtG+"}),children:q.jsx(bi,{size:12})})})]}):q.jsx(h,{tooltipContent:N.formatMessage({defaultMessage:"Clear chat",id:"I4AiMx3dsz"}),children:q.jsx("button",{onClick:d,className:"p-1.5 rounded-md transition-colors text-text-300 hover:bg-bg-300 hover:text-text-100","aria-label":N.formatMessage({defaultMessage:"Clear chat",id:"I4AiMx3dsz"}),children:q.jsx(wi,{size:12})})}),q.jsx(XE,{onConvertToScheduledTask:w,isConvertingToTask:v,isAgentRunning:k,onOpenSettings:M,useSessionsAPI:l,onSessionsToggle:u,hasMessages:S})]}),q.jsx(KE,{conversationUuid:j,onClose:()=>A(null),onDelete:g}),q.jsx(YE,{conversationUuid:I?.uuid||null,currentName:I?.currentName||"",onClose:()=>O(null),onRename:y})]})};class tj{static instance=null;static getInstance(){return tj.instance||(tj.instance=new tj),tj.instance}async injectElementSelector(e){return new Promise(t=>{const n=async(s,r)=>{if(r.tab?.id===e&&"ELEMENT_SELECTION"===s.type)if(chrome.runtime.onMessage.removeListener(n),s.cancelled)t(null);else if(s.elementInfo){const n=r.tab?.id||e;t({element:s.elementInfo,url:s.url||"",timestamp:Date.now(),tabId:n,viewportWidth:s.viewportWidth,viewportHeight:s.viewportHeight,clickCoordinates:s.clickCoordinates,typedText:s.typedText,typedInElement:s.typedInElement})}"CANCEL_ELEMENT_SELECTOR"===s.type&&(chrome.runtime.onMessage.removeListener(n),t(null))};chrome.runtime.onMessage.addListener(n),setTimeout(()=>{chrome.runtime.onMessage.removeListener(n),t(null)},6e4);chrome.scripting.executeScript({target:{tabId:e},func:()=>{const e=window;if(e.__clickListenerActive)return;e.__clickListenerActive=!0;const t=n=>{"CANCEL_ELEMENT_SELECTOR"===n.type&&(document.removeEventListener("click",c,!0),document.removeEventListener("keydown",d,!0),document.removeEventListener("keydown",l,!0),document.removeEventListener("focus",a,!0),chrome.runtime.onMessage.removeListener(t),e.__clickListenerActive=!1,e.__keystrokeListenersActive=!1)};chrome.runtime.onMessage.addListener(t);let n=!1,s=[],r=null;const i=e=>e.className&&null!==e.className?"object"==typeof e.className&&"baseVal"in e.className?e.className.baseVal||"":String(e.className):"",o=!e.__keystrokeListenersActive,a=e=>{const t=e.target;if(r&&t!==r&&s.length>0){const e=i(r);chrome.runtime.sendMessage({type:"KEYSTROKE_UPDATE",text:s.join(""),element:{tagName:r.tagName.toLowerCase(),selector:r.id?`#${r.id}`:e?`${r.tagName.toLowerCase()}.${e.trim().split(/\s+/).join(".")}`:r.tagName.toLowerCase(),name:r.getAttribute("name")||r.getAttribute("placeholder")||r.getAttribute("aria-label")||""},isFinal:!0}),s=[]}r=t};o&&document.addEventListener("focus",a,!0);const l=e=>{if(e.target&&e.target.tagName&&["INPUT","TEXTAREA"].includes(e.target.tagName.toUpperCase())&&(r=e.target),!r)return;const t=r.tagName.toLowerCase();if(!("textarea"===t||"input"===t&&!["submit","button","checkbox","radio","file"].includes(r.type)||"true"===r.getAttribute("contenteditable")))return;const n=e.key;if("Backspace"===n){s.pop();const e=i(r);return void chrome.runtime.sendMessage({type:"KEYSTROKE_UPDATE",text:s.join(""),element:{tagName:r.tagName.toLowerCase(),selector:r.id?`#${r.id}`:e?`${r.tagName.toLowerCase()}.${e.trim().split(/\s+/).join(".")}`:r.tagName.toLowerCase(),name:r.getAttribute("name")||r.getAttribute("placeholder")||r.getAttribute("aria-label")||""}})}if("Enter"===n){s.push("\n");const e=i(r);return void chrome.runtime.sendMessage({type:"KEYSTROKE_UPDATE",text:s.join(""),element:{tagName:r.tagName.toLowerCase(),selector:r.id?`#${r.id}`:e?`${r.tagName.toLowerCase()}.${e.trim().split(/\s+/).join(".")}`:r.tagName.toLowerCase(),name:r.getAttribute("name")||r.getAttribute("placeholder")||r.getAttribute("aria-label")||""}})}if("Tab"===n){s.push("\t");const e=i(r);return void chrome.runtime.sendMessage({type:"KEYSTROKE_UPDATE",text:s.join(""),element:{tagName:r.tagName.toLowerCase(),selector:r.id?`#${r.id}`:e?`${r.tagName.toLowerCase()}.${e.trim().split(/\s+/).join(".")}`:r.tagName.toLowerCase(),name:r.getAttribute("name")||r.getAttribute("placeholder")||r.getAttribute("aria-label")||""}})}if(!["Control","Shift","Alt","Meta"].includes(n)&&!(e.ctrlKey||e.altKey||e.metaKey||n.startsWith("Arrow")||n.startsWith("F")&&n.length<=3||["Home","End","PageUp","PageDown","Delete","Insert","Escape"].includes(n)||1!==n.length)){s.push(n);const e=i(r);chrome.runtime.sendMessage({type:"KEYSTROKE_UPDATE",text:s.join(""),element:{tagName:r.tagName.toLowerCase(),selector:r.id?`#${r.id}`:e?`${r.tagName.toLowerCase()}.${e.trim().split(/\s+/).join(".")}`:r.tagName.toLowerCase(),name:r.getAttribute("name")||r.getAttribute("placeholder")||r.getAttribute("aria-label")||""}})}};o&&(document.addEventListener("keydown",l,!0),e.__keystrokeListenersActive=!0);const c=async o=>{if(o.preventDefault(),o.stopPropagation(),!n){n=!0;try{const e=document.elementFromPoint(o.clientX,o.clientY);if(!e)return void(n=!1);const t=e.getBoundingClientRect(),a=e.tagName.toLowerCase(),l=[];e.id&&l.push(`#${e.id}`);const c=i(e);if(c){const e=c.trim().split(/\s+/).filter(e=>e);e.length>0&&l.push(`${a}.${e.join(".")}`)}const d=Array.from(e.attributes).filter(e=>e.name.startsWith("data-")).slice(0,2);if(d.length>0){const e=d.map(e=>`[${e.name}="${e.value}"]`).join("");l.push(`${a}${e}`)}const u=e.getAttribute("aria-label");if(u&&l.push(`${a}[aria-label="${u}"]`),["button","a"].includes(a)&&e.textContent){const t=e.textContent.trim().substring(0,50);l.push(`${a}:contains("${t}")`)}if("input"===a){const t=e.getAttribute("type")||"text",n=e.getAttribute("name");n?l.push(`input[name="${n}"]`):l.push(`input[type="${t}"]`)}const h=l[0]||a,p={};["id","class","name","type","href","aria-label","aria-description","role","title","data-tooltip","data-tip","data-original-title","data-testid","placeholder","alt","value"].forEach(t=>{const n=e.getAttribute(t);n&&(p[t]=n)});const m={selector:h,tagName:a,text:e.textContent?.trim().substring(0,100)||"",attributes:p,boundingRect:{x:t.x,y:t.y,width:t.width,height:t.height,top:t.top,right:t.right,bottom:t.bottom,left:t.left}};let f,g=null;s.length>0&&(f=s.join(""),g=r,s=[],r=null);try{chrome.runtime.sendMessage({type:"ELEMENT_SELECTION",elementInfo:m,url:window.location.href,viewportWidth:window.innerWidth,viewportHeight:window.innerHeight,needsScreenshot:!0,clickCoordinates:{x:o.clientX,y:o.clientY},typedText:f,typedInElement:g?{tagName:g.tagName.toLowerCase(),selector:g.id?`#${g.id}`:i(g)?`${g.tagName.toLowerCase()}.${i(g).trim().split(/\s+/).join(".")}`:g.tagName.toLowerCase(),name:g.getAttribute("name")||g.getAttribute("placeholder")||g.getAttribute("aria-label")||""}:void 0})}catch{}setTimeout(()=>{try{if("function"==typeof e.click)e.click();else{const t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});e.dispatchEvent(t)}}catch{}finally{n=!1}},300)}catch{n=!1}finally{document.removeEventListener("click",c,!0),document.removeEventListener("keydown",d,!0),chrome.runtime.onMessage.removeListener(t),e.__clickListenerActive=!1}}},d=n=>{"Escape"===n.key&&(n.preventDefault(),chrome.runtime.sendMessage({type:"ELEMENT_SELECTION",cancelled:!0}),document.removeEventListener("click",c,!0),document.removeEventListener("keydown",d,!0),document.removeEventListener("keydown",l,!0),document.removeEventListener("focus",a,!0),chrome.runtime.onMessage.removeListener(t),e.__clickListenerActive=!1,e.__keystrokeListenersActive=!1)};document.addEventListener("click",c,!0),document.addEventListener("keydown",d,!0)}},()=>{chrome.runtime.lastError&&(chrome.runtime.onMessage.removeListener(n),t(null))})})}}const nj=tj.getInstance();const sj=e=>!!e&&!(e.startsWith("chrome://")||e.startsWith("chrome-extension://")||e.startsWith("about:")||e.startsWith("edge://")||e.startsWith("brave://")),rj=({tabId:e,onComplete:t,createMessage:n})=>{const[s,r]=U.useState({isRecording:!1,isPaused:!1,steps:[],startTime:null}),[i,o]=U.useState(null),[a,l]=U.useState(new Set),c=U.useRef(new Set),d=U.useRef(new Set),[u,h]=U.useState(e),p=U.useRef(void 0),m=U.useRef(!1),f=U.useRef(!1),g=U.useRef(""),y=U.useRef(null),x=U.useRef(new Set),C=U.useRef(0),[b,w]=U.useState(""),v=U.useRef(new Set),k=U.useRef(e),{isRecording:M,speechSegments:S,error:N,isSupported:T,hasPermission:E,startRecording:j,stopRecording:A}=(()=>{const[e,t]=U.useState(!1),[n,s]=U.useState([]),[r,i]=U.useState(""),[o,a]=U.useState(null),[l,c]=U.useState(!1),d=U.useRef(null),u=U.useRef(!1),h=U.useRef(0),p=U.useRef(0),m="undefined"!=typeof window&&("SpeechRecognition"in window||"webkitSpeechRecognition"in window);U.useEffect(()=>{(async()=>{try{const e=await navigator.permissions.query({name:"microphone"});c("granted"===e.state),e.addEventListener("change",()=>{c("granted"===e.state)})}catch(e){c(!1)}})()},[]),U.useEffect(()=>{if(!m)return;const e=new(window.SpeechRecognition||window.webkitSpeechRecognition);return e.continuous=!0,e.interimResults=!0,e.lang="en-US",e.onresult=e=>{const t=Date.now();let n="";for(let r=e.resultIndex;r<e.results.length;r++){const o=e.results[r],a=o[0].transcript;if(o.isFinal){const e=a.trim();if(e){const n={text:e,timestamp:h.current>0?h.current:t,isFinal:!0};s(e=>[...e.filter(e=>e.isFinal),n]),i(""),h.current=0}}else n+=a+" "}if(n.trim()){const e=n.trim();0===h.current&&(h.current=t),i(e),s(t=>[...t.filter(e=>e.isFinal),{text:e,timestamp:h.current,isFinal:!1}]),e.split(" ").length}},e.onend=()=>{if(u.current){p.current=0;try{e.start()}catch(n){t(!1),u.current=!1,a("Speech recognition stopped unexpectedly")}}else t(!1)},e.onerror=e=>{"not-allowed"===e.error?(c(!1),u.current=!1,t(!1),a("Microphone permission denied")):"no-speech"===e.error||e.error},d.current=e,()=>{if(d.current)try{u.current=!1,d.current.stop()}catch{}}},[m]);const f=U.useCallback(async()=>{if(!m)return a("Speech recognition not supported in this browser"),!1;if(!l)return a("Microphone permission not granted"),!1;if(!d.current)return a("Speech recognition not initialized"),!1;try{return s([]),i(""),h.current=0,p.current=0,u.current=!0,d.current.start(),t(!0),a(null),!0}catch(e){return u.current=!1,a("Failed to start speech recording"),!1}},[m,l]),g=U.useCallback(()=>{if(u.current=!1,d.current)try{d.current.stop()}catch(e){}t(!1)},[]),y=U.useCallback(()=>{s([])},[]);return{isRecording:e,speechSegments:n,currentInterimTranscript:r,error:o,isSupported:m,hasPermission:l,startRecording:f,stopRecording:g,clearSegments:y}})(),I=U.useRef([]);U.useEffect(()=>{I.current=S;const e=S.filter(e=>e.timestamp>C.current).map(e=>e.text).join(" ").trim();w(e)},[S]),U.useEffect(()=>{if(!f.current||s.isPaused)return;const t=(t,n)=>{if("KEYSTROKE_UPDATE"===t.type&&n.tab?.id===(u||e)){const e=t.text,s=t.element;if(!e)return void r(e=>({...e,steps:e.steps.filter(e=>!("type"===e.action&&e.isPending))}));let i=`Type "${e.substring(0,30)}${e.length>30?"...":""}"`;if(e.includes("@")?i=`Enter email "${e}"`:e.length<20&&!e.includes(" ")?i=`Enter "${e}"`:e.length>50&&(i=`Type text: "${e.substring(0,50)}..."`),s.name){const e=s.name.replace(/_/g," ").replace(/([A-Z])/g," $1").trim().toLowerCase();i+=` in ${e} field`}r(r=>{const o=r.steps.findIndex(e=>"type"===e.action&&e.isPending);if(o>=0){const n=[...r.steps];return n[o]={...n[o],value:e,description:i,selector:s.selector,isPending:!t.isFinal},{...r,steps:n}}if(!t.isFinal){const t={action:"type",selector:s.selector,value:e,description:i,url:window.location.href,tabId:n.tab?.id,timestamp:Date.now(),isPending:!0};return{...r,steps:[...r.steps,t]}}return r})}};return chrome.runtime.onMessage.addListener(t),()=>{chrome.runtime.onMessage.removeListener(t)}},[s.isPaused,u,e]);const{captureFullScreen:O}=kn({tabId:u||e,forceTabActivation:!1,onCapture:e=>{g.current=e.base64||""}}),L=U.useRef(new Set),D=U.useCallback(async e=>{if(!e)return;if(L.current.has(e.timestamp))return;L.current.add(e.timestamp);const t=e.tabId;if(t&&f.current&&!s.isPaused)try{await O();let o=g.current;g.current="",r(n=>{const s=n.steps.findIndex(e=>"type"===e.action&&e.isPending);if(s>=0){const t=[...n.steps];return t[s]={...t[s],screenshot:o,timestamp:e.timestamp-1,isPending:!1},{...n,steps:t}}if(e.typedText&&e.typedInElement){let s=`Type "${e.typedText.substring(0,30)}${e.typedText.length>30?"...":""}"`;if(e.typedText.includes("@")?s=`Enter email "${e.typedText}"`:e.typedText.length<20&&!e.typedText.includes(" ")?s=`Enter "${e.typedText}"`:e.typedText.length>50&&(s=`Type text: "${e.typedText.substring(0,50)}..."`),e.typedInElement.name){s+=` in ${e.typedInElement.name.replace(/_/g," ").replace(/([A-Z])/g," $1").trim().toLowerCase()} field`}const r={action:"type",selector:e.typedInElement.selector,value:e.typedText,screenshot:o,description:s,url:e.url,tabId:t,timestamp:e.timestamp-1};return{...n,steps:[...n.steps,r]}}return n});const a=e.clickCoordinates?e.clickCoordinates:e.element.boundingRect?{x:e.element.boundingRect.x+e.element.boundingRect.width/2,y:e.element.boundingRect.y+e.element.boundingRect.height/2}:void 0;if(o&&a&&e.viewportWidth&&e.viewportHeight)try{o=await async function(e,t,n){return new Promise((s,r)=>{const o=new Image;o.onload=()=>{try{const e=o.width/n.width,i=o.height/n.height,a=t.x*e,l=t.y*i,c=document.createElement("canvas");c.width=o.width,c.height=o.height;const d=c.getContext("2d");if(!d)return void r(new Error("Failed to get canvas context"));d.drawImage(o,0,0);const u=Math.max(40,Math.min(120,.05*Math.min(o.width,o.height)));d.beginPath(),d.arc(a,l,u,0,2*Math.PI),d.fillStyle="rgba(44, 132, 219, 0.3)",d.fill(),d.strokeStyle="rgba(44, 132, 219, 1)",d.lineWidth=2,d.stroke();const h=c.toDataURL("image/jpeg",.9).split(",")[1];s(h)}catch(i){r(i)}},o.onerror=()=>{r(new Error("Failed to load screenshot image"))},o.src=`data:image/jpeg;base64,${e}`})}(o,{x:a.x,y:a.y},{width:e.viewportWidth,height:e.viewportHeight})}catch{}const l=C.current,c=I.current.filter(e=>e.timestamp>=l),d=c.length>0?c.map(e=>e.text).join(" ").trim():void 0;C.current=e.timestamp,w("");const u=(e=>{const t=e.tagName.toLowerCase(),n=e.text?.trim(),s=e.attributes||{};if(s["aria-label"])return`Click on "${s["aria-label"]}"`;if(s.title&&(!n||n.length<=3))return`Click on "${s.title}"`;if(("button"===t||"a"===t)&&n&&n.length>1)return`Click on "${n.length>40?n.substring(0,40)+"...":n}" button`;if(("button"===t||"a"===t)&&s.title)return`Click on "${s.title}" button`;if("input"===t){const e=s.type||"text",t=s.placeholder,r=s.name;if("submit"===e||"button"===e){const e=s.value||n;return e?`Click on "${e}" button`:"Click on submit button"}return t?`Click on "${t}" field`:r?`Click on ${r.replace(/_/g," ").replace(/([A-Z])/g," $1").trim().toLowerCase()} field`:`Click on ${e} input`}if("select"===t){const e=s.name;return e?`Click on ${e.replace(/_/g," ").replace(/([A-Z])/g," $1").trim().toLowerCase()} dropdown`:"Click on dropdown menu"}if("img"===t){const e=s.alt;return e?`Click on "${e}" image`:"Click on image"}if(s.role){const e=s.role;return n?`Click on "${n.length>40?n.substring(0,40)+"...":n}"`:`Click on ${e}`}if("div"===t||"span"===t){const e=s.title||s["data-tooltip"]||s["data-tip"]||s["data-original-title"];if(e&&(!n||n.length<=3))return`Click on "${e}"`;if(n){const e=n.length>50?n.substring(0,50)+"...":n;return s.class?.includes("menu")||s.class?.includes("nav")?`Click on "${e}" menu item`:(s.class?.includes("card")||s.class?.includes("item"),`Click on "${e}"`)}if(e)return`Click on "${e}"`}if(s.id)return`Click on ${s.id.replace(/-/g," ").replace(/_/g," ").replace(/([A-Z])/g," $1").trim()}`;const r=s.title||s["data-tooltip"]||s["data-tip"]||s["data-original-title"]||s["aria-description"];if(r)return`Click on "${r}"`;if(n)return`Click on "${n.length>40?n.substring(0,40)+"...":n}"`;return`Click on ${t} element`})(e.element),h={action:"click",selector:e.element.selector,screenshot:o,description:u,url:e.url,tabId:t,elementText:e.element.text,elementAttributes:e.element.attributes,timestamp:e.timestamp,viewportDimensions:e.viewportWidth&&e.viewportHeight?{width:e.viewportWidth,height:e.viewportHeight}:void 0,clickPosition:a,isEnhancing:!!n,speechTranscript:d};r(e=>({...e,steps:[...e.steps,h]})),n&&chrome.tabs.get(t).then(async t=>{const s=t.title||"";Mn({tagName:e.element.tagName,text:e.element.text,attributes:e.element.attributes,url:e.url,pageTitle:s,action:"click",selector:e.element.selector,screenshot:o,speechTranscript:d},n).then(e=>{r(e?t=>({...t,steps:t.steps.map(t=>t.timestamp===h.timestamp?{...t,description:e,isEnhancing:!1}:t)}):e=>({...e,steps:e.steps.map(e=>e.timestamp===h.timestamp?{...e,isEnhancing:!1}:e)}))}).catch(()=>{r(e=>({...e,steps:e.steps.map(e=>e.timestamp===h.timestamp?{...e,isEnhancing:!1}:e)}))})}),setTimeout(()=>{L.current.delete(e.timestamp)},6e4),f.current&&!s.isPaused&&t&&!x.current.has(t)&&setTimeout(async()=>{if(f.current&&!s.isPaused&&!x.current.has(t))try{x.current.add(t);const e=await nj.injectElementSelector(t);x.current.delete(t),e&&await D(e)}catch{x.current.delete(t)}},350)}catch{o("Failed to capture action")}else L.current.delete(e.timestamp)},[s.isPaused,O,n]),R=U.useCallback(async t=>{f.current=!0;const n=Date.now();r({isRecording:!0,isPaused:!1,steps:[],startTime:n}),o(null),C.current=n;(void 0===t?T&&E:t&&T&&E)&&await j();const i=e;i&&(h(i),l(new Set([i])),c.current=new Set([i]),d.current=new Set([i]),chrome.tabs.get(i).then(e=>{p.current=e.groupId;const t={action:"navigate",description:`Navigate to ${e.url||"page"}`,url:e.url||"",tabId:i,timestamp:n-100};r(e=>({...e,steps:[t,...e.steps]}))}));const u=e=>{if(!f.current||s.isPaused)return;const t=e.tabId;chrome.tabs.get(t).then(e=>{const n=e.groupId,s=p.current;if(void 0===s||-1===s||n!==s)return r(e=>({...e,isPaused:!0})),void a.forEach(e=>{chrome.tabs.sendMessage(e,{type:"CANCEL_ELEMENT_SELECTOR"}).catch(()=>{})});const i=!d.current.has(t),o=!c.current.has(t);if(i&&d.current.add(t),i){const n=Date.now()-150,s={action:"create_tab",description:"Create new tab",url:e.url||"",tabId:t,timestamp:n};r(e=>({...e,steps:[...e.steps,s]}))}if(o&&sj(e.url)){c.current.add(t);const n=Date.now()-100,s={action:"navigate",description:`Navigate to ${e.url||"page"}`,url:e.url||"",tabId:t,timestamp:n};r(e=>({...e,steps:[...e.steps,s]}))}else o&&sj(e.url);h(t),l(e=>new Set(e).add(t)),sj(e.url)&&(x.current.has(t)||(x.current.add(t),nj.injectElementSelector(t).then(e=>{x.current.delete(t),e&&D(e)}).catch(()=>{x.current.delete(t)})))})};if(chrome.tabs.onActivated.addListener(u),y.current=u,i)try{x.current.add(i),nj.injectElementSelector(i).then(e=>{x.current.delete(i),e&&D(e)}).catch(()=>{x.current.delete(i)})}catch{o("Failed to activate element selector")}},[e,D,s.isPaused,a,T,E,j]),_=U.useCallback(()=>{r(e=>({...e,steps:e.steps.map(e=>"type"===e.action&&e.isPending?{...e,isPending:!1}:e)}));const{steps:e}=s;f.current=!1,M&&A(),y.current&&(chrome.tabs.onActivated.removeListener(y.current),y.current=null),a.size>0&&(a.forEach(e=>{chrome.tabs.sendMessage(e,{type:"CANCEL_ELEMENT_SELECTOR"}).catch(()=>{})}),l(new Set)),h(void 0),p.current=void 0,x.current.clear(),c.current.clear(),d.current.clear(),r({isRecording:!1,isPaused:!1,steps:[],startTime:null}),e.length>0&&t&&t(e)},[s,t,a,M,A]),P=U.useCallback(()=>{const t=s.isPaused;if(r(e=>({...e,isPaused:!e.isPaused})),t){const t=u||e;t&&!x.current.has(t)&&(x.current.add(t),nj.injectElementSelector(t).then(e=>{x.current.delete(t),e&&D(e)}).catch(()=>{x.current.delete(t)}))}else x.current.clear(),a.size>0&&a.forEach(e=>{chrome.tabs.sendMessage(e,{type:"CANCEL_ELEMENT_SELECTOR"}).catch(()=>{})})},[s.isPaused,a,u,e,D]),V=U.useCallback(async()=>{s.isRecording&&(M?A():await j())},[s.isRecording,M,j,A]),H=U.useCallback(async()=>{if(e&&s.isRecording&&!s.isPaused)try{const t=await nj.injectElementSelector(e);t&&await D(t)}catch{o("Failed to capture action")}},[e,s,D]),$=U.useCallback(async e=>{if(!s.isRecording||s.isPaused)return;let t=`Navigate to ${e}`;try{const n=new URL(e),s=n.hostname.replace("www.",""),r="/"===n.pathname?"":n.pathname;t=r?`Navigate to ${s}${r}`:`Navigate to ${s}`}catch{}const n={action:"navigate",description:t,url:e,timestamp:Date.now()};r(e=>({...e,steps:[...e.steps,n]}))},[s]),z=U.useCallback(async(t,n)=>{if(!e||!s.isRecording||s.isPaused)return;await O(),await new Promise(e=>setTimeout(e,100));const i=g.current;g.current="";let o=`Type "${t.substring(0,30)}${t.length>30?"...":""}"`;t.includes("@")?o=`Enter email "${t}"`:t.length<20&&!t.includes(" ")?o=`Enter "${t}"`:t.length>50&&(o=`Type text: "${t.substring(0,50)}..."`);const a={action:"type",selector:n,value:t,screenshot:i,description:o,url:window.location.href,timestamp:Date.now()};r(e=>({...e,steps:[...e.steps,a]}))},[e,s,O]),F=U.useCallback(e=>{r(t=>({...t,steps:t.steps.filter((t,n)=>n!==e)}))},[]),B=U.useCallback((e,t)=>{r(n=>{const s=[...n.steps],[r]=s.splice(e,1);return s.splice(t,0,r),{...n,steps:s}})},[]),W=U.useCallback(()=>{r(e=>({...e,steps:[]}))},[]);return U.useEffect(()=>{v.current=a,k.current=u},[a,u]),Yn(u||e,t=>{const n=u||e;"loading"===t.status&&n&&x.current.has(n)&&x.current.delete(n),"complete"===t.status&&f.current&&!s.isPaused&&n&&chrome.tabs.get(n).then(e=>{if(!sj(e.url))return;if(!c.current.has(n)){c.current.add(n);const t=Date.now()-100,s={action:"navigate",description:`Navigate to ${e.url||"page"}`,url:e.url||"",tabId:n,timestamp:t};r(e=>({...e,steps:[...e.steps,s]}))}x.current.has(n)||(x.current.add(n),nj.injectElementSelector(n).then(e=>{x.current.delete(n),e&&D(e)}).catch(()=>{x.current.delete(n)}))})},["status"],[u,e,s.isPaused,D]),Yn(u||e,t=>{const n=u||e;!0===t.active&&f.current&&!s.isPaused&&n&&(chrome.tabs.sendMessage(n,{type:"CANCEL_ELEMENT_SELECTOR"}).catch(()=>{}),x.current.delete(n),setTimeout(()=>{f.current&&!s.isPaused&&chrome.tabs.get(n).then(e=>{sj(e.url)&&(x.current.add(n),nj.injectElementSelector(n).then(e=>{x.current.delete(n),e&&D(e)}).catch(()=>{x.current.delete(n)}))})},150))},["active"],[u,e,s.isPaused,D]),U.useEffect(()=>{const e=()=>{if(f.current){const e=v.current;e.size>0&&e.forEach(e=>{chrome.tabs.sendMessage(e,{type:"CANCEL_ELEMENT_SELECTOR"}).catch(()=>{})}),y.current&&(chrome.tabs.onActivated.removeListener(y.current),y.current=null)}};return window.addEventListener("pagehide",e),window.addEventListener("beforeunload",e),()=>{e(),window.removeEventListener("pagehide",e),window.removeEventListener("beforeunload",e)}},[]),{recordingState:s,error:i,isCapturing:m.current,isSpeechRecording:M,currentInterimTranscript:b,speechError:N,isSpeechSupported:T,hasSpeechPermission:E,startRecording:R,stopRecording:_,togglePause:P,toggleSpeechRecording:V,captureClick:H,captureNavigation:$,captureType:z,removeStep:F,reorderSteps:B,clearSteps:W}},ij=({steps:e,isVisible:t,onRemoveStep:n,onClose:s,fullScreen:o=!1,currentInterimTranscript:a="",isSpeechRecording:l=!1})=>{const c=U.useRef(null),d=U.useRef(null),u=U.useRef(null),[h,p]=U.useState(new Set);return U.useEffect(()=>{u.current?u.current.scrollIntoView({behavior:"smooth",block:"nearest"}):d.current&&d.current.scrollIntoView({behavior:"smooth",block:"end"})},[e.length,a]),t?q.jsxs(Qt.div,{initial:o?{opacity:0}:{opacity:0,x:300},animate:o?{opacity:1}:{opacity:1,x:0},exit:o?{opacity:0}:{opacity:0,x:300},className:o?"flex flex-col h-full":"fixed right-0 top-[60px] bottom-0 w-80 bg-white shadow-xl z-40 border-l border-gray-200",children:[!o&&q.jsxs("div",{className:"flex flex-col border-b border-gray-200",children:[q.jsxs("div",{className:"flex items-center justify-between p-4",children:[q.jsx("h3",{className:"font-base-bold text-text-100",children:q.jsx(r,{defaultMessage:"Steps ({count})",id:"HLzAq2Ombw",values:{count:e.length}})}),s&&q.jsx(i,{variant:"ghost",size:"icon_sm",onClick:s,className:"hover:bg-bg-500",children:q.jsx(f,{size:16})})]}),l&&a&&q.jsxs("div",{className:"px-4 pb-3 flex items-start gap-2",children:[q.jsx(Ss,{size:12,className:"text-accent-main-100 mt-1 flex-shrink-0 animate-pulse"}),q.jsx("p",{className:"text-text-300 font-base-sm italic flex-1",children:q.jsx(r,{defaultMessage:'"{transcript}"',id:"ICmjyWFB52",values:{transcript:a}})})]})]}),q.jsx("div",{ref:c,className:o?"flex-1 overflow-y-auto p-2":"overflow-y-auto h-[calc(100%-60px)] overflow-x-hidden",children:q.jsxs("div",{className:o?"space-y-1 max-w-3xl mx-auto":"p-2 space-y-2",children:[0===e.length&&q.jsx("div",{className:o?"text-center text-text-400 font-base py-8":"p-4 text-center text-text-400 font-base",children:q.jsx(r,{defaultMessage:"Click through your task to record each step",id:"vjsFq8zg2Y"})}),e.length>0&&q.jsx(Xt,{children:e.map((t,s)=>q.jsx(Qt.div,{ref:s===e.length-1?d:null,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,x:-100},className:"group relative",children:q.jsxs("div",{className:"rounded-2xl overflow-hidden transition-all hover:bg-bg-300",children:[q.jsxs("div",{className:"flex items-start justify-between px-3 py-3",children:[q.jsxs("div",{className:"flex items-start gap-3",children:[q.jsx("span",{className:"flex-shrink-0 flex items-center justify-center w-6 h-6 font-small-bold text-text-100 bg-bg-500 rounded-full",children:s+1}),q.jsxs("div",{className:"flex-1 pt-0.5",children:[q.jsx("p",{className:"text-text-100 font-base flex items-center gap-2",children:t.isEnhancing?q.jsx("span",{className:"inline-block bg-gradient-to-r from-text-400 via-text-200 to-text-400 bg-clip-text text-transparent animate-shimmertext bg-[length:400%_100%]",children:q.jsx(r,{defaultMessage:"Loading...",id:"gjBiyjshwX"})}):t.description}),t.tabId&&q.jsx("p",{className:"text-text-400 font-small text-xs mt-0.5",children:q.jsx(r,{defaultMessage:"Tab {tabId}",id:"iTW/IIP3mS",values:{tabId:t.tabId}})})]})]}),n&&q.jsx(i,{variant:"ghost",size:"icon_sm",onClick:()=>n(s),className:"opacity-0 group-hover:opacity-100 hover:bg-bg-500 !h-6 !w-6",children:q.jsx(C,{size:12})})]}),t.screenshot&&t.clickPosition&&q.jsx("div",{className:"px-3 pb-3",children:q.jsx("div",{className:"relative w-full h-48 overflow-hidden rounded-xl border-[0.5px] border-border-200",children:q.jsx(ei,{screenshot:`data:image/jpeg;base64,${t.screenshot}`,coordinates:[t.clickPosition.x,t.clickPosition.y],viewportDimensions:t.viewportDimensions,zoomLevel:2.5,className:"w-full h-full"})})}),t.speechTranscript&&q.jsx("div",{className:"px-3 pb-3",children:q.jsxs("button",{onClick:()=>{p(e=>{const t=new Set(e);return t.has(s)?t.delete(s):t.add(s),t})},className:"w-full flex items-center gap-2 px-3 py-2 bg-bg-200 hover:bg-bg-300 rounded-lg transition-colors text-left",children:[q.jsx(Ss,{size:12,className:"text-text-300 flex-shrink-0"}),q.jsx("span",{className:"text-text-200 font-base-sm flex-1",children:h.has(s)?q.jsx("span",{className:"italic",children:q.jsx(r,{defaultMessage:'"{transcript}"',id:"ICmjyWFB52",values:{transcript:t.speechTranscript}})}):q.jsxs(q.Fragment,{children:[q.jsx("span",{className:"italic",children:q.jsx(r,{defaultMessage:'"{transcript}"',id:"ICmjyWFB52",values:{transcript:t.speechTranscript.length>50?`${t.speechTranscript.substring(0,50)}...`:t.speechTranscript}})}),t.speechTranscript.length>50&&q.jsx("span",{className:"text-text-400 ml-1",children:q.jsx(r,{defaultMessage:"(click to expand)",id:"LcKcJVZQc7"})})]})})]})})]})},t.timestamp))}),o&&l&&q.jsx("div",{ref:u,className:"group relative rounded-2xl overflow-hidden transition-all hover:bg-bg-300",children:q.jsx("div",{className:"flex items-start justify-between px-3 py-3",children:q.jsxs("div",{className:"flex items-start gap-3",children:[q.jsx("span",{className:"flex-shrink-0 flex items-center justify-center w-6 h-6 font-small-bold text-text-100 bg-bg-500 rounded-full",children:e.length+1}),q.jsx("div",{className:"flex-1 pt-0.5",children:q.jsx("p",{className:"text-text-100 font-base flex items-center gap-2",children:a?q.jsx("span",{className:"inline-block bg-gradient-to-r from-text-400 via-text-200 to-text-400 bg-clip-text text-transparent animate-shimmertext bg-[length:400%_100%]",children:q.jsx(r,{defaultMessage:'"{transcript}"',id:"ICmjyWFB52",values:{transcript:a}})}):q.jsx("span",{className:"inline-block bg-gradient-to-r from-text-400 via-text-200 to-text-400 bg-clip-text text-transparent animate-shimmertext bg-[length:400%_100%]",children:q.jsx(r,{defaultMessage:"Listening...",id:"YAeW6K6mK9"})})})})]})})})]})}),!o&&e.length>0&&q.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-200",children:q.jsx("button",{className:"w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-base-bold",children:q.jsx(r,{defaultMessage:"Save as Teach Claude",id:"ZpE0fwR7on"})})})]}):null},oj=({recordingState:e,isSpeechRecording:t,isSpeechSupported:n,hasSpeechPermission:o,currentInterimTranscript:a,onStop:l,onTogglePause:c,onToggleSpeech:d,onRemoveStep:u,onSave:p,createMessage:m,isGeneratingSummary:f,setIsGeneratingSummary:g,currentUrl:y,pageTitle:x})=>{const b=s(),[w,v]=U.useState(!1),k=U.useMemo(()=>{if(!y)return"";try{return new URL(y).hostname}catch{return""}},[y]),M=U.useMemo(()=>k?`https://www.google.com/s2/favicons?domain=${k}&sz=32`:"",[k]),S=U.useCallback(async()=>{g(!0);let t="";if(e.steps.length>0)try{const{generateWorkflowSummary:n}=await te(async()=>{const{generateWorkflowSummary:e}=await import("./ModelSelector-B-fXYzGj.js").then(e=>e.aQ);return{generateWorkflowSummary:e}},__vite__mapDeps([0,1,2,3,4,5]));t=await n(e.steps,m,!0)}catch(r){}g(!1);let n=e.steps;if(a&&a.trim()){const e={action:"narration",description:`Note: "${a}"`,speechTranscript:a,timestamp:Date.now()};n=[...n,e]}const s=n.map(e=>({...e,screenshot:void 0}));p(s,t)},[e.steps,m,a,g,p]);return q.jsxs("div",{className:"flex flex-col h-full bg-bg-100",children:[q.jsxs("div",{className:"flex items-center justify-between px-4 pt-3 pb-3",children:[q.jsxs("div",{className:"flex items-center gap-2",children:[M&&!w?q.jsx("img",{src:M,className:"w-4 h-4",alt:"",onError:()=>v(!0)}):q.jsx(st,{size:16,className:"text-text-300"}),q.jsx("span",{className:"text-text-200 font-base-sm truncate max-w-[200px]",children:x||k})]}),q.jsx("button",{onClick:l,className:"p-1.5 rounded-md transition-colors text-text-300 hover:bg-bg-300 hover:text-text-100","aria-label":b.formatMessage({defaultMessage:"Close",id:"rbrahOGMC3"}),children:q.jsx(Bn,{size:12})})]}),q.jsx("div",{className:"flex-1 overflow-y-auto",children:q.jsx(ij,{steps:e.steps,isVisible:!0,onRemoveStep:u,fullScreen:!0,currentInterimTranscript:a,isSpeechRecording:t})}),q.jsx("div",{className:"mx-auto mb-3 max-w-3xl w-full px-3",children:q.jsx("div",{className:"bg-bg-000 border-[0.5px] border-border-300 hover:border-border-200 rounded-[14px] relative z-30 transition-colors focus-within:outline-none",style:{boxShadow:"0 4px 20px 0 rgba(0, 0, 0, 0.04)",outline:"none"},children:q.jsxs("div",{className:"flex flex-col gap-2 px-3 py-3",children:[q.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[q.jsx(h,{tooltipContent:b.formatMessage({defaultMessage:"Discard",id:"nmpevlUATU"}),side:"top",children:q.jsx(i,{variant:"secondary",size:"default",onClick:()=>{l()},"aria-label":b.formatMessage({defaultMessage:"Discard",id:"nmpevlUATU"}),className:"w-full px-0 min-w-0",children:q.jsx(C,{size:20})})}),q.jsx(h,{tooltipContent:e.isPaused?b.formatMessage({defaultMessage:"Resume",id:"3y9DGgura7"}):b.formatMessage({defaultMessage:"Pause",id:"tFFMkFDBMO"}),side:"top",children:q.jsx(i,{variant:"secondary",size:"default",onClick:c,"aria-label":e.isPaused?b.formatMessage({defaultMessage:"Resume",id:"3y9DGgura7"}):b.formatMessage({defaultMessage:"Pause",id:"tFFMkFDBMO"}),className:"w-full px-0 min-w-0",children:e.isPaused?q.jsx(Cs,{size:20}):q.jsx($r,{size:20,weight:"light"})})}),n&&q.jsx(h,{tooltipContent:t?b.formatMessage({defaultMessage:"Turn off voice narration",id:"Jiou5flQWh"}):o?b.formatMessage({defaultMessage:"Turn on voice narration",id:"FKVVjBA/2e"}):b.formatMessage({defaultMessage:"Microphone permission needed",id:"FPK1O1X8S1"}),side:"top",children:q.jsx(i,{variant:"secondary",size:"default",onClick:d,"aria-label":b.formatMessage({defaultMessage:"Toggle voice narration",id:"Yxxj6rmlSW"}),className:"w-full px-0 min-w-0 "+(t?"bg-accent-main-100 text-oncolor-100 border-accent-main-100":""),children:t?q.jsx(Wn,{size:20,weight:"light"}):q.jsx(_r,{size:20,weight:"light"})})})]}),q.jsx(i,{variant:"primary",size:"default",onClick:S,disabled:f||0===e.steps.length,"aria-label":b.formatMessage({defaultMessage:"Done",id:"JXdbo8Vnlw"}),className:"w-full",children:f?q.jsx(r,{defaultMessage:"Generating shortcut...",id:"9qWxtxsjAd"}):q.jsx(r,{defaultMessage:"Done",id:"JXdbo8Vnlw"})})]})})})]})};function aj({isOpen:e,onVoiceOver:t,onClose:n,currentUrl:o,pageTitle:a,hasMicrophonePermission:l}){const c=s(),d=U.useMemo(()=>{if(!o)return"";try{return new URL(o).hostname}catch{return""}},[o]),u=U.useMemo(()=>d?`https://www.google.com/s2/favicons?domain=${d}&sz=32`:"",[d]),[h,p]=U.useState(!1),[m,f]=U.useState(l);U.useEffect(()=>{if(!e)return;(async()=>{try{const e=await navigator.permissions.query({name:"microphone"});f("granted"===e.state),e.onchange=()=>{f("granted"===e.state)}}catch{f(l)}})()},[e,l]);const g=U.useCallback(async()=>{const e=await chrome.tabs.getCurrent(),t=e?.id,[n]=await chrome.tabs.query({active:!0,currentWindow:!0}),s=n?.id||t,r=chrome.runtime.getURL(`options.html#permissions?requestMicrophone=true&returnTabId=${s}`);chrome.tabs.create({url:r})},[]),y=U.useCallback(()=>{t()},[t]);return e?q.jsxs("div",{className:"flex flex-col h-full bg-bg-100",children:[q.jsxs("div",{className:"flex items-center justify-between px-4 pt-3 pb-3",children:[q.jsxs("div",{className:"flex items-center gap-2",children:[u&&!h?q.jsx("img",{src:u,className:"w-4 h-4",alt:"",onError:()=>p(!0)}):q.jsx(st,{size:16,className:"text-text-300"}),q.jsx("span",{className:"text-text-200 font-base-sm truncate max-w-[200px]",children:a||d})]}),q.jsx("button",{onClick:n,className:"p-1.5 rounded-md transition-colors text-text-300 hover:bg-bg-300 hover:text-text-100","aria-label":c.formatMessage({defaultMessage:"Close",id:"rbrahOGMC3"}),children:q.jsx(Bn,{size:12})})]}),q.jsx("div",{className:"flex-1 flex items-center justify-center px-4",children:q.jsxs("div",{className:"max-w-md w-full flex flex-col items-center text-center space-y-6",children:[q.jsx("div",{className:"w-full flex items-center justify-center",children:q.jsx("img",{src:"/assets/record-workflow-hero-CjmRJsCN.png",alt:c.formatMessage({defaultMessage:"Teach Claude your workflow",id:"83Jawm3PD0"}),className:"w-[360px] h-auto"})}),q.jsxs("div",{className:"space-y-2",children:[q.jsx("h2",{className:"font-base-bold text-text-100",children:q.jsx(r,{defaultMessage:"Teach Claude your workflow",id:"83Jawm3PD0"})}),q.jsx("p",{className:"text-text-300 font-base max-w-[280px] mx-auto",children:m?q.jsx(r,{defaultMessage:"Go through the steps as if you're teaching a new teammate. Claude will learn the process and repeat it for you.",id:"lbjPYg5eW9"}):q.jsx(r,{defaultMessage:"Enable your microphone to narrate as you demonstrate the workflow. Claude will learn the process and repeat it for you.",id:"FWGJ6cHLeQ"})})]})]})}),q.jsx("div",{className:"mx-auto mb-3 max-w-3xl w-full px-3",children:q.jsx("div",{className:"bg-bg-000 border-[0.5px] border-border-300 hover:border-border-200 rounded-[14px] relative z-30 transition-colors focus-within:outline-none",style:{boxShadow:"0 4px 20px 0 rgba(0, 0, 0, 0.04)",outline:"none"},children:q.jsx("div",{className:"flex flex-col gap-2 px-3 py-3",children:m?q.jsxs(i,{variant:"primary",size:"default",onClick:y,className:"w-full justify-center bg-always-black text-oncolor-100 hover:bg-always-black/90",children:[q.jsx(Wn,{size:16,weight:"fill",className:"mr-2"}),q.jsx(r,{defaultMessage:"Start recording",id:"QpxPqx4skB"})]}):q.jsxs(i,{variant:"primary",size:"default",onClick:g,className:"w-full justify-center bg-always-black text-oncolor-100 hover:bg-always-black/90",children:[q.jsx(Wn,{size:16,weight:"fill",className:"mr-2"}),q.jsx(r,{defaultMessage:"Enable microphone",id:"afNc7fLowL"})]})})})})]}):null}function lj(e){const{addServers:t,addTools:n,updateServerConnection:s}=On();U.useEffect(()=>{if(!e)return;let r;return async function(e,t){return E.fetchEventSource(`/api/oauth/organizations/${e}/mcp/v2/bootstrap`,{async onopen(e){if(!e.ok)throw new Error(`Connection failed: ${e.status} ${e.statusText}`)},onmessage(e){try{switch(e.event){case"server_list":{const n=JSON.parse(e.data);t.onServerList(n.servers||[]);break}case"tools":{const n=JSON.parse(e.data);t.onTools(n.server_uuid,n.tools||[]);break}case"server_base":{const n=JSON.parse(e.data);t.onServerBase(n.uuid,n.connected);break}}}catch(n){t.onError(n)}},onerror(e){throw t.onError(new Error("Bootstrap stream connection error")),e}})}(e,{onServerList:e=>{t(e)},onTools:(e,t)=>{n(e,t)},onServerBase:(e,t)=>{s(e,t)},onError:e=>{}}).then(e=>{r=e}).catch(e=>{}),()=>{r&&r()}},[e,t,n,s])}async function cj(e,t,n){try{const{blob:s,fileName:r}=await async function(e){const t=new URLSearchParams({path:e.filePath}),n=`/api/oauth/organizations/${e.organizationUuid}/conversations/${e.conversationUuid}/wiggle/download-file?${t}`;return{blob:await E.fetch(n),fileName:e.filePath.split("/").pop()||"download"}}({organizationUuid:t,conversationUuid:n,filePath:e}),i=URL.createObjectURL(s),o=document.createElement("a");o.href=i,o.download=r,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)}catch(s){}}const dj=new class{async sendMessage(e){return new Promise(t=>{chrome.runtime.sendMessage(e,e=>{chrome.runtime.lastError?t({success:!1,error:chrome.runtime.lastError.message}):t(e||{success:!1,error:"No response received"})})})}};function uj({tabId:e}){const[t,n]=U.useState(!1),s=U.useCallback(async()=>{if(e&&!t){n(!0);try{const t=await Sn.injectSelectionOverlay(e);if(!t)return void n(!1);let s;s=-1===t.width&&-1===t.height?await Sn.captureVisibleTab(e,!0):await Sn.captureRegion(e,t,!0);const r=await Sn.injectPromptOverlay(e,s,t);if(r.cancelled)return void n(!1);const i=s.replace(/^data:image\/\w+;base64,/,"");await dj.sendMessage({type:"SEND_MCP_NOTIFICATION",method:"notifications/message",params:{tabId:e,prompt:r.prompt,image:{type:"base64",media_type:"image/png",data:i}}})}catch(s){}finally{n(!1)}}},[e,t]);return U.useEffect(()=>{if(!t||!e)return;const s=t=>{"Escape"===t.key&&(Sn.cancelPromptOverlay(e),n(!1))};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[t,e]),q.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen h-full","data-theme":"claude",children:q.jsxs("div",{className:"flex flex-col items-center",children:[q.jsx("img",{src:"data:image/svg+xml,%3csvg%20width='47'%20height='38'%20viewBox='0%200%2047%2038'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M5.08191%2010.0769V0.938461H9.37422V10.0769H5.08191ZM9.23305%2010.0769V0.938461H13.5254V10.0769H9.23305ZM13.3842%2010.0769V0.938461H17.6765V10.0769H13.3842ZM17.5353%2010.0769V0.938461H21.8276V10.0769H17.5353ZM21.6865%2010.0769V0.938461H25.9788V10.0769H21.6865ZM25.8376%2010.0769V0.938461H30.1299V10.0769H25.8376ZM29.9888%2010.0769V0.938461H34.2811V10.0769H29.9888ZM34.1399%2010.0769V0.938461H38.4322V10.0769H34.1399ZM38.291%2010.0769V0.938461H42.5834V10.0769H38.291ZM0.930769%2019.0769V9.93846H5.22308V19.0769H0.930769ZM5.08191%2019.0769V9.93846H9.37422V19.0769H5.08191ZM9.23305%2019.0769V14.5077H13.5254V19.0769H9.23305ZM13.3842%2019.0769V9.93846H17.6765V19.0769H13.3842ZM17.5353%2019.0769V9.93846H21.8276V19.0769H17.5353ZM21.6865%2019.0769V9.93846H25.9788V19.0769H21.6865ZM25.8376%2019.0769V9.93846H30.1299V19.0769H25.8376ZM29.9888%2019.0769V9.93846H34.2811V19.0769H29.9888ZM34.1399%2019.0769V14.5077H38.4322V19.0769H34.1399ZM38.291%2019.0769V9.93846H42.5834V19.0769H38.291ZM42.4422%2019.0769V9.93846H46.7345V19.0769H42.4422ZM5.08191%2028.0769V18.9385H9.37422V28.0769H5.08191ZM9.23305%2028.0769V18.9385H13.5254V28.0769H9.23305ZM13.3842%2028.0769V18.9385H17.6765V28.0769H13.3842ZM17.5353%2028.0769V18.9385H21.8276V28.0769H17.5353ZM21.6865%2028.0769V18.9385H25.9788V28.0769H21.6865ZM25.8376%2028.0769V18.9385H30.1299V28.0769H25.8376ZM29.9888%2028.0769V18.9385H34.2811V28.0769H29.9888ZM34.1399%2028.0769V18.9385H38.4322V28.0769H34.1399ZM38.291%2028.0769V18.9385H42.5834V28.0769H38.291ZM5.08191%2037.0769V27.9385H9.37422V37.0769H5.08191ZM13.3842%2037.0769V27.9385H17.6765V37.0769H13.3842ZM29.9888%2037.0769V27.9385H34.2811V37.0769H29.9888ZM38.291%2037.0769V27.9385H42.5834V37.0769H38.291Z'%20fill='%23D97757'/%3e%3c/svg%3e",alt:"",className:"w-[212px] h-[120px] object-contain"}),q.jsx("div",{className:"text-text-200 text-base font-semibold mt-7 text-center font-claude-response",children:q.jsx(r,{defaultMessage:"Another Claude is using this tab",id:"8yJb2QLQAo",description:"Title shown when another Claude instance is controlling the browser tab"})}),q.jsx("div",{className:"text-text-300 text-sm font-normal mt-2 text-center max-w-[320px] font-base",children:t?q.jsx(r,{id:"npmO1c1YO3",defaultMessage:"Click and drag to select an area, or click once for full page",description:"Instructions shown when user is capturing a screenshot"}):q.jsx(r,{id:"+N2w6QNwn2",defaultMessage:"See something Claude should know about? Send a screenshot with a message.",description:"Subtitle prompting user to send a screenshot to Claude"})}),q.jsxs("button",{onClick:s,disabled:t||!e,className:"mt-7 mb-0.5 flex items-center gap-2 pl-5 pr-4 py-[10px] bg-accent-main-100 text-oncolor-100 rounded-[14px] hover:bg-accent-main-200 transition-colors font-ui font-medium text-[14px] disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-0",children:[q.jsx(et,{size:16}),t?q.jsx(r,{id:"XxhTmYWhHR",defaultMessage:"Select area...",description:"Button text while user is selecting screenshot area"}):q.jsx(r,{id:"U/yflCckmc",defaultMessage:"Send Screenshot to Claude",description:"Button text to initiate screenshot capture"})]}),q.jsx("div",{className:"mt-3 px-2 py-0.5 rounded-full bg-bg-300 text-text-300 text-xs font-medium font-ui",children:q.jsx(r,{id:"6aYmc7CQ0R",defaultMessage:"Research Preview",description:"Badge indicating this feature is in research preview"})})]})})}function hj(){const e=s(),t=Je();nE();const i=ao(),o=DT(),a=OT(),l=U.useMemo(()=>"window"===new URLSearchParams(window.location.search).get("mode"),[]),c=ao(oo(e=>({setShowCommandMenu:e.setShowCommandMenu,setShowWorkflowModeSelectionModal:e.setShowWorkflowModeSelectionModal,setShowSkipPermissionsOverlay:e.setShowSkipPermissionsOverlay,setShowShareWarningModal:e.setShowShareWarningModal,setShowAntBuildUpsell:e.setShowAntBuildUpsell,setShowFeedbackForm:e.setShowFeedbackForm,setShowNotificationBanner:e.setShowNotificationBanner,setAnnouncementDismissed:e.setAnnouncementDismissed,setSkipPermissionsWarningDismissed:e.setSkipPermissionsWarningDismissed,setIsMessageLimitDismissed:e.setIsMessageLimitDismissed,setShowTopGradient:e.setShowTopGradient,setHasBlockingWarning:e.setHasBlockingWarning,setCommandSearchTerm:e.setCommandSearchTerm,setIsGeneratingSummary:e.setIsGeneratingSummary,setPendingContinue:e.setPendingContinue,setLastGroupShowExpandedTimeline:e.setLastGroupShowExpandedTimeline,setLastGroupAnimationCompletedAt:e.setLastGroupAnimationCompletedAt,resetOnSessionClear:e.resetOnSessionClear}))),d=DT(oo(e=>({setPermissionPrompt:e.setPermissionPrompt,setPermissionMode:e.setPermissionMode,resetOnSessionClear:e.resetOnSessionClear}))),{data:u}=B(),{data:h,refetch:p}=Nn(),m=(()=>{const e=su(),t=ru(),n=nu();return e||t||n})();lj(u?.organization?.uuid);const{showFeedbackForm:f,setShowFeedbackForm:g,feedbackFormType:y,setFeedbackFormType:x,feedbackForMessage:C,setFeedbackForMessage:w,hardcodedFeedbackType:v,setHardcodedFeedbackType:k,submittedFeedback:M,setSubmittedFeedback:S}=function(){const[e,t]=U.useState(!1),[n,s]=U.useState("negative"),[r,i]=U.useState(null),[o,a]=U.useState(null),[l,c]=U.useState(new Map),d=U.useCallback(e=>{i(e),s("positive"),t(!0)},[]),u=U.useCallback(e=>{i(e),s("negative"),t(!0)},[]),h=U.useCallback(()=>{null!==r&&c(e=>{const t=new Map(e);return t.set(r,n),t}),t(!1),i(null),a(null)},[r,n]),p=U.useCallback(()=>{c(new Map),i(null),t(!1),a(null)},[]);return{showFeedbackForm:e,setShowFeedbackForm:t,feedbackFormType:n,setFeedbackFormType:s,feedbackForMessage:r,setFeedbackForMessage:i,hardcodedFeedbackType:o,setHardcodedFeedbackType:a,submittedFeedback:l,setSubmittedFeedback:c,handleThumbsUp:d,handleThumbsDown:u,handleFeedbackSubmit:h,clearFeedback:p}}(),{selectedModel:N,setSelectedModel:T,selectedModelRef:E,availableModelOptions:j,setAvailableModelOptions:I,modelConfig:O,usingFallbackNonStickyModelRef:L,loadStickyModel:D,setStickyModel:R}=function(e={}){const{onModelChange:t}=e,s=n.useDynamicConfig("chrome_ext_models").value,{loadStickyModel:r,setStickyModel:i}=an(),[o,a]=U.useState(s.default||"claude-sonnet-4-5-20250929"),l=U.useRef(o),c=U.useRef(!1),[d,u]=U.useState(()=>s.options||[]);return U.useEffect(()=>{l.current=o},[o]),U.useEffect(()=>{s.default&&!s.default_model_override_id&&a(s.default)},[s.default,s.default_model_override_id]),U.useEffect(()=>{s.options&&u(s.options)},[s.options]),{selectedModel:o,setSelectedModel:e=>{a(e),t?.(e)},selectedModelRef:l,availableModelOptions:d,setAvailableModelOptions:u,modelConfig:s,usingFallbackNonStickyModelRef:c,loadStickyModel:r,setStickyModel:i}}(),{anthropicApiKey:_,authToken:P,needsOAuth:V,isLoading:H,refreshTokenIfNeeded:$}=(()=>{const[e,t]=U.useState(!0),[n,s]=U.useState(!0),[r,i]=U.useState(void 0),[o,a]=U.useState(void 0),l=U.useCallback(async()=>{s(!0);const e=await le(),n=await J(G.ANTHROPIC_API_KEY)||void 0;t(void 0===e&&!0),i(e),a(n),s(!1)},[]),c=U.useCallback(async()=>{const{isRefreshed:e}=await ce();if(e){const e=await le();i(e)}},[]);return U.useEffect(()=>{l();const e=(e,t)=>{"local"===t&&[G.ACCESS_TOKEN,G.REFRESH_TOKEN,G.TOKEN_EXPIRY,G.ANTHROPIC_API_KEY].some(t=>t in e)&&l()};return chrome.storage.onChanged.addListener(e),()=>{chrome.storage.onChanged.removeListener(e)}},[l]),{authToken:r,needsOAuth:e,isLoading:n,anthropicApiKey:o,refreshTokenIfNeeded:c}})(),z=n.useDynamicConfig("chrome_ext_announcement"),F=ZT(),W=U.useRef(!1),Z=qE(u?.organization?.uuid,N,F),[Y,X]=Zn(G.NOTIFICATIONS_ENABLED,void 0),ee=U.useRef(()=>"skip_all_permission_checks"===o.permissionMode);ee.current=()=>"skip_all_permission_checks"===o.permissionMode;const te=U.useMemo(()=>new Hn(()=>ee.current()),[]),{isSidepanelVisible:ne}=function(){const[e,t]=U.useState(!document.hidden);return U.useEffect(()=>{const e=()=>{const e=!document.hidden;t(e)};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[]),{isSidepanelVisible:e}}(),{tabId:se,currentDomain:ie,setCurrentDomain:ae,currentUrl:he,setCurrentUrl:pe,tabTitle:me,blockedCategory:fe,setBlockedCategory:Me,blockedTabInfo:Se,setBlockedTabInfo:Ne,setIsOnBlockedPage:Te,shouldBlockDomain:Ee,shouldDisableSkipPermissions:je,shouldNotAllowSiteWidePermission:Ae,hasBrowserControlPermission:Ie,setHasBrowserControlPermission:Oe}=function(e){const{permissionManager:t,permissionMode:n,setPermissionMode:s}=e,[r,i]=U.useState(void 0),[o,a]=U.useState(void 0),[l,c]=U.useState(void 0),[d,u]=U.useState(void 0),[h,p]=U.useState(null),[m,f]=U.useState({isMainTabBlocked:!0,blockedTabs:[]}),[g,y]=U.useState(!1),[x,C]=U.useState(!1),b=chrome.runtime.getURL("blocked.html"),w="category0"!==h&&null!==h,v="category1"===h||"category2"===h||"category_org_blocked"===h||g,k="category3"===h;return t.setForcePrompt(k),U.useEffect(()=>{!async function(){const e=new URLSearchParams(window.location.search),r=e.get("tabId");let o;if(r)o=parseInt(r);else if("window"===e.get("mode")){const e=await J(G.TARGET_TAB_ID);e&&(o=e)}if(i(o),o)try{const e=await chrome.tabs.get(o);if(e.url){await ge.initialize();const r=await ge.isInGroup(o),i=ge.isMainTab(o);let l;if(r&&i){l=await ge.getGroupBlocklistStatus(o);const{isMainTabBlocked:e,blockedTabs:t}=await ge.getBlockedTabsInfo(o);f({isMainTabBlocked:e,blockedTabs:t})}else l=await ye.getCategory(e.url),f({isMainTabBlocked:!0,blockedTabs:[]});p(l||null),y(e.url.startsWith(b)),c(e.url),u(e.title);try{const r=new URL(e.url);a(r.hostname),await t.hasSiteWidePermissions(r.hostname)&&"ask"===n&&s("allow_for_site")}catch(Rt){a(void 0),"allow_for_site"===n&&s("ask")}}}catch(Rt){}}()},[b,n,t,s]),U.useEffect(()=>{if(!r)return;const e=(e,t)=>{if(e===r&&(void 0!==t.title&&u(t.title),void 0!==t.url)){c(t.url);try{const e=new URL(t.url);a(e.hostname)}catch{a(void 0)}}};return chrome.tabs.onUpdated.addListener(e),()=>{chrome.tabs.onUpdated.removeListener(e)}},[r]),U.useEffect(()=>{let e=!0;return J(G.BROWSER_CONTROL_PERMISSION_ACCEPTED).then(t=>{e&&C(!0===t)}),()=>{e=!1}},[]),U.useEffect(()=>((async()=>{try{await ge.initialize(),ge.startTabGroupChangeListener()}catch(Rt){}})(),()=>{ge.stopTabGroupChangeListener()}),[]),U.useEffect(()=>{w&&"ask"!==n&&s("ask")},[w,n,s]),{tabId:r,setTabId:i,currentDomain:o,setCurrentDomain:a,currentUrl:l,setCurrentUrl:c,tabTitle:d,setTabTitle:u,blockedCategory:h,setBlockedCategory:p,blockedTabInfo:m,setBlockedTabInfo:f,isOnBlockedPage:g,setIsOnBlockedPage:y,shouldBlockDomain:v,shouldDisableSkipPermissions:w,shouldNotAllowSiteWidePermission:k,hasBrowserControlPermission:x,setHasBrowserControlPermission:C}}({permissionManager:te,permissionMode:o.permissionMode,setPermissionMode:o.setPermissionMode}),{sendNotification:Le}=Un(se),De=U.useRef(!1),{isSecondaryTab:Re,mainTabId:_e}=function(e){const[t,n]=U.useState({isSecondaryTab:!1,mainTabId:null});U.useEffect(()=>{if(!e)return;let t=!0;return(async()=>{if(t)try{await ge.initialize();const s=await ge.isInGroup(e),r=ge.isMainTab(e);if(s&&!r){const s=await ge.getMainTabId(e);t&&s&&n({isSecondaryTab:!0,mainTabId:s})}else t&&n({isSecondaryTab:!1,mainTabId:null})}catch(Rt){}})(),()=>{t=!1}},[e]);const s=U.useCallback(()=>{e&&(async()=>{try{await ge.initialize();const t=await ge.isInGroup(e),s=ge.isMainTab(e);if(t&&!s){const t=await ge.getMainTabId(e);t&&n({isSecondaryTab:!0,mainTabId:t})}else if(n({isSecondaryTab:!1,mainTabId:null}),!t)try{await ge.createGroup(e),n({isSecondaryTab:!1,mainTabId:e})}catch(Rt){}}catch(Rt){}})()},[e]);return Kn(e,["groupId"],(t,n)=>{t===e&&"groupId"in n&&s()},[e,s]),t}(se),Pe=U.useRef(null),Ve=U.useRef(null),{value:He}=n.useFeatureGate("crochet_mcp_controlled"),[$e,ze]=U.useState(!1);U.useEffect(()=>{if(!He||!se)return void ze(!1);let e=!1;return ge.isTabMcp(se).then(t=>{e||ze(t)}),()=>{e=!0}},[He,se]);const Fe=U.useRef(null),Be=U.useRef(null),We=U.useRef(null),Ze=U.useRef(null),Ue=U.useRef(null),Ge=U.useRef(null),Ke=U.useRef({lastAssistantMessage:U.useRef(null),lastHumanMessage:U.useRef(null),extras:U.useRef(null),extraSpace:U.useRef(null),chatInput:U.useRef(null)}).current,{value:Ye}=n.useFeatureGate("crochet_can_skip_permissions"),{value:Qe}=n.useFeatureGate("chrome_ext_domain_transition_prompts"),Xe=Boolean(Qe||!1),{value:et}=n.useFeatureGate("crochet_can_submit_feedback"),{value:tt}=n.useFeatureGate("crochet_upsell_ant_build"),{value:nt}=n.useFeatureGate("chrome_ext_record_workflow"),{value:st}=n.useFeatureGate("chrome_ext_show_model_selector"),{value:rt}=n.useFeatureGate("chrome_ext_eligibility"),it=rt||m,{analytics:ot}=b(),at=u?.organization?.uuid,{attachments:lt,isUploading:ct,uploadingCount:dt,handleFiles:ut,handleDrop:ht,handlePaste:pt,removeAttachment:mt,clearAttachments:ft,addAttachment:gt}=Tn(),{isCapturing:yt,captureSelection:xt}=kn({tabId:se,onCapture:e=>gt(e)}),{permissionPromptRef:Ct}=function({permissionPrompt:e,messagesContainerRef:t}){const[n,s]=U.useState(0),r=U.useRef(null);return U.useEffect(()=>{const i=t.current;if(i){if(e&&r.current){const e=new ResizeObserver(e=>{const t=e[0];if(t){const e=t.contentRect.height,r=n,o=i.scrollHeight-i.scrollTop-i.clientHeight;s(e),r!==e&&o<100&&requestAnimationFrame(()=>{i.scrollTop=i.scrollHeight-i.clientHeight-o})}});return e.observe(r.current),()=>{e.disconnect()}}if(!e&&n>0){const e=i.scrollHeight-i.scrollTop-i.clientHeight-n;s(0),requestAnimationFrame(()=>{const t=i.scrollHeight-i.clientHeight-e;i.scrollTop=Math.max(0,t)})}}},[e,n,t]),{permissionPromptRef:r,permissionPromptHeight:n,paddingBottom:n>0?n-80+"px":"40px"}}({permissionPrompt:o.permissionPrompt,messagesContainerRef:Fe}),bt=aE(),wt=U.useCallback(async()=>(i.setShowShareWarningModal(!0),new Promise(e=>{Ve.current=e})),[i]),vt=U.useCallback(()=>{void 0===Y&&i.setShowNotificationBanner(!0)},[Y,i]),kt=U.useCallback(()=>{"enabled"===Y&&Le({title:e.formatMessage({defaultMessage:"Claude is done",id:"pnrK9Ss/bt"}),body:e.formatMessage({defaultMessage:"Your task is completed. Ready to check in?",id:"dXUR4BjgcC"})})},[Y,Le,e]),{messages:Mt,messageHistory:St,sendMessage:Nt,retryLastMessage:Tt,cancel:Et,clearMessages:jt,clearError:At,isLoading:It,isInitializing:Ot,hasInteractiveTools:Lt,isCompacting:Dt,error:Rt,messageLimit:_t,tokensSaved:Pt,createAnthropicMessage:Vt,lastStopReason:Ht,currentStatus:$t,conversationUuid:zt,useSessionsAPI:Ft,setUseSessionsAPI:Bt}=function(e){const[t,s]=U.useState(!1),r=U.useRef(!1),{value:i}=n.useFeatureGate("chrome_ext_default_sessions");return U.useEffect(()=>{(async()=>{const e=await J(G.USE_SESSIONS_API);void 0!==e?s(e):i&&(s(!0),await K(G.USE_SESSIONS_API,!0))})()},[i]),U.useEffect(()=>{r.current||K(G.USE_SESSIONS_API,t);const e=(e,n)=>{if("local"===n&&e[G.USE_SESSIONS_API]){const n=e[G.USE_SESSIONS_API].newValue;void 0!==n&&n!==t&&(r.current=!0,s(n),setTimeout(()=>{r.current=!1},0))}};return chrome.storage.onChanged.addListener(e),()=>chrome.storage.onChanged.removeListener(e)},[t]),{...iE(e),useSessionsAPI:t,setUseSessionsAPI:s}}({apiKey:_,authToken:P,refreshTokenIfNeeded:$,model:N,modelRef:E,sessionId:a.sessionId,deviceId:a.deviceId,existingSessionId:a.existingSessionIdToLoad,existingConversationUuid:a.existingConversationUuidToLoad,organizationUuid:u?.organization?.uuid,tabId:se,currentDomain:ie,onShowNotificationBanner:vt,onSendNotification:kt,onShareRequested:wt,onSessionCreated:e=>{Z.refreshSessions(),Z.setActiveSessionId(e)},permissionManager:te,permissionMode:o.permissionMode,onPermissionRequired:async e=>{o.setPermissionPrompt(e);try{const t=e.url?new URL(e.url).hostname:"this page";chrome.runtime.sendMessage({type:"SHOW_PERMISSION_NOTIFICATION",action:"browser_automation",domain:t},()=>{chrome.runtime.lastError})}catch(t){}return new Promise(e=>{Pe.current=e})}});!function(e,t){U.useEffect(()=>{const n=new URLSearchParams(window.location.search),s="true"===n.get("mcpPermissionOnly"),r=n.get("requestId");if(!s||!r)return;const i=`mcp_prompt_${r}`;chrome.storage.local.get(i).then(n=>{const s=n[i];s&&(t(s.prompt),e.current=e=>{chrome.runtime.sendMessage({type:"MCP_PERMISSION_RESPONSE",requestId:r,allowed:e}),setTimeout(()=>{window.close()},50)})})},[e,t])}(Pe,o.setPermissionPrompt),function(e,t){U.useEffect(()=>{if(!e||t!==e)return;const n=()=>{"hidden"===document.visibilityState&&ge.stopRunning()};return document.addEventListener("visibilitychange",n),()=>{document.removeEventListener("visibilitychange",n)}},[e,t])}(se,_e),function(e,t){const n=OT(e=>e.currentScheduledTaskRunId),s=OT(e=>e.currentScheduledTaskName),r=OT(e=>e.setCurrentScheduledTask),i=OT(e=>e.clearCurrentScheduledTask);U.useEffect(()=>{const e=sessionStorage.getItem("currentScheduledTaskRunId"),t=sessionStorage.getItem("currentScheduledTaskName");e&&t&&r(e,t)},[r]),U.useEffect(()=>{if(!n||0===e.length)return;const t=e[e.length-1];if("type"in t&&"result"===t.type)return;const s={role:t.role,content:"string"==typeof t.content?t.content:JSON.stringify(t.content),timestamp:Date.now()};IT.addLogMessage(n,s).catch(e=>{})},[n,e]),U.useEffect(()=>{if(!n||!s||t||0===e.length)return;const r=e[e.length-1];"assistant"===r.role&&"string"==typeof r.content&&(r.content.includes("<answer>")||r.content.includes("</answer>"))&&(IT.updateTaskRunStatus(n,"completed").catch(e=>{}),i(),sessionStorage.removeItem("currentScheduledTaskRunId"),sessionStorage.removeItem("currentScheduledTaskName"))},[n,s,e,t,i])}(Mt,It);const Wt=de,Zt=U.useMemo(()=>{try{return uE(Mt,It)}catch(e){return Mt.map((e,t)=>({type:"single",messages:[e],startIndex:t,endIndex:t}))}},[Mt,It]),{recordingState:Ut,error:qt,startRecording:Jt,stopRecording:Gt,togglePause:Kt,removeStep:Yt,isSpeechRecording:Qt,currentInterimTranscript:Xt,isSpeechSupported:en,hasSpeechPermission:tn,toggleSpeechRecording:nn}=rj({tabId:se,createMessage:Vt}),{isConvertingToTask:sn,conversionError:rn,showConversionError:on,handleConvertToScheduledTask:ln}=DE({messages:Mt,isAgentRunning:It,currentUrl:he,createAnthropicMessage:Vt}),cn=U.useCallback(async e=>{at&&zt&&await cj(e,at,zt)},[at,zt]),dn=function({lastStopReason:e,currentModel:t,modelConfig:n,onBlockingStateChange:s}){const i="refusal"===e?.reason,o=i&&!!n.modelFallbacks?.[t];return U.useEffect(()=>{s?.(i)},[i,s]),i?o?null:q.jsx(Zo,{type:"refusal",children:q.jsx("span",{className:"font-small",children:q.jsx(r,{defaultMessage:"Claude is unable to respond to this request, which appears to violate our <usagePolicyLink>Usage Policy</usagePolicyLink>. Please start a new chat.",id:"opnhVjl2Ux",values:{usagePolicyLink:e=>q.jsx("button",{onClick:()=>chrome.tabs.create({url:"https://www.anthropic.com/legal/aup"}),className:"inline-link",children:e})}})})}):null}({lastStopReason:Ht,currentModel:N,modelConfig:O,onBlockingStateChange:i.setHasBlockingWarning});U.useEffect(()=>{c.setHasBlockingWarning(!it)},[it,c]),function({tabId:e,isAgentRunning:t,hasInteractiveTools:n,domainTransitionPromptsEnabled:s,cancel:r,permissionMode:i,permissionManager:o,setPermissionPrompt:a,setBlockedCategory:l,setBlockedTabInfo:c,setIsOnBlockedPage:d,setPendingContinue:u,permissionResolveRef:h}){const p=U.useRef(new Map);U.useEffect(()=>{if(!e)return;chrome.tabs.get(e).then(t=>{t?.url&&p.current.set(e,t.url)});const t=(e,t,n)=>{"complete"===t.status&&n.url&&(p.current.has(e)||p.current.set(e,n.url))};return chrome.tabs.onUpdated.addListener(t),()=>{chrome.tabs.onUpdated.removeListener(t)}},[e]),U.useEffect(()=>{if(!e)return;const n=async n=>{if(0!==n.frameId)return;const{isMainTab:i,isSecondaryTab:m,group:f}=await xe(e,n.tabId);if(i||m)try{let g,y=n.url;if(i||m){const t=await Ce(n.tabId,n.url);if(f){g=await ge.getGroupBlocklistStatus(e);const{isMainTabBlocked:t,blockedTabs:n}=await ge.getBlockedTabsInfo(e);c({isMainTabBlocked:t,blockedTabs:n})}else g=t,c({isMainTabBlocked:!0,blockedTabs:[]});l(g||null)}be(g)&&t&&r(),"category1"===g&&(y=we(n.url),chrome.tabs.update(n.tabId,{url:y})),i&&d(y.startsWith(chrome.runtime.getURL("blocked.html")));const x=p.current.get(n.tabId),C=ve(x,n.url);if(C&&t&&s){const{oldDomain:e,newDomain:t}=C;if((await o.checkDomainTransition(e,t)).needsPrompt){r();const s=ke(e,t,y,n.tabId,!i);a(s),await new Promise(e=>{h.current=e})&&u(!0)}}}catch(Rt){}},i=async(t,n)=>{if(!e)return;const s=await ge.findGroupByMainTab(e);if(s&&s.chromeGroupId===t){l(n||null);const{isMainTabBlocked:t,blockedTabs:s}=await ge.getBlockedTabsInfo(e);c({isMainTabBlocked:t,blockedTabs:s})}},m=e=>{0===e.frameId&&p.current.set(e.tabId,e.url)},f=async n=>{if(0!==n.frameId||!e)return;await ge.initialize();const s=await ge.findGroupByTab(n.tabId);if(s&&s.mainTabId===e&&n.tabId!==e&&!t)try{await ge.setTabIndicatorState(n.tabId,"static")}catch(Rt){}};return chrome.webNavigation.onBeforeNavigate.addListener(n),chrome.webNavigation.onCommitted.addListener(m),chrome.webNavigation.onCompleted.addListener(f),ge.addBlocklistListener(i),()=>{chrome.webNavigation.onBeforeNavigate.removeListener(n),chrome.webNavigation.onCommitted.removeListener(m),chrome.webNavigation.onCompleted.removeListener(f),ge.removeBlocklistListener(i)}},[e,t,n,s,r,i,o,a,l,c,d,u,h])}({tabId:se,isAgentRunning:It,hasInteractiveTools:Lt,domainTransitionPromptsEnabled:Xe,cancel:Et,permissionMode:o.permissionMode,permissionManager:te,setPermissionPrompt:o.setPermissionPrompt,setBlockedCategory:Me,setBlockedTabInfo:Ne,setIsOnBlockedPage:Te,setPendingContinue:i.setPendingContinue,permissionResolveRef:Pe}),function({tabId:e,isAgentRunning:t,hasInteractiveTools:n,isSidepanelVisible:s,setBlockedCategory:r,setBlockedTabInfo:i}){U.useEffect(()=>{e&&(async()=>{if(!e)return;await ge.initialize();const s=await ge.isInGroup(e),r=ge.isMainTab(e);let i;if(i=s?r?e:await ge.getMainTabId(e)||e:e,n&&t)setTimeout(async()=>{try{await chrome.tabs.sendMessage(i,{type:"SHOW_AGENT_INDICATORS"})}catch(Rt){}},300),await ge.startRunning(i);else if(!t||!n){try{await chrome.tabs.sendMessage(i,{type:"HIDE_AGENT_INDICATORS"})}catch(Rt){}await ge.stopRunning()}})()},[n,t,e]),Kn("all",["active"],async(n,s)=>{if(s.active&&t&&e&&(await ge.initialize(),await ge.isInGroup(n)))try{const s=await chrome.tabs.get(n),r=await chrome.tabs.get(e);if(s.groupId!==r.groupId)return;await ge.addTabToIndicatorGroup({tabId:n,isRunning:t})}catch(Rt){}},[t,e]),Kn("all",["groupId","url"],async(n,s)=>{if("groupId"in s&&void 0!==s.groupId&&e)try{await ge.initialize();const t=await ge.isInGroup(e),r=ge.isMainTab(e);if(t&&r){const t=await ge.findGroupByMainTab(e);t&&t.memberTabs.length>1&&await ge.showSecondaryTabIndicators(e),t&&t.chromeGroupId===s.groupId&&n!==e&&(await ge.addTabToGroup(e,n),await ge.setTabIndicatorState(n,"static"))}}catch(Rt){}if(s.url&&"about:blank"!==s.url&&e)try{await ge.initialize();const o=await ge.findGroupByTab(n);if(o&&o.mainTabId===e){await ge.updateTabBlocklistStatus(n,s.url);const o=await ge.getGroupBlocklistStatus(e),{isMainTabBlocked:a,blockedTabs:l}=await ge.getBlockedTabsInfo(e);if(i({isMainTabBlocked:a,blockedTabs:l}),r(o||null),!t&&n!==e)try{await ge.setTabIndicatorState(n,"static")}catch(Rt){}}}catch(Rt){}},[e,t,i,r]),U.useEffect(()=>{if(!e)return;const t=setTimeout(async()=>{try{await ge.initialize();const t=await chrome.tabs.get(e);if(t.groupId===chrome.tabGroups.TAB_GROUP_ID_NONE)return;const n=t.groupId,s=await ge.findGroupByTab(e);s?.isUnmanaged&&await ge.adoptOrphanedGroup(s.mainTabId,n),await ge.showStaticIndicatorsForChromeGroup(n)}catch(Rt){}},3e3);return()=>{clearTimeout(t),(async()=>{try{await ge.hideSecondaryTabIndicators(e)}catch(Rt){}})()}},[e,t]),U.useEffect(()=>{!s&&e&&ge.removeCompletionPrefix(e).catch(e=>{})},[s,e])}({tabId:se,isAgentRunning:It,hasInteractiveTools:Lt,isSidepanelVisible:ne,setBlockedCategory:Me,setBlockedTabInfo:Ne}),U.useEffect(()=>{const e=new URLSearchParams(window.location.search),t="true"===e.get("mcpPermissionOnly"),n=e.get("requestId");if(t&&n){const e=`mcp_prompt_${n}`;chrome.storage.local.get(e).then(t=>{const n=t[e];n&&d.setPermissionPrompt(n.prompt)}),Pe.current=e=>{chrome.runtime.sendMessage({type:"MCP_PERMISSION_RESPONSE",requestId:n,allowed:e}),setTimeout(()=>window.close(),50)}}},[d]),U.useEffect(()=>{tt&&"fcoeoabgfenejglbffodgkkbkcdhcgfn"===chrome.runtime.id&&!De.current&&(c.setShowAntBuildUpsell(!0),De.current=!0)},[tt,c]),U.useEffect(()=>{te.setCanSkipPermissions(Ye)},[Ye,te]),U.useEffect(()=>{se&&chrome.runtime.sendMessage({type:"PANEL_OPENED",tabId:se,mainTabId:_e||se}).catch(console.error)},[se,_e]),U.useEffect(()=>{J(G.ANNOUNCEMENT_DISMISSED).then(e=>{const t=z.get("id","");c.setAnnouncementDismissed(e===t&&!!t)})},[z,c]),U.useEffect(()=>{W.current&&K(G.LAST_PERMISSION_MODE_PREFERENCE,o.permissionMode)},[o.permissionMode]),U.useEffect(()=>{Z.activeSessionId&&!Ft&&Bt(!0)},[Z.activeSessionId,Ft,Bt]),U.useEffect(()=>{let e=!0;return(async()=>{try{if("true"===new URLSearchParams(window.location.search).get("skipPermissions"))return void(W.current=!0);let t=await J(G.LAST_PERMISSION_MODE_PREFERENCE);if(!e)return;"ask"===t&&(t=ue),void 0!==t&&!je&&Wt.includes(t)?d.setPermissionMode(t):d.setPermissionMode(ue)}catch(t){}finally{W.current=!0}})(),()=>{e=!1}},[je,Wt,d]),U.useEffect(()=>{const e=()=>{"hidden"===document.visibilityState&&(async()=>{chrome.runtime.sendMessage({type:"PANEL_CLOSED",tabId:se,mainTabId:_e||se}).catch(console.error),se&&(await ge.initialize(),ge.isMainTab(se)&&ge.stopRunning().catch(console.debug))})()};return document.addEventListener("visibilitychange",e),(async()=>{try{if(a.existingSessionIdToLoad)return;const e=(O.options||[]).map(e=>"string"==typeof e?{model:e,name:e}:e),t=new URLSearchParams(window.location.search).get("model");if(t&&e.some(e=>e.model===t))T(t);else{const t=await D(e);if(L.current)return;if(null!=O.default_model_override_id&&null!=O.default){await J(G.MODEL_OVERRIDE_SEEN)!==O.default_model_override_id?(T(O.default),await R(O.default),await K(G.MODEL_OVERRIDE_SEEN,O.default_model_override_id)):t&&T(t)}else t&&T(t)}}catch(e){}})(),()=>{document.removeEventListener("visibilitychange",e)}},[se,_e,O,D,R,a.existingSessionIdToLoad,T,L]),U.useEffect(()=>{c.setIsMessageLimitDismissed(!1)},[_t,c]),U.useEffect(()=>{c.setSkipPermissionsWarningDismissed(!1)},[a.sessionId,c]),U.useEffect(()=>{Be.current&&(Be.current.style.height="auto",Be.current.style.height=`${Be.current.scrollHeight}px`)},[a.inputText]),U.useEffect(()=>{!a.inputText&&Be.current&&(Be.current.style.height="auto")},[a.inputText]),U.useEffect(()=>{const e=e=>{if("Escape"===e.key&&It&&!yt&&Et(),"Tab"===e.key&&e.shiftKey&&Ye){e.preventDefault();const t=(Wt.indexOf(o.permissionMode)+1)%Wt.length;o.setPermissionMode(Wt[t]),ot?.track("claude_chrome.permission_mode.changed",{from:o.permissionMode,to:Wt[t],method:"keyboard_shortcut"})}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[It,Et,yt,o.permissionMode,Ye,ot,Wt,o]),U.useEffect(()=>{o.permissionPrompt&&Ze.current?.scrollToBottom("smooth",{onlyIfPinned:!0})},[o.permissionPrompt]),U.useEffect(()=>{const e=Ze.current?.getScrollContainer();if(!e)return;const t=()=>{const{scrollTop:t}=e;c.setShowTopGradient(t>10)};return e.addEventListener("scroll",t,{passive:!0}),()=>e.removeEventListener("scroll",t)},[H,bt.isBlocked,V,Ie,c]),U.useEffect(()=>{"true"===new URLSearchParams(window.location.search).get("mcpPermissionOnly")||(o.permissionPrompt&&"enabled"===Y&&Le({title:e.formatMessage({defaultMessage:"Claude had to pause",id:"x8JhFG5A3f"}),body:e.formatMessage({defaultMessage:"Your permission is needed to continue",id:"qEqMmrx/MW"})}),o.permissionPrompt&&se&&ge.addPermissionPrefix(se).catch(console.debug))},[e,o.permissionPrompt,Y,Le,se]),U.useEffect(()=>{"window"===new URLSearchParams(window.location.search).get("mode")&&chrome.windows.getCurrent(e=>{chrome.runtime.sendMessage({type:"resize_window",windowId:e.id})})},[]),Kn("all",["url","status"],async(e,t)=>{if(e===se){if(t.url){pe(t.url);try{const e=new URL(t.url);ae(e.hostname);await te.hasSiteWidePermissions(e.hostname)&&"ask"===o.permissionMode&&o.setPermissionMode("allow_for_site")}catch(n){ae(void 0),"allow_for_site"===o.permissionMode&&o.setPermissionMode("ask")}}"complete"===t.status&&Lt&&It&&ge.addTabToIndicatorGroup({tabId:se,isRunning:It}).catch(console.debug)}},[se,Lt,It]),U.useEffect(()=>{i.pendingContinue&&!It&&(c.setPendingContinue(!1),Nt("continue",void 0,void 0,!0))},[i.pendingContinue,It,Nt,c]);const un=U.useMemo(()=>{if("refusal"===Ht?.reason&&!!O.modelFallbacks?.[N])return null;if(!it)return"eligibility";if(Rt)return"error";if(dn)return"refusal";if(("exceeded_limit"===_t.type||"approaching_limit"===_t.type)&&!i.isMessageLimitDismissed)return"messageLimit";if("skip_all_permission_checks"===o.permissionMode&&!i.skipPermissionsWarningDismissed)return"highRisk";if(i.showNotificationBanner&&void 0===Y)return"notification";const e=z.get("text","");return z.get("enabled",!1)&&e&&!i.announcementDismissed?"announcement":null},[Rt,Ht,N,O,it,dn,_t,i.isMessageLimitDismissed,o.permissionMode,i.skipPermissionsWarningDismissed,i.showNotificationBanner,Y,z,i.announcementDismissed]),hn=U.useCallback(async()=>{const e=lt.some(e=>!e.error);if((a.inputText.trim()||e)&&!It&&(P||_)){let e=a.inputText.trim();if(e.startsWith("/")){const t=e.slice(1).split(" ")[0],n=e.slice(1+t.length).trim(),s=await Q.getPromptByCommand(t);s?(ot?.track("claude_chrome.chat.system_command_executed",{sessionId:a.sessionId||"",commandName:t,commandType:"shortcut"}),e=s.prompt,n&&(e=e+" "+n)):En(t)&&ot?.track("claude_chrome.chat.system_command_executed",{sessionId:a.sessionId||"",commandName:t,commandType:"system"})}const t=lt.filter(e=>!e.error).map(e=>{let t="image/jpeg";return"image/png"===e.file.type?t="image/png":"image/gif"===e.file.type?t="image/gif":"image/webp"===e.file.type&&(t="image/webp"),{base64:e.base64,mediaType:t,id:e.id}});a.setInputText(""),ft();const n=lt.some(e=>e.isAnnotated);await Nt(e,t,n)}},[lt,It,P,_,ot,ft,Nt,a]),pn=U.useCallback(async(e,t)=>{if(!o.permissionPrompt||!Pe.current)return;if(o.permissionPrompt.tool===re.REMOTE_MCP&&o.permissionPrompt.actionData?.remoteMcp&&e===oe.ALWAYS)try{const e=o.permissionPrompt.actionData.remoteMcp.alwaysApprovedKey,t=h?.enabled_mcp_tools||{};await jn({enabled_mcp_tools:{...t,[e]:!0}}),await p()}catch(n){}await te.grantPermission(t,e,e===oe.ONCE?o.permissionPrompt.toolUseId:void 0),Pe.current(!0),Pe.current=null,o.setPermissionPrompt(null),se&&It&&ge.addLoadingPrefix(se).catch(()=>{})},[h,p,te,se,It,o]),mn=U.useCallback(()=>{Pe.current&&(Pe.current(!1),Pe.current=null,o.setPermissionPrompt(null))},[o]);!function({tabId:e,isSecondaryTab:t,isAgentRunning:n,cancel:s,handlePermissionDeny:r,sessionHistory:i,sessionStore:o,permissionStore:a,sendMessage:l,setSelectedModel:c,addAttachment:d,clearAttachments:u,anthropicApiKey:h,authToken:p,hasBrowserControlPermission:m}){U.useEffect(()=>{if(!o.existingConversationUuidToLoad||0===i.sessions.length)return;if(o.existingSessionIdToLoad)return;const e=i.sessions.find(e=>e.uuid===o.existingConversationUuidToLoad);e&&(o.setExistingSessionIdToLoad(e.session_id??void 0),i.setActiveSessionId(e.session_id))},[o.existingConversationUuidToLoad,o.existingSessionIdToLoad,o.setExistingSessionIdToLoad,i,o]),U.useEffect(()=>{const f=(f,g,y)=>{if("PING_SIDEPANEL"===f.type)return y({success:!0,tabId:e}),!0;if("MAIN_TAB_ACK_REQUEST"===f.type)return e!==f.mainTabId||t||(chrome.runtime.sendMessage({type:"MAIN_TAB_ACK_RESPONSE",secondaryTabId:f.secondaryTabId,mainTabId:e,success:!0}),y({success:!0})),!0;if("STOP_AGENT"===f.type)return n&&s(),r(),y({success:!0}),!0;if("EXECUTE_TASK"===f.type){const t=new URLSearchParams(window.location.search),s="window"===t.get("mode"),r=t.get("sessionId");if(s&&r){if(f.windowSessionId!==r)return}else{if(s||f.windowSessionId)return;if(f.targetTabId&&e&&e!==f.targetTabId)return}"true"===t.get("skipPermissions")&&a.setPermissionMode("skip_all_permission_checks");const i=f.isScheduledTask&&f.taskName?`[Scheduled Task: ${f.taskName}]\n${f.prompt}`:f.prompt;return!n&&(h||p)&&i.trim()&&(o.setInputText(""),l(i)),y({success:!0}),!0}if("POPULATE_INPUT_TEXT"===f.type){const e=f.prompt||"";o.setInputText(e),o.setPendingPrompt(e),f.permissionMode&&a.setPermissionMode(f.permissionMode),f.selectedModel&&c(f.selectedModel);const t=[];let s=!1;if(f.attachments&&f.attachments.length>0)for(const n of f.attachments)try{const e=atob(n.base64),r=new Uint8Array(e.length);for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);const i=new Blob([r],{type:n.mediaType}),o=new File([i],n.fileName,{type:n.mediaType}),a={id:n.id,file:o,base64:n.base64,url:`data:${n.mediaType};base64,${n.base64}`,isAnnotated:n.isAnnotated};d(a),t.push({base64:n.base64,mediaType:n.mediaType,id:n.id}),n.isAnnotated&&(s=!0)}catch(Rt){}setTimeout(()=>{!n&&(h||p)&&e.trim()&&m&&(o.setInputText(""),o.setPendingPrompt(null),u(),l(e,t.length>0?t:void 0,s))},500),y({success:!0})}else if("LOAD_CONVERSATION"===f.type){if(f.conversationUuid){o.setExistingConversationUuidToLoad(f.conversationUuid);const e=i.sessions.find(e=>e.uuid===f.conversationUuid);e&&(o.setExistingSessionIdToLoad(e.session_id??void 0),i.setActiveSessionId(e.session_id))}y({success:!0})}};return chrome.runtime.onMessage.addListener(f),()=>{chrome.runtime.onMessage.removeListener(f)}},[i,o,e,t,n,s,r,h,p,l,a,c,d,u,m])}({tabId:se,isSecondaryTab:Re,isAgentRunning:It,cancel:Et,handlePermissionDeny:mn,sessionHistory:Z,sessionStore:a,permissionStore:o,sendMessage:Nt,setSelectedModel:T,addAttachment:gt,clearAttachments:ft,anthropicApiKey:_,authToken:P,hasBrowserControlPermission:Ie});const fn=U.useCallback(()=>{mn();const e=()=>{jt();a.generateNewSessionId();S(new Map),i.resetOnSessionClear(),setTimeout(()=>{Be.current?.focus()},50)};It?(Et(),setTimeout(e,100)):e()},[It,Et,jt,mn,S,a,i]),gn=U.useCallback(async e=>{if(e===Z.activeSessionId)return;It&&Et(),jt();const t=Z.sessions.find(t=>t.session_id===e);if(a.setExistingSessionIdToLoad(e),a.setExistingConversationUuidToLoad(t?.uuid),Z.setActiveSessionId(e),t?.session_id)try{const e=await Z.getSessionModel(t.session_id)||await D(j);e&&(T(e),L.current=!1)}catch(n){}},[Z,It,Et,jt,D,j,a,T,L]),yn=U.useCallback(()=>{fn(),Z.setActiveSessionId(null),a.setExistingSessionIdToLoad(void 0),a.setExistingConversationUuidToLoad(void 0)},[fn,Z,a]),xn=U.useCallback(async e=>{const t=Z.sessions.find(t=>t.uuid===e);await Z.deleteConversationById(e),t?.session_id===Z.activeSessionId&&yn()},[Z,yn]),Cn=U.useCallback(async(e,t)=>{u?.organization?.uuid&&(await An({organizationUuid:u.organization.uuid,conversationUuid:e,name:t}),await Z.refreshSessions())},[u?.organization?.uuid,Z]),bn=U.useCallback(async()=>{await X("enabled"),i.setShowNotificationBanner(!1)},[X,i]),wn=U.useCallback(async()=>{i.setShowNotificationBanner(!1),await X("disabled")},[X,i]),vn=U.useCallback(async()=>{const e=z.get("id","");i.setAnnouncementDismissed(!0),await K(G.ANNOUNCEMENT_DISMISSED,e)},[z,i]),Mn=U.useCallback(async e=>{try{if(null!==C&&C>=0){const e=new Map(M);e.set(C,y),S(e)}if(!et)return;ot?.track("claude_chrome.chat.feedback",{...e,sessionId:a.sessionId,permissions:o.permissionMode})}catch(t){}},[C,M,S,y,et,ot,a.sessionId,o.permissionMode]),Sn=U.useCallback(e=>{x("positive"),w(e),k(null),g(!0)},[x,w,k,g]),On=U.useCallback(e=>{x("negative"),w(e),k(null),g(!0)},[x,w,k,g]),Ln=U.useCallback(e=>{const t=O.modelFallbacks?.[N];if(t){j.some(t=>("string"==typeof t?t:t.model)===e)||I([...j,{model:t.fallbackModelName,name:t.fallbackDisplayName}])}T(e),E.current=e,L.current=!0,Tt()},[O.modelFallbacks,N,j,I,Tt,T,E,L]),Dn=U.useCallback(()=>{x("negative"),w(null),k("sc/false_positive"),g(!0)},[x,w,k,g]),Rn=U.useCallback(e=>{L.current||R(e)},[R,L]);if("true"===new URLSearchParams(window.location.search).get("mcpPermissionOnly"))return q.jsx(CE,{permissionPrompt:o.permissionPrompt,onAllow:pn,onDeny:mn,disableAlwaysAllow:Ae});if(H)return q.jsx(A,{});if(bt.isBlocked)return q.jsx(SE,{currentVersion:bt.currentVersion,minSupportedVersion:bt.minSupportedVersion||""});if(V)return q.jsx(lE,{});if(!Ie)return q.jsx(ME,{onAccept:()=>{K(G.BROWSER_CONTROL_PERMISSION_ACCEPTED,!0).then(()=>{Oe(!0),a.pendingPrompt&&setTimeout(()=>{Nt(a.pendingPrompt),a.setPendingPrompt(null),a.setInputText("")},100)})}});if(He&&$e&&!l)return q.jsx(uj,{tabId:se});if(Re&&_e&&!l)return q.jsx(WE,{mainTabId:_e,onSwitchToMainTab:()=>{}});const _n=Se.blockedTabs.some(e=>e.tabId!==se&&("category1"===e.category||"category2"===e.category||"category_org_blocked"===e.category)),Pn=Se.blockedTabs.find(e=>e.tabId===se)?.category||fe;return Ee||_n?q.jsx(TE,{isMainTabBlocked:Se.isMainTabBlocked,category:Pn}):q.jsxs("div",{className:"relative h-screen","data-theme":"claude",children:[q.jsx(LE,{isActive:"skip_all_permission_checks"===o.permissionMode}),qt&&Ut.isRecording&&q.jsx("div",{className:"fixed top-12 left-4 right-4 z-50 bg-red-100 text-red-700 p-2 rounded text-sm",children:qt}),Ut.isRecording&&en&&!tn&&q.jsxs("div",{className:"fixed top-12 left-4 right-4 z-50 bg-yellow-100 text-yellow-800 p-2 rounded text-sm flex items-center gap-2",children:[q.jsx(Ss,{size:12}),q.jsx("span",{children:q.jsx(r,{defaultMessage:"<link>Enable microphone</link> for voice narration. Recording workflow without speech.",id:"ECOs1wUY9P",values:{link:e=>q.jsx("button",{onClick:()=>chrome.runtime.openOptionsPage(),className:"inline-link hover:no-underline cursor-pointer",children:e})}})})]}),q.jsxs("div",{className:"flex flex-col h-screen bg-bg-100 relative overflow-hidden",children:[!Ut.isRecording&&!i.showWorkflowModeSelectionModal&&q.jsx(ej,{showModelSelector:st,selectedModel:N,onModelChange:T,modelConfig:O,availableModelOptions:j,handleStickyModelChange:Rn,useSessionsAPI:Ft??!1,onNewConversation:yn,onClearChat:fn,onSessionsToggle:e=>{yn(),Bt(e)},sessions:Z.sessions,activeSessionId:Z.activeSessionId,onSelectSession:gn,onConversationDelete:xn,onConversationRename:Cn,isLoadingSessions:Z.isLoading,onLoadMoreSessions:Z.loadMore,hasMoreSessions:Z.hasMore,onConvertToScheduledTask:ln,isConvertingToTask:sn,isAgentRunning:It,onOpenOptions:()=>chrome.runtime.openOptionsPage(),hasMessages:Mt.length>0}),i.showWorkflowModeSelectionModal?q.jsx(aj,{isOpen:!0,onVoiceOver:async()=>{i.setShowWorkflowModeSelectionModal(!1),await Jt(!0)},onClose:()=>i.setShowWorkflowModeSelectionModal(!1),currentUrl:he,pageTitle:me,hasMicrophonePermission:tn}):Ut.isRecording?q.jsx(oj,{recordingState:Ut,isSpeechRecording:Qt,isSpeechSupported:en,hasSpeechPermission:tn,currentInterimTranscript:Xt,onStop:Gt,onTogglePause:Kt,onToggleSpeech:nn,onRemoveStep:Yt,onSave:(e,t)=>{a.setPromptToSave({prompt:t}),Gt()},createMessage:Vt,isGeneratingSummary:i.isGeneratingSummary,setIsGeneratingSummary:i.setIsGeneratingSummary,currentUrl:he,pageTitle:me}):q.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden relative",children:[q.jsx(mo,{messages:Mt,messageGroups:Zt,messageHistory:St,isAgentRunning:It,isCompacting:Dt,isInitializing:Ot,showConversionError:on,conversionError:rn,hasPermissionPrompt:!!o.permissionPrompt,currentStatus:$t,tokensSaved:Pt,isDarkMode:t,tabId:se,autoScrollRef:Ze,scrollRefs:Ke,sentinelRef:Ge,submittedFeedback:M,onThumbsUp:Sn,onThumbsDown:On,onSavePrompt:e=>a.setPromptToSave({prompt:e}),onEditShortcut:async e=>{const t=await Q.getPromptById(e);t&&a.setPromptToEdit(t)},onComputerFileClick:cn,onPromptClick:e=>{a.setInputText(e),setTimeout(()=>{Be.current&&(Be.current.style.height="auto",Be.current.style.height=`${Be.current.scrollHeight}px`,Be.current.focus())},0)},children:q.jsx(AT,{inputText:a.inputText,setInputText:a.setInputText,attachments:lt,isUploading:ct,uploadingCount:dt,hasBlockingWarning:i.hasBlockingWarning,chromeExtEligibility:it,permissionMode:o.permissionMode,setPermissionMode:o.setPermissionMode,supportedPermissionModes:Wt,canSkipPermissions:Ye,shouldDisableSkipPermissions:je,messages:Mt,isAgentRunning:It,recordingState:Ut,isSpeechRecording:Qt,isSpeechSupported:en,hasSpeechPermission:tn,isGeneratingSummary:i.isGeneratingSummary,setIsGeneratingSummary:i.setIsGeneratingSummary,handleDrop:ht,handlePaste:pt,handleFiles:ut,removeAttachment:mt,handleSend:hn,cancel:Et,captureSelection:xt,sendMessage:Nt,stopRecording:Gt,togglePause:Kt,toggleSpeechRecording:nn,setShowWorkflowModeSelectionModal:i.setShowWorkflowModeSelectionModal,setPromptToSave:a.setPromptToSave,setPromptToEdit:a.setPromptToEdit,activeBanner:un,messageStopWarning:dn,error:Rt,onRetryError:Rt?Tt:void 0,onClearError:At,messageLimit:_t,lastStopReason:Ht,selectedModel:N,modelConfig:O,skipPermissionsWarningDismissed:i.skipPermissionsWarningDismissed,setSkipPermissionsWarningDismissed:i.setSkipPermissionsWarningDismissed,isMessageLimitDismissed:i.isMessageLimitDismissed,setIsMessageLimitDismissed:i.setIsMessageLimitDismissed,showNotificationBanner:i.showNotificationBanner,notificationsEnabled:Y,announcementConfig:z,announcementDismissed:i.announcementDismissed,handleEnableNotifications:bn,handleDismissNotificationBanner:wn,handleDismissAnnouncement:vn,handleRetryWithFallback:Ln,handleSendFeedbackForRefusal:Dn,recordWorkflowEnabled:nt,isCapturing:yt,currentUrl:he,useSessionsAPI:Ft??!1,autoScrollRef:Ze,sentinelRef:Ge,isStreaming:It,fileInputRef:Ue,chatInputContainerRef:We,analytics:ot,createAnthropicMessage:Vt})}),o.permissionPrompt&&q.jsx("div",{ref:Ct,className:"absolute bottom-0 left-0 right-0 z-[10] "+((Ze.current?.getScrollContainer()?.scrollHeight??0)>(Ze.current?.getScrollContainer()?.clientHeight??0)?"pr-2":""),children:q.jsxs("div",{className:"mx-auto max-w-3xl md:px-2",children:[q.jsx("div",{className:"mx-3 md:mx-0 border border-border-300 rounded-[14px] shadow-[0_4px_20px_0_rgba(0,0,0,0.04)] bg-bg-100",children:q.jsx(gE,{tool:o.permissionPrompt.tool,url:o.permissionPrompt.url,screenshot:o.permissionPrompt.actionData?.screenshot,coordinate:o.permissionPrompt.actionData?.coordinate,typeText:o.permissionPrompt.actionData?.text,uploadImageData:o.permissionPrompt.actionData?.imageId?(()=>{const e=qe(Mt,o.permissionPrompt.actionData.imageId);return e?`data:image/png;base64,${e.base64}`:void 0})():void 0,plan:o.permissionPrompt.actionData?.plan,fromDomain:o.permissionPrompt.actionData?.fromDomain,toDomain:o.permissionPrompt.actionData?.toDomain,actionData:o.permissionPrompt.actionData,onAllow:pn,onDeny:mn,disableAlwaysAllow:Ae})}),q.jsx("div",{className:"bg-bg-100 h-3"})]})})]}),f&&q.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 flex justify-center px-3 pb-3",children:q.jsx("div",{className:"w-full max-w-3xl border border-border-300 rounded-[14px] bg-bg-100",children:q.jsx(IE,{onClose:()=>{g(!1),k(null)},onSubmit:Mn,feedbackType:y,message:null!==C?Mt[C]:null,hardcodedType:v,messageId:v?Ht?.messageId:null})})}),q.jsx(EE,{isOpen:i.showSkipPermissionsOverlay,onClose:()=>i.setShowSkipPermissionsOverlay(!1),onConfirm:async()=>{if(!je){if(o.permissionPrompt&&"permission_required"===o.permissionPrompt.type){const{host:e}=new URL(o.permissionPrompt.url),t={type:"netloc",netloc:e};pn(oe.ONCE,t)}o.setPermissionMode("skip_all_permission_checks")}}}),q.jsx(jE,{isOpen:i.showAntBuildUpsell,onClose:()=>i.setShowAntBuildUpsell(!1)}),(null!==a.promptToSave||null!==a.promptToEdit)&&q.jsx(RE,{prompt:a.promptToEdit||a.promptToSave||void 0,sessionId:a.sessionId,currentModel:N,onClose:()=>{a.setPromptToSave(null),a.setPromptToEdit(null)},onSave:e=>{a.promptToSave?(a.setPromptToSave(null),a.setInputText(`/${e}`),i.setShowCommandMenu(!0),i.setCommandSearchTerm(e),setTimeout(()=>{if(Be.current){Be.current.focus();const e=Be.current.value.length;Be.current.setSelectionRange(e,e)}},50)):a.setPromptToEdit(null)},onDelete:()=>a.setPromptToEdit(null),generateName:async e=>{try{return await In(e,e=>Vt(e,void 0,"generate_shortcut_name"))}catch(t){return""}}}),!1,q.jsx(BE,{organizationUuid:u?.organization?.uuid})]})]})}$n(),zn(),W.createRoot(document.getElementById("root")).render(q.jsx(Y.StrictMode,{children:q.jsx(Z,{pageName:"Side Panel",children:q.jsx(hj,{})})}));
