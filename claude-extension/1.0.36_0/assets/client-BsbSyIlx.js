import{R as e}from"./permissions-DQjjgS8V.js";function t(e){const[t,s]=e.split(","),n=t.match(/:(.*?);/)?.[1]||"image/png",r=atob(s),i=new Uint8Array(r.length);for(let o=0;o<r.length;o++)i[o]=r.charCodeAt(o);return new Blob([i],{type:n})}function s(e){return new Promise((t,s)=>{const n=new FileReader;n.onloadend=()=>t(n.result),n.onerror=s,n.readAsDataURL(e)})}function n(e){return e&&e.includes(",")&&e.split(",")[1]||""}function r(e,t="image/png"){const s=atob(e),n=new Uint8Array(s.length);for(let r=0;r<s.length;r++)n[r]=s.charCodeAt(r);return new Blob([n],{type:t})}function i(){return`ss_${Date.now().toString().slice(-4)}${Math.random().toString(36).substring(2,7)}`}const o=e=>{let t;const s=new Set,n=(e,n)=>{const r="function"==typeof e?e(t):e;if(!Object.is(r,t)){const e=t;t=(null!=n?n:"object"!=typeof r||null===r)?r:Object.assign({},t,r),s.forEach(s=>s(t,e))}},r=()=>t,i={setState:n,getState:r,getInitialState:()=>o,subscribe:e=>(s.add(e),()=>s.delete(e))},o=t=e(n,r,i);return i},a=e=>e;const c=t=>{const s=(e=>e?o(e):o)(t),n=t=>function(t,s=a){const n=e.useSyncExternalStore(t.subscribe,e.useCallback(()=>s(t.getState()),[t,s]),e.useCallback(()=>s(t.getInitialState()),[t,s]));return e.useDebugValue(n),n}(s,t);return Object.assign(n,s),n},l=e=>e?c(e):c,h=l((e,t)=>({remoteServers:{},remoteTools:{},addServers:t=>e(e=>({remoteServers:t.reduce((e,t)=>({...e,[t.uuid]:t}),e.remoteServers)})),addTools:(t,s)=>e(e=>({remoteTools:{...e.remoteTools,[t]:s}})),updateServerConnection:(t,s)=>e(e=>{const n=e.remoteServers[t];return n?{remoteServers:{...e.remoteServers,[t]:{...n,connected:s}}}:e}),getServerByUuid:e=>t().remoteServers[e]}));function u(e,t,s,n,r){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,s),s}function d(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)}let p=function(){const{crypto:e}=globalThis;if(e?.randomUUID)return p=e.randomUUID.bind(e),e.randomUUID();const t=new Uint8Array(1),s=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^s()&15>>+e/4).toString(16))};function f(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}const g=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){const t=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return new Error(JSON.stringify(e))}catch{}}return new Error(e)};class m extends Error{}class y extends m{constructor(e,t,s,n){super(`${y.makeMessage(e,t,s)}`),this.status=e,this.headers=n,this.requestID=n?.get("request-id"),this.error=t}static makeMessage(e,t,s){const n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,s,n){if(!e||!n)return new w({message:s,cause:g(t)});const r=t;return 400===e?new v(e,r,s,n):401===e?new k(e,r,s,n):403===e?new S(e,r,s,n):404===e?new x(e,r,s,n):409===e?new R(e,r,s,n):422===e?new M(e,r,s,n):429===e?new O(e,r,s,n):e>=500?new P(e,r,s,n):new y(e,r,s,n)}}class b extends y{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class w extends y{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class _ extends w{constructor({message:e}={}){super({message:e??"Request timed out."})}}class v extends y{}class k extends y{}class S extends y{}class x extends y{}class R extends y{}class M extends y{}class O extends y{}class P extends y{}const A=/^[a-z][a-z0-9+.-]*:/i;let $=e=>($=Array.isArray,$(e)),T=$;function q(e){return"object"!=typeof e?{}:e??{}}const E=e=>{try{return JSON.parse(e)}catch(t){return}},I="0.57.0";const j=()=>{const e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":I,"X-Stainless-OS":U(Deno.build.os),"X-Stainless-Arch":L(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":I,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":I,"X-Stainless-OS":U(globalThis.process.platform??"unknown"),"X-Stainless-Arch":L(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const t=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:s}of e){const e=s.exec(navigator.userAgent);if(e){return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":I,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":I,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};const L=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",U=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let N;function W(...e){const t=globalThis.ReadableStream;if(void 0===t)throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function C(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return W({start(){},async pull(e){const{done:s,value:n}=await t.next();s?e.close():e.enqueue(n)},async cancel(){await(t.return?.())}})}function D(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const X=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)});let H,B;function F(e){let t;return(H??(t=new globalThis.TextEncoder,H=t.encode.bind(t)))(e)}function J(e){let t;return(B??(t=new globalThis.TextDecoder,B=t.decode.bind(t)))(e)}var K,V;class z{constructor(){K.set(this,void 0),V.set(this,void 0),u(this,K,new Uint8Array),u(this,V,null)}decode(e){if(null==e)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?F(e):e;u(this,K,function(e){let t=0;for(const r of e)t+=r.length;const s=new Uint8Array(t);let n=0;for(const r of e)s.set(r,n),n+=r.length;return s}([d(this,K,"f"),t]));const s=[];let n;for(;null!=(n=G(d(this,K,"f"),d(this,V,"f")));){if(n.carriage&&null==d(this,V,"f")){u(this,V,n.index);continue}if(null!=d(this,V,"f")&&(n.index!==d(this,V,"f")+1||n.carriage)){s.push(J(d(this,K,"f").subarray(0,d(this,V,"f")-1))),u(this,K,d(this,K,"f").subarray(d(this,V,"f"))),u(this,V,null);continue}const e=null!==d(this,V,"f")?n.preceding-1:n.preceding,t=J(d(this,K,"f").subarray(0,e));s.push(t),u(this,K,d(this,K,"f").subarray(n.index)),u(this,V,null)}return s}flush(){return d(this,K,"f").length?this.decode("\n"):[]}}function G(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}function Q(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}K=new WeakMap,V=new WeakMap,z.NEWLINE_CHARS=new Set(["\n","\r"]),z.NEWLINE_REGEXP=/\r\n|[\n\r]/g;const Y={off:0,error:200,warn:300,info:400,debug:500},Z=(e,t,s)=>{var n,r;if(e)return n=Y,r=e,Object.prototype.hasOwnProperty.call(n,r)?e:void re(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(Y))}`)};function ee(){}function te(e,t,s){return!t||Y[e]>Y[s]?ee:t[e].bind(t)}const se={error:ee,warn:ee,info:ee,debug:ee};let ne=new WeakMap;function re(e){const t=e.logger,s=e.logLevel??"off";if(!t)return se;const n=ne.get(t);if(n&&n[0]===s)return n[1];const r={error:te("error",t,s),warn:te("warn",t,s),info:te("info",t,s),debug:te("debug",t,s)};return ne.set(t,[s,r]),r}const ie=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"x-api-key"===e.toLowerCase()||"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);var oe,ae,ce;class le{constructor(e,t,s){this.iterator=e,oe.set(this,void 0),this.controller=t,u(this,oe,s)}static fromSSEResponse(e,t,s){let n=!1;const r=s?re(s):console;return new le(async function*(){if(n)throw new m("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let s=!1;try{for await(const s of async function*(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new m("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new m("Attempted to iterate over a response with no body")}const s=new he,n=new z,r=D(e.body);for await(const i of async function*(e){let t=new Uint8Array;for await(const s of e){if(null==s)continue;const e=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?F(s):s;let n,r=new Uint8Array(t.length+e.length);for(r.set(t),r.set(e,t.length),t=r;-1!==(n=Q(t));)yield t.slice(0,n),t=t.slice(n)}t.length>0&&(yield t)}(r))for(const e of n.decode(i)){const t=s.decode(e);t&&(yield t)}for(const i of n.flush()){const e=s.decode(i);e&&(yield e)}}(e,t)){if("completion"===s.event)try{yield JSON.parse(s.data)}catch(i){throw r.error("Could not parse message into JSON:",s.data),r.error("From chunk:",s.raw),i}if("message_start"===s.event||"message_delta"===s.event||"message_stop"===s.event||"content_block_start"===s.event||"content_block_delta"===s.event||"content_block_stop"===s.event)try{yield JSON.parse(s.data)}catch(i){throw r.error("Could not parse message into JSON:",s.data),r.error("From chunk:",s.raw),i}if("ping"!==s.event&&"error"===s.event)throw new y(void 0,E(s.data)??s.data,void 0,e.headers)}s=!0}catch(i){if(f(i))return;throw i}finally{s||t.abort()}},t,s)}static fromReadableStream(e,t,s){let n=!1;return new le(async function*(){if(n)throw new m("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let s=!1;try{for await(const t of async function*(){const t=new z,s=D(e);for await(const e of s)for(const s of t.decode(e))yield s;for(const e of t.flush())yield e}())s||t&&(yield JSON.parse(t));s=!0}catch(r){if(f(r))return;throw r}finally{s||t.abort()}},t,s)}[(oe=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const e=[],t=[],s=this.iterator(),n=n=>({next:()=>{if(0===n.length){const n=s.next();e.push(n),t.push(n)}return n.shift()}});return[new le(()=>n(e),this.controller,d(this,oe,"f")),new le(()=>n(t),this.controller,d(this,oe,"f"))]}toReadableStream(){const e=this;let t;return W({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:s,done:n}=await t.next();if(n)return e.close();const r=F(JSON.stringify(s)+"\n");e.enqueue(r)}catch(s){e.error(s)}},async cancel(){await(t.return?.())}})}}class he{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,n]=function(e,t){const s=e.indexOf(t);if(-1!==s)return[e.substring(0,s),t,e.substring(s+t.length)];return[e,"",""]}(e,":");return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}async function ue(e,t){const{response:s,requestLogID:n,retryOfRequestLogID:r,startTime:i}=t,o=await(async()=>{if(t.options.stream)return re(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(s,t.controller):le.fromSSEResponse(s,t.controller);if(204===s.status)return null;if(t.options.__binaryResponse)return s;const n=s.headers.get("content-type"),r=n?.split(";")[0]?.trim();if(r?.includes("application/json")||r?.endsWith("+json")){return de(await s.json(),s)}return await s.text()})();return re(e).debug(`[${n}] response parsed`,ie({retryOfRequestLogID:r,url:s.url,status:s.status,body:o,durationMs:Date.now()-i})),o}function de(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("request-id"),enumerable:!1})}class pe extends Promise{constructor(e,t,s=ue){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=s,ae.set(this,void 0),u(this,ae,e)}_thenUnwrap(e){return new pe(d(this,ae,"f"),this.responsePromise,async(t,s)=>de(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(d(this,ae,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}ae=new WeakMap;class fe{constructor(e,t,s,n){ce.set(this,void 0),u(this,ce,e),this.options=n,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new m("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await d(this,ce,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(ce=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class ge extends pe{constructor(e,t,s){super(e,t,async(e,t)=>new s(e,t.response,await ue(e,t),t.options))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}class me extends fe{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.has_more=s.has_more||!1,this.first_id=s.first_id||null,this.last_id=s.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){if(this.options.query?.before_id){const e=this.first_id;return e?{...this.options,query:{...q(this.options.query),before_id:e}}:null}const e=this.last_id;return e?{...this.options,query:{...q(this.options.query),after_id:e}}:null}}const ye=()=>{if("undefined"==typeof File){const{process:e}=globalThis,t="string"==typeof e?.versions?.node&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function be(e,t,s){return ye(),new File(e,t??"unknown_file",s)}function we(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}const _e=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],ve=new WeakMap;const ke=async(e,t)=>{if(!(await function(e){const t="function"==typeof e?e:e.fetch,s=ve.get(t);if(s)return s;const n=(async()=>{try{const e="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;return s.toString()!==await new e(s).text()}catch{return!0}})();return ve.set(t,n),n}(t)))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const s=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>Se(s,e,t))),s},Se=async(e,t,s)=>{if(void 0!==s){if(null==s)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(s instanceof Response){let n={};const r=s.headers.get("Content-Type");r&&(n={type:r}),e.append(t,be([await s.blob()],we(s),n))}else if(_e(s))e.append(t,be([await new Response(C(s)).blob()],we(s)));else if((e=>e instanceof Blob&&"name"in e)(s))e.append(t,be([s],we(s),{type:s.type}));else if(Array.isArray(s))await Promise.all(s.map(s=>Se(e,t+"[]",s)));else{if("object"!=typeof s)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`);await Promise.all(Object.entries(s).map(([s,n])=>Se(e,`${t}[${s}]`,n)))}}},xe=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function Re(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(xe(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else{if(!_e(e)){const t=e?.constructor?.name;throw new Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";const t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}for await(const s of e)t.push(...await Re(s))}return t}class Me{constructor(e){this._client=e}}const Oe=Symbol.for("brand.privateNullableHeaders");function*Pe(e){if(!e)return;if(Oe in e){const{values:t,nulls:s}=e;yield*t.entries();for(const e of s)yield[e,null];return}let t,s=!1;e instanceof Headers?t=e.entries():T(e)?t=e:(s=!0,t=Object.entries(e??{}));for(let n of t){const e=n[0];if("string"!=typeof e)throw new TypeError("expected header name to be a string");const t=T(n[1])?n[1]:[n[1]];let r=!1;for(const n of t)void 0!==n&&(s&&!r&&(r=!0,yield[e,null]),yield[e,n])}}const Ae=e=>{const t=new Headers,s=new Set;for(const n of e){const e=new Set;for(const[r,i]of Pe(n)){const n=r.toLowerCase();e.has(n)||(t.delete(r),e.add(n)),null===i?(t.delete(r),s.add(n)):(t.append(r,i),s.delete(n))}}return{[Oe]:!0,values:t,nulls:s}};function $e(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const Te=Object.freeze(Object.create(null)),qe=((e=$e)=>function(t,...s){if(1===t.length)return t[0];let n=!1;const r=[],i=t.reduce((t,i,o)=>{/[?#]/.test(i)&&(n=!0);const a=s[o];let c=(n?encodeURIComponent:e)(""+a);return o!==s.length&&(null==a||"object"==typeof a&&a.toString===Object.getPrototypeOf(Object.getPrototypeOf(a.hasOwnProperty??Te)??Te)?.toString)&&(c=a+"",r.push({start:t.length+i.length,length:c.length,error:`Value of type ${Object.prototype.toString.call(a).slice(8,-1)} is not a valid path parameter`})),t+i+(o===s.length?"":c)},""),o=i.split(/[?#]/,1)[0],a=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let c;for(;null!==(c=a.exec(o));)r.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can't be safely passed as a path parameter`});if(r.sort((e,t)=>e.start-t.start),r.length>0){let e=0;const t=r.reduce((t,s)=>{const n=" ".repeat(s.start-e),r="^".repeat(s.length);return e=s.start+s.length,t+n+r},"");throw new m(`Path parameters result in path with invalid segments:\n${r.map(e=>e.error).join("\n")}\n${i}\n${t}`)}return i})($e);class Ee extends Me{list(e={},t){const{betas:s,...n}=e??{};return this._client.getAPIList("/v1/files",me,{query:n,...t,headers:Ae([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString()},t?.headers])})}delete(e,t={},s){const{betas:n}=t??{};return this._client.delete(qe`/v1/files/${e}`,{...s,headers:Ae([{"anthropic-beta":[...n??[],"files-api-2025-04-14"].toString()},s?.headers])})}download(e,t={},s){const{betas:n}=t??{};return this._client.get(qe`/v1/files/${e}/content`,{...s,headers:Ae([{"anthropic-beta":[...n??[],"files-api-2025-04-14"].toString(),Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}retrieveMetadata(e,t={},s){const{betas:n}=t??{};return this._client.get(qe`/v1/files/${e}`,{...s,headers:Ae([{"anthropic-beta":[...n??[],"files-api-2025-04-14"].toString()},s?.headers])})}upload(e,t){const{betas:s,...n}=e;return this._client.post("/v1/files",(async(e,t)=>({...e,body:await ke(e.body,t)}))({body:n,...t,headers:Ae([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString()},t?.headers])},this._client))}}let Ie=class extends Me{retrieve(e,t={},s){const{betas:n}=t??{};return this._client.get(qe`/v1/models/${e}?beta=true`,{...s,headers:Ae([{...null!=n?.toString()?{"anthropic-beta":n?.toString()}:void 0},s?.headers])})}list(e={},t){const{betas:s,...n}=e??{};return this._client.getAPIList("/v1/models?beta=true",me,{query:n,...t,headers:Ae([{...null!=s?.toString()?{"anthropic-beta":s?.toString()}:void 0},t?.headers])})}};class je{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){const e=new z;for await(const t of this.iterator)for(const s of e.decode(t))yield JSON.parse(s);for(const t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new m("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new m("Attempted to iterate over a response with no body")}return new je(D(e.body),t)}}let Le=class extends Me{create(e,t){const{betas:s,...n}=e;return this._client.post("/v1/messages/batches?beta=true",{body:n,...t,headers:Ae([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},t?.headers])})}retrieve(e,t={},s){const{betas:n}=t??{};return this._client.get(qe`/v1/messages/batches/${e}?beta=true`,{...s,headers:Ae([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString()},s?.headers])})}list(e={},t){const{betas:s,...n}=e??{};return this._client.getAPIList("/v1/messages/batches?beta=true",me,{query:n,...t,headers:Ae([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},t?.headers])})}delete(e,t={},s){const{betas:n}=t??{};return this._client.delete(qe`/v1/messages/batches/${e}?beta=true`,{...s,headers:Ae([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString()},s?.headers])})}cancel(e,t={},s){const{betas:n}=t??{};return this._client.post(qe`/v1/messages/batches/${e}/cancel?beta=true`,{...s,headers:Ae([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString()},s?.headers])})}async results(e,t={},s){const n=await this.retrieve(e);if(!n.results_url)throw new m(`No batch \`results_url\`; Has it finished processing? ${n.processing_status} - ${n.id}`);const{betas:r}=t??{};return this._client.get(n.results_url,{...s,headers:Ae([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary"},s?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((e,t)=>je.fromResponse(t.response,t.controller))}};const Ue=e=>{if(0===e.length)return e;let t=e[e.length-1];switch(t.type){case"separator":return e=e.slice(0,e.length-1),Ue(e);case"number":let s=t.value[t.value.length-1];if("."===s||"-"===s)return e=e.slice(0,e.length-1),Ue(e);case"string":let n=e[e.length-2];if("delimiter"===n?.type)return e=e.slice(0,e.length-1),Ue(e);if("brace"===n?.type&&"{"===n.value)return e=e.slice(0,e.length-1),Ue(e);break;case"delimiter":return e=e.slice(0,e.length-1),Ue(e)}return e},Ne=e=>JSON.parse((e=>{let t="";return e.map(e=>{"string"===e.type?t+='"'+e.value+'"':t+=e.value}),t})((e=>{let t=[];return e.map(e=>{"brace"===e.type&&("{"===e.value?t.push("}"):t.splice(t.lastIndexOf("}"),1)),"paren"===e.type&&("["===e.value?t.push("]"):t.splice(t.lastIndexOf("]"),1))}),t.length>0&&t.reverse().map(t=>{"}"===t?e.push({type:"brace",value:"}"}):"]"===t&&e.push({type:"paren",value:"]"})}),e})(Ue((e=>{let t=0,s=[];for(;t<e.length;){let n=e[t];if("\\"===n){t++;continue}if("{"===n){s.push({type:"brace",value:"{"}),t++;continue}if("}"===n){s.push({type:"brace",value:"}"}),t++;continue}if("["===n){s.push({type:"paren",value:"["}),t++;continue}if("]"===n){s.push({type:"paren",value:"]"}),t++;continue}if(":"===n){s.push({type:"separator",value:":"}),t++;continue}if(","===n){s.push({type:"delimiter",value:","}),t++;continue}if('"'===n){let r="",i=!1;for(n=e[++t];'"'!==n;){if(t===e.length){i=!0;break}if("\\"===n){if(t++,t===e.length){i=!0;break}r+=n+e[t],n=e[++t]}else r+=n,n=e[++t]}n=e[++t],i||s.push({type:"string",value:r});continue}if(n&&/\s/.test(n)){t++;continue}let r=/[0-9]/;if(n&&r.test(n)||"-"===n||"."===n){let i="";for("-"===n&&(i+=n,n=e[++t]);n&&r.test(n)||"."===n;)i+=n,n=e[++t];s.push({type:"number",value:i});continue}let i=/[a-z]/i;if(n&&i.test(n)){let r="";for(;n&&i.test(n)&&t!==e.length;)r+=n,n=e[++t];if("true"!=r&&"false"!=r&&"null"!==r){t++;continue}s.push({type:"name",value:r});continue}t++}return s})(e)))));var We,Ce,De,Xe,He,Be,Fe,Je,Ke,Ve,ze,Ge,Qe,Ye,Ze,et,tt,st,nt,rt,it,ot;const at="__json_buf";function ct(e){return"tool_use"===e.type||"server_tool_use"===e.type||"mcp_tool_use"===e.type}class lt{constructor(){We.add(this),this.messages=[],this.receivedMessages=[],Ce.set(this,void 0),this.controller=new AbortController,De.set(this,void 0),Xe.set(this,()=>{}),He.set(this,()=>{}),Be.set(this,void 0),Fe.set(this,()=>{}),Je.set(this,()=>{}),Ke.set(this,{}),Ve.set(this,!1),ze.set(this,!1),Ge.set(this,!1),Qe.set(this,!1),Ye.set(this,void 0),Ze.set(this,void 0),st.set(this,e=>{if(u(this,ze,!0),f(e)&&(e=new b),e instanceof b)return u(this,Ge,!0),this._emit("abort",e);if(e instanceof m)return this._emit("error",e);if(e instanceof Error){const t=new m(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new m(String(e)))}),u(this,De,new Promise((e,t)=>{u(this,Xe,e),u(this,He,t)})),u(this,Be,new Promise((e,t)=>{u(this,Fe,e),u(this,Je,t)})),d(this,De,"f").catch(()=>{}),d(this,Be,"f").catch(()=>{})}get response(){return d(this,Ye,"f")}get request_id(){return d(this,Ze,"f")}async withResponse(){const e=await d(this,De,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new lt;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,s){const n=new lt;for(const r of t.messages)n._addMessageParam(r);return n._run(()=>n._createMessage(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},d(this,st,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,s){const n=s?.signal;let r;n&&(n.aborted&&this.controller.abort(),r=this.controller.abort.bind(this.controller),n.addEventListener("abort",r));try{d(this,We,"m",nt).call(this);const{response:n,data:r}=await e.create({...t,stream:!0},{...s,signal:this.controller.signal}).withResponse();this._connected(n);for await(const e of r)d(this,We,"m",rt).call(this,e);if(r.controller.signal?.aborted)throw new b;d(this,We,"m",it).call(this)}finally{n&&r&&n.removeEventListener("abort",r)}}_connected(e){this.ended||(u(this,Ye,e),u(this,Ze,e?.headers.get("request-id")),d(this,Xe,"f").call(this,e),this._emit("connect"))}get ended(){return d(this,Ve,"f")}get errored(){return d(this,ze,"f")}get aborted(){return d(this,Ge,"f")}abort(){this.controller.abort()}on(e,t){return(d(this,Ke,"f")[e]||(d(this,Ke,"f")[e]=[])).push({listener:t}),this}off(e,t){const s=d(this,Ke,"f")[e];if(!s)return this;const n=s.findIndex(e=>e.listener===t);return n>=0&&s.splice(n,1),this}once(e,t){return(d(this,Ke,"f")[e]||(d(this,Ke,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{u(this,Qe,!0),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){u(this,Qe,!0),await d(this,Be,"f")}get currentMessage(){return d(this,Ce,"f")}async finalMessage(){return await this.done(),d(this,We,"m",et).call(this)}async finalText(){return await this.done(),d(this,We,"m",tt).call(this)}_emit(e,...t){if(d(this,Ve,"f"))return;"end"===e&&(u(this,Ve,!0),d(this,Fe,"f").call(this));const s=d(this,Ke,"f")[e];if(s&&(d(this,Ke,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){const e=t[0];return d(this,Qe,"f")||s?.length||Promise.reject(e),d(this,He,"f").call(this,e),d(this,Je,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];d(this,Qe,"f")||s?.length||Promise.reject(e),d(this,He,"f").call(this,e),d(this,Je,"f").call(this,e),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",d(this,We,"m",et).call(this))}async _fromReadableStream(e,t){const s=t?.signal;let n;s&&(s.aborted&&this.controller.abort(),n=this.controller.abort.bind(this.controller),s.addEventListener("abort",n));try{d(this,We,"m",nt).call(this),this._connected(null);const t=le.fromReadableStream(e,this.controller);for await(const e of t)d(this,We,"m",rt).call(this,e);if(t.controller.signal?.aborted)throw new b;d(this,We,"m",it).call(this)}finally{s&&n&&s.removeEventListener("abort",n)}}[(Ce=new WeakMap,De=new WeakMap,Xe=new WeakMap,He=new WeakMap,Be=new WeakMap,Fe=new WeakMap,Je=new WeakMap,Ke=new WeakMap,Ve=new WeakMap,ze=new WeakMap,Ge=new WeakMap,Qe=new WeakMap,Ye=new WeakMap,Ze=new WeakMap,st=new WeakMap,We=new WeakSet,et=function(){if(0===this.receivedMessages.length)throw new m("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},tt=function(){if(0===this.receivedMessages.length)throw new m("stream ended without producing a Message with role=assistant");const e=this.receivedMessages.at(-1).content.filter(e=>"text"===e.type).map(e=>e.text);if(0===e.length)throw new m("stream ended without producing a content block with type=text");return e.join(" ")},nt=function(){this.ended||u(this,Ce,void 0)},rt=function(e){if(this.ended)return;const t=d(this,We,"m",ot).call(this,e);switch(this._emit("streamEvent",e,t),e.type){case"content_block_delta":{const s=t.content.at(-1);switch(e.delta.type){case"text_delta":"text"===s.type&&this._emit("text",e.delta.text,s.text||"");break;case"citations_delta":"text"===s.type&&this._emit("citation",e.delta.citation,s.citations??[]);break;case"input_json_delta":ct(s)&&s.input&&this._emit("inputJson",e.delta.partial_json,s.input);break;case"thinking_delta":"thinking"===s.type&&this._emit("thinking",e.delta.thinking,s.thinking);break;case"signature_delta":"thinking"===s.type&&this._emit("signature",s.signature);break;default:e.delta}break}case"message_stop":this._addMessageParam(t),this._addMessage(t,!0);break;case"content_block_stop":this._emit("contentBlock",t.content.at(-1));break;case"message_start":u(this,Ce,t)}},it=function(){if(this.ended)throw new m("stream has ended, this shouldn't happen");const e=d(this,Ce,"f");if(!e)throw new m("request ended without sending any chunks");return u(this,Ce,void 0),e},ot=function(e){let t=d(this,Ce,"f");if("message_start"===e.type){if(t)throw new m(`Unexpected event order, got ${e.type} before receiving "message_stop"`);return e.message}if(!t)throw new m(`Unexpected event order, got ${e.type} before "message_start"`);switch(e.type){case"message_stop":case"content_block_stop":return t;case"message_delta":return t.container=e.delta.container,t.stop_reason=e.delta.stop_reason,t.stop_sequence=e.delta.stop_sequence,t.usage.output_tokens=e.usage.output_tokens,null!=e.usage.input_tokens&&(t.usage.input_tokens=e.usage.input_tokens),null!=e.usage.cache_creation_input_tokens&&(t.usage.cache_creation_input_tokens=e.usage.cache_creation_input_tokens),null!=e.usage.cache_read_input_tokens&&(t.usage.cache_read_input_tokens=e.usage.cache_read_input_tokens),null!=e.usage.server_tool_use&&(t.usage.server_tool_use=e.usage.server_tool_use),t;case"content_block_start":return t.content.push(e.content_block),t;case"content_block_delta":{const n=t.content.at(e.index);switch(e.delta.type){case"text_delta":"text"===n?.type&&(t.content[e.index]={...n,text:(n.text||"")+e.delta.text});break;case"citations_delta":"text"===n?.type&&(t.content[e.index]={...n,citations:[...n.citations??[],e.delta.citation]});break;case"input_json_delta":if(n&&ct(n)){let r=n[at]||"";r+=e.delta.partial_json;const i={...n};if(Object.defineProperty(i,at,{value:r,enumerable:!1,writable:!0}),r)try{i.input=Ne(r)}catch(s){const e=new m(`Unable to parse tool parameter JSON from model. Please retry your request or adjust your prompt. Error: ${s}. JSON: ${r}`);d(this,st,"f").call(this,e)}t.content[e.index]=i}break;case"thinking_delta":"thinking"===n?.type&&(t.content[e.index]={...n,thinking:n.thinking+e.delta.thinking});break;case"signature_delta":"thinking"===n?.type&&(t.content[e.index]={...n,signature:e.delta.signature});break;default:e.delta}return t}}},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("streamEvent",s=>{const n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{s=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{s=!0;for(const s of t)s.reject(e);t.length=0}),this.on("error",e=>{s=!0;for(const s of t)s.reject(e);t.length=0}),{next:async()=>{if(!e.length)return s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new le(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}const ht={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192};let ut=class extends Me{constructor(){super(...arguments),this.batches=new Le(this._client)}create(e,t){const{betas:s,...n}=e;n.model;let r=this._client._options.timeout;if(!n.stream&&null==r){const e=ht[n.model]??void 0;r=this._client.calculateNonstreamingTimeout(n.max_tokens,e)}return this._client.post("/v1/messages?beta=true",{body:n,timeout:r??6e5,...t,headers:Ae([{...null!=s?.toString()?{"anthropic-beta":s?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}stream(e,t){return lt.createMessage(this,e,t)}countTokens(e,t){const{betas:s,...n}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:n,...t,headers:Ae([{"anthropic-beta":[...s??[],"token-counting-2024-11-01"].toString()},t?.headers])})}};ut.Batches=Le;class dt extends Me{constructor(){super(...arguments),this.models=new Ie(this._client),this.messages=new ut(this._client),this.files=new Ee(this._client)}}dt.Models=Ie,dt.Messages=ut,dt.Files=Ee;class pt extends Me{create(e,t){const{betas:s,...n}=e;return this._client.post("/v1/complete",{body:n,timeout:this._client._options.timeout??6e5,...t,headers:Ae([{...null!=s?.toString()?{"anthropic-beta":s?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}}var ft,gt,mt,yt,bt,wt,_t,vt,kt,St,xt,Rt,Mt,Ot,Pt,At,$t,Tt,qt,Et,It,jt;const Lt="__json_buf";function Ut(e){return"tool_use"===e.type||"server_tool_use"===e.type}class Nt{constructor(){ft.add(this),this.messages=[],this.receivedMessages=[],gt.set(this,void 0),this.controller=new AbortController,mt.set(this,void 0),yt.set(this,()=>{}),bt.set(this,()=>{}),wt.set(this,void 0),_t.set(this,()=>{}),vt.set(this,()=>{}),kt.set(this,{}),St.set(this,!1),xt.set(this,!1),Rt.set(this,!1),Mt.set(this,!1),Ot.set(this,void 0),Pt.set(this,void 0),Tt.set(this,e=>{if(u(this,xt,!0),f(e)&&(e=new b),e instanceof b)return u(this,Rt,!0),this._emit("abort",e);if(e instanceof m)return this._emit("error",e);if(e instanceof Error){const t=new m(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new m(String(e)))}),u(this,mt,new Promise((e,t)=>{u(this,yt,e),u(this,bt,t)})),u(this,wt,new Promise((e,t)=>{u(this,_t,e),u(this,vt,t)})),d(this,mt,"f").catch(()=>{}),d(this,wt,"f").catch(()=>{})}get response(){return d(this,Ot,"f")}get request_id(){return d(this,Pt,"f")}async withResponse(){const e=await d(this,mt,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new Nt;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,s){const n=new Nt;for(const r of t.messages)n._addMessageParam(r);return n._run(()=>n._createMessage(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},d(this,Tt,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,s){const n=s?.signal;let r;n&&(n.aborted&&this.controller.abort(),r=this.controller.abort.bind(this.controller),n.addEventListener("abort",r));try{d(this,ft,"m",qt).call(this);const{response:n,data:r}=await e.create({...t,stream:!0},{...s,signal:this.controller.signal}).withResponse();this._connected(n);for await(const e of r)d(this,ft,"m",Et).call(this,e);if(r.controller.signal?.aborted)throw new b;d(this,ft,"m",It).call(this)}finally{n&&r&&n.removeEventListener("abort",r)}}_connected(e){this.ended||(u(this,Ot,e),u(this,Pt,e?.headers.get("request-id")),d(this,yt,"f").call(this,e),this._emit("connect"))}get ended(){return d(this,St,"f")}get errored(){return d(this,xt,"f")}get aborted(){return d(this,Rt,"f")}abort(){this.controller.abort()}on(e,t){return(d(this,kt,"f")[e]||(d(this,kt,"f")[e]=[])).push({listener:t}),this}off(e,t){const s=d(this,kt,"f")[e];if(!s)return this;const n=s.findIndex(e=>e.listener===t);return n>=0&&s.splice(n,1),this}once(e,t){return(d(this,kt,"f")[e]||(d(this,kt,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{u(this,Mt,!0),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){u(this,Mt,!0),await d(this,wt,"f")}get currentMessage(){return d(this,gt,"f")}async finalMessage(){return await this.done(),d(this,ft,"m",At).call(this)}async finalText(){return await this.done(),d(this,ft,"m",$t).call(this)}_emit(e,...t){if(d(this,St,"f"))return;"end"===e&&(u(this,St,!0),d(this,_t,"f").call(this));const s=d(this,kt,"f")[e];if(s&&(d(this,kt,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){const e=t[0];return d(this,Mt,"f")||s?.length||Promise.reject(e),d(this,bt,"f").call(this,e),d(this,vt,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];d(this,Mt,"f")||s?.length||Promise.reject(e),d(this,bt,"f").call(this,e),d(this,vt,"f").call(this,e),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",d(this,ft,"m",At).call(this))}async _fromReadableStream(e,t){const s=t?.signal;let n;s&&(s.aborted&&this.controller.abort(),n=this.controller.abort.bind(this.controller),s.addEventListener("abort",n));try{d(this,ft,"m",qt).call(this),this._connected(null);const t=le.fromReadableStream(e,this.controller);for await(const e of t)d(this,ft,"m",Et).call(this,e);if(t.controller.signal?.aborted)throw new b;d(this,ft,"m",It).call(this)}finally{s&&n&&s.removeEventListener("abort",n)}}[(gt=new WeakMap,mt=new WeakMap,yt=new WeakMap,bt=new WeakMap,wt=new WeakMap,_t=new WeakMap,vt=new WeakMap,kt=new WeakMap,St=new WeakMap,xt=new WeakMap,Rt=new WeakMap,Mt=new WeakMap,Ot=new WeakMap,Pt=new WeakMap,Tt=new WeakMap,ft=new WeakSet,At=function(){if(0===this.receivedMessages.length)throw new m("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},$t=function(){if(0===this.receivedMessages.length)throw new m("stream ended without producing a Message with role=assistant");const e=this.receivedMessages.at(-1).content.filter(e=>"text"===e.type).map(e=>e.text);if(0===e.length)throw new m("stream ended without producing a content block with type=text");return e.join(" ")},qt=function(){this.ended||u(this,gt,void 0)},Et=function(e){if(this.ended)return;const t=d(this,ft,"m",jt).call(this,e);switch(this._emit("streamEvent",e,t),e.type){case"content_block_delta":{const s=t.content.at(-1);switch(e.delta.type){case"text_delta":"text"===s.type&&this._emit("text",e.delta.text,s.text||"");break;case"citations_delta":"text"===s.type&&this._emit("citation",e.delta.citation,s.citations??[]);break;case"input_json_delta":Ut(s)&&s.input&&this._emit("inputJson",e.delta.partial_json,s.input);break;case"thinking_delta":"thinking"===s.type&&this._emit("thinking",e.delta.thinking,s.thinking);break;case"signature_delta":"thinking"===s.type&&this._emit("signature",s.signature);break;default:e.delta}break}case"message_stop":this._addMessageParam(t),this._addMessage(t,!0);break;case"content_block_stop":this._emit("contentBlock",t.content.at(-1));break;case"message_start":u(this,gt,t)}},It=function(){if(this.ended)throw new m("stream has ended, this shouldn't happen");const e=d(this,gt,"f");if(!e)throw new m("request ended without sending any chunks");return u(this,gt,void 0),e},jt=function(e){let t=d(this,gt,"f");if("message_start"===e.type){if(t)throw new m(`Unexpected event order, got ${e.type} before receiving "message_stop"`);return e.message}if(!t)throw new m(`Unexpected event order, got ${e.type} before "message_start"`);switch(e.type){case"message_stop":case"content_block_stop":return t;case"message_delta":return t.stop_reason=e.delta.stop_reason,t.stop_sequence=e.delta.stop_sequence,t.usage.output_tokens=e.usage.output_tokens,null!=e.usage.input_tokens&&(t.usage.input_tokens=e.usage.input_tokens),null!=e.usage.cache_creation_input_tokens&&(t.usage.cache_creation_input_tokens=e.usage.cache_creation_input_tokens),null!=e.usage.cache_read_input_tokens&&(t.usage.cache_read_input_tokens=e.usage.cache_read_input_tokens),null!=e.usage.server_tool_use&&(t.usage.server_tool_use=e.usage.server_tool_use),t;case"content_block_start":return t.content.push({...e.content_block}),t;case"content_block_delta":{const s=t.content.at(e.index);switch(e.delta.type){case"text_delta":"text"===s?.type&&(t.content[e.index]={...s,text:(s.text||"")+e.delta.text});break;case"citations_delta":"text"===s?.type&&(t.content[e.index]={...s,citations:[...s.citations??[],e.delta.citation]});break;case"input_json_delta":if(s&&Ut(s)){let n=s[Lt]||"";n+=e.delta.partial_json;const r={...s};Object.defineProperty(r,Lt,{value:n,enumerable:!1,writable:!0}),n&&(r.input=Ne(n)),t.content[e.index]=r}break;case"thinking_delta":"thinking"===s?.type&&(t.content[e.index]={...s,thinking:s.thinking+e.delta.thinking});break;case"signature_delta":"thinking"===s?.type&&(t.content[e.index]={...s,signature:e.delta.signature});break;default:e.delta}return t}}},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("streamEvent",s=>{const n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{s=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{s=!0;for(const s of t)s.reject(e);t.length=0}),this.on("error",e=>{s=!0;for(const s of t)s.reject(e);t.length=0}),{next:async()=>{if(!e.length)return s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new le(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class Wt extends Me{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(qe`/v1/messages/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/v1/messages/batches",me,{query:e,...t})}delete(e,t){return this._client.delete(qe`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(qe`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){const s=await this.retrieve(e);if(!s.results_url)throw new m(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);return this._client.get(s.results_url,{...t,headers:Ae([{Accept:"application/binary"},t?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((e,t)=>je.fromResponse(t.response,t.controller))}}class Ct extends Me{constructor(){super(...arguments),this.batches=new Wt(this._client)}create(e,t){e.model;let s=this._client._options.timeout;if(!e.stream&&null==s){const t=ht[e.model]??void 0;s=this._client.calculateNonstreamingTimeout(e.max_tokens,t)}return this._client.post("/v1/messages",{body:e,timeout:s??6e5,...t,stream:e.stream??!1})}stream(e,t){return Nt.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}}Ct.Batches=Wt;class Dt extends Me{retrieve(e,t={},s){const{betas:n}=t??{};return this._client.get(qe`/v1/models/${e}`,{...s,headers:Ae([{...null!=n?.toString()?{"anthropic-beta":n?.toString()}:void 0},s?.headers])})}list(e={},t){const{betas:s,...n}=e??{};return this._client.getAPIList("/v1/models",me,{query:n,...t,headers:Ae([{...null!=s?.toString()?{"anthropic-beta":s?.toString()}:void 0},t?.headers])})}}var Xt={};const Ht=e=>void 0!==globalThis.process?Xt?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;var Bt,Ft,Jt,Kt;class Vt{constructor({baseURL:e=Ht("ANTHROPIC_BASE_URL"),apiKey:t=Ht("ANTHROPIC_API_KEY")??null,authToken:s=Ht("ANTHROPIC_AUTH_TOKEN")??null,...n}={}){Bt.add(this),Jt.set(this,void 0);const r={apiKey:t,authToken:s,...n,baseURL:e||"https://api.anthropic.com"};if(!r.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new m("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew Anthropic({ apiKey, dangerouslyAllowBrowser: true });\n");this.baseURL=r.baseURL,this.timeout=r.timeout??Ft.DEFAULT_TIMEOUT,this.logger=r.logger??console;const i="warn";this.logLevel=i,this.logLevel=Z(r.logLevel,"ClientOptions.logLevel",this)??Z(Ht("ANTHROPIC_LOG"),"process.env['ANTHROPIC_LOG']",this)??i,this.fetchOptions=r.fetchOptions,this.maxRetries=r.maxRetries??2,this.fetch=r.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),u(this,Jt,X),this._options=r,this.apiKey=t,this.authToken=s}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(this.apiKey&&e.get("x-api-key")||t.has("x-api-key")||this.authToken&&e.get("authorization")||t.has("authorization")))throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}async authHeaders(e){return Ae([await this.apiKeyAuth(e),await this.bearerAuth(e)])}async apiKeyAuth(e){if(null!=this.apiKey)return Ae([{"X-Api-Key":this.apiKey}])}async bearerAuth(e){if(null!=this.authToken)return Ae([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new m(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${I}`}defaultIdempotencyKey(){return`stainless-node-retry-${p()}`}makeStatusError(e,t,s,n){return y.generate(e,t,s,n)}buildURL(e,t,s){const n=!d(this,Bt,"m",Kt).call(this)&&s||this.baseURL,r=(e=>A.test(e))(e)?new URL(e):new URL(n+(n.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return function(e){if(!e)return!0;for(const t in e)return!1;return!0}(i)||(t={...i,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new m("Streaming is strongly recommended for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#streaming-responses for more details");return 6e5}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new pe(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){const n=await e,r=n.maxRetries??this.maxRetries;null==t&&(t=r),await this.prepareOptions(n);const{req:i,url:o,timeout:a}=await this.buildRequest(n,{retryCount:r-t});await this.prepareRequest(i,{url:o,options:n});const c="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),l=void 0===s?"":`, retryOf: ${s}`,h=Date.now();if(re(this).debug(`[${c}] sending request`,ie({retryOfRequestLogID:s,method:n.method,url:o,options:n,headers:i.headers})),n.signal?.aborted)throw new b;const u=new AbortController,d=await this.fetchWithTimeout(o,i,a,u).catch(g),p=Date.now();if(d instanceof Error){const e=`retrying, ${t} attempts remaining`;if(n.signal?.aborted)throw new b;const r=f(d)||/timed? ?out/i.test(String(d)+("cause"in d?String(d.cause):""));if(t)return re(this).info(`[${c}] connection ${r?"timed out":"failed"} - ${e}`),re(this).debug(`[${c}] connection ${r?"timed out":"failed"} (${e})`,ie({retryOfRequestLogID:s,url:o,durationMs:p-h,message:d.message})),this.retryRequest(n,t,s??c);if(re(this).info(`[${c}] connection ${r?"timed out":"failed"} - error; no more retries left`),re(this).debug(`[${c}] connection ${r?"timed out":"failed"} (error; no more retries left)`,ie({retryOfRequestLogID:s,url:o,durationMs:p-h,message:d.message})),r)throw new _;throw new w({cause:d})}const m=`[${c}${l}${[...d.headers.entries()].filter(([e])=>"request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join("")}] ${i.method} ${o} ${d.ok?"succeeded":"failed"} with status ${d.status} in ${p-h}ms`;if(!d.ok){const e=await this.shouldRetry(d);if(t&&e){const e=`retrying, ${t} attempts remaining`;return await async function(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void(await(e[Symbol.asyncIterator]().return?.()));const t=e.getReader(),s=t.cancel();t.releaseLock(),await s}(d.body),re(this).info(`${m} - ${e}`),re(this).debug(`[${c}] response error (${e})`,ie({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-h})),this.retryRequest(n,t,s??c,d.headers)}const r=e?"error; no more retries left":"error; not retryable";re(this).info(`${m} - ${r}`);const i=await d.text().catch(e=>g(e).message),o=E(i),a=o?void 0:i;re(this).debug(`[${c}] response error (${r})`,ie({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,message:a,durationMs:Date.now()-h}));throw this.makeStatusError(d.status,o,a,d.headers)}return re(this).info(m),re(this).debug(`[${c}] response start`,ie({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-h})),{response:d,options:n,controller:u,requestLogID:c,retryOfRequestLogID:s,startTime:h}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){const s=this.makeRequest(t,null,void 0);return new ge(this,s,e)}async fetchWithTimeout(e,t,s,n){const{signal:r,method:i,...o}=t||{};r&&r.addEventListener("abort",()=>n.abort());const a=setTimeout(()=>n.abort(),s),c=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||"object"==typeof o.body&&null!==o.body&&Symbol.asyncIterator in o.body,l={signal:n.signal,...c?{duplex:"half"}:{},method:"GET",...o};i&&(l.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,l)}finally{clearTimeout(a)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||(409===e.status||(429===e.status||e.status>=500)))}async retryRequest(e,t,s,n){let r;const i=n?.get("retry-after-ms");if(i){const e=parseFloat(i);Number.isNaN(e)||(r=e)}const o=n?.get("retry-after");if(o&&!r){const e=parseFloat(o);r=Number.isNaN(e)?Date.parse(o)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){const s=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,s)}var a;return await(a=r,new Promise(e=>setTimeout(e,a))),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){const s=t-e;return Math.min(.5*Math.pow(2,s),8)*(1-.25*Math.random())*1e3}calculateNonstreamingTimeout(e,t){const s=6e5;if(36e5*e/128e3>s||null!=t&&e>t)throw new m("Streaming is strongly recommended for operations that may token longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details");return s}async buildRequest(e,{retryCount:t=0}={}){const s={...e},{method:n,path:r,query:i,defaultBaseURL:o}=s,a=this.buildURL(r,i,o);"timeout"in s&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new m(`${e} must be an integer`);if(t<0)throw new m(`${e} must be a positive integer`)})("timeout",s.timeout),s.timeout=s.timeout??this.timeout;const{bodyHeaders:c,body:l}=this.buildBody({options:s});return{req:{method:n,headers:await this.buildHeaders({options:e,method:n,bodyHeaders:c,retryCount:t}),...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&l instanceof globalThis.ReadableStream&&{duplex:"half"},...l&&{body:l},...this.fetchOptions??{},...s.fetchOptions??{}},url:a,timeout:s.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:n}){let r={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);const i=Ae([r,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...N??(N=j()),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01"},await this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const s=Ae([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&s.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:C(e)}:d(this,Jt,"f").call(this,{body:e,headers:s})}}Ft=Vt,Jt=new WeakMap,Bt=new WeakSet,Kt=function(){return"https://api.anthropic.com"!==this.baseURL},Vt.Anthropic=Ft,Vt.HUMAN_PROMPT="\n\nHuman:",Vt.AI_PROMPT="\n\nAssistant:",Vt.DEFAULT_TIMEOUT=6e5,Vt.AnthropicError=m,Vt.APIError=y,Vt.APIConnectionError=w,Vt.APIConnectionTimeoutError=_,Vt.APIUserAbortError=b,Vt.NotFoundError=x,Vt.ConflictError=R,Vt.RateLimitError=O,Vt.BadRequestError=v,Vt.AuthenticationError=k,Vt.InternalServerError=P,Vt.PermissionDeniedError=S,Vt.UnprocessableEntityError=M,Vt.toFile=async function(e,t,s){if(ye(),e=await e,t||(t=we(e)),(e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&xe(e))(e))return e instanceof File&&null==t&&null==s?e:be([await e.arrayBuffer()],t??e.name,{type:e.type,lastModified:e.lastModified,...s});if((e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob)(e)){const n=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),be(await Re(n),t,s)}const n=await Re(e);if(!s?.type){const e=n.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(s={...s,type:e})}return be(n,t,s)};class zt extends Vt{constructor(){super(...arguments),this.completions=new pt(this),this.messages=new Ct(this),this.models=new Dt(this),this.beta=new dt(this)}}zt.Completions=pt,zt.Messages=Ct,zt.Models=Dt,zt.Beta=dt;const{HUMAN_PROMPT:Gt,AI_PROMPT:Qt}=zt;export{y as A,zt as a,s as b,l as c,t as d,n as e,r as f,i as g,h as u};
