var y=Object.defineProperty;var p=(s,e,r)=>e in s?y(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r;var c=(s,e,r)=>p(s,typeof e!="symbol"?e+"":e,r);import{g as w,l as i}from"./sendMessage.js";class b{constructor(e,r){c(this,"requestId");c(this,"messageType");c(this,"startTime");c(this,"sender");this.requestId=w(),this.messageType=e,this.startTime=Date.now(),this.sender=r}getDuration(){return Date.now()-this.startTime}getSenderInfo(){return this.sender.tab?`tab-${this.sender.tab.id}`:"extension"}}class g{constructor(){c(this,"handlers",new Map);c(this,"middlewares",[]);c(this,"messageListener")}registerHandler(e,r){this.handlers.set(e,r),i.debug(`Registered handler for ${e}`)}batchRegisterHandler(e,r){for(const t of e)this.registerHandler(t,r)}registerMiddleware(e){this.middlewares.push(e)}handleMessage(e,r,t){const o=this.extractMessageType(e);if(!o)return i.error("Invalid message: no type field",e),t({error:"Invalid message format"}),!1;if(!this.handlers.has(o))return i.debug(`No handler for ${o}, passing to other listeners`),!1;const n=new b(o,r);return this.processMessage(e,r,n).then(a=>{t(a)}).catch(a=>{i.error(`Error handling ${o}:`,a),t({error:a.message})}),!0}async processMessage(e,r,t){const o=this.handlers.get(t.messageType);if(!o)throw new Error(`No handler registered for ${t.messageType}`);return this.executeMiddlewareChain(e,r,t,o)}async executeMiddlewareChain(e,r,t,o){let n=0;const a=async()=>n<this.middlewares.length?this.middlewares[n++].execute(e,r,t,a):o.handle(e,r,t);return a()}extractMessageType(e){if(!e||typeof e!="object")return null;const r=e;return typeof r.type=="string"?r.type:null}getHandlerCount(){return this.handlers.size}getMiddlewareCount(){return this.middlewares.length}attach(){if(this.messageListener){i.warn("MessageBus already attached, skipping");return}this.messageListener=(e,r,t)=>this.handleMessage(e,r,t),chrome.runtime.onMessage.addListener(this.messageListener)}detach(){if(!this.messageListener){i.warn("MessageBus not attached, nothing to detach");return}chrome.runtime.onMessage.removeListener(this.messageListener),this.messageListener=void 0,i.info("MessageBus detached from chrome.runtime.onMessage")}isAttached(){return this.messageListener!==void 0}}class m{async execute(e,r,t,o){i.info(`[${t.requestId}] Handling ${t.messageType} from ${t.getSenderInfo()}`);try{const n=await o();return i.info(`[${t.requestId}] Completed ${t.messageType} in ${t.getDuration()}ms`),n}catch(n){throw i.error(`[${t.requestId}] Error in ${t.messageType}:`,n),n}}}const l=[{id:"continuous-scroll-300",name:"持续滚动测试 (300 次)",description:"Continuously scroll to bottom and top for 300 cycles.",steps:[{type:"browser_action",action:{browser_navigate:{url:"https://www.youtube.com/results?search_query=林俊杰"}}},{type:"session_status",status:"running",sessionTitle:"Continuous Scroll Test - 300 cycles"},...Array.from({length:300},()=>[{type:"browser_action",action:{browser_scroll_down:{to_bottom:!0}}},{type:"browser_action",action:{browser_scroll_up:{to_top:!0}}}]).flat(),{type:"session_status",status:"stopped"}]},{id:"youtube-jj-lin-ongoing",name:"YouTube 林俊杰搜索 (永不结束)",description:"Navigate to YouTube search JJ Lin and stay in running state forever.",steps:[{type:"browser_action",action:{browser_navigate:{url:"https://www.youtube.com/results?search_query=林俊杰"}}},{type:"session_status",status:"running",sessionTitle:"YouTube JJ Lin Search - Ongoing"}]},{id:"duckduckgo-search",name:"DuckDuckGo search",description:"Search for Manus AI on DuckDuckGo using input and press enter.",steps:[{type:"browser_action",action:{browser_navigate:{url:"https://duckduckgo.com/"}}},{type:"session_status",status:"running",sessionTitle:"DuckDuckGo search"},{type:"browser_action",action:{browser_input:{index:3,text:"Manus AI Agent"}}},{type:"browser_action",action:{browser_click:{selector:'button[aria-label="Search"][type="submit"]'}}},{type:"browser_action",action:{browser_scroll_down:{}}},{type:"session_status",status:"stopped"}]},{id:"browser-view-test",name:"Browser View Test",description:"Navigate to YouTube search JJ Lin and stay in running state forever.",steps:[{type:"browser_action",action:{browser_navigate:{url:"https://www.youtube.com/results?search_query=林俊杰"}}},{type:"browser_action",action:{browser_view:{}}},{type:"session_status",status:"running",sessionTitle:"YouTube JJ Lin Search - Ongoing"}]},{id:"google-search",name:"Google search",description:"Search for Manus AI on Google home page, using input and press enter.",steps:[{type:"browser_action",action:{browser_navigate:{url:"https://google.com/"}}},{type:"session_status",status:"running",sessionTitle:"Google Search"},{type:"browser_action",action:{browser_input:{index:6,text:"Manus AI Agent",press_enter:!0}}},{type:"browser_action",action:{browser_press_key:{key:"Enter"}}},{type:"browser_action",action:{browser_scroll_down:{to_bottom:!0}}},{type:"session_status",status:"stopped"}]},{id:"example-follow-link",name:"Follow link on example.com",description:"Click the More Information link on example.com to verify click handling.",steps:[{type:"browser_action",action:{browser_navigate:{url:"https://example.com/"}}},{type:"session_status",status:"running",sessionTitle:"Link following test"},{type:"browser_action",action:{browser_click:{index:1}}},{type:"session_status",status:"stopped"}]},{id:"gmail-inbox-scroll",name:"Gmail inbox scroll",description:"Open Gmail inbox and scroll down one screen.",steps:[{type:"browser_action",action:{browser_navigate:{url:"https://mail.google.com/mail/u/0/#inbox"}}},{type:"session_status",status:"running",sessionTitle:"Gmail scrolling"},{type:"browser_action",action:{browser_scroll_down:{to_bottom:!0}}},{type:"session_status",status:"stopped"}]},{id:"test-takeover",name:"User Takeover Test",description:"Test take_over status handling - AI pauses and user can take control.",steps:[{type:"browser_action",action:{browser_navigate:{url:"https://example.com/"}}},{type:"session_status",status:"running",sessionTitle:"Takeover test"},{type:"browser_action",action:{browser_view:{}}},{type:"session_status",status:"take_over"},{type:"session_status",status:"stopped"}]},{id:"test-error-status",name:"Error Status Test",description:"Test session error status handling.",steps:[{type:"browser_action",action:{browser_navigate:{url:"https://example.com/"}}},{type:"session_status",status:"running",sessionTitle:"Error test"},{type:"browser_action",action:{browser_view:{}}},{type:"session_status",status:"error",error:"Simulated error for testing"}]},{id:"test-session-lifecycle",name:"Session Lifecycle Test",description:"Test complete session lifecycle with status transitions.",steps:[{type:"browser_action",action:{browser_navigate:{url:"https://playwright.dev/"}}},{type:"session_status",status:"running",sessionTitle:"Task - Step 1"},{type:"browser_action",action:{browser_scroll_down:{to_bottom:!0}}},{type:"session_status",status:"running",sessionTitle:"Task - Step 2"},{type:"browser_action",action:{browser_scroll_up:{to_top:!0}}},{type:"session_status",status:"running",sessionTitle:"Task - Step 3"},{type:"browser_action",action:{browser_view:{}}},{type:"session_status",status:"stopped"},{type:"session_status",status:"running",sessionTitle:"Task - Step 4"},{type:"browser_action",action:{browser_scroll_down:{to_bottom:!0}}},{type:"session_status",status:"stopped"}]},{id:"google-search-scroll",name:"Google Search Scroll Test",description:"Navigate to Google search and test scroll to bottom and top.",steps:[{type:"browser_action",action:{browser_navigate:{url:"https://www.google.com/search?q=she"}}},{type:"session_status",status:"running",sessionTitle:"Google search scroll test"},{type:"browser_action",action:{browser_scroll_down:{to_bottom:!0}}},{type:"browser_action",action:{browser_scroll_up:{to_top:!0}}},{type:"session_status",status:"stopped"}]},{id:"google-search-scroll-pixels",name:"Google Search Scroll",description:"Navigate to Google search and test scrolling by viewport height.",steps:[{type:"browser_action",action:{browser_navigate:{url:"https://www.google.com/search?q=she"}}},{type:"session_status",status:"running",sessionTitle:"Google search scroll test"},{type:"browser_action",action:{browser_scroll_down:{}}},{type:"browser_action",action:{browser_scroll_down:{}}},{type:"browser_action",action:{browser_scroll_up:{}}},{type:"session_status",status:"stopped"}]},{id:"baidu-search-and-scroll",name:"Baidu Search and Scroll",description:"Navigate to Baidu search results for 人工智能",steps:[{type:"browser_action",action:{browser_navigate:{url:"https://www.baidu.com/s?wd=%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD"}}},{type:"session_status",status:"running",sessionTitle:"Baidu Search and Scroll"},{type:"browser_action",action:{browser_scroll_down:{}}},{type:"browser_action",action:{browser_scroll_down:{to_bottom:!0}}},{type:"browser_action",action:{browser_scroll_up:{}}},{type:"browser_action",action:{browser_scroll_up:{to_top:!0}}},{type:"session_status",status:"stopped"}]},{id:"youtube-search-jj-lin",name:"YouTube Scroll",description:"Navigate to YouTube search results for 林俊杰 and test full scroll cycle: down to bottom, scroll up, then to top.",steps:[{type:"browser_action",action:{browser_navigate:{url:"https://www.youtube.com/results?search_query=%E6%9E%97%E4%BF%8A%E6%9D%B0"}}},{type:"session_status",status:"running",sessionTitle:"YouTube Scroll Test"},{type:"browser_action",action:{browser_scroll_down:{to_bottom:!0}}},{type:"browser_action",action:{browser_scroll_up:{}}},{type:"browser_action",action:{browser_scroll_up:{to_top:!0}}},{type:"session_status",status:"stopped"}]},{id:"youtube-scroll-pagekey",name:"YouTube News Scroll by Page Up/Down",description:"Youtube News Channel Page Down and Page Up keys scrolling.",steps:[{type:"browser_action",action:{browser_navigate:{url:"https://www.youtube.com/channel/UCYfdidRxbB8Qhf0Nx7ioOYw,"}}},{type:"session_status",status:"running",sessionTitle:"YouTube Page Up/Down Test"},{type:"browser_action",action:{browser_press_key:{key:"PageDown"}}},{type:"browser_action",action:{browser_press_key:{key:"PageDown"}}},{type:"browser_action",action:{browser_press_key:{key:"PageDown"}}},{type:"browser_action",action:{browser_press_key:{key:"PageUp"}}},{type:"browser_action",action:{browser_press_key:{key:"PageUp"}}},{type:"session_status",status:"stopped"}]},{id:"playground-click-test",name:"Local Playground Click Test",description:"Navigate to playground click-playground page and click all 6 buttons sequentially at their center points (viewport coordinates).",steps:[{type:"browser_action",action:{browser_navigate:{url:"http://localhost:5173/click-playground"}}},{type:"session_status",status:"running",sessionTitle:"Click playground test"},{type:"browser_action",action:{browser_click:{coordinate_x:140,coordinate_y:188}}},{type:"browser_action",action:{browser_click:{coordinate_x:140,coordinate_y:288}}},{type:"browser_action",action:{browser_click:{coordinate_x:140,coordinate_y:388}}},{type:"browser_action",action:{browser_click:{coordinate_x:290,coordinate_y:188}}},{type:"browser_action",action:{browser_click:{coordinate_x:290,coordinate_y:288}}},{type:"browser_action",action:{browser_click:{coordinate_x:290,coordinate_y:388}}},{type:"session_status",status:"stopped"}]},{id:"full-keyboard-test",name:"完整键盘测试",description:"Test all keyboard keys sequentially on keyboard tester website.",steps:[{type:"browser_action",action:{browser_navigate:{url:"https://www.zfrontier.com/lab/keyboardTester"}}},{type:"session_status",status:"running",sessionTitle:"Full Keyboard Test"},{type:"browser_action",action:{browser_press_key:{key:"Escape"}}},{type:"browser_action",action:{browser_press_key:{key:"F1"}}},{type:"browser_action",action:{browser_press_key:{key:"F2"}}},{type:"browser_action",action:{browser_press_key:{key:"F3"}}},{type:"browser_action",action:{browser_press_key:{key:"F4"}}},{type:"browser_action",action:{browser_press_key:{key:"F5"}}},{type:"browser_action",action:{browser_press_key:{key:"F6"}}},{type:"browser_action",action:{browser_press_key:{key:"F7"}}},{type:"browser_action",action:{browser_press_key:{key:"F8"}}},{type:"browser_action",action:{browser_press_key:{key:"F9"}}},{type:"browser_action",action:{browser_press_key:{key:"F10"}}},{type:"browser_action",action:{browser_press_key:{key:"F11"}}},{type:"browser_action",action:{browser_press_key:{key:"F12"}}},{type:"browser_action",action:{browser_press_key:{key:"`"}}},{type:"browser_action",action:{browser_press_key:{key:"1"}}},{type:"browser_action",action:{browser_press_key:{key:"2"}}},{type:"browser_action",action:{browser_press_key:{key:"3"}}},{type:"browser_action",action:{browser_press_key:{key:"4"}}},{type:"browser_action",action:{browser_press_key:{key:"5"}}},{type:"browser_action",action:{browser_press_key:{key:"6"}}},{type:"browser_action",action:{browser_press_key:{key:"7"}}},{type:"browser_action",action:{browser_press_key:{key:"8"}}},{type:"browser_action",action:{browser_press_key:{key:"9"}}},{type:"browser_action",action:{browser_press_key:{key:"0"}}},{type:"browser_action",action:{browser_press_key:{key:"-"}}},{type:"browser_action",action:{browser_press_key:{key:"="}}},{type:"browser_action",action:{browser_press_key:{key:"Backspace"}}},{type:"browser_action",action:{browser_press_key:{key:"Tab"}}},{type:"browser_action",action:{browser_press_key:{key:"Q"}}},{type:"browser_action",action:{browser_press_key:{key:"W"}}},{type:"browser_action",action:{browser_press_key:{key:"E"}}},{type:"browser_action",action:{browser_press_key:{key:"R"}}},{type:"browser_action",action:{browser_press_key:{key:"T"}}},{type:"browser_action",action:{browser_press_key:{key:"Y"}}},{type:"browser_action",action:{browser_press_key:{key:"U"}}},{type:"browser_action",action:{browser_press_key:{key:"I"}}},{type:"browser_action",action:{browser_press_key:{key:"O"}}},{type:"browser_action",action:{browser_press_key:{key:"P"}}},{type:"browser_action",action:{browser_press_key:{key:"["}}},{type:"browser_action",action:{browser_press_key:{key:"]"}}},{type:"browser_action",action:{browser_press_key:{key:"\\"}}},{type:"browser_action",action:{browser_press_key:{key:"CapsLock"}}},{type:"browser_action",action:{browser_press_key:{key:"A"}}},{type:"browser_action",action:{browser_press_key:{key:"S"}}},{type:"browser_action",action:{browser_press_key:{key:"D"}}},{type:"browser_action",action:{browser_press_key:{key:"F"}}},{type:"browser_action",action:{browser_press_key:{key:"G"}}},{type:"browser_action",action:{browser_press_key:{key:"H"}}},{type:"browser_action",action:{browser_press_key:{key:"J"}}},{type:"browser_action",action:{browser_press_key:{key:"K"}}},{type:"browser_action",action:{browser_press_key:{key:"L"}}},{type:"browser_action",action:{browser_press_key:{key:";"}}},{type:"browser_action",action:{browser_press_key:{key:"'"}}},{type:"browser_action",action:{browser_press_key:{key:"Enter"}}},{type:"browser_action",action:{browser_press_key:{key:"Z"}}},{type:"browser_action",action:{browser_press_key:{key:"X"}}},{type:"browser_action",action:{browser_press_key:{key:"C"}}},{type:"browser_action",action:{browser_press_key:{key:"V"}}},{type:"browser_action",action:{browser_press_key:{key:"B"}}},{type:"browser_action",action:{browser_press_key:{key:"N"}}},{type:"browser_action",action:{browser_press_key:{key:"M"}}},{type:"browser_action",action:{browser_press_key:{key:","}}},{type:"browser_action",action:{browser_press_key:{key:"."}}},{type:"browser_action",action:{browser_press_key:{key:"/"}}},{type:"browser_action",action:{browser_press_key:{key:"Shift"}}},{type:"browser_action",action:{browser_press_key:{key:"Control"}}},{type:"browser_action",action:{browser_press_key:{key:"Alt"}}},{type:"browser_action",action:{browser_press_key:{key:"Meta"}}},{type:"browser_action",action:{browser_press_key:{key:" "}}},{type:"browser_action",action:{browser_press_key:{key:"Insert"}}},{type:"browser_action",action:{browser_press_key:{key:"Home"}}},{type:"browser_action",action:{browser_press_key:{key:"PageUp"}}},{type:"browser_action",action:{browser_press_key:{key:"Delete"}}},{type:"browser_action",action:{browser_press_key:{key:"End"}}},{type:"browser_action",action:{browser_press_key:{key:"PageDown"}}},{type:"browser_action",action:{browser_press_key:{key:"ArrowUp"}}},{type:"browser_action",action:{browser_press_key:{key:"ArrowDown"}}},{type:"browser_action",action:{browser_press_key:{key:"ArrowLeft"}}},{type:"browser_action",action:{browser_press_key:{key:"ArrowRight"}}},{type:"browser_action",action:{browser_press_key:{key:"Numpad0"}}},{type:"browser_action",action:{browser_press_key:{key:"Numpad1"}}},{type:"browser_action",action:{browser_press_key:{key:"Numpad2"}}},{type:"browser_action",action:{browser_press_key:{key:"Numpad3"}}},{type:"browser_action",action:{browser_press_key:{key:"Numpad4"}}},{type:"browser_action",action:{browser_press_key:{key:"Numpad5"}}},{type:"browser_action",action:{browser_press_key:{key:"Numpad6"}}},{type:"browser_action",action:{browser_press_key:{key:"Numpad7"}}},{type:"browser_action",action:{browser_press_key:{key:"Numpad8"}}},{type:"browser_action",action:{browser_press_key:{key:"Numpad9"}}},{type:"browser_action",action:{browser_press_key:{key:"NumpadDivide"}}},{type:"browser_action",action:{browser_press_key:{key:"NumpadMultiply"}}},{type:"browser_action",action:{browser_press_key:{key:"NumpadSubtract"}}},{type:"browser_action",action:{browser_press_key:{key:"NumpadAdd"}}},{type:"browser_action",action:{browser_press_key:{key:"NumpadDecimal"}}},{type:"browser_action",action:{browser_press_key:{key:"NumpadEnter"}}},{type:"session_status",status:"stopped"}]},{id:"key-combinations-test",name:"组合键测试",description:"Test various key combinations including Command+End, Control+A, Shift+End, etc.",steps:[{type:"browser_action",action:{browser_navigate:{url:"https://www.zfrontier.com/lab/keyboardTester"}}},{type:"session_status",status:"running",sessionTitle:"Key Combinations Test"},{type:"browser_action",action:{browser_press_key:{key:"Command+End"}}},{type:"browser_action",action:{browser_press_key:{key:"Command+Home"}}},{type:"browser_action",action:{browser_press_key:{key:"Shift+End"}}},{type:"browser_action",action:{browser_press_key:{key:"Shift+ArrowLeft"}}},{type:"browser_action",action:{browser_press_key:{key:"Shift+ArrowRight"}}},{type:"browser_action",action:{browser_press_key:{key:"Control+Shift+A"}}},{type:"browser_action",action:{browser_press_key:{key:"Cmd+A"}}},{type:"browser_action",action:{browser_press_key:{key:"Ctrl+C"}}},{type:"browser_action",action:{browser_press_key:{key:"Alt+ArrowLeft"}}},{type:"browser_action",action:{browser_press_key:{key:"F1"}}},{type:"browser_action",action:{browser_press_key:{key:"F5"}}},{type:"browser_action",action:{browser_press_key:{key:"Control+F5"}}},{type:"browser_action",action:{browser_press_key:{key:"Meta+F1"}}},{type:"browser_action",action:{browser_press_key:{key:"Shift+F10"}}},{type:"browser_action",action:{browser_press_key:{key:"Alt+F4"}}},{type:"browser_action",action:{browser_press_key:{key:"Control+F12"}}},{type:"browser_action",action:{browser_press_key:{key:"Enter"}}},{type:"browser_action",action:{browser_press_key:{key:"Escape"}}},{type:"browser_action",action:{browser_press_key:{key:"ArrowDown"}}},{type:"session_status",status:"stopped"}]}];function h(s){return l.find(e=>e.id===s)}function f(s){if(s.browser_navigate){if(!s.browser_navigate.url)throw new Error("browser_navigate missing url");return{type:"browser_navigate",url:s.browser_navigate.url}}if(s.browser_click){const{index:e,coordinate_x:r,coordinate_y:t,selector:o}=s.browser_click;return{type:"browser_click",target:_(e,r,t,o)}}if(s.browser_input){const{index:e,coordinate_x:r,coordinate_y:t,text:o,press_enter:n}=s.browser_input;return{type:"browser_input",target:_(e,r,t),text:o,pressEnter:!!n}}if(s.browser_press_key)return{type:"browser_press_key",key:s.browser_press_key.key};if(s.browser_scroll_up)return{type:"browser_scroll",direction:"up",toExtreme:!!s.browser_scroll_up.to_top};if(s.browser_scroll_down)return{type:"browser_scroll",direction:"down",toExtreme:!!s.browser_scroll_down.to_bottom};if(s.browser_scroll_left)return{type:"browser_scroll",direction:"left",toExtreme:!!s.browser_scroll_left.to_end};if(s.browser_scroll_right)return{type:"browser_scroll",direction:"right",toExtreme:!!s.browser_scroll_right.to_end};if(s.browser_find_keyword)return{type:"browser_find_keyword",keyword:s.browser_find_keyword.keyword};if(s.browser_view)return{type:"browser_view"};throw i.error("Received unsupported browser action",{wrapper:s}),new Error("Unsupported browser action in payload")}function _(s,e,r,t){if(t)return{strategy:"bySelector",selector:t};if(typeof s=="number"&&Number.isFinite(s))return{strategy:"byIndex",index:s};if(typeof e=="number"&&typeof r=="number")return{strategy:"byCoordinates",x:e,y:r};throw new Error("Action target missing index or coordinates")}function T(s){return s!=null&&s.elements?s.elements.slice(0,500).map(e=>`${e.index}[:]{${e.description}}`).join(`
`):""}export{m as L,g as M,h as a,f as c,T as f,l as t};
