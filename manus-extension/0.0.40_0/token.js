import{l as i}from"./sendMessage.js";var g=(e=>(e.Local="local",e.Session="session",e.Sync="sync",e))(g||{}),N=(e=>(e.ExtensionPagesOnly="TRUSTED_CONTEXTS",e.ExtensionPagesAndContentScripts="TRUSTED_AND_UNTRUSTED_CONTEXTS",e))(N||{});const r=globalThis.chrome;async function T(e,n){function s(a){return typeof a=="function"}return s(e)?await e(n):e}let _=!1;function C(e){if(r&&r.storage[e]===void 0)throw new Error(`Check your storage permission in manifest.json: ${e} is not defined`)}function w(e,n,s){var m,f;let a=null,b=!1,c=[];const l=(s==null?void 0:s.storageEnum)??g.Local,R=(s==null?void 0:s.liveUpdate)??!1,A=((m=s==null?void 0:s.serialization)==null?void 0:m.serialize)??(t=>t),v=((f=s==null?void 0:s.serialization)==null?void 0:f.deserialize)??(t=>t);_===!1&&l===g.Session&&(s==null?void 0:s.sessionAccessForContentScripts)===!0&&(C(l),r==null||r.storage[l].setAccessLevel({accessLevel:N.ExtensionPagesAndContentScripts}).catch(t=>{console.warn(t),console.warn("Please call setAccessLevel in background context")}),_=!0);const E=()=>{c.forEach(t=>{t()})},p=async()=>{C(l);const t=await(r==null?void 0:r.storage[l].get([e]));if(!t)return i.debug(`[Storage:${e}] get: no value, returning fallback`),n;const o=v(t[e])??n;return i.debug(`[Storage:${e}] get: value retrieved`,{value:o}),o},D=async t=>{b||(a=await p());const o=a;a=await T(t,a),i.info(`[Storage:${e}] set: updating value`,{old:o,new:a}),await(r==null?void 0:r.storage[l].set({[e]:A(a)})),E(),i.debug(`[Storage:${e}] set: ${c.length} listeners notified`)},L=t=>(c=[...c,t],()=>{c=c.filter(o=>o!==t)}),M=()=>a;p().then(t=>{b||(a=t,b=!0,i.info(`[Storage:${e}] initialized`,{value:a}),E())});async function U(t){if(t[e]===void 0)return;const o=v(t[e].newValue);if(a===o){i.debug(`[Storage:${e}] onChanged: same value, skipping`);return}const F=a;a=await T(o,a),i.info(`[Storage:${e}] onChanged: synced from other context`,{old:F,new:a}),E(),i.debug(`[Storage:${e}] onChanged: ${c.length} listeners notified`)}return R&&(r==null||r.storage[l].onChanged.addListener(U),i.debug(`[Storage:${e}] liveUpdate enabled, listening for cross-context changes`)),{get:p,set:D,getSnapshot:M,subscribe:L}}function W(){return chrome.runtime.getManifest().version}function I(){var n;return(n=chrome.runtime.getManifest().custom_meta)==null?void 0:n.buildTime}const x=["Swift","Bright","Quick","Smart","Cosmic","Quantum","Radiant","Nova","Stellar","Aurora","Turbo","Lightning","Mighty","Noble","Mystic","Crimson","Silver","Golden","Thunder","Crystal"],B=["Fox","Eagle","Falcon","Phoenix","Dragon","Voyager","Explorer","Navigator","Ranger","Seeker","Hawk","Wolf","Tiger","Panther","Comet","Meteor","Titan","Shadow","Spirit","Hunter"],$=()=>{const e=x[Math.floor(Math.random()*x.length)],n=B[Math.floor(Math.random()*B.length)];return`${e}-${n}`},h={browserName:$(),allowCrossBrowser:!1,skipAuthorization:!1},z="manus_extension_browser_settings",u=w(z,h,{storageEnum:g.Local,liveUpdate:!0}),K={...u,getBrowserSettings(){return u.getSnapshot()??h},async setBrowserSettings(e){await u.set(e)},async updateBrowserSettings(e){const n=u.getSnapshot()??h;await u.set({...n,...e})},subscribeBrowserSettings(e){return u.subscribe(()=>{const n=u.getSnapshot()??h;e(n)})}},O="manus_extension_dev_branch",S=w(O,null,{storageEnum:g.Local,liveUpdate:!0}),V={...S,getDevBranch(){return S.getSnapshot()},async setDevBranch(e){await S.set(e)},subscribeDevBranch(e){return S.subscribe(()=>{const n=S.getSnapshot();e(n)})}},P="manus_extension_token",d=w(P,null,{storageEnum:g.Local,liveUpdate:!0}),X={...d,getToken(){return d.getSnapshot()},async setToken(e){await d.set(e)},subscribeToken(e){return d.subscribe(()=>{const n=d.getSnapshot();e(n)})}};export{h as D,I as a,K as b,V as d,W as g,X as t};
