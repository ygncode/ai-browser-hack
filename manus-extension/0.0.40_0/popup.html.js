import{c as p,j as e,E,r as n,a as D}from"./eye.js";import{e as _}from"./typeGuards.js";import{e as B,s as y,l as g}from"./sendMessage.js";import{g as L}from"./chromeAsync.js";import{g as P,a as z,t as w,d as N}from"./token.js";/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],$=p("circle-x",F);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],q=p("file-text",A);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],U=p("message-circle",H);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],V=p("settings",R);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],W=p("shield",O);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Z=p("square-pen",X);function G({onSelect:s,active:m=!1,footer:t,sessionId:i}){const o=[{key:"start-new-task",label:"Start new task",icon:e.jsx(Z,{className:"w-4 h-4"}),variant:"default",show:!m},{key:"visit",label:"Visit Task",icon:e.jsx(E,{className:"w-4 h-4"}),variant:"default",show:!!i},{key:"revoke",label:"Revoke authorization",icon:e.jsx($,{className:"w-4 h-4"}),variant:"danger",show:m},{key:"settings",label:"Settings",icon:e.jsx(V,{className:"w-4 h-4"}),variant:"default",show:!0},{key:"security",label:"View security guidelines",icon:e.jsx(W,{className:"w-4 h-4"}),variant:"default",show:!0},{key:"tutorial",label:"Tutorial",icon:e.jsx(q,{className:"w-4 h-4"}),variant:"default",show:!0},{key:"feedback",label:"Feedback",icon:e.jsx(U,{className:"w-4 h-4"}),variant:"default",show:!0}],l=r=>{s==null||s(r)},h=o.filter(r=>r.show),f=h.reduce((r,u,x)=>u.key==="start-new-task"||u.key==="revoke"||u.key==="visit"?x:r,-1);return e.jsxs("div",{className:"w-[250px] bg-[var(--background-menu-white)] py-1","data-name":"Popup Menu",children:[h.map((r,u)=>{const x=u===f,v=r.variant==="danger"?"text-[var(--function-error)]":"text-[var(--icon-primary)]",d=r.variant==="danger"?"text-[var(--function-error)]":"text-[var(--text-primary)]";return e.jsxs("div",{children:[e.jsx("div",{className:"px-1","data-name":"Menu Item",children:e.jsxs("button",{type:"button",onClick:()=>l(r.key),className:"clickable flex w-full items-center gap-1 rounded-lg p-2 transition-colors hover:bg-[var(--fill-tsp-white-light)] active:bg-[var(--fill-tsp-white-dark)]","data-name":"Container",children:[e.jsx("div",{className:"flex items-center justify-center w-5 h-5 shrink-0","data-name":"lead-icon",children:e.jsx("div",{className:`h-4 w-4 ${v}`,"data-name":"icon",children:r.icon})}),e.jsx("div",{className:"flex-1 flex items-center px-1","data-name":"label",children:e.jsx("p",{className:`whitespace-nowrap text-sm font-normal tracking-[-0.154px] ${d}`,children:r.label})})]})}),x&&e.jsx("div",{className:"px-3 py-1","data-name":"Divider",children:e.jsx("div",{className:"h-px bg-[var(--border-main)]"})})]},r.key)}),t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-1","data-name":"Footer Divider",children:e.jsx("div",{className:"h-px bg-[var(--border-main)]"})}),t.content]})]})}function J(){const[s,m]=n.useState(()=>typeof window>"u"||typeof window.matchMedia!="function"?!1:window.matchMedia("(prefers-color-scheme: dark)").matches);return n.useEffect(()=>{if(typeof window>"u"||typeof window.matchMedia!="function")return;const t=window.matchMedia("(prefers-color-scheme: dark)"),i=l=>{m(h=>h===l?h:l)};i(t.matches);const o=l=>{i(l.matches)};return typeof t.addEventListener=="function"?(t.addEventListener("change",o),()=>t.removeEventListener("change",o)):(t.addListener(o),()=>t.removeListener(o))},[]),n.useEffect(()=>{if(typeof document>"u")return;const t=document.documentElement,i=t.style.colorScheme,o=document.body.style.backgroundColor;return t.classList.toggle("dark",s),t.style.colorScheme=s?"dark":"light",document.body.style.backgroundColor="var(--background-white-main)",()=>{t.classList.remove("dark"),i?t.style.colorScheme=i:t.style.removeProperty("color-scheme"),o?document.body.style.backgroundColor=o:document.body.style.removeProperty("background-color")}},[s]),s}function K(){J();const[s,m]=n.useState(null),[t,i]=n.useState(null),[o,l]=n.useState(null),[h,f]=n.useState(""),[r,u]=n.useState(null),[x,v]=n.useState(null),d=n.useMemo(()=>B.getEnvParams(),[]);n.useEffect(()=>{const c=P(),a=z();m({version:c,buildTime:a})},[]),n.useEffect(()=>{(async()=>{const a=await L();f(a);const b=w.getToken(),k=N.getDevBranch();u(b),v(k);const I=w.subscribeToken(u),T=N.subscribeDevBranch(v);return()=>{I(),T()}})()},[]),n.useEffect(()=>{const c=(a,b,k)=>{_(a)&&a.type==="popup/tab-status-update"&&(a.sessionMeta?(i(a.sessionMeta.sessionId),l(a.sessionMeta.status)):(i(null),l(null)))};return chrome.runtime.onMessage.addListener(c),y({source:"popup",type:"popup/get-tab-status"}).catch(a=>{g.error("Failed to get tab status",a)}),()=>{chrome.runtime.onMessage.removeListener(c)}},[]);const M=()=>{chrome.tabs.query({active:!0,currentWindow:!0},c=>{var a;(a=c[0])!=null&&a.id&&c[0].windowId&&chrome.sidePanel.open({windowId:c[0].windowId})})},S=c=>{switch(c){case"start-new-task":chrome.tabs.create({url:d.startTaskUrl}),window.close();break;case"visit":chrome.tabs.create({url:`${d.appUrl}/${t}`});break;case"revoke":t&&y({source:"popup",type:"extension/unauthorize-task",sessionId:t}).catch(a=>{g.error("Failed to unauthorize task",a)});break;case"settings":chrome.tabs.create({url:d.settingsUrl});break;case"security":chrome.tabs.create({url:d.securityUrl});break;case"tutorial":chrome.tabs.create({url:d.tutorialUrl});break;case"feedback":chrome.tabs.create({url:d.feedbackUrl});break}},C=()=>{if(d.env!=="prod")return{content:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 pt-2 pb-1","data-name":"Footer Annotation",children:[e.jsx("p",{className:"text-[10px] text-[var(--text-tertiary)] italic text-center",children:"This section and sidebar only in Dev version for debugging"}),e.jsx("p",{className:"text-[10px] text-[var(--text-tertiary)] italic text-center",children:"此处和侧边栏只在测试版本展示，debug 用"})]}),e.jsxs("div",{className:"px-3 pb-2 space-y-2","data-name":"Footer",children:[e.jsxs("div",{className:"flex flex-col gap-0.5 items-center",children:[e.jsxs("p",{className:"text-xs font-medium text-[var(--text-secondary)]",children:["version ",(s==null?void 0:s.version)||"0.0.0"]}),e.jsxs("p",{className:"text-[10px] text-[var(--text-tertiary)]",children:["built at ",(s==null?void 0:s.buildTime)||"N/A"]})]}),e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsxs("p",{className:"text-[10px] text-[var(--text-secondary)] break-all",children:[e.jsx("span",{className:"font-semibold",children:"ClientId:"})," ",h||"Loading..."]}),e.jsxs("p",{className:"text-[10px] text-[var(--text-secondary)] break-all",children:[e.jsx("span",{className:"font-semibold",children:"Token:"})," ",r?`${r.substring(0,20)}...`:"Not logged in"]}),e.jsxs("p",{className:"text-[10px] text-[var(--text-secondary)] break-all",children:[e.jsx("span",{className:"font-semibold",children:"DevBranch:"})," ",x||"None"]})]}),e.jsx("button",{type:"button",onClick:M,className:"clickable w-full rounded-lg border border-[var(--border-light)] bg-[var(--fill-tsp-white-light)] px-3 py-1 text-xs font-medium text-[var(--text-primary)] transition-colors hover:bg-[var(--fill-tsp-white-main)] active:bg-[var(--fill-tsp-white-dark)]",children:"Open Side Panel"})]})]})}};return e.jsx(G,{active:o==="running",sessionId:t??void 0,onSelect:S,footer:C()})}const j=document.getElementById("root");j&&D(j).render(e.jsx(K,{}));
