import{e as n,l as a,s as o}from"./sendMessage.js";import{i as d}from"./manus.js";const g="manus-app";window.addEventListener("message",async s=>{var i,t;if(s.source!==window)return;if(!d(s.origin)){const e=n.getEnvParams();a.debug("Manus App Bridge rejected message from unexpected origin",{receivedOrigin:s.origin,expectedOrigin:e.webAppDomain,env:e.env});return}const r=s.data;if(!(!r||r.source!==g)){a.debug("Manus App Bridge received message from page",{type:r.type,requestId:r.requestId});try{const e=await o(r);a.debug("Manus App Bridge received response from background",{requestId:r.requestId,ok:e==null?void 0:e.ok,clientId:(i=e==null?void 0:e.data)==null?void 0:i.clientId,browserSettings:(t=e==null?void 0:e.data)==null?void 0:t.browserSettings,fullResponse:e}),window.postMessage(e,"*")}catch(e){a.error("Manus App Bridge failed to send message",{error:e instanceof Error?e.message:String(e),requestId:r.requestId}),window.postMessage({source:"my-browser",ok:!1,requestId:r.requestId,error:e instanceof Error?e.message:"Failed to communicate with extension"},"*")}}});
